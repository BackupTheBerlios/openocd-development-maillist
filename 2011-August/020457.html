<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] Last call before release / Olimex ARM-JTAG-EW patches
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2011-August/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Last%20call%20before%20release%20/%20Olimex%0A%20ARM-JTAG-EW%20patches&In-Reply-To=%3C4E38F8D3.8080004%40gmx.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020456.html">
   <LINK REL="Next"  HREF="020458.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] Last call before release / Olimex ARM-JTAG-EW patches</H1>
    <B>Simon Barner</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Last%20call%20before%20release%20/%20Olimex%0A%20ARM-JTAG-EW%20patches&In-Reply-To=%3C4E38F8D3.8080004%40gmx.de%3E"
       TITLE="[Openocd-development] Last call before release / Olimex ARM-JTAG-EW patches">barner at gmx.de
       </A><BR>
    <I>Wed Aug  3 09:29:23 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="020456.html">[Openocd-development] Last call before release
</A></li>
        <LI>Next message: <A HREF="020458.html">[Openocd-development] Last call before release / Olimex ARM-JTAG-EW patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20457">[ date ]</a>
              <a href="thread.html#20457">[ thread ]</a>
              <a href="subject.html#20457">[ subject ]</a>
              <a href="author.html#20457">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Jean-Christophe,

&gt;&gt;<i> 	I'm going to create the 0.5.0 release
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 	If any patch are still pending ping the patch or send a e-mail with a
</I>&gt;&gt;<i> 	link to it
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 	as announce before I've delay the release a little as we have the linux kerne
</I>&gt;&gt;<i> 	merge windows this days
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 	if nothing new I'll relase it tomorrow morning China time
</I>&gt;<i> 
</I>&gt;<i> Only yesterday I was able to fix the issues with my Olimex ARM-JTAG-EW
</I>&gt;<i> as described in tickets #34 and #35.
</I>&gt;<i> 
</I>&gt;<i> I will clean up my (non-intrusive) patches, and send them to you within
</I>&gt;<i> the next hours. I would really appreciate to get them into 0.5.0 since
</I>&gt;<i> we are using this interface in a production environment.
</I>
As announced before, here are two patches that address the above tickets:

#34: 0001-JTAG-speed.patch

There where two distinct problems: The message length for &quot;set speed&quot;
messages is 5, not 4. This part of the patch fixes the usb_bulk_read
failures reported in the ticket.

Additionally, the device expects the speed in Hz, not kHz. I figured
this out be sniffing the USB traffic generated by IAR EWARM (using
Olimex' JLINK emulation driver). Since the default speed in the target
configuration file is 1000 kHz, this resulted in an effective speed of
1 kHz. This was probably the reason for the additional errors (JTAG
chain timeout (?), as in private email from Dimitar Dimitrov, the
original author of the driver and a former Olimex employee).

The patch also contains further minor improvements (see commit log).

#35: 0002-gdb.patch

As it turned out, this bug was only triggered when OpenOCD was compiled
with verbose logging (including USB and JTAG communcation). This can be
addressed by adding a keep_alive() call in the most expensive logging
function. Please note that this code is not compiled in release mode, so
this does not degrade the default performance.

Speaking of performance: Flashing now works with ~10 kBytes / s @ 1MHz
JTAG speed. I am not sure if this is great, but it is much better than
before (when the &quot;set speed&quot; command) was a NO-OP).

I also have some more findings from my analysis the USB traffic of the
IAR EWARM traffic, but I will discuss this at later point in with
Dimitar before since I am not sure what those commands are acutually doing.

Please let me know if you need more feedback. I would really appreciate
to get these fixes into 0.5.0.

Btw. If the are some testers who also own this interface, just let me
know and I can provide you with a build that includes my patches.

Best regards,
 Simon
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0001-JTAG-speed.patch
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/openocd-development/attachments/20110803/7209b110/attachment.ksh">https://lists.berlios.de/pipermail/openocd-development/attachments/20110803/7209b110/attachment.ksh</A>&gt;
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0002-gdb.patch
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/openocd-development/attachments/20110803/7209b110/attachment-0001.ksh">https://lists.berlios.de/pipermail/openocd-development/attachments/20110803/7209b110/attachment-0001.ksh</A>&gt;
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0001-JTAG-speed.log
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/openocd-development/attachments/20110803/7209b110/attachment-0002.ksh">https://lists.berlios.de/pipermail/openocd-development/attachments/20110803/7209b110/attachment-0002.ksh</A>&gt;
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: 0002-gdb.log
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/openocd-development/attachments/20110803/7209b110/attachment-0003.ksh">https://lists.berlios.de/pipermail/openocd-development/attachments/20110803/7209b110/attachment-0003.ksh</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020456.html">[Openocd-development] Last call before release
</A></li>
	<LI>Next message: <A HREF="020458.html">[Openocd-development] Last call before release / Olimex ARM-JTAG-EW patches
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20457">[ date ]</a>
              <a href="thread.html#20457">[ thread ]</a>
              <a href="subject.html#20457">[ subject ]</a>
              <a href="author.html#20457">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
