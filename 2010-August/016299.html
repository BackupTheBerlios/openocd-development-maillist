<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2010-August/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Problem%20with%20LPC2148%20and%20ARM-USB-TINY-H&In-Reply-To=%3CAANLkTi%3DCubqECJc%2B3PhoS4Sv60H-E1smN%3DxMNTqs4nVW%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016298.html">
   <LINK REL="Next"  HREF="016301.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H</H1>
    <B>Xiaofan Chen</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Problem%20with%20LPC2148%20and%20ARM-USB-TINY-H&In-Reply-To=%3CAANLkTi%3DCubqECJc%2B3PhoS4Sv60H-E1smN%3DxMNTqs4nVW%40mail.gmail.com%3E"
       TITLE="[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H">xiaofanc at gmail.com
       </A><BR>
    <I>Sat Aug 14 02:39:17 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="016298.html">[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H
</A></li>
        <LI>Next message: <A HREF="016301.html">[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16299">[ date ]</a>
              <a href="thread.html#16299">[ thread ]</a>
              <a href="subject.html#16299">[ subject ]</a>
              <a href="author.html#16299">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Aug 14, 2010 at 8:30 AM, Xiaofan Chen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">xiaofanc at gmail.com</A>&gt; wrote:
&gt;<i> On Sat, Aug 14, 2010 at 1:48 AM, Olof T&#229;ngrot &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">olof.tangrot at telia.com</A>&gt; wrote:
</I>&gt;&gt;<i> Xiaofan Chen wrote:
</I>&gt;&gt;&gt;<i> I am using the original OpenOCD binaries from Freddie Chopin
</I>&gt;&gt;&gt;<i> under 32bit Vista. The driver is the original Amontec driver
</I>&gt;&gt;&gt;<i> (WHQL, based on FTDI's 2.06.00 version) and libusb-win32
</I>&gt;&gt;&gt;<i> filter driver 1.2.1.0. The two config files are also unmodified.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> I also started to doubt that openocd actually could work with the
</I>&gt;&gt;<i> LPC2148 since Macraigor OCDCommander seems to be working at least with
</I>&gt;&gt;<i> the wiggler clone.
</I>&gt;&gt;<i> And it is strange that proprietary drivers seems to
</I>&gt;&gt;<i> be the involved your setup.
</I>&gt;<i>
</I>&gt;<i> Ah, I just got the Amontec Amontec JTAGkey2 so I installed
</I>&gt;<i> Amontec's driver first which is based on FTDI driver.
</I>&gt;<i>
</I>&gt;<i> To use libftdi, you need libusb-win32 driver, either device driver
</I>&gt;<i> mode (recommended) or filter driver (which is not recommended
</I>&gt;<i> for normal users, only for power users and developers). It is
</I>&gt;<i> just that I am one of the admins of libusb-win32 and my
</I>&gt;<i> responsibility includes testing the filter driver to improve its
</I>&gt;<i> stability (it is much more stable now, but could still cause
</I>&gt;<i> BSODs in certain cases). So I used the filter driver.
</I>&gt;<i>
</I>&gt;<i> If the filter driver works, normally the device driver will work.
</I>&gt;<i> To prove that, I just used libusb-win32 device driver to replace
</I>&gt;<i> the Amontec driver for Channel A using Zadig. And openocd
</I>&gt;<i> works fine as well. This is under Windows 7 with no filter driver
</I>&gt;<i> enabled.
</I>&gt;<i>
</I>&gt;<i> The inf file generated by Zadig is also attached. In fact, it
</I>&gt;<i> can generate inf file for libusb0.sys and winusb.sys. So I
</I>&gt;<i> can switch between using libftdi (with Freddie Chopin's binary)
</I>&gt;<i> and libftdi-1.0 (with the binary I built). Zadig can also install the
</I>&gt;<i> driver for you or just generate the binary package.
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.libusb.org/wiki/windows_backend">http://www.libusb.org/wiki/windows_backend</A>
</I>&gt;<i>
</I>
So I tested the OpenOCD binary I built with libftdi-1.0 support.
libftdi-1.0 is based on libusb-1.0. So under Windows it needs
to use WinUSB driver. Firstly I use Zadig to switch the driver to
WinUSB. Then I run the binary I built.

The WinUSB inf file generated is also attached. Take note
the following line. It only attaches to Interface 0 (Channel A).

DeviceID   = &quot;VID_0403&amp;PID_CFF8&amp;MI_00&quot;

D:\work\openocd\openocd_04Aug2010_mingw32\bin&gt;dir
 Volume in drive D is DATA
 Volume Serial Number is 748A-B2F8

 Directory of D:\work\openocd\openocd_04Aug2010_mingw32\bin

04/08/2010  08:43 PM    &lt;DIR&gt;          .
04/08/2010  08:43 PM    &lt;DIR&gt;          ..
04/08/2010  08:48 PM               655 info.txt
04/08/2010  07:13 PM            76,819 libftdi.dll
03/08/2010  06:18 AM           155,417 libusb-1.0.dll
04/08/2010  07:54 PM         4,091,470 openocd.exe
               4 File(s)      4,324,361 bytes
               2 Dir(s)  58,172,010,496 bytes free

D:\work\openocd\openocd_04Aug2010_mingw32\bin&gt;openocd -f interface/jtagkey2.cfg
 -f board/olimex_lpc_h2148.cfg
Open On-Chip Debugger 0.5.0-dev (2010-08-04-19:54)
Licensed under GNU GPL v2
For bug reports, read
        <A HREF="http://openocd.berlios.de/doc/doxygen/bugs.html">http://openocd.berlios.de/doc/doxygen/bugs.html</A>
Info : only one transport option; autoselect 'jtag'
RCLK - adaptive
adapter_nsrst_delay: 200
jtag_ntrst_delay: 200
trst_and_srst separate srst_gates_jtag trst_push_pull srst_open_drain
Info : max TCK change to: 30000 kHz
Info : RCLK (adaptive clock speed)
Info : JTAG tap: lpc2148.cpu tap/device found: 0x4f1f0f0f (mfg: 0x787, part: 0xf
1f0, ver: 0x4)
Info : Embedded ICE version 4
Info : lpc2148.cpu: hardware has 2 breakpoint/watchpoint units


; Amontec_JTAGkey-2_(Interface_0).inf
; Copyright (c) 2010 libusb (GNU LGPL)
[Strings]
DeviceName = &quot;Amontec JTAGkey-2 (Interface 0)&quot;
VendorName = &quot;Future Technology Devices International, Ltd&quot;
SourceName = &quot;Amontec JTAGkey-2 (Interface 0) Install Disk&quot;
DeviceID   = &quot;VID_0403&amp;PID_CFF8&amp;MI_00&quot;
DeviceGUID = &quot;{5237123D-5CA6-46B2-9B2C-9EA25BE4079C}&quot;

[Version]
Signature   = &quot;$Windows NT$&quot;
Class       = &quot;libusb (WinUSB) devices&quot;
ClassGuid   = {78a1c341-4539-11d3-b88d-00c04fad5171}
Provider    = &quot;libusb.org&quot;
CatalogFile = Amontec_JTAGkey-2_(Interface_0).cat
DriverVer   = 07/14/2009, 6.1.7600.16385

[ClassInstall32]
Addreg = WinUSBDeviceClassReg

[WinUSBDeviceClassReg]
HKR,,,0,&quot;libusb (WinUSB) devices&quot;
HKR,,Icon,,-20

[Manufacturer]
%VendorName% = libusbDevice_WinUSB,NTx86,NTamd64,NTia64

[libusbDevice_WinUSB.NTx86]
%DeviceName% = USB_Install, USB\%DeviceID%

[libusbDevice_WinUSB.NTamd64]
%DeviceName% = USB_Install, USB\%DeviceID%

[libusbDevice_WinUSB.NTia64]
%DeviceName% = USB_Install, USB\%DeviceID%

[USB_Install]
Include = winusb.inf
Needs   = WINUSB.NT

[USB_Install.Services]
Include    = winusb.inf
AddService = WinUSB,0x00000002,WinUSB_ServiceInstall

[WinUSB_ServiceInstall]
DisplayName   = &quot;WinUSB - Kernel Driver 07/14/2009 6.1.7600.16385&quot;
ServiceType   = 1
StartType     = 3
ErrorControl  = 1
ServiceBinary = %12%\WinUSB.sys

[USB_Install.Wdf]
KmdfService = WINUSB, WinUsb_Install

[WinUSB_Install]
KmdfLibraryVersion = 1.9

[USB_Install.HW]
AddReg = Dev_AddReg

[Dev_AddReg]
HKR,,DeviceInterfaceGUIDs,0x10000,%DeviceGUID%

[USB_Install.CoInstallers]
AddReg    = CoInstallers_AddReg
CopyFiles = CoInstallers_CopyFiles

[CoInstallers_AddReg]
HKR,,CoInstallers32,0x00010000,&quot;WdfCoInstaller01009.dll,WdfCoInstaller&quot;,&quot;WinUSBCoInstaller2.dll&quot;

[CoInstallers_CopyFiles]
WinUSBCoInstaller2.dll
WdfCoInstaller01009.dll

[DestinationDirs]
CoInstallers_CopyFiles = 11

[SourceDisksNames]
1 = %SourceName%

[SourceDisksFiles.x86]
WinUSBCoInstaller2.dll  = 1,x86
WdfCoInstaller01009.dll = 1,x86

[SourceDisksFiles.amd64]
WinUSBCoInstaller2.dll  = 1,amd64
WdfCoInstaller01009.dll = 1,amd64

[SourceDisksFiles.ia64]
WinUSBCoInstaller2.dll  = 1,ia64
WdfCoInstaller01009.dll = 1,ia64



-- 
Xiaofan

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016298.html">[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H
</A></li>
	<LI>Next message: <A HREF="016301.html">[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16299">[ date ]</a>
              <a href="thread.html#16299">[ thread ]</a>
              <a href="subject.html#16299">[ subject ]</a>
              <a href="author.html#16299">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
