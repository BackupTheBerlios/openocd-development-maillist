<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2010-August/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Problem%20with%20LPC2148%20and%20ARM-USB-TINY-H&In-Reply-To=%3CAANLkTikEHRLo4b-dra0UGiU1D9xmcqyXCn23D8tTEwV2%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016294.html">
   <LINK REL="Next"  HREF="016299.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H</H1>
    <B>Xiaofan Chen</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Problem%20with%20LPC2148%20and%20ARM-USB-TINY-H&In-Reply-To=%3CAANLkTikEHRLo4b-dra0UGiU1D9xmcqyXCn23D8tTEwV2%40mail.gmail.com%3E"
       TITLE="[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H">xiaofanc at gmail.com
       </A><BR>
    <I>Sat Aug 14 02:30:54 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="016294.html">[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H
</A></li>
        <LI>Next message: <A HREF="016299.html">[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16298">[ date ]</a>
              <a href="thread.html#16298">[ thread ]</a>
              <a href="subject.html#16298">[ subject ]</a>
              <a href="author.html#16298">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, Aug 14, 2010 at 1:48 AM, Olof T&#229;ngrot &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">olof.tangrot at telia.com</A>&gt; wrote:
&gt;<i> Xiaofan Chen wrote:
</I>&gt;&gt;<i> I am using the original OpenOCD binaries from Freddie Chopin
</I>&gt;&gt;<i> under 32bit Vista. The driver is the original Amontec driver
</I>&gt;&gt;<i> (WHQL, based on FTDI's 2.06.00 version) and libusb-win32
</I>&gt;&gt;<i> filter driver 1.2.1.0. The two config files are also unmodified.
</I>&gt;&gt;<i>
</I>&gt;<i> I also started to doubt that openocd actually could work with the
</I>&gt;<i> LPC2148 since Macraigor OCDCommander seems to be working at least with
</I>&gt;<i> the wiggler clone.
</I>&gt;<i> And it is strange that proprietary drivers seems to
</I>&gt;<i> be the involved your setup.
</I>
Ah, I just got the Amontec Amontec JTAGkey2 so I installed
Amontec's driver first which is based on FTDI driver.

To use libftdi, you need libusb-win32 driver, either device driver
mode (recommended) or filter driver (which is not recommended
for normal users, only for power users and developers). It is
just that I am one of the admins of libusb-win32 and my
responsibility includes testing the filter driver to improve its
stability (it is much more stable now, but could still cause
BSODs in certain cases). So I used the filter driver.

If the filter driver works, normally the device driver will work.
To prove that, I just used libusb-win32 device driver to replace
the Amontec driver for Channel A using Zadig. And openocd
works fine as well. This is under Windows 7 with no filter driver
enabled.

The inf file generated by Zadig is also attached. In fact, it
can generate inf file for libusb0.sys and winusb.sys. So I
can switch between using libftdi (with Freddie Chopin's binary)
and libftdi-1.0 (with the binary I built). Zadig can also install the
driver for you or just generate the binary package.

<A HREF="http://www.libusb.org/wiki/windows_backend">http://www.libusb.org/wiki/windows_backend</A>

OpenOCD has long worked with LPC-2148. Last time I was
using a J-Link (V6, V7 and V3, it took some time to get V3 working).

D:\Program Files\OpenOCD\0.4.0\bin&gt;
openocd -f interface/jtagkey2.cfg  -f board/olimex_lpc_h2148.cfg
Open On-Chip Debugger 0.4.0 (2010-02-22-19:05)
Licensed under GNU GPL v2
For bug reports, read
        <A HREF="http://openocd.berlios.de/doc/doxygen/bugs.html">http://openocd.berlios.de/doc/doxygen/bugs.html</A>
RCLK - adaptive
jtag_nsrst_delay: 200
jtag_ntrst_delay: 200
trst_and_srst srst_pulls_trst srst_gates_jtag trst_push_pull srst_open_drain
Info : max TCK change to: 30000 kHz
Info : RCLK (adaptive clock speed)
Info : JTAG tap: lpc2148.cpu tap/device found: 0x4f1f0f0f (mfg: 0x787, part: 0xf
1f0, ver: 0x4)
Info : Embedded ICE version 4
Info : lpc2148.cpu: hardware has 2 breakpoint/watchpoint units


; Amontec_JTAGkey-2_(Interface_0).inf
; Copyright (c) 2010 libusb-win32 (GNU LGPL)
[Strings]
DeviceName = &quot;Amontec JTAGkey-2 (Interface 0)&quot;
VendorName = &quot;Future Technology Devices International, Ltd&quot;
SourceName = &quot;Amontec JTAGkey-2 (Interface 0) Install Disk&quot;
DeviceID   = &quot;VID_0403&amp;PID_CFF8&amp;MI_00&quot;
DeviceGUID = &quot;{248C2A0C-51D8-4AC3-B588-2DFA42B58D34}&quot;

[Version]
Signature   = &quot;$Windows NT$&quot;
Class       = &quot;libusb-win32 devices&quot;
ClassGuid   = {EB781AAF-9C70-4523-A5DF-642A87ECA567}
Provider    = &quot;libusb-win32&quot;
CatalogFile = Amontec_JTAGkey-2_(Interface_0).cat
DriverVer   = 08/05/2010, 1.2.1.0

[ClassInstall32]
Addreg = libusb_class_install_add_reg

[libusb_class_install_add_reg]
HKR,,,0,&quot;libusb-win32 devices&quot;
HKR,,Icon,,-20

[Manufacturer]
%VendorName% = Devices, NT, NTAMD64, NTIA64

;--------------------------------------------------------------------------
; libusb-win32 files
;--------------------------------------------------------------------------

[SourceDisksNames]
1 = %SourceName%

[SourceDisksFiles.x86]
libusb0.sys     = 1,x86
libusb0_x86.dll = 1,x86

[SourceDisksFiles.amd64]
libusb0.sys     = 1,amd64
libusb0.dll     = 1,amd64
libusb0_x86.dll = 1,x86

[SourceDisksFiles.ia64]
libusb0.sys     = 1,ia64
libusb0.dll     = 1,ia64
libusb0_x86.dll = 1,x86

[DestinationDirs]
libusb_files_sys       = 10,system32\drivers
libusb_files_dll       = 10,system32
libusb_files_dll_wow64 = 10,syswow64
libusb_files_dll_x86   = 10,system32

[libusb_files_sys]
libusb0.sys

[libusb_files_dll]
libusb0.dll

[libusb_files_dll_x86]
libusb0.dll, libusb0_x86.dll

[libusb_files_dll_wow64]
libusb0.dll, libusb0_x86.dll

;--------------------------------------------------------------------------
; libusb-win32 device driver
;--------------------------------------------------------------------------

[LIBUSB_WIN32_DEV.NT]
CopyFiles = libusb_files_sys, libusb_files_dll_x86

[LIBUSB_WIN32_DEV.NTAMD64]
CopyFiles = libusb_files_sys, libusb_files_dll, libusb_files_dll_wow64

[LIBUSB_WIN32_DEV.NTIA64]
CopyFiles = libusb_files_sys, libusb_files_dll, libusb_files_dll_wow64

[LIBUSB_WIN32_DEV.NT.HW]
DelReg = libusb_del_reg_hw
AddReg = libusb_add_reg_hw

[LIBUSB_WIN32_DEV.NTAMD64.HW]
DelReg = libusb_del_reg_hw
AddReg = libusb_add_reg_hw

[LIBUSB_WIN32_DEV.NTIA64.HW]
DelReg = libusb_del_reg_hw
AddReg = libusb_add_reg_hw

[LIBUSB_WIN32_DEV.NT.Services]
AddService = libusb0, 0x00000002, libusb_add_service

[LIBUSB_WIN32_DEV.NTAMD64.Services]
AddService = libusb0, 0x00000002, libusb_add_service

[LIBUSB_WIN32_DEV.NTIA64.Services]
AddService = libusb0, 0x00000002, libusb_add_service

; Older versions of this .inf file installed filter drivers. They are not
; needed any more and must be removed
[libusb_del_reg_hw]
HKR,,LowerFilters
HKR,,UpperFilters

; libusb-win32 device properties
[libusb_add_reg_hw]
HKR,,SurpriseRemovalOK,0x00010001,1

; (Optional) the usb configuration value to select when this device
; is started.  If this key does not exist the first config is selected.
;HKR,,InitialConfigValue,0x00010001,&lt;your config value&gt;

;--------------------------------------------------------------------------
; libusb-win32 service
;--------------------------------------------------------------------------

[libusb_add_service]
DisplayName   = &quot;libusb-win32 - Kernel Driver 08/05/2010 1.2.1.0&quot;
ServiceType   = 1
StartType     = 3
ErrorControl  = 0
ServiceBinary = %12%\libusb0.sys

;--------------------------------------------------------------------------
; libusb-win32 devices
;--------------------------------------------------------------------------

; Hardware IDs in a 'Devices' section can be installed by libusb-win32
; using usb_install_driver_np(), usb_install_driver_np_rundll(), or the
; inf-wizard utility.
;
[Devices]
%DeviceName% = LIBUSB_WIN32_DEV, USB\%DeviceID%

[Devices.NT]
%DeviceName% = LIBUSB_WIN32_DEV.NT, USB\%DeviceID%

[Devices.NTAMD64]
%DeviceName% = LIBUSB_WIN32_DEV.NTAMD64, USB\%DeviceID%

[Devices.NTIA64]
%DeviceName% = LIBUSB_WIN32_DEV.NTIA64, USB\%DeviceID%




-- 
Xiaofan

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016294.html">[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H
</A></li>
	<LI>Next message: <A HREF="016299.html">[Openocd-development] Problem with LPC2148 and ARM-USB-TINY-H
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16298">[ date ]</a>
              <a href="thread.html#16298">[ thread ]</a>
              <a href="subject.html#16298">[ subject ]</a>
              <a href="author.html#16298">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
