<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] Warn : Unexpected idcode after end of chain: 0x00000000 and Info : TAP does not have IDCODE
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2010-August/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Warn%20%3A%20Unexpected%20idcode%20after%20end%20of%0A%20chain%3A%200x00000000%20and%20Info%20%3A%20TAP%20does%20not%20have%20IDCODE&In-Reply-To=%3CAANLkTim2OQjtLatpXp9Tj98dFZ7neYAxRgC_LO27U6QL%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016350.html">
   <LINK REL="Next"  HREF="016352.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] Warn : Unexpected idcode after end of chain: 0x00000000 and Info : TAP does not have IDCODE</H1>
    <B>Drasko DRASKOVIC</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Warn%20%3A%20Unexpected%20idcode%20after%20end%20of%0A%20chain%3A%200x00000000%20and%20Info%20%3A%20TAP%20does%20not%20have%20IDCODE&In-Reply-To=%3CAANLkTim2OQjtLatpXp9Tj98dFZ7neYAxRgC_LO27U6QL%40mail.gmail.com%3E"
       TITLE="[Openocd-development] Warn : Unexpected idcode after end of chain: 0x00000000 and Info : TAP does not have IDCODE">drasko.draskovic at gmail.com
       </A><BR>
    <I>Wed Aug 25 17:17:50 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="016350.html">[Openocd-development] Warn : Unexpected idcode after end of chain: 0x00000000 and Info : TAP does not have IDCODE
</A></li>
        <LI>Next message: <A HREF="016352.html">[Openocd-development] Warn : Unexpected idcode after end of chain: 0x00000000 and Info : TAP does not have IDCODE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16351">[ date ]</a>
              <a href="thread.html#16351">[ thread ]</a>
              <a href="subject.html#16351">[ subject ]</a>
              <a href="author.html#16351">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Aug 25, 2010 at 11:19 AM, Drasko DRASKOVIC
&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">drasko.draskovic at gmail.com</A>&gt; wrote:
&gt;<i> On Wed, Aug 25, 2010 at 8:38 AM, Laurent Gauch
</I>&gt;<i> &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">laurent.gauch at amontec.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hello David,
</I>&gt;&gt;&gt;<i> I am not so sure about this. Still smells like reset problem to me.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> It should be noted that when I let small bootloader execute from the
</I>&gt;&gt;&gt;<i> SPI flash and do the reset (and some other config), I can attach &#160;with
</I>&gt;&gt;&gt;<i> OpenOCD, i.e. chain is well scanned. I was able after attachment to
</I>&gt;&gt;&gt;<i> set-up SDRAM and launch eCos application (which would further
</I>&gt;&gt;&gt;<i> configure SoC). Now I erased the flash and tried without bootloader. I
</I>&gt;&gt;&gt;<i> do not exactly know what bootloader is doing (have not insight in the
</I>&gt;&gt;&gt;<i> code yet), but obviously nothing expect reset is needed for a proper
</I>&gt;&gt;&gt;<i> chain scanning.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> It should be also noted that Lauterbach jtag attaches without any
</I>&gt;&gt;&gt;<i> problems. I do not think that it does anything special for this step.
</I>&gt;&gt;&gt;<i> All what is needed after is few lines of SDRAM set-up and application
</I>&gt;&gt;&gt;<i> can be uploaded and run. But that comes after attachment (as for
</I>&gt;&gt;&gt;<i> OpenOCD).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> All this confirms that hardware is working properly. I am almost
</I>&gt;&gt;&gt;<i> convinced that bug is either on OpenOCD side (I tried with both ftd
</I>&gt;&gt;&gt;<i> libs) or I should configure reset in some special way...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Would anybody have some hints after these additional explanations ?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Best regards,
</I>&gt;&gt;&gt;<i> Drasko
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It is not coming from your JTAGkey-2 since you can scan and detect the chain
</I>&gt;&gt;<i> after configuration of your system.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It is really somewhere in the OpenOCD .
</I>&gt;<i>
</I>&gt;<i> I am almost sure. As I mentioned, Lautebach works fine. So is Amontec
</I>&gt;<i> JTAG2 when bootloder passed before (probably doing reset correctly).
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But you could try to disable the use of RTCK feature from the Amontec
</I>&gt;&gt;<i> JTAGkey-2 and run at a super low frequency before doing your scan chain
</I>&gt;&gt;<i> detection.
</I>&gt;<i>
</I>&gt;<i> How to do this ? In configuration file ?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Also, could you please try to disconnect the JTAGkey from USB port before
</I>&gt;&gt;<i> doing this. OpenOCD is still not really clean regarding the finish using the
</I>&gt;&gt;<i> Amontec JTAGey as other FT2232 USB JTAG dongle before closing its handle in
</I>&gt;&gt;<i> mpsse mode.
</I>&gt;<i>
</I>&gt;<i> I noted this before. When reset (USB disconnected and re-connected)
</I>&gt;<i> Amontec Jtag2 have only 2 green leds on.
</I>&gt;<i> After running one session of OpenOCD all leds stay on (mentioned two
</I>&gt;<i> gree + one yellow + one red).
</I>&gt;<i>
</I>&gt;&gt;<i> Let us know the debug output in this case.
</I>&gt;<i>
</I>&gt;<i> OK, here is my procedure :
</I>&gt;<i>
</I>&gt;<i> 1) Disconnect/re-connect Amontec JtagKey2. Only two green leds are on.
</I>&gt;<i> 2) Commented out #jtag_rclk 1 line in config. Now config has only 3 lines :
</I>&gt;<i>
</I>&gt;<i> source [find ../tcl/interface/jtagkey2.cfg]
</I>&gt;<i> adapter_khz 1
</I>&gt;<i> scan_chain
</I>&gt;<i>
</I>&gt;<i> That's all. I do not think that we can get slower than 1KHz
</I>&gt;<i> (adapter_khz 1). If yes, please tell me how.
</I>&gt;<i>
</I>&gt;<i> 3) launched openocd. It keeps getting all zeros :
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">root at konj</A>:~/openocd/openocd/src# ./openocd -f my_openocd.cfg
</I>&gt;<i> Open On-Chip Debugger 0.5.0-dev-00494-g5c98e06-dirty (2010-08-24-20:22)
</I>&gt;<i> Licensed under GNU GPL v2
</I>&gt;<i> For bug reports, read
</I>&gt;<i> &#160; &#160; &#160; &#160;<A HREF="http://openocd.berlios.de/doc/doxygen/bugs.html">http://openocd.berlios.de/doc/doxygen/bugs.html</A>
</I>&gt;<i> Info : only one transport option; autoselect 'jtag'
</I>&gt;<i> 1 kHz
</I>&gt;<i> &#160; TapName &#160; &#160; &#160; &#160; &#160; &#160; Enabled &#160;IdCode &#160; &#160; Expected &#160; IrLen IrCap IrMask
</I>&gt;<i> -- ------------------- -------- ---------- ---------- ----- ----- ------
</I>&gt;<i> Info : max TCK change to: 30000 kHz
</I>&gt;<i> Info : clock speed 1 kHz
</I>&gt;<i> Warn : There are no enabled taps. &#160;AUTO PROBING MIGHT NOT WORK!!
</I>&gt;<i> Info : inter: 0.000079, inter2: 0.000079 end: 0.653373
</I>&gt;<i> Warn : AUTO auto0.tap - use &quot;jtag newtap auto0 tap -expected-id 0x01273043 ...&quot;
</I>&gt;<i> Warn : AUTO auto1.tap - use &quot;jtag newtap auto1 tap -expected-id 0x01273043 ...&quot;
</I>&gt;<i> Warn : AUTO auto2.tap - use &quot;jtag newtap auto2 tap -expected-id 0x01273043 ...&quot;
</I>&gt;<i> Warn : AUTO auto3.tap - use &quot;jtag newtap auto3 tap -expected-id 0x01273043 ...&quot;
</I>&gt;<i> Warn : AUTO auto4.tap - use &quot;jtag newtap auto4 tap -expected-id 0x01273043 ...&quot;
</I>&gt;<i> Warn : AUTO auto5.tap - use &quot;jtag newtap auto5 tap -expected-id 0x00000000 ...&quot;
</I>&gt;<i> Warn : AUTO auto6.tap - use &quot;jtag newtap auto6 tap -expected-id 0x00000000 ...&quot;
</I>&gt;<i> Warn : AUTO auto7.tap - use &quot;jtag newtap auto7 tap -expected-id 0x00000000 ...&quot;
</I>
I changed reference board and succeed to connect, but it was
absolutely needed to prevent RTCK and to use lowest freq in the
begining:

#jtag_rclk 1
adapter_khz 1
jtag_khz 1

It seems that problem was really in HW, but also this should be noted
- no RTCK and super-low freq.

However, another problem still persist :

First launch of application suceedes. SDRAM is configured and all ends well.

However, after reset any next launch does not work. First, when I try
to upload app it complains :
&gt;<i> load_image /home/ddraskovic/update.elf
</I>DCC write failed, expected end address 0x00085f30 got 0x21cf07be
Command handler execution failed
in procedure 'load_image'

Then I can disable DCC, reset init, load is reported as successful,
but launch does not work.

I am using ARM946E-S, but target is defined as :

target create $_TARGETNAME arm966e -endian big -chain-position
sqn3010_1.cpu -variant arm946e

$_TARGETNAME configure -work-area-phys 0x00000000 -work-area-size
0x01000000 -work-area-backup 0


Can it be that OpenOCD does not handle well ARM946E-S after reset
(because of some differences with ARM966, like coprocessor, or
endianess (I am using BIG)  ?

Inspecting the SDRAM config registers re-initialized after reset, I's
say that SDRAM is well configured and see no reason why upload breaks
with DCC error,  and why app can not be launched.


Any hints ?

Thanks and best regards,
Drasko

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016350.html">[Openocd-development] Warn : Unexpected idcode after end of chain: 0x00000000 and Info : TAP does not have IDCODE
</A></li>
	<LI>Next message: <A HREF="016352.html">[Openocd-development] Warn : Unexpected idcode after end of chain: 0x00000000 and Info : TAP does not have IDCODE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16351">[ date ]</a>
              <a href="thread.html#16351">[ thread ]</a>
              <a href="subject.html#16351">[ subject ]</a>
              <a href="author.html#16351">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
