<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] Nit to pick with recent set of cleanups
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2009-June/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Nit%20to%20pick%20with%20recent%20set%20of%20cleanups&In-Reply-To=%3CFBE2E499-44E2-4A4B-8653-E5129726F190%40kc8apf.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008079.html">
   <LINK REL="Next"  HREF="008118.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] Nit to pick with recent set of cleanups</H1>
    <B>Rick Altherr</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Nit%20to%20pick%20with%20recent%20set%20of%20cleanups&In-Reply-To=%3CFBE2E499-44E2-4A4B-8653-E5129726F190%40kc8apf.net%3E"
       TITLE="[Openocd-development] Nit to pick with recent set of cleanups">kc8apf at kc8apf.net
       </A><BR>
    <I>Tue Jun 16 05:25:03 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="008079.html">[Openocd-development] Nit to pick with recent set of cleanups
</A></li>
        <LI>Next message: <A HREF="008118.html">[Openocd-development] Nit to pick with recent set of cleanups
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8082">[ date ]</a>
              <a href="thread.html#8082">[ thread ]</a>
              <a href="subject.html#8082">[ subject ]</a>
              <a href="author.html#8082">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jun 15, 2009, at 6:58 PM, Zach Welch wrote:

&gt;<i> On Mon, 2009-06-15 at 17:01 -0700, Rick Altherr wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Jun 15, 2009, at 4:19 PM, Zach Welch wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Sat, 2009-06-13 at 21:14 -0400, Duane Ellis wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>   bool okay = *str &amp;&amp; !*end &amp;&amp; ULLONG_MAX != *ul;
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> In my long career, I have seen too many poor souls - including my
</I>&gt;&gt;&gt;&gt;<i> self
</I>&gt;&gt;&gt;&gt;<i> become the victim of even my own seemingly simple attempts to
</I>&gt;&gt;&gt;&gt;<i> reduce the
</I>&gt;&gt;&gt;&gt;<i> levels of  () and {}.   Yes, there are cases where it gets a little
</I>&gt;&gt;&gt;&gt;<i> too
</I>&gt;&gt;&gt;&gt;<i> deep, but there must be a balance.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On the opposite side of the coin, I have seen too many programmers
</I>&gt;&gt;&gt;<i> rely
</I>&gt;&gt;&gt;<i> on extra parentheses because they do not _know_ C operator  
</I>&gt;&gt;&gt;<i> precedence.
</I>&gt;&gt;&gt;<i> There are cases that deserve extra parenthesis, but not on that  
</I>&gt;&gt;&gt;<i> line.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The extra parentheses and braces do not hurt anything, however.  They
</I>&gt;&gt;<i> _do_ make it easier for those who are newer to programming or to
</I>&gt;&gt;<i> clarify the sets of tests being done.  I'm personally not fond of
</I>&gt;&gt;<i> incorporating multiple logical (as in separate tests, not  
</I>&gt;&gt;<i> specifically
</I>&gt;&gt;<i> those using logic operators) tests into a single statement.  If they
</I>&gt;&gt;<i> are going to be, then I prefer the unnecessarily parentheses be used
</I>&gt;&gt;<i> to separate the logical tests to make the statement more  
</I>&gt;&gt;<i> understandable.
</I>&gt;<i>
</I>&gt;<i> Okay, wait..... you say below that you have written this same code, so
</I>&gt;<i> anyone familiar with strtoul (or bothers to read its man page) will
</I>&gt;<i> understand exactly what it does.  OpenOCD's style should _not_ cater  
</I>&gt;<i> to
</I>&gt;<i> those &quot;newer to programming&quot;.  This is not a beginner's project, nor
</I>&gt;<i> should developers working on it expect to produce code at that level.
</I>&gt;<i>
</I>
No, we should cater to clarity and readability.  Code should only be  
difficult to read and/or understand under a few specific conditions:
- Working around an optimizer bug that would otherwise allow the code  
to be written more simply
- Well-commented algrithmic optimizations that are the result of  
measurement and analysis

Since this case is neither, it should be written so that any developer  
who chooses to look at the code can easily understand it.  To do  
otherwise is generally a sign of elitism or laziness.


&gt;<i> The function under scrutiny is _trivial_, but you failed to account  
</I>&gt;<i> for
</I>&gt;<i> (or notice, perhaps) the fact that I was asking a much broader  
</I>&gt;<i> question
</I>&gt;<i> in my reply.  This one line of code aside: are my cleanups resulting  
</I>&gt;<i> in
</I>&gt;<i> a clearer to understand tree?
</I>&gt;<i>
</I>
Yes, I think you have been in general improving the code base.  Even  
in this case you've managed to improve the overall code base even if a  
few of us have a few nits to pick with it.

&gt;&gt;&gt;&gt;<i> Openocd is not, and should never become an entry in the  
</I>&gt;&gt;&gt;&gt;<i> 'obfuscated C
</I>&gt;&gt;&gt;&gt;<i> code contest[1]'.  It seems that we are heading down that road.
</I>&gt;&gt;&gt;&gt;<i> &lt;/screaming-rant&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Seriously?  You think that my efforts have increased the  
</I>&gt;&gt;&gt;<i> obfuscation?
</I>&gt;&gt;&gt;<i> My principle aim has been to improve the readability of the code,  
</I>&gt;&gt;&gt;<i> so I
</I>&gt;&gt;&gt;<i> have to wonder whether others agree with this particular assessment.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I personally find the excerpted line confusing and clunky.  I _do_
</I>&gt;&gt;<i> know what it does, but only because I've written the exact same code
</I>&gt;&gt;<i> to handle the error cases returned by stroul.  Without seeing the  
</I>&gt;&gt;<i> rest
</I>&gt;&gt;<i> of the code, here's what I don't like about it:
</I>&gt;&gt;<i>  - okay is a poor choice of variable name.  Its name declares that it
</I>&gt;&gt;<i> is &quot;okay&quot;, but it really is telling you _if_ something is okay.
</I>&gt;&gt;<i> is_okay is much clearer.
</I>&gt;&gt;<i> - There are really two separate tests being done sequentially.  The
</I>&gt;&gt;<i> first is to see if the whole string was used to generate the number.
</I>&gt;&gt;<i> The second is to see if the parsed number was larger than an unsigned
</I>&gt;&gt;<i> log.  That isn't immediately clear even though operator precedence  
</I>&gt;&gt;<i> and
</I>&gt;&gt;<i> associativity means it evaluates that way.
</I>&gt;&gt;<i> - The use of 'okay' seems potentially unnecessary.  Even if the test
</I>&gt;&gt;<i> is being used to determine multiple control flow paths, the code can
</I>&gt;&gt;<i> usually be changed to only need a single if.  The variable  
</I>&gt;&gt;<i> declaration
</I>&gt;&gt;<i> doesn't really add anything to the clarity.
</I>&gt;&gt;<i> - If you are testing that a variable is non-NULL, write that.
</I>&gt;&gt;<i> Similarly for a test for NULL.  Taking the short-cut just makes it
</I>&gt;&gt;<i> less clear what you are doing and why.  Besides, it isn't necessarily
</I>&gt;&gt;<i> guaranteed that NULL will always be 0. ;)
</I>&gt;<i>
</I>&gt;<i> This is a four line function!  The okay variable turns a four line if
</I>&gt;<i> into two lines of code that I think are very easy to read.  Sure, it
</I>&gt;<i> might be better called is_okay, but it is barely objectionable as-is.
</I>&gt;<i> It is typed 'bool'; its meaning can only be 'is' or 'is not'.  If it  
</I>&gt;<i> was
</I>&gt;<i> called isOkay or is_number_okay, then I might have issues too... but
</I>&gt;<i> this seems like grasping at straws.
</I>&gt;<i>
</I>
You could have inverted the test logic for the each test and written  
them as separate early exits.  The success case would be a fall  
through.  The indentation level would be the same, but the code would  
be clearer.

&gt;<i> I agree with explicit NULL test, particular in contexts where the
</I>&gt;<i> variable declaration is not present.  However, the declaration is  
</I>&gt;<i> right
</I>&gt;<i> there so it would not be confusing to any developer for long.
</I>
Perhaps, but considering I got it wrong in this case, it certainly is  
confusing.

&gt;<i>  Further,
</I>&gt;<i> I copied the core of this code from elsewhere in the tree, and I  
</I>&gt;<i> cannot
</I>&gt;<i> manage to fix every problem in the tree in one pass.  There are too  
</I>&gt;<i> many
</I>&gt;<i> problems to expect that I would get everything right.
</I>
Didn't say I expected you to.  Just pointing it out.

&gt;<i> Finally, both of
</I>&gt;<i> the uses of '!' are _not_ NULL pointer checks; they are integer tests
</I>&gt;<i> for the end of the string.  So, yes, those checks will _always_ be 0.
</I>&gt;<i>
</I>
Well, those _shouldn't_ be integer tests, they should be character  
tests.  You are looking for the NULL termination on the string which  
is technically '\0'.

&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> Zach
</I>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2446 bytes
Desc: not available
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/openocd-development/attachments/20090615/f44b3ca8/attachment.bin">https://lists.berlios.de/pipermail/openocd-development/attachments/20090615/f44b3ca8/attachment.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008079.html">[Openocd-development] Nit to pick with recent set of cleanups
</A></li>
	<LI>Next message: <A HREF="008118.html">[Openocd-development] Nit to pick with recent set of cleanups
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8082">[ date ]</a>
              <a href="thread.html#8082">[ thread ]</a>
              <a href="subject.html#8082">[ subject ]</a>
              <a href="author.html#8082">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
