<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] lpc3131 and Actel FPGA chain programming.
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2010-November/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20lpc3131%20and%20Actel%20FPGA%20chain%20programming.&In-Reply-To=%3CAANLkTina8jcDy%2BN8ucdXA9O7QThzRJqGf2X0cVw1Oa8e%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017031.html">
   <LINK REL="Next"  HREF="017091.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] lpc3131 and Actel FPGA chain programming.</H1>
    <B>Andrew Leech</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20lpc3131%20and%20Actel%20FPGA%20chain%20programming.&In-Reply-To=%3CAANLkTina8jcDy%2BN8ucdXA9O7QThzRJqGf2X0cVw1Oa8e%40mail.gmail.com%3E"
       TITLE="[Openocd-development] lpc3131 and Actel FPGA chain programming.">coronasensei at gmail.com
       </A><BR>
    <I>Fri Nov 12 06:18:14 CET 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="017031.html">[Openocd-development] lpc3131 and Actel FPGA chain programming.
</A></li>
        <LI>Next message: <A HREF="017091.html">[Openocd-development] lpc3131 and Actel FPGA chain programming.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17078">[ date ]</a>
              <a href="thread.html#17078">[ thread ]</a>
              <a href="subject.html#17078">[ subject ]</a>
              <a href="author.html#17078">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Nov 11, 2010 at 2:44 AM, Peter Stuge &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">peter at stuge.se</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Andrew Leech wrote:
</I>&gt;<i> &gt; Now I need to figure out how to bypass the lpc via software rather
</I>&gt;<i> &gt; than physically changing the chain. I can't seem to find much
</I>&gt;<i> &gt; information about how bypass works with openocd, do you have any
</I>&gt;<i> &gt; idea?
</I>&gt;<i>
</I>&gt;<i> Sorry, no idea.
</I>&gt;<i>
</I>
Ok I've actually got this working! From my research there's two
typical ways of using a SVF on a chain, either the SVF file has to be
generated to know about the chain or the jtag software has to be aware
of the chain. Basically each ir and dr command needs a header and
trailer padding bytes to cover the other taps on the chain. There's
specific HDR and similar commands in svf to define these paddings.
Some software like UrJtag ignores these commands if they even exist
and figures them out itself by scanning the chain, this is neat.The
svf player in openocd doesn't have anything like this (and I don't
have time right now how to figure out how to add it, maybe later), so
you're left with generating the svf files to be aware of the chain, if
the software making the svf has this functionality.

&gt;<i>
</I>&gt;<i> &gt; Once I have it all sorted out I think this is well worth me making
</I>&gt;<i> &gt; a wiki page for programming fpga's on a chain, as there's not much
</I>&gt;<i> &gt; info about it so far, and it actually seems quite easy once you
</I>&gt;<i> &gt; know what your're doing.
</I>&gt;<i>
</I>&gt;<i> That would be fantastic. At the very least please do send an email
</I>&gt;<i> with what you came up with!
</I>&gt;<i>
</I>&gt;<i>
</I>
So yeah,&#160;I was initially generating my svf files directly from Actel
Designer Software using the actel project file generated by Altium
Designer (where i do the actual fpga designing). It doesn't allow you
to define chains anywhere, so I though I'd be in trouble, maybe having
to figure out the command manually.

Looking further I found that Actel FlashPro software on the other hand
allows chains to be manually defined (or detect them automatically if
you have their programmer hardware plugged in), and Altium was already
exporting a STAPL file by default which FlashPro was happy to assign
to the fpga that was defined in the chain. Then File-&gt;Export-&gt;Chain
SVF File and I had svf files complete with chain header and trailer.

The basic openocd command then for me are simply:

source [find interface/luminary-icdi.cfg] &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;#
My programmer
source [find target/lpc3131.cfg]
# This is now in mainline :)
jtag_khz 6000
 &#160; &#160; # Going to try to optimise this later...
reset_config srst_only srst_pulls_trst &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;#
My board's only wired to do this
jtag newtap a3p125 tap -irlen 8 -expected-id 0x02a121cf  &#160;# The FPGA
init
scan_chain
&#160; &#160; &#160; # just to be sure they're connected properly
svf Chain_PROGRAM_ARRAY.svf quiet &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  # runs my
svf file from flashpro

and it sits there quietly for just over 3 minutes before informing me
it's all done nicely, and I have a working fpga!
When I get a chance I'll make a patch/updates to the wiki page on the
svf player to be a bit more explicit on how to use it.

Cheers,
Andrew

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017031.html">[Openocd-development] lpc3131 and Actel FPGA chain programming.
</A></li>
	<LI>Next message: <A HREF="017091.html">[Openocd-development] lpc3131 and Actel FPGA chain programming.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17078">[ date ]</a>
              <a href="thread.html#17078">[ thread ]</a>
              <a href="subject.html#17078">[ subject ]</a>
              <a href="author.html#17078">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
