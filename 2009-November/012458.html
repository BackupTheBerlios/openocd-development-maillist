<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] [PATCH 4/6] command_handler: change 'cmd_ctx'	to CMD_CTX
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2009-November/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20%5BPATCH%204/6%5D%20command_handler%3A%20change%20%27cmd_ctx%27%0A%09to%20CMD_CTX&In-Reply-To=%3C1258414478-8037-5-git-send-email-zw%40superlucidity.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012456.html">
   <LINK REL="Next"  HREF="012455.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] [PATCH 4/6] command_handler: change 'cmd_ctx'	to CMD_CTX</H1>
    <B>Zachary T Welch</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20%5BPATCH%204/6%5D%20command_handler%3A%20change%20%27cmd_ctx%27%0A%09to%20CMD_CTX&In-Reply-To=%3C1258414478-8037-5-git-send-email-zw%40superlucidity.net%3E"
       TITLE="[Openocd-development] [PATCH 4/6] command_handler: change 'cmd_ctx'	to CMD_CTX">zw at superlucidity.net
       </A><BR>
    <I>Tue Nov 17 00:34:36 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="012456.html">[Openocd-development] [PATCH 3/6] command_handler: change 'args' to	CMD_ARGV
</A></li>
        <LI>Next message: <A HREF="012455.html">[Openocd-development] [PATCH 5/6] add struct command_invocation for	COMMAND_HANDLER
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12458">[ date ]</a>
              <a href="thread.html#12458">[ thread ]</a>
              <a href="subject.html#12458">[ subject ]</a>
              <a href="author.html#12458">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Convert all command handler 'cmd_ctx' parameter usage with CMD_CTX.

Signed-off-by: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">zw at superlucidity.net</A>&gt;
---
 src/flash/at91sam3.c                |   30 +++---
 src/flash/at91sam7.c                |    6 +-
 src/flash/avrf.c                    |    6 +-
 src/flash/flash.c                   |   58 +++++-----
 src/flash/lpc2000.c                 |    6 +-
 src/flash/lpc2900.c                 |   16 ++--
 src/flash/lpc3180_nand_controller.c |    4 +-
 src/flash/mflash.c                  |    6 +-
 src/flash/nand.c                    |   66 ++++++------
 src/flash/pic32mx.c                 |   30 +++---
 src/flash/stellaris.c               |    6 +-
 src/flash/stm32x.c                  |   52 +++++-----
 src/flash/str7x.c                   |    2 +-
 src/flash/str9xpec.c                |   46 ++++----
 src/flash/tms470.c                  |   20 ++--
 src/hello.c                         |    2 +-
 src/helper/command.h                |    2 +-
 src/helper/ioutil.c                 |   26 +++---
 src/helper/log.c                    |    2 +-
 src/jtag/amt_jtagaccel.c            |    4 +-
 src/jtag/gw16012.c                  |    2 +-
 src/jtag/jlink.c                    |    2 +-
 src/jtag/parport.c                  |    6 +-
 src/jtag/tcl.c                      |   42 ++++----
 src/openocd.c                       |   18 ++--
 src/pld/pld.c                       |   14 ++--
 src/pld/virtex2.c                   |    8 +-
 src/server/gdb_server.c             |    2 +-
 src/server/server.c                 |    2 +-
 src/svf/svf.c                       |   12 +-
 src/target/arm720t.c                |   14 ++--
 src/target/arm7_9_common.c          |   48 +++++-----
 src/target/arm920t.c                |   56 +++++-----
 src/target/arm926ejs.c              |   22 ++--
 src/target/arm966e.c                |   14 ++--
 src/target/arm9tdmi.c               |    8 +-
 src/target/arm_adi_v5.c             |    8 +-
 src/target/armv4_5.c                |   26 +++---
 src/target/armv7a.c                 |   22 ++--
 src/target/armv7m.c                 |   14 ++--
 src/target/cortex_a8.c              |    6 +-
 src/target/cortex_m3.c              |   27 +++--
 src/target/etb.c                    |    4 +-
 src/target/etm.c                    |  194 +++++++++++++++++-----------------
 src/target/etm_dummy.c              |    2 +-
 src/target/oocd_trace.c             |   26 +++---
 src/target/target.c                 |  130 ++++++++++++------------
 src/target/target_request.c         |   12 +-
 src/target/trace.c                  |   14 ++--
 src/target/xscale.c                 |   92 ++++++++--------
 src/xsvf/xsvf.c                     |   14 ++--
 51 files changed, 627 insertions(+), 624 deletions(-)

diff --git a/src/flash/at91sam3.c b/src/flash/at91sam3.c
index 4cf4d20..195da91 100644
--- a/src/flash/at91sam3.c
+++ b/src/flash/at91sam3.c
@@ -2267,7 +2267,7 @@ COMMAND_HANDLER(sam3_handle_info_command)
 	unsigned x;
 	int r;
 
-	pChip = get_current_sam3(cmd_ctx);
+	pChip = get_current_sam3(CMD_CTX);
 	if (!pChip) {
 		return ERROR_OK;
 	}
@@ -2278,7 +2278,7 @@ COMMAND_HANDLER(sam3_handle_info_command)
 	if (pChip-&gt;details.bank[0].pBank == NULL) {
 		x = 0;
 	need_define:
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 					   &quot;Please define bank %d via command: flash bank %s ... &quot;,
 					   x,
 					   at91sam3_flash.name);
@@ -2329,7 +2329,7 @@ COMMAND_HANDLER(sam3_handle_info_command)
 	// print results
 	cp = membuf_strtok(pChip-&gt;mbuf, &quot;\n&quot;, &amp;vp);
 	while (cp) {
-		command_print(cmd_ctx,&quot;%s&quot;, cp);
+		command_print(CMD_CTX,&quot;%s&quot;, cp);
 		cp = membuf_strtok(NULL, &quot;\n&quot;, &amp;vp);
 	}
 	return ERROR_OK;
@@ -2341,7 +2341,7 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 	int r,who;
 	struct sam3_chip *pChip;
 
-	pChip = get_current_sam3(cmd_ctx);
+	pChip = get_current_sam3(CMD_CTX);
 	if (!pChip) {
 		return ERROR_OK;
 	}
@@ -2353,7 +2353,7 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 
 
 	if (pChip-&gt;details.bank[0].pBank == NULL) {
-		command_print(cmd_ctx, &quot;Bank0 must be defined first via: flash bank %s ...&quot;,
+		command_print(CMD_CTX, &quot;Bank0 must be defined first via: flash bank %s ...&quot;,
 					   at91sam3_flash.name);
 		return ERROR_FAIL;
 	}
@@ -2367,7 +2367,7 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 
 	switch (CMD_ARGC) {
 	default:
-		command_print(cmd_ctx,&quot;Too many parameters\n&quot;);
+		command_print(CMD_CTX,&quot;Too many parameters\n&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 		break;
 	case 0:
@@ -2397,22 +2397,22 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 				if (r != ERROR_OK) {
 					break;
 				}
-				command_print(cmd_ctx, &quot;sam3-gpnvm%u: %u&quot;, x, v);
+				command_print(CMD_CTX, &quot;sam3-gpnvm%u: %u&quot;, x, v);
 			}
 			return r;
 		}
 		if ((who &gt;= 0) &amp;&amp; (((unsigned)(who)) &lt; pChip-&gt;details.n_gpnvms)) {
 			r = FLASHD_GetGPNVM(&amp;(pChip-&gt;details.bank[0]), who, &amp;v);
-			command_print(cmd_ctx, &quot;sam3-gpnvm%u: %u&quot;, who, v);
+			command_print(CMD_CTX, &quot;sam3-gpnvm%u: %u&quot;, who, v);
 			return r;
 		} else {
-			command_print(cmd_ctx, &quot;sam3-gpnvm invalid GPNVM: %u&quot;, who);
+			command_print(CMD_CTX, &quot;sam3-gpnvm invalid GPNVM: %u&quot;, who);
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		}
 	}
 
 	if (who == -1) {
-		command_print(cmd_ctx, &quot;Missing GPNVM number&quot;);
+		command_print(CMD_CTX, &quot;Missing GPNVM number&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
@@ -2422,7 +2422,7 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 			   (0 == strcmp(&quot;clear&quot;, CMD_ARGV[0]))) { // quietly accept both
 		r = FLASHD_ClrGPNVM(&amp;(pChip-&gt;details.bank[0]), who);
 	} else {
-		command_print(cmd_ctx, &quot;Unkown command: %s&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;Unkown command: %s&quot;, CMD_ARGV[0]);
 		r = ERROR_COMMAND_SYNTAX_ERROR;
 	}
 	return r;
@@ -2432,7 +2432,7 @@ COMMAND_HANDLER(sam3_handle_slowclk_command)
 {
 	struct sam3_chip *pChip;
 
-	pChip = get_current_sam3(cmd_ctx);
+	pChip = get_current_sam3(CMD_CTX);
 	if (!pChip) {
 		return ERROR_OK;
 	}
@@ -2449,7 +2449,7 @@ COMMAND_HANDLER(sam3_handle_slowclk_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], v);
 		if (v &gt; 200000) {
 			// absurd slow clock of 200Khz?
-			command_print(cmd_ctx,&quot;Absurd/illegal slow clock freq: %d\n&quot;, (int)(v));
+			command_print(CMD_CTX,&quot;Absurd/illegal slow clock freq: %d\n&quot;, (int)(v));
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		}
 		pChip-&gt;cfg.slow_freq = v;
@@ -2457,11 +2457,11 @@ COMMAND_HANDLER(sam3_handle_slowclk_command)
 	}
 	default:
 		// error
-		command_print(cmd_ctx,&quot;Too many parameters&quot;);
+		command_print(CMD_CTX,&quot;Too many parameters&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 		break;
 	}
-	command_print(cmd_ctx, &quot;Slowclk freq: %d.%03dkhz&quot;,
+	command_print(CMD_CTX, &quot;Slowclk freq: %d.%03dkhz&quot;,
 				   (int)(pChip-&gt;cfg.slow_freq/ 1000),
 				   (int)(pChip-&gt;cfg.slow_freq% 1000));
 	return ERROR_OK;
diff --git a/src/flash/at91sam7.c b/src/flash/at91sam7.c
index d23d2b0..3e5dbdd 100644
--- a/src/flash/at91sam7.c
+++ b/src/flash/at91sam7.c
@@ -1109,7 +1109,7 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 
 	if (CMD_ARGC != 2)
 	{
-		command_print(cmd_ctx, &quot;at91sam7 gpnvm &lt;bit&gt; &lt;set | clear&gt;&quot;);
+		command_print(CMD_CTX, &quot;at91sam7 gpnvm &lt;bit&gt; &lt;set | clear&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1120,7 +1120,7 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 	}
 	if (strcmp(bank-&gt;driver-&gt;name, &quot;at91sam7&quot;))
 	{
-		command_print(cmd_ctx, &quot;not an at91sam7 flash bank '%s'&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;not an at91sam7 flash bank '%s'&quot;, CMD_ARGV[0]);
 		return ERROR_FLASH_BANK_INVALID;
 	}
 	if (bank-&gt;target-&gt;state != TARGET_HALTED)
@@ -1155,7 +1155,7 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 	COMMAND_PARSE_NUMBER(int, CMD_ARGV[0], bit);
 	if ((bit &lt; 0) || (bit &gt;= at91sam7_info-&gt;num_nvmbits))
 	{
-		command_print(cmd_ctx, &quot;gpnvm bit '#%s' is out of bounds for target %s&quot;, CMD_ARGV[0], at91sam7_info-&gt;target_name);
+		command_print(CMD_CTX, &quot;gpnvm bit '#%s' is out of bounds for target %s&quot;, CMD_ARGV[0], at91sam7_info-&gt;target_name);
 		return ERROR_OK;
 	}
 
diff --git a/src/flash/avrf.c b/src/flash/avrf.c
index f1db3c4..20c619d 100644
--- a/src/flash/avrf.c
+++ b/src/flash/avrf.c
@@ -421,7 +421,7 @@ COMMAND_HANDLER(avrf_handle_mass_erase_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;avr mass_erase &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;avr mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -438,11 +438,11 @@ COMMAND_HANDLER(avrf_handle_mass_erase_command)
 			bank-&gt;sectors[i].is_erased = 1;
 		}
 
-		command_print(cmd_ctx, &quot;avr mass erase complete&quot;);
+		command_print(CMD_CTX, &quot;avr mass erase complete&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;avr mass erase failed&quot;);
+		command_print(CMD_CTX, &quot;avr mass erase failed&quot;);
 	}
 
 	LOG_DEBUG(&quot;%s&quot;, __FUNCTION__);
diff --git a/src/flash/flash.c b/src/flash/flash.c
index 99e71d7..fe0791f 100644
--- a/src/flash/flash.c
+++ b/src/flash/flash.c
@@ -208,7 +208,7 @@ COMMAND_HELPER(flash_command_get_bank_by_num,
 	*bank = get_flash_bank_by_num(bank_num);
 	if (!*bank)
 	{
-		command_print(cmd_ctx, &quot;flash bank '%s' not found&quot;, name);
+		command_print(CMD_CTX, &quot;flash bank '%s' not found&quot;, name);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 	return ERROR_OK;
@@ -241,7 +241,7 @@ COMMAND_HANDLER(handle_flash_bank_command)
 		struct flash_bank *p, *c;
 
 		/* register flash specific commands */
-		if (flash_drivers[i]-&gt;register_commands(cmd_ctx) != ERROR_OK)
+		if (flash_drivers[i]-&gt;register_commands(CMD_CTX) != ERROR_OK)
 		{
 			LOG_ERROR(&quot;couldn't register '%s' commands&quot;, CMD_ARGV[0]);
 			return ERROR_FAIL;
@@ -320,7 +320,7 @@ COMMAND_HANDLER(handle_flash_info_command)
 		if ((retval = p-&gt;driver-&gt;auto_probe(p)) != ERROR_OK)
 			return retval;
 
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 			      &quot;#%&quot; PRIi32 &quot; : %s at 0x%8.8&quot; PRIx32 &quot;, size 0x%8.8&quot; PRIx32 &quot;, buswidth %i, chipwidth %i&quot;,
 			      i,
 			      p-&gt;driver-&gt;name,
@@ -339,7 +339,7 @@ COMMAND_HANDLER(handle_flash_info_command)
 			else
 				protect_state = &quot;protection state unknown&quot;;
 
-			command_print(cmd_ctx,
+			command_print(CMD_CTX,
 				      &quot;\t#%3i: 0x%8.8&quot; PRIx32 &quot; (0x%&quot; PRIx32 &quot; %&quot; PRIi32 &quot;kB) %s&quot;,
 				      j,
 				      p-&gt;sectors[j].offset,
@@ -350,7 +350,7 @@ COMMAND_HANDLER(handle_flash_info_command)
 
 		*buf = '\0'; /* initialize buffer, otherwise it migh contain garbage if driver function fails */
 		retval = p-&gt;driver-&gt;info(p, buf, sizeof(buf));
-		command_print(cmd_ctx, &quot;%s&quot;, buf);
+		command_print(CMD_CTX, &quot;%s&quot;, buf);
 		if (retval != ERROR_OK)
 			LOG_ERROR(&quot;error retrieving flash info (%d)&quot;, retval);
 	}
@@ -374,22 +374,22 @@ COMMAND_HANDLER(handle_flash_probe_command)
 	{
 		if ((retval = p-&gt;driver-&gt;probe(p)) == ERROR_OK)
 		{
-			command_print(cmd_ctx, &quot;flash '%s' found at 0x%8.8&quot; PRIx32, p-&gt;driver-&gt;name, p-&gt;base);
+			command_print(CMD_CTX, &quot;flash '%s' found at 0x%8.8&quot; PRIx32, p-&gt;driver-&gt;name, p-&gt;base);
 		}
 		else if (retval == ERROR_FLASH_BANK_INVALID)
 		{
-			command_print(cmd_ctx, &quot;probing failed for flash bank '#%s' at 0x%8.8&quot; PRIx32,
+			command_print(CMD_CTX, &quot;probing failed for flash bank '#%s' at 0x%8.8&quot; PRIx32,
 						  CMD_ARGV[0], p-&gt;base);
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;unknown error when probing flash bank '#%s' at 0x%8.8&quot; PRIx32,
+			command_print(CMD_CTX, &quot;unknown error when probing flash bank '#%s' at 0x%8.8&quot; PRIx32,
 						  CMD_ARGV[0], p-&gt;base);
 		}
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;flash bank '#%s' is out of bounds&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;flash bank '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 	}
 
 	return ERROR_OK;
@@ -410,11 +410,11 @@ COMMAND_HANDLER(handle_flash_erase_check_command)
 	int j;
 	if ((retval = p-&gt;driver-&gt;erase_check(p)) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;successfully checked erase state&quot;);
+		command_print(CMD_CTX, &quot;successfully checked erase state&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unknown error when checking erase state of flash bank #%s at 0x%8.8&quot; PRIx32,
+		command_print(CMD_CTX, &quot;unknown error when checking erase state of flash bank #%s at 0x%8.8&quot; PRIx32,
 			CMD_ARGV[0], p-&gt;base);
 	}
 
@@ -429,7 +429,7 @@ COMMAND_HANDLER(handle_flash_erase_check_command)
 		else
 			erase_state = &quot;erase state unknown&quot;;
 
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 			      &quot;\t#%3i: 0x%8.8&quot; PRIx32 &quot; (0x%&quot; PRIx32 &quot; %&quot; PRIi32 &quot;kB) %s&quot;,
 			      j,
 			      p-&gt;sectors[j].offset,
@@ -448,7 +448,7 @@ COMMAND_HANDLER(handle_flash_erase_address_command)
 	int address;
 	int length;
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	if (CMD_ARGC != 2)
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -457,7 +457,7 @@ COMMAND_HANDLER(handle_flash_erase_address_command)
 	COMMAND_PARSE_NUMBER(int, CMD_ARGV[1], length);
 	if (length &lt;= 0)
 	{
-		command_print(cmd_ctx, &quot;Length must be &gt;0&quot;);
+		command_print(CMD_CTX, &quot;Length must be &gt;0&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
@@ -477,7 +477,7 @@ COMMAND_HANDLER(handle_flash_erase_address_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;erased address 0x%8.8x (length %i)&quot;
+		command_print(CMD_CTX, &quot;erased address 0x%8.8x (length %i)&quot;
 				&quot; in %fs (%0.3f kb/s)&quot;, address, length,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, length));
 	}
@@ -497,15 +497,15 @@ COMMAND_HANDLER(handle_flash_protect_check_command)
 
 	if ((retval = p-&gt;driver-&gt;protect_check(p)) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;successfully checked protect state&quot;);
+		command_print(CMD_CTX, &quot;successfully checked protect state&quot;);
 	}
 	else if (retval == ERROR_FLASH_OPERATION_FAILED)
 	{
-		command_print(cmd_ctx, &quot;checking protection state failed (possibly unsupported) by flash #%s at 0x%8.8&quot; PRIx32, CMD_ARGV[0], p-&gt;base);
+		command_print(CMD_CTX, &quot;checking protection state failed (possibly unsupported) by flash #%s at 0x%8.8&quot; PRIx32, CMD_ARGV[0], p-&gt;base);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unknown error when checking protection state of flash bank '#%s' at 0x%8.8&quot; PRIx32, CMD_ARGV[0], p-&gt;base);
+		command_print(CMD_CTX, &quot;unknown error when checking protection state of flash bank '#%s' at 0x%8.8&quot; PRIx32, CMD_ARGV[0], p-&gt;base);
 	}
 
 	return ERROR_OK;
@@ -550,7 +550,7 @@ COMMAND_HANDLER(handle_flash_erase_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], last);
 
 	int retval;
-	if ((retval = flash_check_sector_parameters(cmd_ctx,
+	if ((retval = flash_check_sector_parameters(CMD_CTX,
 			first, last, p-&gt;num_sectors)) != ERROR_OK)
 		return retval;
 
@@ -561,7 +561,7 @@ COMMAND_HANDLER(handle_flash_erase_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;erased sectors %&quot; PRIu32 &quot; &quot;
+		command_print(CMD_CTX, &quot;erased sectors %&quot; PRIu32 &quot; &quot;
 				&quot;through %&quot; PRIu32&quot; on flash bank %&quot; PRIu32 &quot; &quot;
 				&quot;in %fs&quot;, first, last, bank_nr, duration_elapsed(&amp;bench));
 	}
@@ -598,13 +598,13 @@ COMMAND_HANDLER(handle_flash_protect_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int retval;
-	if ((retval = flash_check_sector_parameters(cmd_ctx,
+	if ((retval = flash_check_sector_parameters(CMD_CTX,
 			first, last, p-&gt;num_sectors)) != ERROR_OK)
 		return retval;
 
 	retval = flash_driver_protect(p, set, first, last);
 	if (retval == ERROR_OK) {
-		command_print(cmd_ctx, &quot;%s protection for sectors %i &quot;
+		command_print(CMD_CTX, &quot;%s protection for sectors %i &quot;
 				&quot;through %i on flash bank %i&quot;,
 			(set) ? &quot;set&quot; : &quot;cleared&quot;, (int) first,
 			(int) last, (int) bank_nr);
@@ -615,7 +615,7 @@ COMMAND_HANDLER(handle_flash_protect_command)
 
 COMMAND_HANDLER(handle_flash_write_image_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	struct image image;
 	uint32_t written;
@@ -638,13 +638,13 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 			auto_erase = 1;
 			CMD_ARGV++;
 			CMD_ARGC--;
-			command_print(cmd_ctx, &quot;auto erase enabled&quot;);
+			command_print(CMD_CTX, &quot;auto erase enabled&quot;);
 		} else if (strcmp(CMD_ARGV[0], &quot;unlock&quot;) == 0)
 		{
 			auto_unlock = true;
 			CMD_ARGV++;
 			CMD_ARGC--;
-			command_print(cmd_ctx, &quot;auto unlock enabled&quot;);
+			command_print(CMD_CTX, &quot;auto unlock enabled&quot;);
 		} else
 		{
 			break;
@@ -693,7 +693,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;wrote %&quot; PRIu32 &quot; byte from file %s &quot;
+		command_print(CMD_CTX, &quot;wrote %&quot; PRIu32 &quot; byte from file %s &quot;
 				&quot;in %fs (%0.3f kb/s)&quot;, written, CMD_ARGV[0],
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, written));
 	}
@@ -714,7 +714,7 @@ COMMAND_HANDLER(handle_flash_fill_command)
 	uint32_t wrote = 0;
 	uint32_t cur_size = 0;
 	uint32_t chunk_count;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	uint32_t i;
 	uint32_t wordsize;
 
@@ -800,7 +800,7 @@ COMMAND_HANDLER(handle_flash_fill_command)
 
 	if (duration_measure(&amp;bench) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;wrote %&quot; PRIu32 &quot; bytes to 0x%8.8&quot; PRIx32 
+		command_print(CMD_CTX, &quot;wrote %&quot; PRIu32 &quot; bytes to 0x%8.8&quot; PRIx32 
 				&quot; in %fs (%0.3f kb/s)&quot;, wrote, address,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, wrote));
 	}
@@ -847,7 +847,7 @@ COMMAND_HANDLER(handle_flash_write_bank_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;wrote %zu byte from file %s to flash bank %u&quot;
+		command_print(CMD_CTX, &quot;wrote %zu byte from file %s to flash bank %u&quot;
 				&quot; at offset 0x%8.8&quot; PRIx32 &quot; in %fs (%0.3f kb/s)&quot;,
 				fileio.size, CMD_ARGV[1], p-&gt;bank_number, offset,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, fileio.size));
diff --git a/src/flash/lpc2000.c b/src/flash/lpc2000.c
index 6378130..191eb4b 100644
--- a/src/flash/lpc2000.c
+++ b/src/flash/lpc2000.c
@@ -764,14 +764,14 @@ COMMAND_HANDLER(lpc2000_handle_part_id_command)
 	{
 		if (status_code == ERROR_FLASH_OPERATION_FAILED)
 		{
-			command_print(cmd_ctx, &quot;no sufficient working area specified, can't access LPC2000 IAP interface&quot;);
+			command_print(CMD_CTX, &quot;no sufficient working area specified, can't access LPC2000 IAP interface&quot;);
 			return ERROR_OK;
 		}
-		command_print(cmd_ctx, &quot;lpc2000 IAP returned status code %i&quot;, status_code);
+		command_print(CMD_CTX, &quot;lpc2000 IAP returned status code %i&quot;, status_code);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;lpc2000 part id: 0x%8.8&quot; PRIx32 , result_table[0]);
+		command_print(CMD_CTX, &quot;lpc2000 part id: 0x%8.8&quot; PRIx32 , result_table[0]);
 	}
 
 	return ERROR_OK;
diff --git a/src/flash/lpc2900.c b/src/flash/lpc2900.c
index 98b13bf..1d5abd9 100644
--- a/src/flash/lpc2900.c
+++ b/src/flash/lpc2900.c
@@ -564,7 +564,7 @@ COMMAND_HANDLER(lpc2900_handle_signature_command)
 		return status;
 	}
 
-	command_print( cmd_ctx, &quot;signature: 0x%8.8&quot; PRIx32
+	command_print( CMD_CTX, &quot;signature: 0x%8.8&quot; PRIx32
 	                                  &quot;:0x%8.8&quot; PRIx32
 	                                  &quot;:0x%8.8&quot; PRIx32
 	                                  &quot;:0x%8.8&quot; PRIx32,
@@ -672,11 +672,11 @@ COMMAND_HANDLER(lpc2900_handle_password_command)
 
 	if( !lpc2900_info-&gt;risky )
 	{
-		command_print(cmd_ctx, &quot;Wrong password (use '%s')&quot;, ISS_PASSWORD);
+		command_print(CMD_CTX, &quot;Wrong password (use '%s')&quot;, ISS_PASSWORD);
 		return ERROR_COMMAND_ARGUMENT_INVALID;
 	}
 
-	command_print(cmd_ctx,
+	command_print(CMD_CTX,
                   &quot;Potentially dangerous operation allowed in next command!&quot;);
 
 	return ERROR_OK;
@@ -704,7 +704,7 @@ COMMAND_HANDLER(lpc2900_handle_write_custom_command)
 	/* Check if command execution is allowed. */
 	if( !lpc2900_info-&gt;risky )
 	{
-		command_print( cmd_ctx, &quot;Command execution not allowed!&quot; );
+		command_print( CMD_CTX, &quot;Command execution not allowed!&quot; );
 		return ERROR_COMMAND_ARGUMENT_INVALID;
 	}
 	lpc2900_info-&gt;risky = 0;
@@ -815,7 +815,7 @@ COMMAND_HANDLER(lpc2900_handle_secure_sector_command)
 	/* Check if command execution is allowed. */
 	if( !lpc2900_info-&gt;risky )
 	{
-		command_print( cmd_ctx, &quot;Command execution not allowed! &quot;
+		command_print( CMD_CTX, &quot;Command execution not allowed! &quot;
 		&quot;(use 'password' command first)&quot;);
 		return ERROR_COMMAND_ARGUMENT_INVALID;
 	}
@@ -829,7 +829,7 @@ COMMAND_HANDLER(lpc2900_handle_secure_sector_command)
 	    (last &gt;= bank-&gt;num_sectors) ||
 	    (first &gt; last) )
 	{
-		command_print( cmd_ctx, &quot;Illegal sector range&quot; );
+		command_print( CMD_CTX, &quot;Illegal sector range&quot; );
 		return ERROR_COMMAND_ARGUMENT_INVALID;
 	}
 
@@ -878,7 +878,7 @@ COMMAND_HANDLER(lpc2900_handle_secure_sector_command)
 		}
 	}
 
-	command_print( cmd_ctx,
+	command_print( CMD_CTX,
 	        &quot;Sectors security will become effective after next power cycle&quot;);
 
 	/* Update the sector security status */
@@ -914,7 +914,7 @@ COMMAND_HANDLER(lpc2900_handle_secure_jtag_command)
 	/* Check if command execution is allowed. */
 	if( !lpc2900_info-&gt;risky )
 	{
-		command_print( cmd_ctx, &quot;Command execution not allowed! &quot;
+		command_print( CMD_CTX, &quot;Command execution not allowed! &quot;
 		                        &quot;(use 'password' command first)&quot;);
 		return ERROR_COMMAND_ARGUMENT_INVALID;
 	}
diff --git a/src/flash/lpc3180_nand_controller.c b/src/flash/lpc3180_nand_controller.c
index 1de48f4..61bef90 100644
--- a/src/flash/lpc3180_nand_controller.c
+++ b/src/flash/lpc3180_nand_controller.c
@@ -846,7 +846,7 @@ COMMAND_HANDLER(handle_lpc3180_select_command)
 	struct nand_device *nand = get_nand_device_by_num(num);
 	if (!nand)
 	{
-		command_print(cmd_ctx, &quot;nand device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;nand device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -868,7 +868,7 @@ COMMAND_HANDLER(handle_lpc3180_select_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;%s controller selected&quot;, selected[lpc3180_info-&gt;selected_controller]);
+	command_print(CMD_CTX, &quot;%s controller selected&quot;, selected[lpc3180_info-&gt;selected_controller]);
 
 	return ERROR_OK;
 }
diff --git a/src/flash/mflash.c b/src/flash/mflash.c
index 64f332e..2a1fbe5 100644
--- a/src/flash/mflash.c
+++ b/src/flash/mflash.c
@@ -416,7 +416,7 @@ COMMAND_HANDLER(mg_probe_cmd)
 	ret = mg_mflash_probe();
 
 	if (ret == ERROR_OK) {
-		command_print(cmd_ctx, &quot;mflash (total %&quot; PRIu32 &quot; sectors) found at 0x%8.8&quot; PRIx32 &quot;&quot;,
+		command_print(CMD_CTX, &quot;mflash (total %&quot; PRIu32 &quot; sectors) found at 0x%8.8&quot; PRIx32 &quot;&quot;,
 				mflash_bank-&gt;drv_info-&gt;tot_sects, mflash_bank-&gt;base);
 	}
 
@@ -751,7 +751,7 @@ COMMAND_HANDLER(mg_write_cmd)
 
 	if (duration_measure(&amp;bench) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;wrote %zu byte from file %s &quot;
+		command_print(CMD_CTX, &quot;wrote %zu byte from file %s &quot;
 				&quot;in %fs (%0.3f kB/s)&quot;, fileio.size, CMD_ARGV[1],
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, fileio.size));
 	}
@@ -817,7 +817,7 @@ COMMAND_HANDLER(mg_dump_cmd)
 
 	if (duration_measure(&amp;bench) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;dump image (address 0x%8.8&quot; PRIx32 &quot; &quot;
+		command_print(CMD_CTX, &quot;dump image (address 0x%8.8&quot; PRIx32 &quot; &quot;
 				&quot;size %&quot; PRIu32 &quot;) to file %s in %fs (%0.3f kB/s)&quot;,
 				address, size, CMD_ARGV[1],
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, size));
diff --git a/src/flash/nand.c b/src/flash/nand.c
index ce713b9..c96354a 100644
--- a/src/flash/nand.c
+++ b/src/flash/nand.c
@@ -223,7 +223,7 @@ COMMAND_HANDLER(handle_nand_device_command)
 		if (strcmp(CMD_ARGV[0], nand_flash_controllers[i]-&gt;name) == 0)
 		{
 			/* register flash specific commands */
-			if ((retval = nand_flash_controllers[i]-&gt;register_commands(cmd_ctx)) != ERROR_OK)
+			if ((retval = nand_flash_controllers[i]-&gt;register_commands(CMD_CTX)) != ERROR_OK)
 			{
 				LOG_ERROR(&quot;couldn't register '%s' commands&quot;, CMD_ARGV[0]);
 				return retval;
@@ -312,7 +312,7 @@ COMMAND_HELPER(nand_command_get_device_by_num, unsigned name_index,
 	COMMAND_PARSE_NUMBER(uint, str, num);
 	*nand = get_nand_device_by_num(num);
 	if (!*nand) {
-		command_print(cmd_ctx, &quot;NAND flash device '#%s' is out of bounds&quot;, str);
+		command_print(CMD_CTX, &quot;NAND flash device '#%s' is out of bounds&quot;, str);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 	return ERROR_OK;
@@ -1050,21 +1050,21 @@ COMMAND_HANDLER(handle_nand_list_command)
 
 	if (!nand_devices)
 	{
-		command_print(cmd_ctx, &quot;no NAND flash devices configured&quot;);
+		command_print(CMD_CTX, &quot;no NAND flash devices configured&quot;);
 		return ERROR_OK;
 	}
 
 	for (p = nand_devices, i = 0; p; p = p-&gt;next, i++)
 	{
 		if (p-&gt;device)
-			command_print(cmd_ctx, &quot;#%i: %s (%s) &quot;
+			command_print(CMD_CTX, &quot;#%i: %s (%s) &quot;
 				&quot;pagesize: %i, buswidth: %i,\n\t&quot;
 				&quot;blocksize: %i, blocks: %i&quot;,
 				i, p-&gt;device-&gt;name, p-&gt;manufacturer-&gt;name,
 				p-&gt;page_size, p-&gt;bus_width,
 				p-&gt;erase_size, p-&gt;num_blocks);
 		else
-			command_print(cmd_ctx, &quot;#%i: not probed&quot;, i);
+			command_print(CMD_CTX, &quot;#%i: not probed&quot;, i);
 	}
 
 	return ERROR_OK;
@@ -1102,7 +1102,7 @@ COMMAND_HANDLER(handle_nand_info_command)
 
 	if (NULL == p-&gt;device)
 	{
-		command_print(cmd_ctx, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -1112,7 +1112,7 @@ COMMAND_HANDLER(handle_nand_info_command)
 	if (last &gt;= p-&gt;num_blocks)
 		last = p-&gt;num_blocks - 1;
 
-	command_print(cmd_ctx, &quot;#%i: %s (%s) pagesize: %i, buswidth: %i, erasesize: %i&quot;,
+	command_print(CMD_CTX, &quot;#%i: %s (%s) pagesize: %i, buswidth: %i, erasesize: %i&quot;,
 		i++, p-&gt;device-&gt;name, p-&gt;manufacturer-&gt;name, p-&gt;page_size, p-&gt;bus_width, p-&gt;erase_size);
 
 	for (j = first; j &lt;= last; j++)
@@ -1133,7 +1133,7 @@ COMMAND_HANDLER(handle_nand_info_command)
 		else
 			bad_state = &quot; (block condition unknown)&quot;;
 
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 			      &quot;\t#%i: 0x%8.8&quot; PRIx32 &quot; (%&quot; PRId32 &quot;kB) %s%s&quot;,
 			      j,
 			      p-&gt;blocks[j].offset,
@@ -1159,15 +1159,15 @@ COMMAND_HANDLER(handle_nand_probe_command)
 
 	if ((retval = nand_probe(p)) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;NAND flash device '%s' found&quot;, p-&gt;device-&gt;name);
+		command_print(CMD_CTX, &quot;NAND flash device '%s' found&quot;, p-&gt;device-&gt;name);
 	}
 	else if (retval == ERROR_NAND_OPERATION_FAILED)
 	{
-		command_print(cmd_ctx, &quot;probing failed for NAND flash device&quot;);
+		command_print(CMD_CTX, &quot;probing failed for NAND flash device&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unknown error when probing NAND flash device&quot;);
+		command_print(CMD_CTX, &quot;unknown error when probing NAND flash device&quot;);
 	}
 
 	return ERROR_OK;
@@ -1212,18 +1212,18 @@ COMMAND_HANDLER(handle_nand_erase_command)
 	retval = nand_erase(p, offset, offset + length - 1);
 	if (retval == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;erased blocks %lu to %lu &quot;
+		command_print(CMD_CTX, &quot;erased blocks %lu to %lu &quot;
 				&quot;on NAND flash device #%s '%s'&quot;,
 				offset, offset + length,
 				CMD_ARGV[0], p-&gt;device-&gt;name);
 	}
 	else if (retval == ERROR_NAND_OPERATION_FAILED)
 	{
-		command_print(cmd_ctx, &quot;erase failed&quot;);
+		command_print(CMD_CTX, &quot;erase failed&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unknown error when erasing NAND flash device&quot;);
+		command_print(CMD_CTX, &quot;unknown error when erasing NAND flash device&quot;);
 	}
 
 	return ERROR_OK;
@@ -1269,17 +1269,17 @@ COMMAND_HANDLER(handle_nand_check_bad_blocks_command)
 	retval = nand_build_bbt(p, first, last);
 	if (retval == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;checked NAND flash device for bad blocks, &quot;
+		command_print(CMD_CTX, &quot;checked NAND flash device for bad blocks, &quot;
 				&quot;use \&quot;nand info\&quot; command to list blocks&quot;);
 	}
 	else if (retval == ERROR_NAND_OPERATION_FAILED)
 	{
-		command_print(cmd_ctx, &quot;error when checking for bad blocks on &quot;
+		command_print(CMD_CTX, &quot;error when checking for bad blocks on &quot;
 				&quot;NAND flash device&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unknown error when checking for bad &quot;
+		command_print(CMD_CTX, &quot;unknown error when checking for bad &quot;
 				&quot;blocks on NAND flash device&quot;);
 	}
 
@@ -1399,7 +1399,7 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 
 	if (NULL == nand-&gt;device)
 	{
-		command_print(cmd_ctx, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -1409,7 +1409,7 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], state-&gt;size);
 			if (state-&gt;size % nand-&gt;page_size)
 			{
-				command_print(cmd_ctx, &quot;only page-aligned sizes are supported&quot;);
+				command_print(CMD_CTX, &quot;only page-aligned sizes are supported&quot;);
 				return ERROR_COMMAND_SYNTAX_ERROR;
 			}
 	}
@@ -1428,13 +1428,13 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 				state-&gt;oob_format |= NAND_OOB_SW_ECC_KW;
 			else
 			{
-				command_print(cmd_ctx, &quot;unknown option: %s&quot;, CMD_ARGV[i]);
+				command_print(CMD_CTX, &quot;unknown option: %s&quot;, CMD_ARGV[i]);
 				return ERROR_COMMAND_SYNTAX_ERROR;
 			}
 		}
 	}
 
-	retval = nand_fileio_start(cmd_ctx, nand, CMD_ARGV[1], filemode, state);
+	retval = nand_fileio_start(CMD_CTX, nand, CMD_ARGV[1], filemode, state);
 	if (ERROR_OK != retval)
 		return retval;
 
@@ -1517,7 +1517,7 @@ COMMAND_HANDLER(handle_nand_write_command)
 		int bytes_read = nand_fileio_read(nand, &amp;s);
 		if (bytes_read &lt;= 0)
 		{
-			command_print(cmd_ctx, &quot;error while reading file&quot;);
+			command_print(CMD_CTX, &quot;error while reading file&quot;);
 			return nand_fileio_cleanup(&amp;s);
 		}
 		s.size -= bytes_read;
@@ -1526,7 +1526,7 @@ COMMAND_HANDLER(handle_nand_write_command)
 				s.page, s.page_size, s.oob, s.oob_size);
 		if (ERROR_OK != retval)
 		{
-			command_print(cmd_ctx, &quot;failed writing file %s &quot;
+			command_print(CMD_CTX, &quot;failed writing file %s &quot;
 				&quot;to NAND flash %s at offset 0x%8.8&quot; PRIx32,
 				CMD_ARGV[1], CMD_ARGV[0], s.address);
 			return nand_fileio_cleanup(&amp;s);
@@ -1536,7 +1536,7 @@ COMMAND_HANDLER(handle_nand_write_command)
 
 	if (nand_fileio_finish(&amp;s))
 	{
-		command_print(cmd_ctx, &quot;wrote file %s to NAND flash %s up to &quot;
+		command_print(CMD_CTX, &quot;wrote file %s to NAND flash %s up to &quot;
 				&quot;offset 0x%8.8&quot; PRIx32 &quot; in %fs (%0.3f kb/s)&quot;,
 				CMD_ARGV[1], CMD_ARGV[0], s.address, duration_elapsed(&amp;s.bench),
 				duration_kbps(&amp;s.bench, total_bytes));
@@ -1558,7 +1558,7 @@ COMMAND_HANDLER(handle_nand_verify_command)
 	dev.address = file.address;
 	dev.size = file.size;
 	dev.oob_format = file.oob_format;
-	retval = nand_fileio_start(cmd_ctx, nand, NULL, FILEIO_NONE, &amp;dev);
+	retval = nand_fileio_start(CMD_CTX, nand, NULL, FILEIO_NONE, &amp;dev);
 	if (ERROR_OK != retval)
 		return retval;
 
@@ -1568,7 +1568,7 @@ COMMAND_HANDLER(handle_nand_verify_command)
 				dev.page, dev.page_size, dev.oob, dev.oob_size);
 		if (ERROR_OK != retval)
 		{
-			command_print(cmd_ctx, &quot;reading NAND flash page failed&quot;);
+			command_print(CMD_CTX, &quot;reading NAND flash page failed&quot;);
 			nand_fileio_cleanup(&amp;dev);
 			return nand_fileio_cleanup(&amp;file);
 		}
@@ -1576,7 +1576,7 @@ COMMAND_HANDLER(handle_nand_verify_command)
 		int bytes_read = nand_fileio_read(nand, &amp;file);
 		if (bytes_read &lt;= 0)
 		{
-			command_print(cmd_ctx, &quot;error while reading file&quot;);
+			command_print(CMD_CTX, &quot;error while reading file&quot;);
 			nand_fileio_cleanup(&amp;dev);
 			return nand_fileio_cleanup(&amp;file);
 		}
@@ -1584,7 +1584,7 @@ COMMAND_HANDLER(handle_nand_verify_command)
 		if ((dev.page &amp;&amp; memcmp(dev.page, file.page, dev.page_size)) ||
 		    (dev.oob &amp;&amp; memcmp(dev.oob, file.oob, dev.oob_size)) )
 		{
-			command_print(cmd_ctx, &quot;NAND flash contents differ &quot;
+			command_print(CMD_CTX, &quot;NAND flash contents differ &quot;
 						&quot;at 0x%8.8&quot; PRIx32, dev.address);
 			nand_fileio_cleanup(&amp;dev);
 			return nand_fileio_cleanup(&amp;file);
@@ -1596,7 +1596,7 @@ COMMAND_HANDLER(handle_nand_verify_command)
 
 	if (nand_fileio_finish(&amp;file) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;verified file %s in NAND flash %s &quot;
+		command_print(CMD_CTX, &quot;verified file %s in NAND flash %s &quot;
 				&quot;up to offset 0x%8.8&quot; PRIx32 &quot; in %fs (%0.3f kb/s)&quot;,
 				CMD_ARGV[1], CMD_ARGV[0], dev.address, duration_elapsed(&amp;file.bench),
 				duration_kbps(&amp;file.bench, dev.size));
@@ -1621,7 +1621,7 @@ COMMAND_HANDLER(handle_nand_dump_command)
 				s.page, s.page_size, s.oob, s.oob_size);
 		if (ERROR_OK != retval)
 		{
-			command_print(cmd_ctx, &quot;reading NAND flash page failed&quot;);
+			command_print(CMD_CTX, &quot;reading NAND flash page failed&quot;);
 			return nand_fileio_cleanup(&amp;s);
 		}
 
@@ -1637,7 +1637,7 @@ COMMAND_HANDLER(handle_nand_dump_command)
 
 	if (nand_fileio_finish(&amp;s) == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;dumped %zu bytes in %fs (%0.3f kb/s)&quot;, 
+		command_print(CMD_CTX, &quot;dumped %zu bytes in %fs (%0.3f kb/s)&quot;, 
 				s.fileio.size, duration_elapsed(&amp;s.bench),
 				duration_kbps(&amp;s.bench, s.fileio.size));
 	}
@@ -1658,7 +1658,7 @@ COMMAND_HANDLER(handle_nand_raw_access_command)
 
 	if (NULL == p-&gt;device)
 	{
-		command_print(cmd_ctx, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;#%s: not probed&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -1673,7 +1673,7 @@ COMMAND_HANDLER(handle_nand_raw_access_command)
 	}
 
 	const char *msg = p-&gt;use_raw ? &quot;enabled&quot; : &quot;disabled&quot;;
-	command_print(cmd_ctx, &quot;raw access is %s&quot;, msg);
+	command_print(CMD_CTX, &quot;raw access is %s&quot;, msg);
 
 	return ERROR_OK;
 }
diff --git a/src/flash/pic32mx.c b/src/flash/pic32mx.c
index 05e0474..4bfe91b 100644
--- a/src/flash/pic32mx.c
+++ b/src/flash/pic32mx.c
@@ -679,7 +679,7 @@ COMMAND_HANDLER(pic32mx_handle_lock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;pic32mx lock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;pic32mx lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -700,7 +700,7 @@ COMMAND_HANDLER(pic32mx_handle_lock_command)
 
 	if (pic32mx_erase_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;pic32mx failed to erase options&quot;);
+		command_print(CMD_CTX, &quot;pic32mx failed to erase options&quot;);
 		return ERROR_OK;
 	}
 
@@ -709,11 +709,11 @@ COMMAND_HANDLER(pic32mx_handle_lock_command)
 
 	if (pic32mx_write_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;pic32mx failed to lock device&quot;);
+		command_print(CMD_CTX, &quot;pic32mx failed to lock device&quot;);
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;pic32mx locked&quot;);
+	command_print(CMD_CTX, &quot;pic32mx locked&quot;);
 
 	return ERROR_OK;
 }
@@ -725,7 +725,7 @@ COMMAND_HANDLER(pic32mx_handle_unlock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;pic32mx unlock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;pic32mx unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -746,17 +746,17 @@ COMMAND_HANDLER(pic32mx_handle_unlock_command)
 
 	if (pic32mx_erase_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;pic32mx failed to unlock device&quot;);
+		command_print(CMD_CTX, &quot;pic32mx failed to unlock device&quot;);
 		return ERROR_OK;
 	}
 
 	if (pic32mx_write_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;pic32mx failed to lock device&quot;);
+		command_print(CMD_CTX, &quot;pic32mx failed to lock device&quot;);
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;pic32mx unlocked&quot;);
+	command_print(CMD_CTX, &quot;pic32mx unlocked&quot;);
 
 	return ERROR_OK;
 }
@@ -815,7 +815,7 @@ COMMAND_HANDLER(pic32mx_handle_chip_erase_command)
 
 	if (CMD_ARGC != 0)
 	{
-		command_print(cmd_ctx, &quot;pic32mx chip_erase&quot;);
+		command_print(CMD_CTX, &quot;pic32mx chip_erase&quot;);
 		return ERROR_OK;
 	}
 
@@ -832,11 +832,11 @@ COMMAND_HANDLER(pic32mx_handle_chip_erase_command)
 			bank-&gt;sectors[i].is_erased = 1;
 		}
 
-		command_print(cmd_ctx, &quot;pic32mx chip erase complete&quot;);
+		command_print(CMD_CTX, &quot;pic32mx chip erase complete&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;pic32mx chip erase failed&quot;);
+		command_print(CMD_CTX, &quot;pic32mx chip erase failed&quot;);
 	}
 #endif
 
@@ -850,7 +850,7 @@ COMMAND_HANDLER(pic32mx_handle_pgm_word_command)
 
 	if (CMD_ARGC != 3)
 	{
-		command_print(cmd_ctx, &quot;pic32mx pgm_word &lt;addr&gt; &lt;value&gt; &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;pic32mx pgm_word &lt;addr&gt; &lt;value&gt; &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -864,7 +864,7 @@ COMMAND_HANDLER(pic32mx_handle_pgm_word_command)
 
 	if (address &lt; bank-&gt;base || address &gt;= (bank-&gt;base + bank-&gt;size))
 	{
-		command_print(cmd_ctx, &quot;flash address '%s' is out of bounds&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;flash address '%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -876,9 +876,9 @@ COMMAND_HANDLER(pic32mx_handle_pgm_word_command)
 		res = ERROR_FLASH_OPERATION_FAILED;
 
 	if (res == ERROR_OK)
-		command_print(cmd_ctx, &quot;pic32mx pgm word complete&quot;);
+		command_print(CMD_CTX, &quot;pic32mx pgm word complete&quot;);
 	else
-		command_print(cmd_ctx, &quot;pic32mx pgm word failed (status = 0x%x)&quot;, status);
+		command_print(CMD_CTX, &quot;pic32mx pgm word failed (status = 0x%x)&quot;, status);
 
 	return ERROR_OK;
 }
diff --git a/src/flash/stellaris.c b/src/flash/stellaris.c
index 4f28c09..a18c99b 100644
--- a/src/flash/stellaris.c
+++ b/src/flash/stellaris.c
@@ -1134,7 +1134,7 @@ COMMAND_HANDLER(stellaris_handle_mass_erase_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;stellaris mass_erase &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;stellaris mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1151,11 +1151,11 @@ COMMAND_HANDLER(stellaris_handle_mass_erase_command)
 			bank-&gt;sectors[i].is_erased = 1;
 		}
 
-		command_print(cmd_ctx, &quot;stellaris mass erase complete&quot;);
+		command_print(CMD_CTX, &quot;stellaris mass erase complete&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;stellaris mass erase failed&quot;);
+		command_print(CMD_CTX, &quot;stellaris mass erase failed&quot;);
 	}
 
 	return ERROR_OK;
diff --git a/src/flash/stm32x.c b/src/flash/stm32x.c
index f59ed61..4db338d 100644
--- a/src/flash/stm32x.c
+++ b/src/flash/stm32x.c
@@ -900,7 +900,7 @@ COMMAND_HANDLER(stm32x_handle_lock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;stm32x lock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;stm32x lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -921,7 +921,7 @@ COMMAND_HANDLER(stm32x_handle_lock_command)
 
 	if (stm32x_erase_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to erase options&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to erase options&quot;);
 		return ERROR_OK;
 	}
 
@@ -930,11 +930,11 @@ COMMAND_HANDLER(stm32x_handle_lock_command)
 
 	if (stm32x_write_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to lock device&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to lock device&quot;);
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;stm32x locked&quot;);
+	command_print(CMD_CTX, &quot;stm32x locked&quot;);
 
 	return ERROR_OK;
 }
@@ -946,7 +946,7 @@ COMMAND_HANDLER(stm32x_handle_unlock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;stm32x unlock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;stm32x unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -967,17 +967,17 @@ COMMAND_HANDLER(stm32x_handle_unlock_command)
 
 	if (stm32x_erase_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to unlock device&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to unlock device&quot;);
 		return ERROR_OK;
 	}
 
 	if (stm32x_write_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to lock device&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to lock device&quot;);
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;stm32x unlocked&quot;);
+	command_print(CMD_CTX, &quot;stm32x unlocked&quot;);
 
 	return ERROR_OK;
 }
@@ -990,7 +990,7 @@ COMMAND_HANDLER(stm32x_handle_options_read_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;stm32x options_read &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;stm32x options_read &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1010,30 +1010,30 @@ COMMAND_HANDLER(stm32x_handle_options_read_command)
 	}
 
 	target_read_u32(target, STM32_FLASH_OBR, &amp;optionbyte);
-	command_print(cmd_ctx, &quot;Option Byte: 0x%&quot; PRIx32 &quot;&quot;, optionbyte);
+	command_print(CMD_CTX, &quot;Option Byte: 0x%&quot; PRIx32 &quot;&quot;, optionbyte);
 
 	if (buf_get_u32((uint8_t*)&amp;optionbyte, OPT_ERROR, 1))
-		command_print(cmd_ctx, &quot;Option Byte Complement Error&quot;);
+		command_print(CMD_CTX, &quot;Option Byte Complement Error&quot;);
 
 	if (buf_get_u32((uint8_t*)&amp;optionbyte, OPT_READOUT, 1))
-		command_print(cmd_ctx, &quot;Readout Protection On&quot;);
+		command_print(CMD_CTX, &quot;Readout Protection On&quot;);
 	else
-		command_print(cmd_ctx, &quot;Readout Protection Off&quot;);
+		command_print(CMD_CTX, &quot;Readout Protection Off&quot;);
 
 	if (buf_get_u32((uint8_t*)&amp;optionbyte, OPT_RDWDGSW, 1))
-		command_print(cmd_ctx, &quot;Software Watchdog&quot;);
+		command_print(CMD_CTX, &quot;Software Watchdog&quot;);
 	else
-		command_print(cmd_ctx, &quot;Hardware Watchdog&quot;);
+		command_print(CMD_CTX, &quot;Hardware Watchdog&quot;);
 
 	if (buf_get_u32((uint8_t*)&amp;optionbyte, OPT_RDRSTSTOP, 1))
-		command_print(cmd_ctx, &quot;Stop: No reset generated&quot;);
+		command_print(CMD_CTX, &quot;Stop: No reset generated&quot;);
 	else
-		command_print(cmd_ctx, &quot;Stop: Reset generated&quot;);
+		command_print(CMD_CTX, &quot;Stop: Reset generated&quot;);
 
 	if (buf_get_u32((uint8_t*)&amp;optionbyte, OPT_RDRSTSTDBY, 1))
-		command_print(cmd_ctx, &quot;Standby: No reset generated&quot;);
+		command_print(CMD_CTX, &quot;Standby: No reset generated&quot;);
 	else
-		command_print(cmd_ctx, &quot;Standby: Reset generated&quot;);
+		command_print(CMD_CTX, &quot;Standby: Reset generated&quot;);
 
 	return ERROR_OK;
 }
@@ -1046,7 +1046,7 @@ COMMAND_HANDLER(stm32x_handle_options_write_command)
 
 	if (CMD_ARGC &lt; 4)
 	{
-		command_print(cmd_ctx, &quot;stm32x options_write &lt;bank&gt; &lt;SWWDG | HWWDG&gt; &lt;RSTSTNDBY | NORSTSTNDBY&gt; &lt;RSTSTOP | NORSTSTOP&gt;&quot;);
+		command_print(CMD_CTX, &quot;stm32x options_write &lt;bank&gt; &lt;SWWDG | HWWDG&gt; &lt;RSTSTNDBY | NORSTSTNDBY&gt; &lt;RSTSTOP | NORSTSTOP&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1094,7 +1094,7 @@ COMMAND_HANDLER(stm32x_handle_options_write_command)
 
 	if (stm32x_erase_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to erase options&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to erase options&quot;);
 		return ERROR_OK;
 	}
 
@@ -1102,11 +1102,11 @@ COMMAND_HANDLER(stm32x_handle_options_write_command)
 
 	if (stm32x_write_options(bank) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;stm32x failed to write options&quot;);
+		command_print(CMD_CTX, &quot;stm32x failed to write options&quot;);
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;stm32x write options complete&quot;);
+	command_print(CMD_CTX, &quot;stm32x write options complete&quot;);
 
 	return ERROR_OK;
 }
@@ -1155,7 +1155,7 @@ COMMAND_HANDLER(stm32x_handle_mass_erase_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;stm32x mass_erase &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;stm32x mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1172,11 +1172,11 @@ COMMAND_HANDLER(stm32x_handle_mass_erase_command)
 			bank-&gt;sectors[i].is_erased = 1;
 		}
 
-		command_print(cmd_ctx, &quot;stm32x mass erase complete&quot;);
+		command_print(CMD_CTX, &quot;stm32x mass erase complete&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;stm32x mass erase failed&quot;);
+		command_print(CMD_CTX, &quot;stm32x mass erase failed&quot;);
 	}
 
 	return ERROR_OK;
diff --git a/src/flash/str7x.c b/src/flash/str7x.c
index 76b6467..da1899d 100644
--- a/src/flash/str7x.c
+++ b/src/flash/str7x.c
@@ -613,7 +613,7 @@ COMMAND_HANDLER(str7x_handle_disable_jtag_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str7x disable_jtag &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str7x disable_jtag &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
diff --git a/src/flash/str9xpec.c b/src/flash/str9xpec.c
index a87d0ff..de222fb 100644
--- a/src/flash/str9xpec.c
+++ b/src/flash/str9xpec.c
@@ -759,7 +759,7 @@ COMMAND_HANDLER(str9xpec_handle_part_id_command)
 
 	idcode = buf_get_u32(buffer, 0, 32);
 
-	command_print(cmd_ctx, &quot;str9xpec part id: 0x%8.8&quot; PRIx32 &quot;&quot;, idcode);
+	command_print(CMD_CTX, &quot;str9xpec part id: 0x%8.8&quot; PRIx32 &quot;&quot;, idcode);
 
 	free(buffer);
 
@@ -784,7 +784,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_read_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_read &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_read &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -802,33 +802,33 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_read_command)
 
 	/* boot bank */
 	if (buf_get_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_CSMAPBIT, 1))
-		command_print(cmd_ctx, &quot;CS Map: bank1&quot;);
+		command_print(CMD_CTX, &quot;CS Map: bank1&quot;);
 	else
-		command_print(cmd_ctx, &quot;CS Map: bank0&quot;);
+		command_print(CMD_CTX, &quot;CS Map: bank0&quot;);
 
 	/* OTP lock */
 	if (buf_get_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_OTPBIT, 1))
-		command_print(cmd_ctx, &quot;OTP Lock: OTP Locked&quot;);
+		command_print(CMD_CTX, &quot;OTP Lock: OTP Locked&quot;);
 	else
-		command_print(cmd_ctx, &quot;OTP Lock: OTP Unlocked&quot;);
+		command_print(CMD_CTX, &quot;OTP Lock: OTP Unlocked&quot;);
 
 	/* LVD Threshold */
 	if (buf_get_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_LVDTHRESBIT, 1))
-		command_print(cmd_ctx, &quot;LVD Threshold: 2.7v&quot;);
+		command_print(CMD_CTX, &quot;LVD Threshold: 2.7v&quot;);
 	else
-		command_print(cmd_ctx, &quot;LVD Threshold: 2.4v&quot;);
+		command_print(CMD_CTX, &quot;LVD Threshold: 2.4v&quot;);
 
 	/* LVD reset warning */
 	if (buf_get_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_LVDWARNBIT, 1))
-		command_print(cmd_ctx, &quot;LVD Reset Warning: VDD or VDDQ Inputs&quot;);
+		command_print(CMD_CTX, &quot;LVD Reset Warning: VDD or VDDQ Inputs&quot;);
 	else
-		command_print(cmd_ctx, &quot;LVD Reset Warning: VDD Input Only&quot;);
+		command_print(CMD_CTX, &quot;LVD Reset Warning: VDD Input Only&quot;);
 
 	/* LVD reset select */
 	if (buf_get_u32(str9xpec_info-&gt;options, STR9XPEC_OPT_LVDSELBIT, 1))
-		command_print(cmd_ctx, &quot;LVD Reset Selection: VDD or VDDQ Inputs&quot;);
+		command_print(CMD_CTX, &quot;LVD Reset Selection: VDD or VDDQ Inputs&quot;);
 	else
-		command_print(cmd_ctx, &quot;LVD Reset Selection: VDD Input Only&quot;);
+		command_print(CMD_CTX, &quot;LVD Reset Selection: VDD Input Only&quot;);
 
 	return ERROR_OK;
 }
@@ -900,7 +900,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_write_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_write &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_write &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -923,7 +923,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_cmap_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_cmap &lt;bank&gt; &lt;bank0 | bank1&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_cmap &lt;bank&gt; &lt;bank0 | bank1&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -952,7 +952,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdthd_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_lvdthd &lt;bank&gt; &lt;2.4v | 2.7v&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_lvdthd &lt;bank&gt; &lt;2.4v | 2.7v&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -981,7 +981,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdsel_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_lvdsel &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_lvdsel &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1010,7 +1010,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdwarn_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;str9xpec options_lvdwarn &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec options_lvdwarn &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1039,7 +1039,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_lock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec lock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1062,7 +1062,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_unlock_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec unlock &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1088,7 +1088,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_enable_turbo_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec enable_turbo &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec enable_turbo &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1106,14 +1106,14 @@ COMMAND_HANDLER(str9xpec_handle_flash_enable_turbo_command)
 	if (tap1 == NULL)
 	{
 		/* things are *WRONG* */
-		command_print(cmd_ctx,&quot;**STR9FLASH** (tap1) invalid chain?&quot;);
+		command_print(CMD_CTX,&quot;**STR9FLASH** (tap1) invalid chain?&quot;);
 		return ERROR_OK;
 	}
 	tap2 = tap1-&gt;next_tap;
 	if (tap2 == NULL)
 	{
 		/* things are *WRONG* */
-		command_print(cmd_ctx,&quot;**STR9FLASH** (tap2) invalid chain?&quot;);
+		command_print(CMD_CTX,&quot;**STR9FLASH** (tap2) invalid chain?&quot;);
 		return ERROR_OK;
 	}
 
@@ -1135,7 +1135,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_disable_turbo_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;str9xpec disable_turbo &lt;bank&gt;&quot;);
+		command_print(CMD_CTX, &quot;str9xpec disable_turbo &lt;bank&gt;&quot;);
 		return ERROR_OK;
 	}
 
diff --git a/src/flash/tms470.c b/src/flash/tms470.c
index 890db73..f6f3900 100644
--- a/src/flash/tms470.c
+++ b/src/flash/tms470.c
@@ -293,7 +293,7 @@ COMMAND_HANDLER(tms470_handle_flash_keyset_command)
 {
 	if (CMD_ARGC &gt; 4)
 	{
-		command_print(cmd_ctx, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
+		command_print(CMD_CTX, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 	else if (CMD_ARGC == 4)
@@ -306,7 +306,7 @@ COMMAND_HANDLER(tms470_handle_flash_keyset_command)
 
 			if (1 != sscanf(&amp;CMD_ARGV[i][start], &quot;%&quot; SCNx32 &quot;&quot;, &amp;flashKeys[i]))
 			{
-				command_print(cmd_ctx, &quot;could not process flash key %s&quot;, CMD_ARGV[i]);
+				command_print(CMD_CTX, &quot;could not process flash key %s&quot;, CMD_ARGV[i]);
 				LOG_ERROR(&quot;could not process flash key %s&quot;, CMD_ARGV[i]);
 				return ERROR_INVALID_ARGUMENTS;
 			}
@@ -316,18 +316,18 @@ COMMAND_HANDLER(tms470_handle_flash_keyset_command)
 	}
 	else if (CMD_ARGC != 0)
 	{
-		command_print(cmd_ctx, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
+		command_print(CMD_CTX, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
 	if (keysSet)
 	{
-		command_print(cmd_ctx, &quot;using flash keys 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;&quot;,
+		command_print(CMD_CTX, &quot;using flash keys 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;, 0x%08&quot; PRIx32 &quot;&quot;,
 			      flashKeys[0], flashKeys[1], flashKeys[2], flashKeys[3]);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;flash keys not set&quot;);
+		command_print(CMD_CTX, &quot;flash keys not set&quot;);
 	}
 
 	return ERROR_OK;
@@ -357,7 +357,7 @@ COMMAND_HANDLER(tms470_handle_osc_megahertz_command)
 {
 	if (CMD_ARGC &gt; 1)
 	{
-		command_print(cmd_ctx, &quot;tms470 osc_megahertz &lt;MHz&gt;&quot;);
+		command_print(CMD_CTX, &quot;tms470 osc_megahertz &lt;MHz&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 	else if (CMD_ARGC == 1)
@@ -368,12 +368,12 @@ COMMAND_HANDLER(tms470_handle_osc_megahertz_command)
 	if (oscMHz &lt;= 0)
 	{
 		LOG_ERROR(&quot;osc_megahertz must be positive and non-zero!&quot;);
-		command_print(cmd_ctx, &quot;osc_megahertz must be positive and non-zero!&quot;);
+		command_print(CMD_CTX, &quot;osc_megahertz must be positive and non-zero!&quot;);
 		oscMHz = 12;
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
-	command_print(cmd_ctx, &quot;osc_megahertz=%d&quot;, oscMHz);
+	command_print(CMD_CTX, &quot;osc_megahertz=%d&quot;, oscMHz);
 
 	return ERROR_OK;
 }
@@ -386,7 +386,7 @@ COMMAND_HANDLER(tms470_handle_plldis_command)
 {
 	if (CMD_ARGC &gt; 1)
 	{
-		command_print(cmd_ctx, &quot;tms470 plldis &lt;0 | 1&gt;&quot;);
+		command_print(CMD_CTX, &quot;tms470 plldis &lt;0 | 1&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 	else if (CMD_ARGC == 1)
@@ -395,7 +395,7 @@ COMMAND_HANDLER(tms470_handle_plldis_command)
 		plldis = plldis ? 1 : 0;
 	}
 
-	command_print(cmd_ctx, &quot;plldis=%d&quot;, plldis);
+	command_print(CMD_CTX, &quot;plldis=%d&quot;, plldis);
 
 	return ERROR_OK;
 }
diff --git a/src/hello.c b/src/hello.c
index df0cb02..dd33650 100644
--- a/src/hello.c
+++ b/src/hello.c
@@ -44,7 +44,7 @@ COMMAND_HANDLER(handle_hello_command)
 	const char *sep, *name;
 	int retval = CALL_COMMAND_HANDLER(handle_hello_args, &amp;sep, &amp;name);
 	if (ERROR_OK == retval)
-		command_print(cmd_ctx, &quot;Greetings%s%s!&quot;, sep, name);
+		command_print(CMD_CTX, &quot;Greetings%s%s!&quot;, sep, name);
 	return retval;
 }
 
diff --git a/src/helper/command.h b/src/helper/command.h
index 3e36627..7484964 100644
--- a/src/helper/command.h
+++ b/src/helper/command.h
@@ -244,7 +244,7 @@ DECLARE_PARSE_WRAPPER(_s8, int8_t);
 	do { \
 		int retval = parse_##type(in, &amp;(out)); \
 		if (ERROR_OK != retval) { \
-			command_print(cmd_ctx, stringify(out) \
+			command_print(CMD_CTX, stringify(out) \
 				&quot; option value ('%s') is not valid&quot;, in); \
 			return retval; \
 		} \
diff --git a/src/helper/ioutil.c b/src/helper/ioutil.c
index 3fc1a96..3fb3014 100644
--- a/src/helper/ioutil.c
+++ b/src/helper/ioutil.c
@@ -61,13 +61,13 @@ COMMAND_HANDLER(handle_rm_command)
 {
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;rm &lt;filename&gt;&quot;);
+		command_print(CMD_CTX, &quot;rm &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
 	if (unlink(CMD_ARGV[0]) != 0)
 	{
-		command_print(cmd_ctx, &quot;failed: %d&quot;, errno);
+		command_print(CMD_CTX, &quot;failed: %d&quot;, errno);
 	}
 
 	return ERROR_OK;
@@ -137,7 +137,7 @@ COMMAND_HANDLER(handle_cat_command)
 {
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;cat &lt;filename&gt;&quot;);
+		command_print(CMD_CTX, &quot;cat &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -148,12 +148,12 @@ COMMAND_HANDLER(handle_cat_command)
 	int retval = loadFile(CMD_ARGV[0], &amp;data, &amp;len);
 	if (retval == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;%s&quot;, (char *)data);
+		command_print(CMD_CTX, &quot;%s&quot;, (char *)data);
 		free(data);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;%s not found %d&quot;, CMD_ARGV[0], retval);
+		command_print(CMD_CTX, &quot;%s not found %d&quot;, CMD_ARGV[0], retval);
 	}
 
 	return ERROR_OK;
@@ -163,7 +163,7 @@ COMMAND_HANDLER(handle_trunc_command)
 {
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;trunc &lt;filename&gt;&quot;);
+		command_print(CMD_CTX, &quot;trunc &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -182,7 +182,7 @@ COMMAND_HANDLER(handle_meminfo_command)
 
 	if (CMD_ARGC != 0)
 	{
-		command_print(cmd_ctx, &quot;meminfo&quot;);
+		command_print(CMD_CTX, &quot;meminfo&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -190,11 +190,11 @@ COMMAND_HANDLER(handle_meminfo_command)
 
 	if (prev &gt; 0)
 	{
-		command_print(cmd_ctx, &quot;Diff:            %d&quot;, prev - info.fordblks);
+		command_print(CMD_CTX, &quot;Diff:            %d&quot;, prev - info.fordblks);
 	}
 	prev = info.fordblks;
 
-	command_print(cmd_ctx, &quot;Available ram:   %d&quot;, info.fordblks);
+	command_print(CMD_CTX, &quot;Available ram:   %d&quot;, info.fordblks);
 
 	return ERROR_OK;
 }
@@ -204,7 +204,7 @@ COMMAND_HANDLER(handle_append_command)
 {
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;append &lt;filename&gt; [&lt;string1&gt;, [&lt;string2&gt;, ...]]&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
@@ -276,7 +276,7 @@ COMMAND_HANDLER(handle_cp_command)
 			break;
 		}
 
-		command_print(cmd_ctx, &quot;%zu&quot;, len - pos);
+		command_print(CMD_CTX, &quot;%zu&quot;, len - pos);
 
 		pos += chunk;
 
@@ -286,10 +286,10 @@ COMMAND_HANDLER(handle_cp_command)
 
 	if (retval == ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;Copied %s to %s&quot;, CMD_ARGV[0], CMD_ARGV[1]);
+		command_print(CMD_CTX, &quot;Copied %s to %s&quot;, CMD_ARGV[0], CMD_ARGV[1]);
 	} else
 	{
-		command_print(cmd_ctx, &quot;Failed: %d&quot;, retval);
+		command_print(CMD_CTX, &quot;Failed: %d&quot;, retval);
 	}
 
 	if (data != NULL)
diff --git a/src/helper/log.c b/src/helper/log.c
index 0e04c8e..caaed42 100644
--- a/src/helper/log.c
+++ b/src/helper/log.c
@@ -296,7 +296,7 @@ COMMAND_HANDLER(handle_debug_level_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;debug_level: %i&quot;, debug_level);
+	command_print(CMD_CTX, &quot;debug_level: %i&quot;, debug_level);
 
 	return ERROR_OK;
 }
diff --git a/src/jtag/amt_jtagaccel.c b/src/jtag/amt_jtagaccel.c
index d35b0c2..4da2fa1 100644
--- a/src/jtag/amt_jtagaccel.c
+++ b/src/jtag/amt_jtagaccel.c
@@ -513,7 +513,7 @@ COMMAND_HANDLER(amt_jtagaccel_handle_parport_port_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;parport port = %u&quot;, amt_jtagaccel_port);
+	command_print(CMD_CTX, &quot;parport port = %u&quot;, amt_jtagaccel_port);
 
 	return ERROR_OK;
 }
@@ -522,7 +522,7 @@ COMMAND_HANDLER(amt_jtagaccel_handle_rtck_command)
 {
 	if (CMD_ARGC == 0)
 	{
-		command_print(cmd_ctx, &quot;amt_jtagaccel RTCK feature %s&quot;, (rtck_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
+		command_print(CMD_CTX, &quot;amt_jtagaccel RTCK feature %s&quot;, (rtck_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
 		return ERROR_OK;
 	}
 	else
diff --git a/src/jtag/gw16012.c b/src/jtag/gw16012.c
index d0cdde6..2d7b453 100644
--- a/src/jtag/gw16012.c
+++ b/src/jtag/gw16012.c
@@ -557,7 +557,7 @@ COMMAND_HANDLER(gw16012_handle_parport_port_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;parport port = %u&quot;, gw16012_port);
+	command_print(CMD_CTX, &quot;parport port = %u&quot;, gw16012_port);
 
 	return ERROR_OK;
 }
diff --git a/src/jtag/jlink.c b/src/jtag/jlink.c
index 80e7150..dbbddb8 100644
--- a/src/jtag/jlink.c
+++ b/src/jtag/jlink.c
@@ -629,7 +629,7 @@ COMMAND_HANDLER(jlink_handle_jlink_hw_jtag_command)
 {
 	switch (CMD_ARGC) {
 	case 0:
-		command_print(cmd_ctx, &quot;jlink hw jtag  %i&quot;, jlink_hw_jtag_version);
+		command_print(CMD_CTX, &quot;jlink hw jtag  %i&quot;, jlink_hw_jtag_version);
 		break;
 	case 1: {
 		int request_version = atoi(CMD_ARGV[0]);
diff --git a/src/jtag/parport.c b/src/jtag/parport.c
index e15c66d..97f6458 100644
--- a/src/jtag/parport.c
+++ b/src/jtag/parport.c
@@ -425,7 +425,7 @@ COMMAND_HANDLER(parport_handle_parport_port_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;parport port = %u&quot;, parport_port);
+	command_print(CMD_CTX, &quot;parport port = %u&quot;, parport_port);
 
 	return ERROR_OK;
 }
@@ -449,7 +449,7 @@ COMMAND_HANDLER(parport_handle_write_on_exit_command)
 {
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;usage: parport_write_on_exit &lt;on | off&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: parport_write_on_exit &lt;on | off&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -479,7 +479,7 @@ COMMAND_HANDLER(parport_handle_parport_toggling_time_command)
 		wait_states = jtag_get_speed();
 	}
 
-	command_print(cmd_ctx, &quot;parport toggling time = %&quot; PRIu32 &quot; ns&quot;,
+	command_print(CMD_CTX, &quot;parport toggling time = %&quot; PRIu32 &quot; ns&quot;,
 			parport_toggling_time_ns);
 
 	return ERROR_OK;
diff --git a/src/jtag/tcl.c b/src/jtag/tcl.c
index 1eead8d..96018b5 100644
--- a/src/jtag/tcl.c
+++ b/src/jtag/tcl.c
@@ -608,11 +608,11 @@ COMMAND_HANDLER(handle_interface_list_command)
 	if (strcmp(CMD_NAME, &quot;interface_list&quot;) == 0 &amp;&amp; CMD_ARGC &gt; 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	command_print(cmd_ctx, &quot;The following JTAG interfaces are available:&quot;);
+	command_print(CMD_CTX, &quot;The following JTAG interfaces are available:&quot;);
 	for (unsigned i = 0; NULL != jtag_interfaces[i]; i++)
 	{
 		const char *name = jtag_interfaces[i]-&gt;name;
-		command_print(cmd_ctx, &quot;%u: %s&quot;, i + 1, name);
+		command_print(CMD_CTX, &quot;%u: %s&quot;, i + 1, name);
 	}
 
 	return ERROR_OK;
@@ -636,7 +636,7 @@ COMMAND_HANDLER(handle_interface_command)
 		if (strcmp(CMD_ARGV[0], jtag_interfaces[i]-&gt;name) != 0)
 			continue;
 
-		int retval = jtag_interfaces[i]-&gt;register_commands(cmd_ctx);
+		int retval = jtag_interfaces[i]-&gt;register_commands(CMD_CTX);
 		if (ERROR_OK != retval)
 				return retval;
 
@@ -667,8 +667,8 @@ COMMAND_HANDLER(handle_scan_chain_command)
 	struct jtag_tap *tap;
 
 	tap = jtag_all_taps();
-	command_print(cmd_ctx, &quot;     TapName            | Enabled |   IdCode      Expected    IrLen IrCap  IrMask Instr     &quot;);
-	command_print(cmd_ctx, &quot;---|--------------------|---------|------------|------------|------|------|------|---------&quot;);
+	command_print(CMD_CTX, &quot;     TapName            | Enabled |   IdCode      Expected    IrLen IrCap  IrMask Instr     &quot;);
+	command_print(CMD_CTX, &quot;---|--------------------|---------|------------|------------|------|------|------|---------&quot;);
 
 	while (tap) {
 		uint32_t expected, expected_mask, cur_instr, ii;
@@ -676,7 +676,7 @@ COMMAND_HANDLER(handle_scan_chain_command)
 		expected_mask = buf_get_u32(tap-&gt;expected_mask, 0, tap-&gt;ir_length);
 		cur_instr = buf_get_u32(tap-&gt;cur_instr, 0, tap-&gt;ir_length);
 
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 					  &quot;%2d | %-18s |    %c    | 0x%08x | 0x%08x | 0x%02x | 0x%02x | 0x%02x | 0x%02x&quot;,
 					  tap-&gt;abs_chain_position,
 					  tap-&gt;dotted_name,
@@ -689,7 +689,7 @@ COMMAND_HANDLER(handle_scan_chain_command)
 					  (unsigned int)(cur_instr));
 
 		for (ii = 1; ii &lt; tap-&gt;expected_ids_cnt; ii++) {
-			command_print(cmd_ctx, &quot;   |                    |         |            | 0x%08x |      |      |      |         &quot;,
+			command_print(CMD_CTX, &quot;   |                    |         |            | 0x%08x |      |      |      |         &quot;,
 						  (unsigned int)(tap-&gt;expected_ids[ii]));
 		}
 
@@ -888,7 +888,7 @@ next:
 		modes[4] = &quot;&quot;;
 	}
 
-	command_print(cmd_ctx, &quot;%s %s%s%s%s&quot;,
+	command_print(CMD_CTX, &quot;%s %s%s%s%s&quot;,
 			modes[0], modes[1],
 			modes[2], modes[3], modes[4]);
 
@@ -906,7 +906,7 @@ COMMAND_HANDLER(handle_jtag_nsrst_delay_command)
 
 		jtag_set_nsrst_delay(delay);
 	}
-	command_print(cmd_ctx, &quot;jtag_nsrst_delay: %u&quot;, jtag_get_nsrst_delay());
+	command_print(CMD_CTX, &quot;jtag_nsrst_delay: %u&quot;, jtag_get_nsrst_delay());
 	return ERROR_OK;
 }
 
@@ -921,7 +921,7 @@ COMMAND_HANDLER(handle_jtag_ntrst_delay_command)
 
 		jtag_set_ntrst_delay(delay);
 	}
-	command_print(cmd_ctx, &quot;jtag_ntrst_delay: %u&quot;, jtag_get_ntrst_delay());
+	command_print(CMD_CTX, &quot;jtag_ntrst_delay: %u&quot;, jtag_get_ntrst_delay());
 	return ERROR_OK;
 }
 
@@ -936,7 +936,7 @@ COMMAND_HANDLER(handle_jtag_nsrst_assert_width_command)
 
 		jtag_set_nsrst_assert_width(delay);
 	}
-	command_print(cmd_ctx, &quot;jtag_nsrst_assert_width: %u&quot;, jtag_get_nsrst_assert_width());
+	command_print(CMD_CTX, &quot;jtag_nsrst_assert_width: %u&quot;, jtag_get_nsrst_assert_width());
 	return ERROR_OK;
 }
 
@@ -951,7 +951,7 @@ COMMAND_HANDLER(handle_jtag_ntrst_assert_width_command)
 
 		jtag_set_ntrst_assert_width(delay);
 	}
-	command_print(cmd_ctx, &quot;jtag_ntrst_assert_width: %u&quot;, jtag_get_ntrst_assert_width());
+	command_print(CMD_CTX, &quot;jtag_ntrst_assert_width: %u&quot;, jtag_get_ntrst_assert_width());
 	return ERROR_OK;
 }
 
@@ -977,9 +977,9 @@ COMMAND_HANDLER(handle_jtag_khz_command)
 		return retval;
 
 	if (cur_speed)
-		command_print(cmd_ctx, &quot;%d kHz&quot;, cur_speed);
+		command_print(CMD_CTX, &quot;%d kHz&quot;, cur_speed);
 	else
-		command_print(cmd_ctx, &quot;RCLK - adaptive&quot;);
+		command_print(CMD_CTX, &quot;RCLK - adaptive&quot;);
 
 	return retval;
 }
@@ -1006,9 +1006,9 @@ COMMAND_HANDLER(handle_jtag_rclk_command)
 		return retval;
 
 	if (cur_khz)
-		command_print(cmd_ctx, &quot;RCLK not supported - fallback to %d kHz&quot;, cur_khz);
+		command_print(CMD_CTX, &quot;RCLK not supported - fallback to %d kHz&quot;, cur_khz);
 	else
-		command_print(cmd_ctx, &quot;RCLK - adaptive&quot;);
+		command_print(CMD_CTX, &quot;RCLK - adaptive&quot;);
 
 	return retval;
 }
@@ -1034,7 +1034,7 @@ COMMAND_HANDLER(handle_jtag_reset_command)
 	else
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	if (jtag_interface_init(cmd_ctx) != ERROR_OK)
+	if (jtag_interface_init(CMD_CTX) != ERROR_OK)
 		return ERROR_JTAG_INIT_FAILED;
 
 	jtag_add_reset(trst, srst);
@@ -1122,7 +1122,7 @@ COMMAND_HANDLER(handle_irscan_command)
 			for (j = 0; j &lt; i; j++)
 				free(fields[j].out_value);
                         free(fields);
-			command_print(cmd_ctx, &quot;Tap: %s unknown&quot;, CMD_ARGV[i*2]);
+			command_print(CMD_CTX, &quot;Tap: %s unknown&quot;, CMD_ARGV[i*2]);
 
 			return ERROR_FAIL;
 		}
@@ -1366,7 +1366,7 @@ COMMAND_HANDLER(handle_verify_ircapture_command)
 	}
 
 	const char *status = jtag_will_verify_capture_ir() ? &quot;enabled&quot;: &quot;disabled&quot;;
-	command_print(cmd_ctx, &quot;verify Capture-IR is %s&quot;, status);
+	command_print(CMD_CTX, &quot;verify Capture-IR is %s&quot;, status);
 
 	return ERROR_OK;
 }
@@ -1387,7 +1387,7 @@ COMMAND_HANDLER(handle_verify_jtag_command)
 	}
 
 	const char *status = jtag_will_verify() ? &quot;enabled&quot;: &quot;disabled&quot;;
-	command_print(cmd_ctx, &quot;verify jtag capture is %s&quot;, status);
+	command_print(CMD_CTX, &quot;verify jtag capture is %s&quot;, status);
 
 	return ERROR_OK;
 }
@@ -1410,7 +1410,7 @@ COMMAND_HANDLER(handle_tms_sequence_command)
 		tap_use_new_tms_table(use_new_table);
 	}
 
-	command_print(cmd_ctx, &quot;tms sequence is  %s&quot;,
+	command_print(CMD_CTX, &quot;tms sequence is  %s&quot;,
 			tap_uses_new_tms_table() ? &quot;short&quot;: &quot;long&quot;);
 
 	return ERROR_OK;
diff --git a/src/openocd.c b/src/openocd.c
index 1a43b3c..9edd611 100644
--- a/src/openocd.c
+++ b/src/openocd.c
@@ -55,7 +55,7 @@ COMMAND_HANDLER(handle_version_command)
 	if (CMD_ARGC != 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	command_print(cmd_ctx, OPENOCD_VERSION);
+	command_print(CMD_CTX, OPENOCD_VERSION);
 
 	return ERROR_OK;
 }
@@ -107,11 +107,11 @@ COMMAND_HANDLER(handle_init_command)
 
 	atexit(exit_handler);
 
-	if (target_init(cmd_ctx) != ERROR_OK)
+	if (target_init(CMD_CTX) != ERROR_OK)
 		return ERROR_FAIL;
 	LOG_DEBUG(&quot;target init complete&quot;);
 
-	if ((retval = jtag_interface_init(cmd_ctx)) != ERROR_OK)
+	if ((retval = jtag_interface_init(CMD_CTX)) != ERROR_OK)
 	{
 		/* we must be able to set up the jtag interface */
 		return retval;
@@ -120,7 +120,7 @@ COMMAND_HANDLER(handle_init_command)
 
 	/* Try to initialize &amp; examine the JTAG chain at this point, but
 	 * continue startup regardless */
-	if (jtag_init(cmd_ctx) == ERROR_OK)
+	if (jtag_init(CMD_CTX) == ERROR_OK)
 	{
 		LOG_DEBUG(&quot;jtag init complete&quot;);
 		if (target_examine() == ERROR_OK)
@@ -129,19 +129,19 @@ COMMAND_HANDLER(handle_init_command)
 		}
 	}
 
-	if (flash_init_drivers(cmd_ctx) != ERROR_OK)
+	if (flash_init_drivers(CMD_CTX) != ERROR_OK)
 		return ERROR_FAIL;
 	LOG_DEBUG(&quot;flash init complete&quot;);
 
-	if (mflash_init_drivers(cmd_ctx) != ERROR_OK)
+	if (mflash_init_drivers(CMD_CTX) != ERROR_OK)
 		return ERROR_FAIL;
 	LOG_DEBUG(&quot;mflash init complete&quot;);
 
-	if (nand_init(cmd_ctx) != ERROR_OK)
+	if (nand_init(CMD_CTX) != ERROR_OK)
 		return ERROR_FAIL;
 	LOG_DEBUG(&quot;NAND init complete&quot;);
 
-	if (pld_init(cmd_ctx) != ERROR_OK)
+	if (pld_init(CMD_CTX) != ERROR_OK)
 		return ERROR_FAIL;
 	LOG_DEBUG(&quot;pld init complete&quot;);
 
@@ -153,7 +153,7 @@ COMMAND_HANDLER(handle_init_command)
 	gdb_init();
 	tcl_init(); /* allows tcl to just connect without going thru telnet */
 
-	target_register_event_callback(log_target_callback_event_handler, cmd_ctx);
+	target_register_event_callback(log_target_callback_event_handler, CMD_CTX);
 
 	return ERROR_OK;
 }
diff --git a/src/pld/pld.c b/src/pld/pld.c
index 96d37f1..d021f7b 100644
--- a/src/pld/pld.c
+++ b/src/pld/pld.c
@@ -75,7 +75,7 @@ COMMAND_HANDLER(handle_pld_device_command)
 			struct pld_device *p, *c;
 
 			/* register pld specific commands */
-			if (pld_drivers[i]-&gt;register_commands(cmd_ctx) != ERROR_OK)
+			if (pld_drivers[i]-&gt;register_commands(CMD_CTX) != ERROR_OK)
 			{
 				LOG_ERROR(&quot;couldn't register '%s' commands&quot;, CMD_ARGV[0]);
 				exit(-1);
@@ -127,13 +127,13 @@ COMMAND_HANDLER(handle_pld_devices_command)
 
 	if (!pld_devices)
 	{
-		command_print(cmd_ctx, &quot;no pld devices configured&quot;);
+		command_print(CMD_CTX, &quot;no pld devices configured&quot;);
 		return ERROR_OK;
 	}
 
 	for (p = pld_devices; p; p = p-&gt;next)
 	{
-		command_print(cmd_ctx, &quot;#%i: %s&quot;, i++, p-&gt;driver-&gt;name);
+		command_print(CMD_CTX, &quot;#%i: %s&quot;, i++, p-&gt;driver-&gt;name);
 	}
 
 	return ERROR_OK;
@@ -149,7 +149,7 @@ COMMAND_HANDLER(handle_pld_load_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;usage: pld load &lt;device#&gt; &lt;file&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: pld load &lt;device#&gt; &lt;file&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -158,13 +158,13 @@ COMMAND_HANDLER(handle_pld_load_command)
 	p = get_pld_device_by_num(dev_id);
 	if (!p)
 	{
-		command_print(cmd_ctx, &quot;pld device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;pld device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
 	if ((retval = p-&gt;driver-&gt;load(p, CMD_ARGV[1])) != ERROR_OK)
 	{
-		command_print(cmd_ctx, &quot;failed loading file %s to pld device %u&quot;,
+		command_print(CMD_CTX, &quot;failed loading file %s to pld device %u&quot;,
 			CMD_ARGV[1], dev_id);
 		switch (retval)
 		{
@@ -176,7 +176,7 @@ COMMAND_HANDLER(handle_pld_load_command)
 		gettimeofday(&amp;end, NULL);
 		timeval_subtract(&amp;duration, &amp;end, &amp;start);
 
-		command_print(cmd_ctx, &quot;loaded file %s to pld device %u in %jis %jius&quot;,
+		command_print(CMD_CTX, &quot;loaded file %s to pld device %u in %jis %jius&quot;,
 			CMD_ARGV[1], dev_id,
 			(intmax_t)duration.tv_sec, (intmax_t)duration.tv_usec);
 	}
diff --git a/src/pld/virtex2.c b/src/pld/virtex2.c
index b4593cc..e8fe63b 100644
--- a/src/pld/virtex2.c
+++ b/src/pld/virtex2.c
@@ -185,7 +185,7 @@ COMMAND_HANDLER(virtex2_handle_read_stat_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;usage: virtex2 read_stat &lt;num&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: virtex2 read_stat &lt;num&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -194,7 +194,7 @@ COMMAND_HANDLER(virtex2_handle_read_stat_command)
 	device = get_pld_device_by_num(dev_id);
 	if (!device)
 	{
-		command_print(cmd_ctx, &quot;pld device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;pld device '#%s' is out of bounds&quot;, CMD_ARGV[0]);
 		return ERROR_OK;
 	}
 
@@ -202,7 +202,7 @@ COMMAND_HANDLER(virtex2_handle_read_stat_command)
 
 	virtex2_read_stat(device, &amp;status);
 
-	command_print(cmd_ctx, &quot;virtex2 status register: 0x%8.8&quot; PRIx32 &quot;&quot;, status);
+	command_print(CMD_CTX, &quot;virtex2 status register: 0x%8.8&quot; PRIx32 &quot;&quot;, status);
 
 	return ERROR_OK;
 }
@@ -221,7 +221,7 @@ PLD_DEVICE_COMMAND_HANDLER(virtex2_pld_device_command)
 
 	tap = jtag_tap_by_string(CMD_ARGV[1]);
 	if (tap == NULL) {
-		command_print(cmd_ctx, &quot;Tap: %s does not exist&quot;, CMD_ARGV[1]);
+		command_print(CMD_CTX, &quot;Tap: %s does not exist&quot;, CMD_ARGV[1]);
 		return ERROR_OK;
 	}
 
diff --git a/src/server/gdb_server.c b/src/server/gdb_server.c
index 1ffd6a3..e236b50 100644
--- a/src/server/gdb_server.c
+++ b/src/server/gdb_server.c
@@ -2259,7 +2259,7 @@ COMMAND_HANDLER(handle_gdb_sync_command)
 
 	if (current_gdb_connection == NULL)
 	{
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;gdb_sync command can only be run from within gdb using \&quot;monitor gdb_sync\&quot;&quot;);
 		return ERROR_FAIL;
 	}
diff --git a/src/server/server.c b/src/server/server.c
index 258c89b..b28aa50 100644
--- a/src/server/server.c
+++ b/src/server/server.c
@@ -553,7 +553,7 @@ SERVER_PORT_COMMAND()
 {
 	switch (CMD_ARGC) {
 	case 0:
-		command_print(cmd_ctx, &quot;%d&quot;, *out);
+		command_print(CMD_CTX, &quot;%d&quot;, *out);
 		break;
 	case 1:
 	{
diff --git a/src/svf/svf.c b/src/svf/svf.c
index 45f3493..545bcf8 100644
--- a/src/svf/svf.c
+++ b/src/svf/svf.c
@@ -310,7 +310,7 @@ COMMAND_HANDLER(handle_svf_command)
 
 	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; (1 + SVF_NUM_OF_OPTIONS)))
 	{
-		command_print(cmd_ctx, &quot;usage: svf &lt;file&gt; [quiet]&quot;);
+		command_print(CMD_CTX, &quot;usage: svf &lt;file&gt; [quiet]&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -333,7 +333,7 @@ COMMAND_HANDLER(handle_svf_command)
 
 	if ((svf_fd = open(CMD_ARGV[0], O_RDONLY)) &lt; 0)
 	{
-		command_print(cmd_ctx, &quot;file \&quot;%s\&quot; not found&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;file \&quot;%s\&quot; not found&quot;, CMD_ARGV[0]);
 
 		// no need to free anything now
 		return ERROR_FAIL;
@@ -392,7 +392,7 @@ COMMAND_HANDLER(handle_svf_command)
 
 	while (ERROR_OK == svf_read_command_from_file(svf_fd))
 	{
-		if (ERROR_OK != svf_run_command(cmd_ctx, svf_command_buffer))
+		if (ERROR_OK != svf_run_command(CMD_CTX, svf_command_buffer))
 		{
 			LOG_ERROR(&quot;fail to run command at line %d&quot;, svf_line_number);
 			ret = ERROR_FAIL;
@@ -410,7 +410,7 @@ COMMAND_HANDLER(handle_svf_command)
 	}
 
 	// print time
-	command_print(cmd_ctx, &quot;%lld ms used&quot;, timeval_ms() - time_ago);
+	command_print(CMD_CTX, &quot;%lld ms used&quot;, timeval_ms() - time_ago);
 
 free_all:
 
@@ -457,11 +457,11 @@ free_all:
 
 	if (ERROR_OK == ret)
 	{
-		command_print(cmd_ctx, &quot;svf file programmed successfully for %d commands&quot;, command_num);
+		command_print(CMD_CTX, &quot;svf file programmed successfully for %d commands&quot;, command_num);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;svf file programmed failed&quot;);
+		command_print(CMD_CTX, &quot;svf file programmed failed&quot;);
 	}
 
 	return ret;
diff --git a/src/target/arm720t.c b/src/target/arm720t.c
index 3590bed..1716f34 100644
--- a/src/target/arm720t.c
+++ b/src/target/arm720t.c
@@ -413,11 +413,11 @@ static int arm720t_target_create(struct target *target, Jim_Interp *interp)
 COMMAND_HANDLER(arm720t_handle_cp15_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm720t_common *arm720t = target_to_arm720(target);
 	struct arm_jtag *jtag_info;
 
-	retval = arm720t_verify_pointer(cmd_ctx, arm720t);
+	retval = arm720t_verify_pointer(CMD_CTX, arm720t);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -425,7 +425,7 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -440,7 +440,7 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 			uint32_t value;
 			if ((retval = arm720t_read_cp15(target, opcode, &amp;value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't access cp15 with opcode 0x%8.8&quot; PRIx32 &quot;&quot;, opcode);
+				command_print(CMD_CTX, &quot;couldn't access cp15 with opcode 0x%8.8&quot; PRIx32 &quot;&quot;, opcode);
 				return ERROR_OK;
 			}
 
@@ -449,7 +449,7 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 				return retval;
 			}
 
-			command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32 &quot;: 0x%8.8&quot; PRIx32 &quot;&quot;, opcode, value);
+			command_print(CMD_CTX, &quot;0x%8.8&quot; PRIx32 &quot;: 0x%8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
 		else if (CMD_ARGC == 2)
 		{
@@ -458,10 +458,10 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 
 			if ((retval = arm720t_write_cp15(target, opcode, value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't access cp15 with opcode 0x%8.8&quot; PRIx32 &quot;&quot;, opcode);
+				command_print(CMD_CTX, &quot;couldn't access cp15 with opcode 0x%8.8&quot; PRIx32 &quot;&quot;, opcode);
 				return ERROR_OK;
 			}
-			command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32 &quot;: 0x%8.8&quot; PRIx32 &quot;&quot;, opcode, value);
+			command_print(CMD_CTX, &quot;0x%8.8&quot; PRIx32 &quot;: 0x%8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
 	}
 
diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index 03d075b..18a2f9d 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -2751,24 +2751,24 @@ COMMAND_HANDLER(handle_arm7_9_write_xpsr_command)
 	uint32_t value;
 	int spsr;
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;can't write registers while running&quot;);
+		command_print(CMD_CTX, &quot;can't write registers while running&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;usage: write_xpsr &lt;value&gt; &lt;not cpsr | spsr&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: write_xpsr &lt;value&gt; &lt;not cpsr | spsr&gt;&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -2795,24 +2795,24 @@ COMMAND_HANDLER(handle_arm7_9_write_xpsr_im8_command)
 	int rotate;
 	int spsr;
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;can't write registers while running&quot;);
+		command_print(CMD_CTX, &quot;can't write registers while running&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (CMD_ARGC &lt; 3)
 	{
-		command_print(cmd_ctx, &quot;usage: write_xpsr_im8 &lt;im8&gt; &lt;rotate&gt; &lt;not cpsr | spsr&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: write_xpsr_im8 &lt;im8&gt; &lt;rotate&gt; &lt;not cpsr | spsr&gt;&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -2835,24 +2835,24 @@ COMMAND_HANDLER(handle_arm7_9_write_core_reg_command)
 	uint32_t value;
 	uint32_t mode;
 	int num;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;can't write registers while running&quot;);
+		command_print(CMD_CTX, &quot;can't write registers while running&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (CMD_ARGC &lt; 3)
 	{
-		command_print(cmd_ctx, &quot;usage: write_core_reg &lt;num&gt; &lt;mode&gt; &lt;value&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: write_core_reg &lt;num&gt; &lt;mode&gt; &lt;value&gt;&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -2865,12 +2865,12 @@ COMMAND_HANDLER(handle_arm7_9_write_core_reg_command)
 
 COMMAND_HANDLER(handle_arm7_9_dbgrq_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
@@ -2886,23 +2886,23 @@ COMMAND_HANDLER(handle_arm7_9_dbgrq_command)
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;usage: arm7_9 dbgrq &lt;enable | disable&gt;&quot;);
+			command_print(CMD_CTX, &quot;usage: arm7_9 dbgrq &lt;enable | disable&gt;&quot;);
 		}
 	}
 
-	command_print(cmd_ctx, &quot;use of EmbeddedICE dbgrq instead of breakpoint for target halt %s&quot;, (arm7_9-&gt;use_dbgrq) ? &quot;enabled&quot; : &quot;disabled&quot;);
+	command_print(CMD_CTX, &quot;use of EmbeddedICE dbgrq instead of breakpoint for target halt %s&quot;, (arm7_9-&gt;use_dbgrq) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(handle_arm7_9_fast_memory_access_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
@@ -2918,23 +2918,23 @@ COMMAND_HANDLER(handle_arm7_9_fast_memory_access_command)
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;usage: arm7_9 fast_memory_access &lt;enable | disable&gt;&quot;);
+			command_print(CMD_CTX, &quot;usage: arm7_9 fast_memory_access &lt;enable | disable&gt;&quot;);
 		}
 	}
 
-	command_print(cmd_ctx, &quot;fast memory access is %s&quot;, (arm7_9-&gt;fast_memory_access) ? &quot;enabled&quot; : &quot;disabled&quot;);
+	command_print(CMD_CTX, &quot;fast memory access is %s&quot;, (arm7_9-&gt;fast_memory_access) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(handle_arm7_9_dcc_downloads_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 
 	if (!is_arm7_9(arm7_9))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM7/ARM9 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM7/ARM9 target&quot;);
 		return ERROR_TARGET_INVALID;
 	}
 
@@ -2950,11 +2950,11 @@ COMMAND_HANDLER(handle_arm7_9_dcc_downloads_command)
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;usage: arm7_9 dcc_downloads &lt;enable | disable&gt;&quot;);
+			command_print(CMD_CTX, &quot;usage: arm7_9 dcc_downloads &lt;enable | disable&gt;&quot;);
 		}
 	}
 
-	command_print(cmd_ctx, &quot;dcc downloads are %s&quot;, (arm7_9-&gt;dcc_downloads) ? &quot;enabled&quot; : &quot;disabled&quot;);
+	command_print(CMD_CTX, &quot;dcc downloads are %s&quot;, (arm7_9-&gt;dcc_downloads) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	return ERROR_OK;
 }
diff --git a/src/target/arm920t.c b/src/target/arm920t.c
index 9f4533d..be3a1a2 100644
--- a/src/target/arm920t.c
+++ b/src/target/arm920t.c
@@ -666,7 +666,7 @@ static int arm920t_target_create(struct target *target, Jim_Interp *interp)
 COMMAND_HANDLER(arm920t_handle_read_cache_command)
 {
 	int retval = ERROR_OK;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm920t_common *arm920t = target_to_arm920(target);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 	struct armv4_5_common_s *armv4_5 = &amp;arm7_9-&gt;armv4_5_common;
@@ -680,13 +680,13 @@ COMMAND_HANDLER(arm920t_handle_read_cache_command)
 	struct arm920t_cache_line d_cache[8][64], i_cache[8][64];
 	int segment, index;
 
-	retval = arm920t_verify_pointer(cmd_ctx, arm920t);
+	retval = arm920t_verify_pointer(CMD_CTX, arm920t);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;usage: arm920t read_cache &lt;filename&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: arm920t read_cache &lt;filename&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -887,7 +887,7 @@ COMMAND_HANDLER(arm920t_handle_read_cache_command)
 	/* restore CP15 MMU and Cache settings */
 	arm920t_write_cp15_physical(target, ARM920T_CP15_PHYS_ADDR(0, 0x1, 0), cp15_ctrl_saved);
 
-	command_print(cmd_ctx, &quot;cache content successfully output to %s&quot;, CMD_ARGV[0]);
+	command_print(CMD_CTX, &quot;cache content successfully output to %s&quot;, CMD_ARGV[0]);
 
 	fclose(output);
 
@@ -912,7 +912,7 @@ COMMAND_HANDLER(arm920t_handle_read_cache_command)
 COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 {
 	int retval = ERROR_OK;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm920t_common *arm920t = target_to_arm920(target);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 	struct armv4_5_common_s *armv4_5 = &amp;arm7_9-&gt;armv4_5_common;
@@ -926,13 +926,13 @@ COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 	struct arm920t_tlb_entry d_tlb[64], i_tlb[64];
 	int victim;
 
-	retval = arm920t_verify_pointer(cmd_ctx, arm920t);
+	retval = arm920t_verify_pointer(CMD_CTX, arm920t);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;usage: arm920t read_mmu &lt;filename&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: arm920t read_mmu &lt;filename&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -1170,7 +1170,7 @@ COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 		fprintf(output, &quot;%i: 0x%8.8&quot; PRIx32 &quot; 0x%8.8&quot; PRIx32 &quot; 0x%8.8&quot; PRIx32 &quot; %s\n&quot;, i, i_tlb[i].cam, i_tlb[i].ram1, i_tlb[i].ram2, (i_tlb[i].cam &amp; 0x20) ? &quot;(valid)&quot; : &quot;(invalid)&quot;);
 	}
 
-	command_print(cmd_ctx, &quot;mmu content successfully output to %s&quot;, CMD_ARGV[0]);
+	command_print(CMD_CTX, &quot;mmu content successfully output to %s&quot;, CMD_ARGV[0]);
 
 	fclose(output);
 
@@ -1195,16 +1195,16 @@ COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 COMMAND_HANDLER(arm920t_handle_cp15_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm920t_common *arm920t = target_to_arm920(target);
 
-	retval = arm920t_verify_pointer(cmd_ctx, arm920t);
+	retval = arm920t_verify_pointer(CMD_CTX, arm920t);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -1219,7 +1219,7 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 			uint32_t value;
 			if ((retval = arm920t_read_cp15_physical(target, address, &amp;value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't access reg %i&quot;, address);
+				command_print(CMD_CTX, &quot;couldn't access reg %i&quot;, address);
 				return ERROR_OK;
 			}
 			if ((retval = jtag_execute_queue()) != ERROR_OK)
@@ -1227,7 +1227,7 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 				return retval;
 			}
 
-			command_print(cmd_ctx, &quot;%i: %8.8&quot; PRIx32 &quot;&quot;, address, value);
+			command_print(CMD_CTX, &quot;%i: %8.8&quot; PRIx32 &quot;&quot;, address, value);
 		}
 		else if (CMD_ARGC == 2)
 		{
@@ -1235,10 +1235,10 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 			if ((retval = arm920t_write_cp15_physical(target, address, value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't access reg %i&quot;, address);
+				command_print(CMD_CTX, &quot;couldn't access reg %i&quot;, address);
 				return ERROR_OK;
 			}
-			command_print(cmd_ctx, &quot;%i: %8.8&quot; PRIx32 &quot;&quot;, address, value);
+			command_print(CMD_CTX, &quot;%i: %8.8&quot; PRIx32 &quot;&quot;, address, value);
 		}
 	}
 
@@ -1248,17 +1248,17 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 COMMAND_HANDLER(arm920t_handle_cp15i_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm920t_common *arm920t = target_to_arm920(target);
 
-	retval = arm920t_verify_pointer(cmd_ctx, arm920t);
+	retval = arm920t_verify_pointer(CMD_CTX, arm920t);
 	if (retval != ERROR_OK)
 		return retval;
 
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -1273,11 +1273,11 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 			uint32_t value;
 			if ((retval = arm920t_read_cp15_interpreted(target, opcode, 0x0, &amp;value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
+				command_print(CMD_CTX, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
 				return ERROR_OK;
 			}
 
-			command_print(cmd_ctx, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
+			command_print(CMD_CTX, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
 		else if (CMD_ARGC == 2)
 		{
@@ -1285,10 +1285,10 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 			if ((retval = arm920t_write_cp15_interpreted(target, opcode, value, 0)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
+				command_print(CMD_CTX, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
 				return ERROR_OK;
 			}
-			command_print(cmd_ctx, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
+			command_print(CMD_CTX, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
 		else if (CMD_ARGC == 3)
 		{
@@ -1298,15 +1298,15 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[2], address);
 			if ((retval = arm920t_write_cp15_interpreted(target, opcode, value, address)) != ERROR_OK)
 			{
-				command_print(cmd_ctx, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
+				command_print(CMD_CTX, &quot;couldn't execute %8.8&quot; PRIx32 &quot;&quot;, opcode);
 				return ERROR_OK;
 			}
-			command_print(cmd_ctx, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot; %8.8&quot; PRIx32 &quot;&quot;, opcode, value, address);
+			command_print(CMD_CTX, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot; %8.8&quot; PRIx32 &quot;&quot;, opcode, value, address);
 		}
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;usage: arm920t cp15i &lt;opcode&gt; [value] [address]&quot;);
+		command_print(CMD_CTX, &quot;usage: arm920t cp15i &lt;opcode&gt; [value] [address]&quot;);
 	}
 
 	return ERROR_OK;
@@ -1315,14 +1315,14 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 COMMAND_HANDLER(arm920t_handle_cache_info_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm920t_common *arm920t = target_to_arm920(target);
 
-	retval = arm920t_verify_pointer(cmd_ctx, arm920t);
+	retval = arm920t_verify_pointer(CMD_CTX, arm920t);
 	if (retval != ERROR_OK)
 		return retval;
 
-	return armv4_5_handle_cache_info_command(cmd_ctx, &amp;arm920t-&gt;armv4_5_mmu.armv4_5_cache);
+	return armv4_5_handle_cache_info_command(CMD_CTX, &amp;arm920t-&gt;armv4_5_mmu.armv4_5_cache);
 }
 
 
diff --git a/src/target/arm926ejs.c b/src/target/arm926ejs.c
index cbd178e..65d9e65 100644
--- a/src/target/arm926ejs.c
+++ b/src/target/arm926ejs.c
@@ -717,7 +717,7 @@ static int arm926ejs_target_create(struct target *target, Jim_Interp *interp)
 COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm926ejs_common *arm926ejs = target_to_arm926(target);
 	int opcode_1;
 	int opcode_2;
@@ -726,7 +726,7 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 
 	if ((CMD_ARGC &lt; 4) || (CMD_ARGC &gt; 5))
 	{
-		command_print(cmd_ctx, &quot;usage: arm926ejs cp15 &lt;opcode_1&gt; &lt;opcode_2&gt; &lt;CRn&gt; &lt;CRm&gt; [value]&quot;);
+		command_print(CMD_CTX, &quot;usage: arm926ejs cp15 &lt;opcode_1&gt; &lt;opcode_2&gt; &lt;CRn&gt; &lt;CRm&gt; [value]&quot;);
 		return ERROR_OK;
 	}
 
@@ -735,13 +735,13 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 	COMMAND_PARSE_NUMBER(int, CMD_ARGV[2], CRn);
 	COMMAND_PARSE_NUMBER(int, CMD_ARGV[3], CRm);
 
-	retval = arm926ejs_verify_pointer(cmd_ctx, arm926ejs);
+	retval = arm926ejs_verify_pointer(CMD_CTX, arm926ejs);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -750,7 +750,7 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 		uint32_t value;
 		if ((retval = arm926ejs-&gt;read_cp15(target, opcode_1, opcode_2, CRn, CRm, &amp;value)) != ERROR_OK)
 		{
-			command_print(cmd_ctx, &quot;couldn't access register&quot;);
+			command_print(CMD_CTX, &quot;couldn't access register&quot;);
 			return ERROR_OK;
 		}
 		if ((retval = jtag_execute_queue()) != ERROR_OK)
@@ -758,7 +758,7 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 			return retval;
 		}
 
-		command_print(cmd_ctx, &quot;%i %i %i %i: %8.8&quot; PRIx32 &quot;&quot;, opcode_1, opcode_2, CRn, CRm, value);
+		command_print(CMD_CTX, &quot;%i %i %i %i: %8.8&quot; PRIx32 &quot;&quot;, opcode_1, opcode_2, CRn, CRm, value);
 	}
 	else
 	{
@@ -766,10 +766,10 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[4], value);
 		if ((retval = arm926ejs-&gt;write_cp15(target, opcode_1, opcode_2, CRn, CRm, value)) != ERROR_OK)
 		{
-			command_print(cmd_ctx, &quot;couldn't access register&quot;);
+			command_print(CMD_CTX, &quot;couldn't access register&quot;);
 			return ERROR_OK;
 		}
-		command_print(cmd_ctx, &quot;%i %i %i %i: %8.8&quot; PRIx32 &quot;&quot;, opcode_1, opcode_2, CRn, CRm, value);
+		command_print(CMD_CTX, &quot;%i %i %i %i: %8.8&quot; PRIx32 &quot;&quot;, opcode_1, opcode_2, CRn, CRm, value);
 	}
 
 	return ERROR_OK;
@@ -778,14 +778,14 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 COMMAND_HANDLER(arm926ejs_handle_cache_info_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm926ejs_common *arm926ejs = target_to_arm926(target);
 
-	retval = arm926ejs_verify_pointer(cmd_ctx, arm926ejs);
+	retval = arm926ejs_verify_pointer(CMD_CTX, arm926ejs);
 	if (retval != ERROR_OK)
 		return retval;
 
-	return armv4_5_handle_cache_info_command(cmd_ctx, &amp;arm926ejs-&gt;armv4_5_mmu.armv4_5_cache);
+	return armv4_5_handle_cache_info_command(CMD_CTX, &amp;arm926ejs-&gt;armv4_5_mmu.armv4_5_cache);
 }
 
 static int arm926ejs_virt2phys(struct target *target, uint32_t virtual, uint32_t *physical)
diff --git a/src/target/arm966e.c b/src/target/arm966e.c
index d12e7c0..675bca8 100644
--- a/src/target/arm966e.c
+++ b/src/target/arm966e.c
@@ -165,16 +165,16 @@ int arm966e_write_cp15(struct target *target, int reg_addr, uint32_t value)
 COMMAND_HANDLER(arm966e_handle_cp15_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm966e_common *arm966e = target_to_arm966(target);
 
-	retval = arm966e_verify_pointer(cmd_ctx, arm966e);
+	retval = arm966e_verify_pointer(CMD_CTX, arm966e);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -189,7 +189,7 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 			uint32_t value;
 			if ((retval = arm966e_read_cp15(target, address, &amp;value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx,
+				command_print(CMD_CTX,
 						&quot;couldn't access reg %&quot; PRIi32,
 						address);
 				return ERROR_OK;
@@ -199,7 +199,7 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 				return retval;
 			}
 
-			command_print(cmd_ctx, &quot;%&quot; PRIi32 &quot;: %8.8&quot; PRIx32,
+			command_print(CMD_CTX, &quot;%&quot; PRIi32 &quot;: %8.8&quot; PRIx32,
 					address, value);
 		}
 		else if (CMD_ARGC == 2)
@@ -208,12 +208,12 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 			COMMAND_PARSE_NUMBER(u32, CMD_ARGV[1], value);
 			if ((retval = arm966e_write_cp15(target, address, value)) != ERROR_OK)
 			{
-				command_print(cmd_ctx,
+				command_print(CMD_CTX,
 						&quot;couldn't access reg %&quot; PRIi32,
 						address);
 				return ERROR_OK;
 			}
-			command_print(cmd_ctx, &quot;%&quot; PRIi32 &quot;: %8.8&quot; PRIx32,
+			command_print(CMD_CTX, &quot;%&quot; PRIi32 &quot;: %8.8&quot; PRIx32,
 					address, value);
 		}
 	}
diff --git a/src/target/arm9tdmi.c b/src/target/arm9tdmi.c
index 8a12608..ad9e717 100644
--- a/src/target/arm9tdmi.c
+++ b/src/target/arm9tdmi.c
@@ -822,7 +822,7 @@ static int arm9tdmi_target_create(struct target *target, Jim_Interp *interp)
 
 COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm7_9_common *arm7_9 = target_to_arm7_9(target);
 	struct reg *vector_catch;
 	uint32_t vector_catch_value;
@@ -830,7 +830,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 	/* it's uncommon, but some ARM7 chips can support this */
 	if (arm7_9-&gt;common_magic != ARM7_9_COMMON_MAGIC
 			|| !arm7_9-&gt;has_vector_catch) {
-		command_print(cmd_ctx, &quot;target doesn't have EmbeddedICE &quot;
+		command_print(CMD_CTX, &quot;target doesn't have EmbeddedICE &quot;
 				&quot;with vector_catch&quot;);
 		return ERROR_TARGET_INVALID;
 	}
@@ -873,7 +873,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 				/* complain if vector wasn't found */
 				if (!arm9tdmi_vectors[j].name)
 				{
-					command_print(cmd_ctx, &quot;vector '%s' not found, leaving current setting unchanged&quot;, CMD_ARGV[i]);
+					command_print(CMD_CTX, &quot;vector '%s' not found, leaving current setting unchanged&quot;, CMD_ARGV[i]);
 
 					/* reread current setting */
 					vector_catch_value = buf_get_u32(
@@ -892,7 +892,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 
 	/* output current settings */
 	for (unsigned i = 0; arm9tdmi_vectors[i].name; i++) {
-		command_print(cmd_ctx, &quot;%s: %s&quot;, arm9tdmi_vectors[i].name,
+		command_print(CMD_CTX, &quot;%s: %s&quot;, arm9tdmi_vectors[i].name,
 			(vector_catch_value &amp; arm9tdmi_vectors[i].value)
 				? &quot;catch&quot; : &quot;don't catch&quot;);
 	}
diff --git a/src/target/arm_adi_v5.c b/src/target/arm_adi_v5.c
index 7f4bc58..3d0b8f8 100644
--- a/src/target/arm_adi_v5.c
+++ b/src/target/arm_adi_v5.c
@@ -1386,7 +1386,7 @@ DAP_COMMAND_HANDLER(dap_baseaddr_command)
 
 	dap_ap_read_reg_u32(swjdp, 0xF8, &amp;baseaddr);
 	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32, baseaddr);
+	command_print(CMD_CTX, &quot;0x%8.8&quot; PRIx32, baseaddr);
 
 	if (apselsave != apsel)
 		dap_ap_select(swjdp, apselsave);
@@ -1410,7 +1410,7 @@ DAP_COMMAND_HANDLER(dap_memaccess_command)
 	}
 	swjdp-&gt;memaccess_tck = memaccess_tck;
 
-	command_print(cmd_ctx, &quot;memory bus access delay set to %&quot; PRIi32 &quot; tck&quot;,
+	command_print(CMD_CTX, &quot;memory bus access delay set to %&quot; PRIi32 &quot; tck&quot;,
 			swjdp-&gt;memaccess_tck);
 
 	return ERROR_OK;
@@ -1435,7 +1435,7 @@ DAP_COMMAND_HANDLER(dap_apsel_command)
 	dap_ap_select(swjdp, apsel);
 	dap_ap_read_reg_u32(swjdp, 0xFC, &amp;apid);
 	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, &quot;ap %&quot; PRIi32 &quot; selected, identification register 0x%8.8&quot; PRIx32,
+	command_print(CMD_CTX, &quot;ap %&quot; PRIi32 &quot; selected, identification register 0x%8.8&quot; PRIx32,
 			apsel, apid);
 
 	return retval;
@@ -1463,7 +1463,7 @@ DAP_COMMAND_HANDLER(dap_apid_command)
 
 	dap_ap_read_reg_u32(swjdp, 0xFC, &amp;apid);
 	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32, apid);
+	command_print(CMD_CTX, &quot;0x%8.8&quot; PRIx32, apid);
 	if (apselsave != apsel)
 		dap_ap_select(swjdp, apselsave);
 
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index c57c939..e29de87 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -310,18 +310,18 @@ COMMAND_HANDLER(handle_armv4_5_reg_command)
 	char output[128];
 	int output_len;
 	int mode, num;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv4_5_common_s *armv4_5 = target_to_armv4_5(target);
 
 	if (armv4_5-&gt;common_magic != ARMV4_5_COMMON_MAGIC)
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARMV4/5 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARMV4/5 target&quot;);
 		return ERROR_OK;
 	}
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;error: target must be halted for register accesses&quot;);
+		command_print(CMD_CTX, &quot;error: target must be halted for register accesses&quot;);
 		return ERROR_OK;
 	}
 
@@ -343,9 +343,9 @@ COMMAND_HANDLER(handle_armv4_5_reg_command)
 					       ARMV4_5_CORE_REG_MODENUM(armv4_5-&gt;core_cache, mode, num).name,
 					       buf_get_u32(ARMV4_5_CORE_REG_MODENUM(armv4_5-&gt;core_cache, mode, num).value, 0, 32));
 		}
-		command_print(cmd_ctx, &quot;%s&quot;, output);
+		command_print(CMD_CTX, &quot;%s&quot;, output);
 	}
-	command_print(cmd_ctx,
+	command_print(CMD_CTX,
 		      &quot;    cpsr: %8.8&quot; PRIx32 &quot; spsr_fiq: %8.8&quot; PRIx32 &quot; spsr_irq: %8.8&quot; PRIx32 &quot; spsr_svc: %8.8&quot; PRIx32 &quot; spsr_abt: %8.8&quot; PRIx32 &quot; spsr_und: %8.8&quot; PRIx32 &quot;&quot;,
 			  buf_get_u32(armv4_5-&gt;core_cache-&gt;reg_list[ARMV4_5_CPSR].value, 0, 32),
 			  buf_get_u32(armv4_5-&gt;core_cache-&gt;reg_list[ARMV4_5_SPSR_FIQ].value, 0, 32),
@@ -359,12 +359,12 @@ COMMAND_HANDLER(handle_armv4_5_reg_command)
 
 COMMAND_HANDLER(handle_armv4_5_core_state_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv4_5_common_s *armv4_5 = target_to_armv4_5(target);
 
 	if (armv4_5-&gt;common_magic != ARMV4_5_COMMON_MAGIC)
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARMV4/5 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARMV4/5 target&quot;);
 		return ERROR_OK;
 	}
 
@@ -380,7 +380,7 @@ COMMAND_HANDLER(handle_armv4_5_core_state_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;core state: %s&quot;, armv4_5_state_strings[armv4_5-&gt;core_state]);
+	command_print(CMD_CTX, &quot;core state: %s&quot;, armv4_5_state_strings[armv4_5-&gt;core_state]);
 
 	return ERROR_OK;
 }
@@ -388,7 +388,7 @@ COMMAND_HANDLER(handle_armv4_5_core_state_command)
 COMMAND_HANDLER(handle_armv4_5_disassemble_command)
 {
 	int retval = ERROR_OK;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv4_5_common_s *armv4_5 = target_to_armv4_5(target);
 	uint32_t address;
 	int count = 1;
@@ -400,7 +400,7 @@ COMMAND_HANDLER(handle_armv4_5_disassemble_command)
 
 	if (armv4_5-&gt;common_magic != ARMV4_5_COMMON_MAGIC)
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARMV4/5 target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARMV4/5 target&quot;);
 		return ERROR_OK;
 	}
 
@@ -417,7 +417,7 @@ COMMAND_HANDLER(handle_armv4_5_disassemble_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
 		if (address &amp; 0x01) {
 			if (!thumb) {
-				command_print(cmd_ctx, &quot;Disassemble as Thumb&quot;);
+				command_print(CMD_CTX, &quot;Disassemble as Thumb&quot;);
 				thumb = 1;
 			}
 			address &amp;= ~1;
@@ -425,7 +425,7 @@ COMMAND_HANDLER(handle_armv4_5_disassemble_command)
 		break;
 	default:
 usage:
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 			&quot;usage: armv4_5 disassemble &lt;address&gt; [&lt;count&gt; ['thumb']]&quot;);
 		return ERROR_OK;
 	}
@@ -453,7 +453,7 @@ usage:
 				return retval;
 			}
 		}
-		command_print(cmd_ctx, &quot;%s&quot;, cur_instruction.text);
+		command_print(CMD_CTX, &quot;%s&quot;, cur_instruction.text);
 		address += (thumb) ? 2 : 4;
 	}
 
diff --git a/src/target/armv7a.c b/src/target/armv7a.c
index 9eb0faa..d4b9226 100644
--- a/src/target/armv7a.c
+++ b/src/target/armv7a.c
@@ -219,7 +219,7 @@ int armv7a_arch_state(struct target *target)
 
 COMMAND_HANDLER(handle_dap_baseaddr_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 
@@ -228,7 +228,7 @@ COMMAND_HANDLER(handle_dap_baseaddr_command)
 
 COMMAND_HANDLER(handle_dap_memaccess_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 
@@ -237,7 +237,7 @@ COMMAND_HANDLER(handle_dap_memaccess_command)
 
 COMMAND_HANDLER(handle_dap_apsel_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 
@@ -246,7 +246,7 @@ COMMAND_HANDLER(handle_dap_apsel_command)
 
 COMMAND_HANDLER(handle_dap_apid_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 
@@ -255,7 +255,7 @@ COMMAND_HANDLER(handle_dap_apid_command)
 
 COMMAND_HANDLER(handle_dap_info_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 	uint32_t apsel;
@@ -271,12 +271,12 @@ COMMAND_HANDLER(handle_dap_info_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	return dap_info_command(cmd_ctx, swjdp, apsel);
+	return dap_info_command(CMD_CTX, swjdp, apsel);
 }
 
 COMMAND_HANDLER(handle_armv7a_disassemble_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv4_5_common_s *armv4_5 = target_to_armv4_5(target);
 	int thumb = 0;
 	int count = 1;
@@ -284,7 +284,7 @@ COMMAND_HANDLER(handle_armv7a_disassemble_command)
 	int i;
 
 	if (armv4_5-&gt;common_magic != ARMV4_5_COMMON_MAGIC) {
-		command_print(cmd_ctx, &quot;current target isn't an ARM target&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM target&quot;);
 		return ERROR_OK;
 	}
 
@@ -305,7 +305,7 @@ COMMAND_HANDLER(handle_armv7a_disassemble_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
 		if (address &amp; 0x01) {
 			if (!thumb) {
-				command_print(cmd_ctx, &quot;Disassemble as Thumb&quot;);
+				command_print(CMD_CTX, &quot;Disassemble as Thumb&quot;);
 				thumb = 1;
 			}
 			address &amp;= ~1;
@@ -313,7 +313,7 @@ COMMAND_HANDLER(handle_armv7a_disassemble_command)
 		break;
 	default:
 usage:
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 			&quot;usage: armv7a disassemble &lt;address&gt; [&lt;count&gt; ['thumb']]&quot;);
 		return ERROR_OK;
 	}
@@ -342,7 +342,7 @@ usage:
 
 			address += 4;
 		}
-		command_print(cmd_ctx, &quot;%s&quot;, cur_instruction.text);
+		command_print(CMD_CTX, &quot;%s&quot;, cur_instruction.text);
 	}
 
 	return ERROR_OK;
diff --git a/src/target/armv7m.c b/src/target/armv7m.c
index 2061a4a..8516913 100644
--- a/src/target/armv7m.c
+++ b/src/target/armv7m.c
@@ -765,7 +765,7 @@ int armv7m_blank_check_memory(struct target *target,
  */
 COMMAND_HANDLER(handle_dap_baseaddr_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7m_common *armv7m = target_to_armv7m(target);
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 	uint32_t apsel, apselsave, baseaddr;
@@ -788,7 +788,7 @@ COMMAND_HANDLER(handle_dap_baseaddr_command)
 
 	dap_ap_read_reg_u32(swjdp, 0xF8, &amp;baseaddr);
 	retval = swjdp_transaction_endcheck(swjdp);
-	command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32 &quot;&quot;, baseaddr);
+	command_print(CMD_CTX, &quot;0x%8.8&quot; PRIx32 &quot;&quot;, baseaddr);
 
 	if (apselsave != apsel)
 		dap_ap_select(swjdp, apselsave);
@@ -802,7 +802,7 @@ COMMAND_HANDLER(handle_dap_baseaddr_command)
  */
 COMMAND_HANDLER(handle_dap_apid_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7m_common *armv7m = target_to_armv7m(target);
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 
@@ -811,7 +811,7 @@ COMMAND_HANDLER(handle_dap_apid_command)
 
 COMMAND_HANDLER(handle_dap_apsel_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7m_common *armv7m = target_to_armv7m(target);
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 
@@ -820,7 +820,7 @@ COMMAND_HANDLER(handle_dap_apsel_command)
 
 COMMAND_HANDLER(handle_dap_memaccess_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7m_common *armv7m = target_to_armv7m(target);
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 
@@ -830,7 +830,7 @@ COMMAND_HANDLER(handle_dap_memaccess_command)
 
 COMMAND_HANDLER(handle_dap_info_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7m_common *armv7m = target_to_armv7m(target);
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 	uint32_t apsel;
@@ -846,7 +846,7 @@ COMMAND_HANDLER(handle_dap_info_command)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	return dap_info_command(cmd_ctx, swjdp, apsel);
+	return dap_info_command(CMD_CTX, swjdp, apsel);
 }
 
 /** Registers commands used to access DAP resources. */
diff --git a/src/target/cortex_a8.c b/src/target/cortex_a8.c
index f099be9..00b5ba3 100644
--- a/src/target/cortex_a8.c
+++ b/src/target/cortex_a8.c
@@ -1528,17 +1528,17 @@ static int cortex_a8_target_create(struct target *target, Jim_Interp *interp)
 
 COMMAND_HANDLER(cortex_a8_handle_cache_info_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct armv7a_common *armv7a = target_to_armv7a(target);
 
-	return armv4_5_handle_cache_info_command(cmd_ctx,
+	return armv4_5_handle_cache_info_command(CMD_CTX,
 			&amp;armv7a-&gt;armv4_5_mmu.armv4_5_cache);
 }
 
 
 COMMAND_HANDLER(cortex_a8_handle_dbginit_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	cortex_a8_init_debug_access(target);
 
diff --git a/src/target/cortex_m3.c b/src/target/cortex_m3.c
index a05ff2e..a3d9d08 100644
--- a/src/target/cortex_m3.c
+++ b/src/target/cortex_m3.c
@@ -1784,13 +1784,13 @@ static int cortex_m3_verify_pointer(struct command_context *cmd_ctx,
 COMMAND_HANDLER(handle_cortex_m3_disassemble_command)
 {
 	int retval;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct cortex_m3_common *cortex_m3 = target_to_cm3(target);
 	uint32_t address;
 	unsigned long count = 1;
 	struct arm_instruction cur_instruction;
 
-	retval = cortex_m3_verify_pointer(cmd_ctx, cortex_m3);
+	retval = cortex_m3_verify_pointer(CMD_CTX, cortex_m3);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -1803,7 +1803,7 @@ COMMAND_HANDLER(handle_cortex_m3_disassemble_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], address);
 		break;
 	default:
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 			&quot;usage: cortex_m3 disassemble &lt;address&gt; [&lt;count&gt;]&quot;);
 		return ERROR_OK;
 	}
@@ -1812,7 +1812,7 @@ COMMAND_HANDLER(handle_cortex_m3_disassemble_command)
 		retval = thumb2_opcode(target, address, &amp;cur_instruction);
 		if (retval != ERROR_OK)
 			return retval;
-		command_print(cmd_ctx, &quot;%s&quot;, cur_instruction.text);
+		command_print(CMD_CTX, &quot;%s&quot;, cur_instruction.text);
 		address += cur_instruction.instruction_size;
 	}
 
@@ -1835,13 +1835,14 @@ static const struct {
 
 COMMAND_HANDLER(handle_cortex_m3_vector_catch_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct cortex_m3_common *cortex_m3 = target_to_cm3(target);
 	struct armv7m_common *armv7m = &amp;cortex_m3-&gt;armv7m;
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 	uint32_t demcr = 0;
 	int retval;
-	retval = cortex_m3_verify_pointer(cmd_ctx, cortex_m3);
+
+	retval = cortex_m3_verify_pointer(CMD_CTX, cortex_m3);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -1883,25 +1884,27 @@ write:
 	}
 
 	for (unsigned i = 0; i &lt; ARRAY_SIZE(vec_ids); i++)
-		command_print(cmd_ctx, &quot;%9s: %s&quot;, vec_ids[i].name,
+	{
+		command_print(CMD_CTX, &quot;%9s: %s&quot;, vec_ids[i].name,
 			(demcr &amp; vec_ids[i].mask) ? &quot;catch&quot; : &quot;ignore&quot;);
+	}
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(handle_cortex_m3_mask_interrupts_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct cortex_m3_common *cortex_m3 = target_to_cm3(target);
 	int retval;
 
-	retval = cortex_m3_verify_pointer(cmd_ctx, cortex_m3);
+	retval = cortex_m3_verify_pointer(CMD_CTX, cortex_m3);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -1917,11 +1920,11 @@ COMMAND_HANDLER(handle_cortex_m3_mask_interrupts_command)
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;usage: cortex_m3 maskisr ['on'|'off']&quot;);
+			command_print(CMD_CTX, &quot;usage: cortex_m3 maskisr ['on'|'off']&quot;);
 		}
 	}
 
-	command_print(cmd_ctx, &quot;cortex_m3 interrupt mask %s&quot;,
+	command_print(CMD_CTX, &quot;cortex_m3 interrupt mask %s&quot;,
 			(cortex_m3-&gt;dcb_dhcsr &amp; C_MASKINTS) ? &quot;on&quot; : &quot;off&quot;);
 
 	return ERROR_OK;
diff --git a/src/target/etb.c b/src/target/etb.c
index 1d71dc0..86731c7 100644
--- a/src/target/etb.c
+++ b/src/target/etb.c
@@ -371,14 +371,14 @@ COMMAND_HANDLER(handle_etb_config_command)
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETB: '%s' isn't an ARM&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;ETB: '%s' isn't an ARM&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
 	tap = jtag_tap_by_string(CMD_ARGV[1]);
 	if (tap == NULL)
 	{
-		command_print(cmd_ctx, &quot;ETB: TAP %s does not exist&quot;, CMD_ARGV[1]);
+		command_print(CMD_CTX, &quot;ETB: TAP %s does not exist&quot;, CMD_ARGV[1]);
 		return ERROR_FAIL;
 	}
 
diff --git a/src/target/etm.c b/src/target/etm.c
index 44b8a95..b43f48c 100644
--- a/src/target/etm.c
+++ b/src/target/etm.c
@@ -1192,7 +1192,7 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 		tracemode = ETMV1_TRACE_DATA | ETMV1_TRACE_ADDR;
 	else
 	{
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;invalid option '%s'&quot;, CMD_ARGV[0]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -1213,7 +1213,7 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 		tracemode |= ETMV1_CONTEXTID_32;
 		break;
 	default:
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[1]);
+		command_print(CMD_CTX, &quot;invalid option '%s'&quot;, CMD_ARGV[1]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -1223,7 +1223,7 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 		tracemode |= 0;
 	else
 	{
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[2]);
+		command_print(CMD_CTX, &quot;invalid option '%s'&quot;, CMD_ARGV[2]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -1233,7 +1233,7 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 		tracemode |= 0;
 	else
 	{
-		command_print(cmd_ctx, &quot;invalid option '%s'&quot;, CMD_ARGV[3]);
+		command_print(CMD_CTX, &quot;invalid option '%s'&quot;, CMD_ARGV[3]);
 		return ERROR_INVALID_ARGUMENTS;
 	}
 
@@ -1249,18 +1249,18 @@ static COMMAND_HELPER(handle_etm_tracemode_command_update,
 
 COMMAND_HANDLER(handle_etm_tracemode_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct arm *arm = target_to_arm(target);
 	struct etm_context *etm;
 
 	if (!is_arm(arm)) {
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm = arm-&gt;etm;
 	if (!etm) {
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1274,7 +1274,7 @@ COMMAND_HANDLER(handle_etm_tracemode_command)
 		CALL_COMMAND_HANDLER(handle_etm_tracemode_command_update, &amp;tracemode);
 		break;
 	default:
-		command_print(cmd_ctx, &quot;usage: configure trace mode &quot;
+		command_print(CMD_CTX, &quot;usage: configure trace mode &quot;
 				&quot;&lt;none | data | address | all&gt; &quot;
 				&quot;&lt;context id bits&gt; &lt;cycle accurate&gt; &lt;branch output&gt;&quot;);
 		return ERROR_FAIL;
@@ -1285,56 +1285,56 @@ COMMAND_HANDLER(handle_etm_tracemode_command)
 	 * or couldn't be written; display actual hardware state...
 	 */
 
-	command_print(cmd_ctx, &quot;current tracemode configuration:&quot;);
+	command_print(CMD_CTX, &quot;current tracemode configuration:&quot;);
 
 	switch (tracemode &amp; ETMV1_TRACE_MASK)
 	{
 		case ETMV1_TRACE_NONE:
-			command_print(cmd_ctx, &quot;data tracing: none&quot;);
+			command_print(CMD_CTX, &quot;data tracing: none&quot;);
 			break;
 		case ETMV1_TRACE_DATA:
-			command_print(cmd_ctx, &quot;data tracing: data only&quot;);
+			command_print(CMD_CTX, &quot;data tracing: data only&quot;);
 			break;
 		case ETMV1_TRACE_ADDR:
-			command_print(cmd_ctx, &quot;data tracing: address only&quot;);
+			command_print(CMD_CTX, &quot;data tracing: address only&quot;);
 			break;
 		case ETMV1_TRACE_DATA | ETMV1_TRACE_ADDR:
-			command_print(cmd_ctx, &quot;data tracing: address and data&quot;);
+			command_print(CMD_CTX, &quot;data tracing: address and data&quot;);
 			break;
 	}
 
 	switch (tracemode &amp; ETMV1_CONTEXTID_MASK)
 	{
 		case ETMV1_CONTEXTID_NONE:
-			command_print(cmd_ctx, &quot;contextid tracing: none&quot;);
+			command_print(CMD_CTX, &quot;contextid tracing: none&quot;);
 			break;
 		case ETMV1_CONTEXTID_8:
-			command_print(cmd_ctx, &quot;contextid tracing: 8 bit&quot;);
+			command_print(CMD_CTX, &quot;contextid tracing: 8 bit&quot;);
 			break;
 		case ETMV1_CONTEXTID_16:
-			command_print(cmd_ctx, &quot;contextid tracing: 16 bit&quot;);
+			command_print(CMD_CTX, &quot;contextid tracing: 16 bit&quot;);
 			break;
 		case ETMV1_CONTEXTID_32:
-			command_print(cmd_ctx, &quot;contextid tracing: 32 bit&quot;);
+			command_print(CMD_CTX, &quot;contextid tracing: 32 bit&quot;);
 			break;
 	}
 
 	if (tracemode &amp; ETMV1_CYCLE_ACCURATE)
 	{
-		command_print(cmd_ctx, &quot;cycle-accurate tracing enabled&quot;);
+		command_print(CMD_CTX, &quot;cycle-accurate tracing enabled&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;cycle-accurate tracing disabled&quot;);
+		command_print(CMD_CTX, &quot;cycle-accurate tracing disabled&quot;);
 	}
 
 	if (tracemode &amp; ETMV1_BRANCH_OUTPUT)
 	{
-		command_print(cmd_ctx, &quot;full branch address output enabled&quot;);
+		command_print(CMD_CTX, &quot;full branch address output enabled&quot;);
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;full branch address output disabled&quot;);
+		command_print(CMD_CTX, &quot;full branch address output disabled&quot;);
 	}
 
 	/* only update ETM_CTRL register if tracemode changed */
@@ -1389,7 +1389,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 
 	arm = target_to_arm(target);
 	if (!is_arm(arm)) {
-		command_print(cmd_ctx, &quot;target '%s' is '%s'; not an ARM&quot;,
+		command_print(CMD_CTX, &quot;target '%s' is '%s'; not an ARM&quot;,
 				target-&gt;cmd_name, target_get_name(target));
 		return ERROR_FAIL;
 	}
@@ -1440,7 +1440,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 			portmode |= ETM_PORT_2BIT;
 			break;
 		default:
-			command_print(cmd_ctx,
+			command_print(CMD_CTX,
 				&quot;unsupported ETM port width '%s'&quot;, CMD_ARGV[1]);
 			return ERROR_FAIL;
 	}
@@ -1459,7 +1459,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unsupported ETM port mode '%s', must be 'normal', 'multiplexed' or 'demultiplexed'&quot;, CMD_ARGV[2]);
+		command_print(CMD_CTX, &quot;unsupported ETM port mode '%s', must be 'normal', 'multiplexed' or 'demultiplexed'&quot;, CMD_ARGV[2]);
 		return ERROR_FAIL;
 	}
 
@@ -1473,7 +1473,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;unsupported ETM port clocking '%s', must be 'full' or 'half'&quot;, CMD_ARGV[3]);
+		command_print(CMD_CTX, &quot;unsupported ETM port clocking '%s', must be 'full' or 'half'&quot;, CMD_ARGV[3]);
 		return ERROR_FAIL;
 	}
 
@@ -1488,7 +1488,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 		if (strcmp(CMD_ARGV[4], etm_capture_drivers[i]-&gt;name) == 0)
 		{
 			int retval;
-			if ((retval = etm_capture_drivers[i]-&gt;register_commands(cmd_ctx)) != ERROR_OK)
+			if ((retval = etm_capture_drivers[i]-&gt;register_commands(CMD_CTX)) != ERROR_OK)
 			{
 				free(etm_ctx);
 				return retval;
@@ -1516,7 +1516,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 
 	arm-&gt;etm = etm_ctx;
 
-	return etm_register_user_commands(cmd_ctx);
+	return etm_register_user_commands(CMD_CTX);
 }
 
 COMMAND_HANDLER(handle_etm_info_command)
@@ -1528,49 +1528,49 @@ COMMAND_HANDLER(handle_etm_info_command)
 	int max_port_size;
 	uint32_t config;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm = arm-&gt;etm;
 	if (!etm)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
-	command_print(cmd_ctx, &quot;ETM v%d.%d&quot;,
+	command_print(CMD_CTX, &quot;ETM v%d.%d&quot;,
 			etm-&gt;bcd_vers &gt;&gt; 4, etm-&gt;bcd_vers &amp; 0xf);
-	command_print(cmd_ctx, &quot;pairs of address comparators: %i&quot;,
+	command_print(CMD_CTX, &quot;pairs of address comparators: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 0) &amp; 0x0f);
-	command_print(cmd_ctx, &quot;data comparators: %i&quot;,
+	command_print(CMD_CTX, &quot;data comparators: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 4) &amp; 0x0f);
-	command_print(cmd_ctx, &quot;memory map decoders: %i&quot;,
+	command_print(CMD_CTX, &quot;memory map decoders: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 8) &amp; 0x1f);
-	command_print(cmd_ctx, &quot;number of counters: %i&quot;,
+	command_print(CMD_CTX, &quot;number of counters: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 13) &amp; 0x07);
-	command_print(cmd_ctx, &quot;sequencer %spresent&quot;,
+	command_print(CMD_CTX, &quot;sequencer %spresent&quot;,
 			(int) (etm-&gt;config &amp; (1 &lt;&lt; 16)) ? &quot;&quot; : &quot;not &quot;);
-	command_print(cmd_ctx, &quot;number of ext. inputs: %i&quot;,
+	command_print(CMD_CTX, &quot;number of ext. inputs: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 17) &amp; 0x07);
-	command_print(cmd_ctx, &quot;number of ext. outputs: %i&quot;,
+	command_print(CMD_CTX, &quot;number of ext. outputs: %i&quot;,
 			(int) (etm-&gt;config &gt;&gt; 20) &amp; 0x07);
-	command_print(cmd_ctx, &quot;FIFO full %spresent&quot;,
+	command_print(CMD_CTX, &quot;FIFO full %spresent&quot;,
 			(int) (etm-&gt;config &amp; (1 &lt;&lt; 23)) ? &quot;&quot; : &quot;not &quot;);
 	if (etm-&gt;bcd_vers &lt; 0x20)
-		command_print(cmd_ctx, &quot;protocol version: %i&quot;,
+		command_print(CMD_CTX, &quot;protocol version: %i&quot;,
 				(int) (etm-&gt;config &gt;&gt; 28) &amp; 0x07);
 	else {
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;coprocessor and memory access %ssupported&quot;,
 				(etm-&gt;config &amp; (1 &lt;&lt; 26)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;trace start/stop %spresent&quot;,
+		command_print(CMD_CTX, &quot;trace start/stop %spresent&quot;,
 				(etm-&gt;config &amp; (1 &lt;&lt; 26)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;number of context comparators: %i&quot;,
+		command_print(CMD_CTX, &quot;number of context comparators: %i&quot;,
 				(int) (etm-&gt;config &gt;&gt; 24) &amp; 0x03);
 	}
 
@@ -1622,30 +1622,30 @@ COMMAND_HANDLER(handle_etm_info_command)
 			LOG_ERROR(&quot;Illegal max_port_size&quot;);
 			return ERROR_FAIL;
 	}
-	command_print(cmd_ctx, &quot;max. port size: %i&quot;, max_port_size);
+	command_print(CMD_CTX, &quot;max. port size: %i&quot;, max_port_size);
 
 	if (etm-&gt;bcd_vers &lt; 0x30) {
-		command_print(cmd_ctx, &quot;half-rate clocking %ssupported&quot;,
+		command_print(CMD_CTX, &quot;half-rate clocking %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 3)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;full-rate clocking %ssupported&quot;,
+		command_print(CMD_CTX, &quot;full-rate clocking %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 4)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;normal trace format %ssupported&quot;,
+		command_print(CMD_CTX, &quot;normal trace format %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 5)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;multiplex trace format %ssupported&quot;,
+		command_print(CMD_CTX, &quot;multiplex trace format %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 6)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;demultiplex trace format %ssupported&quot;,
+		command_print(CMD_CTX, &quot;demultiplex trace format %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 7)) ? &quot;&quot; : &quot;not &quot;);
 	} else {
 		/* REVISIT show which size and format are selected ... */
-		command_print(cmd_ctx, &quot;current port size %ssupported&quot;,
+		command_print(CMD_CTX, &quot;current port size %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 10)) ? &quot;&quot; : &quot;not &quot;);
-		command_print(cmd_ctx, &quot;current trace format %ssupported&quot;,
+		command_print(CMD_CTX, &quot;current trace format %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 11)) ? &quot;&quot; : &quot;not &quot;);
 	}
 	if (etm-&gt;bcd_vers &gt;= 0x21)
-		command_print(cmd_ctx, &quot;fetch comparisons %ssupported&quot;,
+		command_print(CMD_CTX, &quot;fetch comparisons %ssupported&quot;,
 				(config &amp; (1 &lt;&lt; 17)) ? &quot;not &quot; : &quot;&quot;);
-	command_print(cmd_ctx, &quot;FIFO full %ssupported&quot;,
+	command_print(CMD_CTX, &quot;FIFO full %ssupported&quot;,
 			(config &amp; (1 &lt;&lt; 8)) ? &quot;&quot; : &quot;not &quot;);
 
 	return ERROR_OK;
@@ -1658,18 +1658,18 @@ COMMAND_HANDLER(handle_etm_status_command)
 	struct etm_context *etm;
 	trace_status_t trace_status;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm = arm-&gt;etm;
 	if (!etm)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1683,7 +1683,7 @@ COMMAND_HANDLER(handle_etm_status_command)
 		if (etm_get_reg(reg) == ERROR_OK) {
 			unsigned s = buf_get_u32(reg-&gt;value, 0, reg-&gt;size);
 
-			command_print(cmd_ctx, &quot;etm: %s%s%s%s&quot;,
+			command_print(CMD_CTX, &quot;etm: %s%s%s%s&quot;,
 				/* bit(1) == progbit */
 				(etm-&gt;bcd_vers &gt;= 0x12)
 					? ((s &amp; (1 &lt;&lt; 1))
@@ -1702,7 +1702,7 @@ COMMAND_HANDLER(handle_etm_status_command)
 	trace_status = etm-&gt;capture_driver-&gt;status(etm);
 	if (trace_status == TRACE_IDLE)
 	{
-		command_print(cmd_ctx, &quot;%s: idle&quot;, etm-&gt;capture_driver-&gt;name);
+		command_print(CMD_CTX, &quot;%s: idle&quot;, etm-&gt;capture_driver-&gt;name);
 	}
 	else
 	{
@@ -1711,7 +1711,7 @@ COMMAND_HANDLER(handle_etm_status_command)
 		static char *overflowed = &quot;, overflowed&quot;;
 		static char *triggered = &quot;, triggered&quot;;
 
-		command_print(cmd_ctx, &quot;%s: trace collection%s%s%s&quot;,
+		command_print(CMD_CTX, &quot;%s: trace collection%s%s%s&quot;,
 			etm-&gt;capture_driver-&gt;name,
 			(trace_status &amp; TRACE_RUNNING) ? running : completed,
 			(trace_status &amp; TRACE_OVERFLOWED) ? overflowed : &quot;&quot;,
@@ -1719,7 +1719,7 @@ COMMAND_HANDLER(handle_etm_status_command)
 
 		if (etm-&gt;trace_depth &gt; 0)
 		{
-			command_print(cmd_ctx, &quot;%i frames of trace data read&quot;,
+			command_print(CMD_CTX, &quot;%i frames of trace data read&quot;,
 					(int)(etm-&gt;trace_depth));
 		}
 	}
@@ -1735,22 +1735,22 @@ COMMAND_HANDLER(handle_etm_image_command)
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;usage: etm image &lt;file&gt; [base address] [type]&quot;);
+		command_print(CMD_CTX, &quot;usage: etm image &lt;file&gt; [base address] [type]&quot;);
 		return ERROR_FAIL;
 	}
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1758,7 +1758,7 @@ COMMAND_HANDLER(handle_etm_image_command)
 	{
 		image_close(etm_ctx-&gt;image);
 		free(etm_ctx-&gt;image);
-		command_print(cmd_ctx, &quot;previously loaded image found and closed&quot;);
+		command_print(CMD_CTX, &quot;previously loaded image found and closed&quot;);
 	}
 
 	etm_ctx-&gt;image = malloc(sizeof(struct image));
@@ -1796,35 +1796,35 @@ COMMAND_HANDLER(handle_etm_dump_command)
 
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;usage: etm dump &lt;file&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: etm dump &lt;file&gt;&quot;);
 		return ERROR_FAIL;
 	}
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (etm_ctx-&gt;capture_driver-&gt;status == TRACE_IDLE)
 	{
-		command_print(cmd_ctx, &quot;trace capture wasn't enabled, no trace data captured&quot;);
+		command_print(CMD_CTX, &quot;trace capture wasn't enabled, no trace data captured&quot;);
 		return ERROR_OK;
 	}
 
 	if (etm_ctx-&gt;capture_driver-&gt;status(etm_ctx) &amp; TRACE_RUNNING)
 	{
 		/* TODO: if on-the-fly capture is to be supported, this needs to be changed */
-		command_print(cmd_ctx, &quot;trace capture not completed&quot;);
+		command_print(CMD_CTX, &quot;trace capture not completed&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1864,28 +1864,28 @@ COMMAND_HANDLER(handle_etm_load_command)
 
 	if (CMD_ARGC != 1)
 	{
-		command_print(cmd_ctx, &quot;usage: etm load &lt;file&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: etm load &lt;file&gt;&quot;);
 		return ERROR_FAIL;
 	}
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (etm_ctx-&gt;capture_driver-&gt;status(etm_ctx) &amp; TRACE_RUNNING)
 	{
-		command_print(cmd_ctx, &quot;trace capture running, stop first&quot;);
+		command_print(CMD_CTX, &quot;trace capture running, stop first&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1896,7 +1896,7 @@ COMMAND_HANDLER(handle_etm_load_command)
 
 	if (file.size % 4)
 	{
-		command_print(cmd_ctx, &quot;size isn't a multiple of 4, no valid trace data&quot;);
+		command_print(CMD_CTX, &quot;size isn't a multiple of 4, no valid trace data&quot;);
 		fileio_close(&amp;file);
 		return ERROR_FAIL;
 	}
@@ -1917,7 +1917,7 @@ COMMAND_HANDLER(handle_etm_load_command)
 	etm_ctx-&gt;trace_data = malloc(sizeof(struct etmv1_trace_data) * etm_ctx-&gt;trace_depth);
 	if (etm_ctx-&gt;trace_data == NULL)
 	{
-		command_print(cmd_ctx, &quot;not enough memory to perform operation&quot;);
+		command_print(CMD_CTX, &quot;not enough memory to perform operation&quot;);
 		fileio_close(&amp;file);
 		return ERROR_FAIL;
 	}
@@ -1944,18 +1944,18 @@ COMMAND_HANDLER(handle_etm_trigger_percent_command)
 	struct arm *arm;
 	struct etm_context *etm_ctx;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1966,7 +1966,7 @@ COMMAND_HANDLER(handle_etm_trigger_percent_command)
 
 		if ((new_value &lt; 2) || (new_value &gt; 100))
 		{
-			command_print(cmd_ctx, &quot;valid settings are 2%% to 100%%&quot;);
+			command_print(CMD_CTX, &quot;valid settings are 2%% to 100%%&quot;);
 		}
 		else
 		{
@@ -1974,7 +1974,7 @@ COMMAND_HANDLER(handle_etm_trigger_percent_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;%i percent of the tracebuffer reserved for after the trigger&quot;, ((int)(etm_ctx-&gt;trigger_percent)));
+	command_print(CMD_CTX, &quot;%i percent of the tracebuffer reserved for after the trigger&quot;, ((int)(etm_ctx-&gt;trigger_percent)));
 
 	return ERROR_OK;
 }
@@ -1986,18 +1986,18 @@ COMMAND_HANDLER(handle_etm_start_command)
 	struct etm_context *etm_ctx;
 	struct reg *etm_ctrl_reg;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -2034,18 +2034,18 @@ COMMAND_HANDLER(handle_etm_stop_command)
 	struct etm_context *etm_ctx;
 	struct reg *etm_ctrl_reg;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -2073,36 +2073,36 @@ COMMAND_HANDLER(handle_etm_analyze_command)
 	struct etm_context *etm_ctx;
 	int retval;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;ETM: current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;ETM: current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	etm_ctx = arm-&gt;etm;
 	if (!etm_ctx)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
-	if ((retval = etmv1_analyze_trace(etm_ctx, cmd_ctx)) != ERROR_OK)
+	if ((retval = etmv1_analyze_trace(etm_ctx, CMD_CTX)) != ERROR_OK)
 	{
 		switch (retval)
 		{
 			case ERROR_ETM_ANALYSIS_FAILED:
-				command_print(cmd_ctx, &quot;further analysis failed (corrupted trace data or just end of data&quot;);
+				command_print(CMD_CTX, &quot;further analysis failed (corrupted trace data or just end of data&quot;);
 				break;
 			case ERROR_TRACE_INSTRUCTION_UNAVAILABLE:
-				command_print(cmd_ctx, &quot;no instruction for current address available, analysis aborted&quot;);
+				command_print(CMD_CTX, &quot;no instruction for current address available, analysis aborted&quot;);
 				break;
 			case ERROR_TRACE_IMAGE_UNAVAILABLE:
-				command_print(cmd_ctx, &quot;no image available for trace analysis&quot;);
+				command_print(CMD_CTX, &quot;no image available for trace analysis&quot;);
 				break;
 			default:
-				command_print(cmd_ctx, &quot;unknown error: %i&quot;, retval);
+				command_print(CMD_CTX, &quot;unknown error: %i&quot;, retval);
 		}
 	}
 
diff --git a/src/target/etm_dummy.c b/src/target/etm_dummy.c
index ae53802..7621414 100644
--- a/src/target/etm_dummy.c
+++ b/src/target/etm_dummy.c
@@ -41,7 +41,7 @@ COMMAND_HANDLER(handle_etm_dummy_config_command)
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;target '%s' isn't an ARM&quot;, CMD_ARGV[0]);
+		command_print(CMD_CTX, &quot;target '%s' isn't an ARM&quot;, CMD_ARGV[0]);
 		return ERROR_FAIL;
 	}
 
diff --git a/src/target/oocd_trace.c b/src/target/oocd_trace.c
index 74f8955..05df258 100644
--- a/src/target/oocd_trace.c
+++ b/src/target/oocd_trace.c
@@ -300,11 +300,11 @@ COMMAND_HANDLER(handle_oocd_trace_config_command)
 		return ERROR_FAIL;
 	}
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -333,24 +333,24 @@ COMMAND_HANDLER(handle_oocd_trace_status_command)
 	struct oocd_trace *oocd_trace;
 	uint32_t status;
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (!arm-&gt;etm)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (strcmp(arm-&gt;etm-&gt;capture_driver-&gt;name, &quot;oocd_trace&quot;) != 0)
 	{
-		command_print(cmd_ctx, &quot;current target's ETM capture driver isn't 'oocd_trace'&quot;);
+		command_print(CMD_CTX, &quot;current target's ETM capture driver isn't 'oocd_trace'&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -359,9 +359,9 @@ COMMAND_HANDLER(handle_oocd_trace_status_command)
 	oocd_trace_read_reg(oocd_trace, OOCD_TRACE_STATUS, &amp;status);
 
 	if (status &amp; 0x8)
-		command_print(cmd_ctx, &quot;trace clock locked&quot;);
+		command_print(CMD_CTX, &quot;trace clock locked&quot;);
 	else
-		command_print(cmd_ctx, &quot;no trace clock&quot;);
+		command_print(CMD_CTX, &quot;no trace clock&quot;);
 
 	return ERROR_OK;
 }
@@ -374,24 +374,24 @@ COMMAND_HANDLER(handle_oocd_trace_resync_command)
 	size_t bytes_written;
 	uint8_t cmd_array[1];
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 
 	arm = target_to_arm(target);
 	if (!is_arm(arm))
 	{
-		command_print(cmd_ctx, &quot;current target isn't an ARM&quot;);
+		command_print(CMD_CTX, &quot;current target isn't an ARM&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (!arm-&gt;etm)
 	{
-		command_print(cmd_ctx, &quot;current target doesn't have an ETM configured&quot;);
+		command_print(CMD_CTX, &quot;current target doesn't have an ETM configured&quot;);
 		return ERROR_FAIL;
 	}
 
 	if (strcmp(arm-&gt;etm-&gt;capture_driver-&gt;name, &quot;oocd_trace&quot;) != 0)
 	{
-		command_print(cmd_ctx, &quot;current target's ETM capture driver isn't 'oocd_trace'&quot;);
+		command_print(CMD_CTX, &quot;current target's ETM capture driver isn't 'oocd_trace'&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -401,7 +401,7 @@ COMMAND_HANDLER(handle_oocd_trace_resync_command)
 
 	bytes_written = write(oocd_trace-&gt;tty_fd, cmd_array, 1);
 
-	command_print(cmd_ctx, &quot;requesting traceclock resync&quot;);
+	command_print(CMD_CTX, &quot;requesting traceclock resync&quot;);
 	LOG_DEBUG(&quot;resyncing traceclk pll&quot;);
 
 	return ERROR_OK;
diff --git a/src/target/target.c b/src/target/target.c
index 76406a9..7e09da2 100644
--- a/src/target/target.c
+++ b/src/target/target.c
@@ -1652,24 +1652,24 @@ COMMAND_HANDLER(handle_targets_command)
 	{
 		target = get_target(CMD_ARGV[0]);
 		if (target == NULL) {
-			command_print(cmd_ctx,&quot;Target: %s is unknown, try one of:\n&quot;, CMD_ARGV[0]);
+			command_print(CMD_CTX,&quot;Target: %s is unknown, try one of:\n&quot;, CMD_ARGV[0]);
 			goto DumpTargets;
 		}
 		if (!target-&gt;tap-&gt;enabled) {
-			command_print(cmd_ctx,&quot;Target: TAP %s is disabled, &quot;
+			command_print(CMD_CTX,&quot;Target: TAP %s is disabled, &quot;
 					&quot;can't be the current target\n&quot;,
 					target-&gt;tap-&gt;dotted_name);
 			return ERROR_FAIL;
 		}
 
-		cmd_ctx-&gt;current_target = target-&gt;target_number;
+		CMD_CTX-&gt;current_target = target-&gt;target_number;
 		return ERROR_OK;
 	}
 DumpTargets:
 
 	target = all_targets;
-	command_print(cmd_ctx, &quot;    TargetName         Type       Endian TapName            State       &quot;);
-	command_print(cmd_ctx, &quot;--  ------------------ ---------- ------ ------------------ ------------&quot;);
+	command_print(CMD_CTX, &quot;    TargetName         Type       Endian TapName            State       &quot;);
+	command_print(CMD_CTX, &quot;--  ------------------ ---------- ------ ------------------ ------------&quot;);
 	while (target)
 	{
 		const char *state;
@@ -1680,11 +1680,11 @@ DumpTargets:
 		else
 			state = &quot;tap-disabled&quot;;
 
-		if (cmd_ctx-&gt;current_target == target-&gt;target_number)
+		if (CMD_CTX-&gt;current_target == target-&gt;target_number)
 			marker = '*';
 
 		/* keep columns lined up to match the headers above */
-		command_print(cmd_ctx, &quot;%2d%c %-18s %-10s %-6s %-18s %s&quot;,
+		command_print(CMD_CTX, &quot;%2d%c %-18s %-10s %-6s %-18s %s&quot;,
 					  target-&gt;target_number,
 					  marker,
 					  target-&gt;cmd_name,
@@ -1865,7 +1865,7 @@ COMMAND_HANDLER(handle_reg_command)
 
 	LOG_DEBUG(&quot;-&quot;);
 
-	target = get_current_target(cmd_ctx);
+	target = get_current_target(CMD_CTX);
 
 	/* list all available registers for the current target */
 	if (CMD_ARGC == 0)
@@ -1877,7 +1877,7 @@ COMMAND_HANDLER(handle_reg_command)
 		{
 			int i;
 
-			command_print(cmd_ctx, &quot;===== %s&quot;, cache-&gt;name);
+			command_print(CMD_CTX, &quot;===== %s&quot;, cache-&gt;name);
 
 			for (i = 0, reg = cache-&gt;reg_list;
 					i &lt; cache-&gt;num_regs;
@@ -1887,7 +1887,7 @@ COMMAND_HANDLER(handle_reg_command)
 				if (reg-&gt;valid) {
 					value = buf_to_str(reg-&gt;value,
 							reg-&gt;size, 16);
-					command_print(cmd_ctx,
+					command_print(CMD_CTX,
 							&quot;(%i) %s (/%&quot; PRIu32 &quot;): 0x%s%s&quot;,
 							count, reg-&gt;name,
 							reg-&gt;size, value,
@@ -1896,7 +1896,7 @@ COMMAND_HANDLER(handle_reg_command)
 								: &quot;&quot;);
 					free(value);
 				} else {
-					command_print(cmd_ctx, &quot;(%i) %s (/%&quot; PRIu32 &quot;)&quot;,
+					command_print(CMD_CTX, &quot;(%i) %s (/%&quot; PRIu32 &quot;)&quot;,
 							  count, reg-&gt;name,
 							  reg-&gt;size) ;
 				}
@@ -1933,7 +1933,7 @@ COMMAND_HANDLER(handle_reg_command)
 
 		if (!reg)
 		{
-			command_print(cmd_ctx, &quot;%i is out of bounds, the current target has only %i registers (0 - %i)&quot;, num, count, count - 1);
+			command_print(CMD_CTX, &quot;%i is out of bounds, the current target has only %i registers (0 - %i)&quot;, num, count, count - 1);
 			return ERROR_OK;
 		}
 	} else /* access a single register by its name */
@@ -1942,7 +1942,7 @@ COMMAND_HANDLER(handle_reg_command)
 
 		if (!reg)
 		{
-			command_print(cmd_ctx, &quot;register %s not found in current target&quot;, CMD_ARGV[0]);
+			command_print(CMD_CTX, &quot;register %s not found in current target&quot;, CMD_ARGV[0]);
 			return ERROR_OK;
 		}
 	}
@@ -1959,7 +1959,7 @@ COMMAND_HANDLER(handle_reg_command)
 			arch_type-&gt;get(reg);
 		}
 		value = buf_to_str(reg-&gt;value, reg-&gt;size, 16);
-		command_print(cmd_ctx, &quot;%s (/%i): 0x%s&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
+		command_print(CMD_CTX, &quot;%s (/%i): 0x%s&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
 		free(value);
 		return ERROR_OK;
 	}
@@ -1974,7 +1974,7 @@ COMMAND_HANDLER(handle_reg_command)
 		arch_type-&gt;set(reg, buf);
 
 		value = buf_to_str(reg-&gt;value, reg-&gt;size, 16);
-		command_print(cmd_ctx, &quot;%s (/%i): 0x%s&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
+		command_print(CMD_CTX, &quot;%s (/%i): 0x%s&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
 		free(value);
 
 		free(buf);
@@ -1982,7 +1982,7 @@ COMMAND_HANDLER(handle_reg_command)
 		return ERROR_OK;
 	}
 
-	command_print(cmd_ctx, &quot;usage: reg &lt;#|name&gt; [value]&quot;);
+	command_print(CMD_CTX, &quot;usage: reg &lt;#|name&gt; [value]&quot;);
 
 	return ERROR_OK;
 }
@@ -1990,13 +1990,13 @@ COMMAND_HANDLER(handle_reg_command)
 COMMAND_HANDLER(handle_poll_command)
 {
 	int retval = ERROR_OK;
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	if (CMD_ARGC == 0)
 	{
-		command_print(cmd_ctx, &quot;background polling: %s&quot;,
+		command_print(CMD_CTX, &quot;background polling: %s&quot;,
 				jtag_poll_get_enabled() ? &quot;on&quot; : &quot;off&quot;);
-		command_print(cmd_ctx, &quot;TAP: %s (%s)&quot;,
+		command_print(CMD_CTX, &quot;TAP: %s (%s)&quot;,
 				target-&gt;tap-&gt;dotted_name,
 				target-&gt;tap-&gt;enabled ? &quot;enabled&quot; : &quot;disabled&quot;);
 		if (!target-&gt;tap-&gt;enabled)
@@ -2019,7 +2019,7 @@ COMMAND_HANDLER(handle_poll_command)
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;arg is \&quot;on\&quot; or \&quot;off\&quot;&quot;);
+			command_print(CMD_CTX, &quot;arg is \&quot;on\&quot; or \&quot;off\&quot;&quot;);
 		}
 	} else
 	{
@@ -2040,14 +2040,14 @@ COMMAND_HANDLER(handle_wait_halt_command)
 		int retval = parse_uint(CMD_ARGV[0], &amp;ms);
 		if (ERROR_OK != retval)
 		{
-			command_print(cmd_ctx, &quot;usage: %s [seconds]&quot;, CMD_NAME);
+			command_print(CMD_CTX, &quot;usage: %s [seconds]&quot;, CMD_NAME);
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		}
 		// convert seconds (given) to milliseconds (needed)
 		ms *= 1000;
 	}
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	return target_wait_state(target, TARGET_HALTED, ms);
 }
 
@@ -2100,7 +2100,7 @@ COMMAND_HANDLER(handle_halt_command)
 {
 	LOG_DEBUG(&quot;-&quot;);
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	int retval = target_halt(target);
 	if (ERROR_OK != retval)
 		return retval;
@@ -2120,7 +2120,7 @@ COMMAND_HANDLER(handle_halt_command)
 
 COMMAND_HANDLER(handle_soft_reset_halt_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	LOG_USER(&quot;requesting target halt and executing a soft reset&quot;);
 
@@ -2146,7 +2146,7 @@ COMMAND_HANDLER(handle_reset_command)
 	}
 
 	/* reset *all* targets */
-	return target_process_reset(cmd_ctx, reset_mode);
+	return target_process_reset(CMD_CTX, reset_mode);
 }
 
 
@@ -2156,7 +2156,7 @@ COMMAND_HANDLER(handle_resume_command)
 	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	target_handle_event(target, TARGET_EVENT_OLD_pre_resume);
 
 	/* with no CMD_ARGV, resume from current pc, addr = 0,
@@ -2190,7 +2190,7 @@ COMMAND_HANDLER(handle_step_command)
 		current_pc = 0;
 	}
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	return target-&gt;type-&gt;step(target, current_pc, addr, 1);
 }
@@ -2284,10 +2284,10 @@ COMMAND_HANDLER(handle_md_command)
 
 	uint8_t *buffer = calloc(count, size);
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	int retval = fn(target, address, size, count, buffer);
 	if (ERROR_OK == retval)
-		handle_md_output(cmd_ctx, target, address, size, count, buffer);
+		handle_md_output(CMD_CTX, target, address, size, count, buffer);
 
 	free(buffer);
 
@@ -2326,7 +2326,7 @@ COMMAND_HANDLER(handle_mw_command)
 	if (CMD_ARGC == 3)
 		COMMAND_PARSE_NUMBER(uint, CMD_ARGV[2], count);
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	unsigned wordsize;
 	uint8_t value_buf[4];
 	switch (cmd_name[6])
@@ -2411,7 +2411,7 @@ COMMAND_HANDLER(handle_load_image_command)
 	if (ERROR_OK != retval)
 		return retval;
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	struct duration bench;
 	duration_start(&amp;bench);
@@ -2428,7 +2428,7 @@ COMMAND_HANDLER(handle_load_image_command)
 		buffer = malloc(image.sections[i].size);
 		if (buffer == NULL)
 		{
-			command_print(cmd_ctx,
+			command_print(CMD_CTX,
 						  &quot;error allocating buffer for section (%d bytes)&quot;,
 						  (int)(image.sections[i].size));
 			break;
@@ -2466,7 +2466,7 @@ COMMAND_HANDLER(handle_load_image_command)
 				break;
 			}
 			image_size += length;
-			command_print(cmd_ctx, &quot;%u bytes written at address 0x%8.8&quot; PRIx32 &quot;&quot;,
+			command_print(CMD_CTX, &quot;%u bytes written at address 0x%8.8&quot; PRIx32 &quot;&quot;,
 						  (unsigned int)length,
 						  image.sections[i].base_address + offset);
 		}
@@ -2476,7 +2476,7 @@ COMMAND_HANDLER(handle_load_image_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;downloaded %&quot; PRIu32 &quot; bytes &quot;
+		command_print(CMD_CTX, &quot;downloaded %&quot; PRIu32 &quot; bytes &quot;
 				&quot;in %fs (%0.3f kb/s)&quot;, image_size,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, image_size));
 	}
@@ -2495,11 +2495,11 @@ COMMAND_HANDLER(handle_dump_image_command)
 	int retvaltemp;
 
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	if (CMD_ARGC != 3)
 	{
-		command_print(cmd_ctx, &quot;usage: dump_image &lt;filename&gt; &lt;address&gt; &lt;size&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: dump_image &lt;filename&gt; &lt;address&gt; &lt;size&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -2542,7 +2542,7 @@ COMMAND_HANDLER(handle_dump_image_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;dumped %zu bytes in %fs (%0.3f kb/s)&quot;, fileio.size,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, fileio.size));
 	}
@@ -2562,7 +2562,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 
 	struct image image;
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	if (CMD_ARGC &lt; 1)
 	{
@@ -2605,7 +2605,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 		buffer = malloc(image.sections[i].size);
 		if (buffer == NULL)
 		{
-			command_print(cmd_ctx,
+			command_print(CMD_CTX,
 						  &quot;error allocating buffer for section (%d bytes)&quot;,
 						  (int)(image.sections[i].size));
 			break;
@@ -2633,7 +2633,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 				/* failed crc checksum, fall back to a binary compare */
 				uint8_t *data;
 
-				command_print(cmd_ctx, &quot;checksum mismatch - attempting binary compare&quot;);
+				command_print(CMD_CTX, &quot;checksum mismatch - attempting binary compare&quot;);
 
 				data = (uint8_t*)malloc(buf_cnt);
 
@@ -2653,7 +2653,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 					{
 						if (data[t] != buffer[t])
 						{
-							command_print(cmd_ctx,
+							command_print(CMD_CTX,
 										  &quot;Verify operation failed address 0x%08x. Was 0x%02x instead of 0x%02x\n&quot;,
 										  (unsigned)(t + image.sections[i].base_address),
 										  data[t],
@@ -2674,7 +2674,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 			}
 		} else
 		{
-			command_print(cmd_ctx, &quot;address 0x%08&quot; PRIx32 &quot; length 0x%08zx&quot;,
+			command_print(CMD_CTX, &quot;address 0x%08&quot; PRIx32 &quot; length 0x%08zx&quot;,
 						  image.sections[i].base_address,
 						  buf_cnt);
 		}
@@ -2685,7 +2685,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 done:
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;verified %&quot; PRIu32 &quot; bytes &quot;
+		command_print(CMD_CTX, &quot;verified %&quot; PRIu32 &quot; bytes &quot;
 				&quot;in %fs (%0.3f kb/s)&quot;, image_size,
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, image_size));
 	}
@@ -2748,11 +2748,11 @@ static int handle_bp_command_set(struct command_context *cmd_ctx,
 COMMAND_HANDLER(handle_bp_command)
 {
 	if (CMD_ARGC == 0)
-		return handle_bp_command_list(cmd_ctx);
+		return handle_bp_command_list(CMD_CTX);
 
 	if (CMD_ARGC &lt; 2 || CMD_ARGC &gt; 3)
 	{
-		command_print(cmd_ctx, &quot;usage: bp &lt;address&gt; &lt;length&gt; ['hw']&quot;);
+		command_print(CMD_CTX, &quot;usage: bp &lt;address&gt; &lt;length&gt; ['hw']&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
@@ -2770,7 +2770,7 @@ COMMAND_HANDLER(handle_bp_command)
 			return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
-	return handle_bp_command_set(cmd_ctx, addr, length, hw);
+	return handle_bp_command_set(CMD_CTX, addr, length, hw);
 }
 
 COMMAND_HANDLER(handle_rbp_command)
@@ -2781,7 +2781,7 @@ COMMAND_HANDLER(handle_rbp_command)
 	uint32_t addr;
 	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], addr);
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	breakpoint_remove(target, addr);
 
 	return ERROR_OK;
@@ -2789,7 +2789,7 @@ COMMAND_HANDLER(handle_rbp_command)
 
 COMMAND_HANDLER(handle_wp_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	if (CMD_ARGC == 0)
 	{
@@ -2797,7 +2797,7 @@ COMMAND_HANDLER(handle_wp_command)
 
 		while (watchpoint)
 		{
-			command_print(cmd_ctx, &quot;address: 0x%8.8&quot; PRIx32
+			command_print(CMD_CTX, &quot;address: 0x%8.8&quot; PRIx32
 					&quot;, len: 0x%8.8&quot; PRIx32
 					&quot;, r/w/a: %i, value: 0x%8.8&quot; PRIx32
 					&quot;, mask: 0x%8.8&quot; PRIx32,
@@ -2848,7 +2848,7 @@ COMMAND_HANDLER(handle_wp_command)
 		break;
 
 	default:
-		command_print(cmd_ctx, &quot;usage: wp [address length &quot;
+		command_print(CMD_CTX, &quot;usage: wp [address length &quot;
 				&quot;[(r|w|a) [value [mask]]]]&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -2869,7 +2869,7 @@ COMMAND_HANDLER(handle_rwp_command)
 	uint32_t addr;
 	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], addr);
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	watchpoint_remove(target, addr);
 
 	return ERROR_OK;
@@ -2891,10 +2891,10 @@ COMMAND_HANDLER(handle_virt2phys_command)
 	COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], va);
 	uint32_t pa;
 
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	int retval = target-&gt;type-&gt;virt2phys(target, va, &amp;pa);
 	if (retval == ERROR_OK)
-		command_print(cmd_ctx, &quot;Physical address 0x%08&quot; PRIx32 &quot;&quot;, pa);
+		command_print(CMD_CTX, &quot;Physical address 0x%08&quot; PRIx32 &quot;&quot;, pa);
 
 	return retval;
 }
@@ -3018,7 +3018,7 @@ static void writeGmon(uint32_t *samples, uint32_t sampleNum, const char *filenam
 /* profiling samples the CPU PC as quickly as OpenOCD is able, which will be used as a random sampling of PC */
 COMMAND_HANDLER(handle_profile_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct timeval timeout, now;
 
 	gettimeofday(&amp;timeout, NULL);
@@ -3031,7 +3031,7 @@ COMMAND_HANDLER(handle_profile_command)
 
 	timeval_add_time(&amp;timeout, offset, 0);
 
-	command_print(cmd_ctx, &quot;Starting profiling. Halting and resuming the target as often as we can...&quot;);
+	command_print(CMD_CTX, &quot;Starting profiling. Halting and resuming the target as often as we can...&quot;);
 
 	static const int maxSample = 10000;
 	uint32_t *samples = malloc(sizeof(uint32_t)*maxSample);
@@ -3063,7 +3063,7 @@ COMMAND_HANDLER(handle_profile_command)
 			}
 		} else
 		{
-			command_print(cmd_ctx, &quot;Target not halted or running&quot;);
+			command_print(CMD_CTX, &quot;Target not halted or running&quot;);
 			retval = ERROR_OK;
 			break;
 		}
@@ -3075,7 +3075,7 @@ COMMAND_HANDLER(handle_profile_command)
 		gettimeofday(&amp;now, NULL);
 		if ((numSamples &gt;= maxSample) || ((now.tv_sec &gt;= timeout.tv_sec) &amp;&amp; (now.tv_usec &gt;= timeout.tv_usec)))
 		{
-			command_print(cmd_ctx, &quot;Profiling completed. %d samples.&quot;, numSamples);
+			command_print(CMD_CTX, &quot;Profiling completed. %d samples.&quot;, numSamples);
 			if ((retval = target_poll(target)) != ERROR_OK)
 			{
 				free(samples);
@@ -3091,7 +3091,7 @@ COMMAND_HANDLER(handle_profile_command)
 				return retval;
 			}
 			writeGmon(samples, numSamples, CMD_ARGV[1]);
-			command_print(cmd_ctx, &quot;Wrote %s&quot;, CMD_ARGV[1]);
+			command_print(CMD_CTX, &quot;Wrote %s&quot;, CMD_ARGV[1]);
 			break;
 		}
 	}
@@ -4573,7 +4573,7 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 		buffer = malloc(image.sections[i].size);
 		if (buffer == NULL)
 		{
-			command_print(cmd_ctx, &quot;error allocating buffer for section (%d bytes)&quot;,
+			command_print(CMD_CTX, &quot;error allocating buffer for section (%d bytes)&quot;,
 						  (int)(image.sections[i].size));
 			break;
 		}
@@ -4616,7 +4616,7 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 			fastload[i].length = length;
 
 			image_size += length;
-			command_print(cmd_ctx, &quot;%u bytes written at address 0x%8.8x&quot;,
+			command_print(CMD_CTX, &quot;%u bytes written at address 0x%8.8x&quot;,
 						  (unsigned int)length,
 						  ((unsigned int)(image.sections[i].base_address + offset)));
 		}
@@ -4626,11 +4626,11 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 
 	if ((ERROR_OK == retval) &amp;&amp; (duration_measure(&amp;bench) == ERROR_OK))
 	{
-		command_print(cmd_ctx, &quot;Loaded %&quot; PRIu32 &quot; bytes &quot;
+		command_print(CMD_CTX, &quot;Loaded %&quot; PRIu32 &quot; bytes &quot;
 				&quot;in %fs (%0.3f kb/s)&quot;, image_size, 
 				duration_elapsed(&amp;bench), duration_kbps(&amp;bench, image_size));
 
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;WARNING: image has not been loaded to target!&quot;
 				&quot;You can issue a 'fast_load' to finish loading.&quot;);
 	}
@@ -4660,8 +4660,8 @@ COMMAND_HANDLER(handle_fast_load_command)
 	int retval = ERROR_OK;
 	for (i = 0; i &lt; fastload_num;i++)
 	{
-		struct target *target = get_current_target(cmd_ctx);
-		command_print(cmd_ctx, &quot;Write to 0x%08x, length 0x%08x&quot;,
+		struct target *target = get_current_target(CMD_CTX);
+		command_print(CMD_CTX, &quot;Write to 0x%08x, length 0x%08x&quot;,
 					  (unsigned int)(fastload[i].address),
 					  (unsigned int)(fastload[i].length));
 		if (retval == ERROR_OK)
@@ -4671,7 +4671,7 @@ COMMAND_HANDLER(handle_fast_load_command)
 		size += fastload[i].length;
 	}
 	int after = timeval_ms();
-	command_print(cmd_ctx, &quot;Loaded image %f kBytes/s&quot;, (float)(size/1024.0)/((float)(after-ms)/1000.0));
+	command_print(CMD_CTX, &quot;Loaded image %f kBytes/s&quot;, (float)(size/1024.0)/((float)(after-ms)/1000.0));
 	return retval;
 }
 
diff --git a/src/target/target_request.c b/src/target/target_request.c
index 1d618cc..583f4c0 100644
--- a/src/target/target_request.c
+++ b/src/target/target_request.c
@@ -260,12 +260,12 @@ int delete_debug_msg_receiver(struct command_context *cmd_ctx, struct target *ta
 
 COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 
 	int receiving = 0;
 
 	/* see if reciever is already registered */
-	if (find_debug_msg_receiver(cmd_ctx, target) != NULL)
+	if (find_debug_msg_receiver(CMD_CTX, target) != NULL)
 		receiving = 1;
 
 	if (CMD_ARGC &gt; 0)
@@ -276,7 +276,7 @@ COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 			if (!receiving)
 			{
 				receiving = 1;
-				add_debug_msg_receiver(cmd_ctx, target);
+				add_debug_msg_receiver(CMD_CTX, target);
 			}
 			charmsg_mode = !strcmp(CMD_ARGV[0], &quot;charmsg&quot;);
 		}
@@ -286,16 +286,16 @@ COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 			if (receiving)
 			{
 				receiving = 0;
-				delete_debug_msg_receiver(cmd_ctx, target);
+				delete_debug_msg_receiver(CMD_CTX, target);
 			}
 		}
 		else
 		{
-			command_print(cmd_ctx, &quot;usage: target_request debugmsgs ['enable'|'disable'|'charmsg']&quot;);
+			command_print(CMD_CTX, &quot;usage: target_request debugmsgs ['enable'|'disable'|'charmsg']&quot;);
 		}
 	}
 
-	command_print(cmd_ctx, &quot;receiving debug messages from current target %s&quot;,
+	command_print(CMD_CTX, &quot;receiving debug messages from current target %s&quot;,
 		      (receiving) ? (charmsg_mode?&quot;charmsg&quot;:&quot;enabled&quot;) : &quot;disabled&quot;);
 	return ERROR_OK;
 }
diff --git a/src/target/trace.c b/src/target/trace.c
index f2fd790..c038a15 100644
--- a/src/target/trace.c
+++ b/src/target/trace.c
@@ -49,7 +49,7 @@ int trace_point(struct target *target, uint32_t number)
 
 COMMAND_HANDLER(handle_trace_point_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct trace *trace = target-&gt;trace_info;
 
 	if (CMD_ARGC == 0)
@@ -58,7 +58,7 @@ COMMAND_HANDLER(handle_trace_point_command)
 
 		for (i = 0; i &lt; trace-&gt;num_trace_points; i++)
 		{
-			command_print(cmd_ctx, &quot;trace point 0x%8.8&quot; PRIx32 &quot; (%lld times hit)&quot;,
+			command_print(CMD_CTX, &quot;trace point 0x%8.8&quot; PRIx32 &quot; (%lld times hit)&quot;,
 					trace-&gt;trace_points[i].address,
 					(long long)trace-&gt;trace_points[i].hit_counter);
 		}
@@ -97,7 +97,7 @@ COMMAND_HANDLER(handle_trace_point_command)
 
 COMMAND_HANDLER(handle_trace_history_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct trace *trace = target-&gt;trace_info;
 
 	if (CMD_ARGC &gt; 0)
@@ -117,7 +117,7 @@ COMMAND_HANDLER(handle_trace_history_command)
 		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], trace-&gt;trace_history_size);
 		trace-&gt;trace_history = malloc(sizeof(uint32_t) * trace-&gt;trace_history_size);
 
-		command_print(cmd_ctx, &quot;new trace history size: %i&quot;, (int)(trace-&gt;trace_history_size));
+		command_print(CMD_CTX, &quot;new trace history size: %i&quot;, (int)(trace-&gt;trace_history_size));
 	}
 	else
 	{
@@ -126,7 +126,7 @@ COMMAND_HANDLER(handle_trace_history_command)
 		uint32_t last = trace-&gt;trace_history_pos;
 
 		if (!trace-&gt;trace_history_size) {
-			command_print(cmd_ctx, &quot;trace history buffer is not allocated&quot;);
+			command_print(CMD_CTX, &quot;trace history buffer is not allocated&quot;);
 			return ERROR_OK;
 		}
 		if (trace-&gt;trace_history_overflowed)
@@ -141,14 +141,14 @@ COMMAND_HANDLER(handle_trace_history_command)
 			{
 				uint32_t address;
 				address = trace-&gt;trace_points[trace-&gt;trace_history[i % trace-&gt;trace_history_size]].address;
-				command_print(cmd_ctx, &quot;trace point %i: 0x%8.8&quot; PRIx32 &quot;&quot;,
+				command_print(CMD_CTX, &quot;trace point %i: 0x%8.8&quot; PRIx32 &quot;&quot;,
 					      (int)(trace-&gt;trace_history[i % trace-&gt;trace_history_size]),
 					      address);
 			}
 
 			else
 			{
-				command_print(cmd_ctx, &quot;trace point %i: -not defined-&quot;, (int)(trace-&gt;trace_history[i % trace-&gt;trace_history_size]));
+				command_print(CMD_CTX, &quot;trace point %i: -not defined-&quot;, (int)(trace-&gt;trace_history[i % trace-&gt;trace_history_size]));
 			}
 		}
 	}
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 3bd61d1..e16f202 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -3009,7 +3009,7 @@ COMMAND_HANDLER(xscale_handle_debug_handler_command)
 	}
 
 	xscale = target_to_xscale(target);
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -3048,7 +3048,7 @@ COMMAND_HANDLER(xscale_handle_cache_clean_address_command)
 		return ERROR_FAIL;
 	}
 	xscale = target_to_xscale(target);
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -3068,15 +3068,15 @@ COMMAND_HANDLER(xscale_handle_cache_clean_address_command)
 
 COMMAND_HANDLER(xscale_handle_cache_info_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
-	return armv4_5_handle_cache_info_command(cmd_ctx, &amp;xscale-&gt;armv4_5_mmu.armv4_5_cache);
+	return armv4_5_handle_cache_info_command(CMD_CTX, &amp;xscale-&gt;armv4_5_mmu.armv4_5_cache);
 }
 
 static int xscale_virt2phys(struct target *target,
@@ -3117,17 +3117,17 @@ static int xscale_mmu(struct target *target, int *enabled)
 
 COMMAND_HANDLER(xscale_handle_mmu_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -3145,25 +3145,25 @@ COMMAND_HANDLER(xscale_handle_mmu_command)
 		}
 	}
 
-	command_print(cmd_ctx, &quot;mmu %s&quot;, (xscale-&gt;armv4_5_mmu.mmu_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
+	command_print(CMD_CTX, &quot;mmu %s&quot;, (xscale-&gt;armv4_5_mmu.mmu_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(xscale_handle_idcache_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int icache = 0, dcache = 0;
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -3195,27 +3195,27 @@ COMMAND_HANDLER(xscale_handle_idcache_command)
 	}
 
 	if (icache)
-		command_print(cmd_ctx, &quot;icache %s&quot;, (xscale-&gt;armv4_5_mmu.armv4_5_cache.i_cache_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
+		command_print(CMD_CTX, &quot;icache %s&quot;, (xscale-&gt;armv4_5_mmu.armv4_5_cache.i_cache_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	if (dcache)
-		command_print(cmd_ctx, &quot;dcache %s&quot;, (xscale-&gt;armv4_5_mmu.armv4_5_cache.d_u_cache_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
+		command_print(CMD_CTX, &quot;dcache %s&quot;, (xscale-&gt;armv4_5_mmu.armv4_5_cache.d_u_cache_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(xscale_handle_vector_catch_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;usage: xscale vector_catch [mask]&quot;);
+		command_print(CMD_CTX, &quot;usage: xscale vector_catch [mask]&quot;);
 	}
 	else
 	{
@@ -3224,7 +3224,7 @@ COMMAND_HANDLER(xscale_handle_vector_catch_command)
 		xscale_write_dcsr(target, -1, -1);
 	}
 
-	command_print(cmd_ctx, &quot;vector catch mask: 0x%2.2x&quot;, xscale-&gt;vector_catch);
+	command_print(CMD_CTX, &quot;vector catch mask: 0x%2.2x&quot;, xscale-&gt;vector_catch);
 
 	return ERROR_OK;
 }
@@ -3232,12 +3232,12 @@ COMMAND_HANDLER(xscale_handle_vector_catch_command)
 
 COMMAND_HANDLER(xscale_handle_vector_table_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int err = 0;
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -3245,13 +3245,13 @@ COMMAND_HANDLER(xscale_handle_vector_table_command)
 	{
 		int idx;
 
-		command_print(cmd_ctx, &quot;active user-set static vectors:&quot;);
+		command_print(CMD_CTX, &quot;active user-set static vectors:&quot;);
 		for (idx = 1; idx &lt; 8; idx++)
 			if (xscale-&gt;static_low_vectors_set &amp; (1 &lt;&lt; idx))
-				command_print(cmd_ctx, &quot;low  %d: 0x%&quot; PRIx32, idx, xscale-&gt;static_low_vectors[idx]);
+				command_print(CMD_CTX, &quot;low  %d: 0x%&quot; PRIx32, idx, xscale-&gt;static_low_vectors[idx]);
 		for (idx = 1; idx &lt; 8; idx++)
 			if (xscale-&gt;static_high_vectors_set &amp; (1 &lt;&lt; idx))
-				command_print(cmd_ctx, &quot;high %d: 0x%&quot; PRIx32, idx, xscale-&gt;static_high_vectors[idx]);
+				command_print(CMD_CTX, &quot;high %d: 0x%&quot; PRIx32, idx, xscale-&gt;static_high_vectors[idx]);
 		return ERROR_OK;
 	}
 
@@ -3282,7 +3282,7 @@ COMMAND_HANDLER(xscale_handle_vector_table_command)
 	}
 
 	if (err)
-		command_print(cmd_ctx, &quot;usage: xscale vector_table &lt;high|low&gt; &lt;index&gt; &lt;code&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: xscale vector_table &lt;high|low&gt; &lt;index&gt; &lt;code&gt;&quot;);
 
 	return ERROR_OK;
 }
@@ -3290,19 +3290,19 @@ COMMAND_HANDLER(xscale_handle_vector_table_command)
 
 COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	struct armv4_5_common_s *armv4_5 = &amp;xscale-&gt;armv4_5_common;
 	uint32_t dcsr_value;
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
@@ -3354,7 +3354,7 @@ COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 		xscale-&gt;trace.pc_ok = 0;
 	}
 
-	command_print(cmd_ctx, &quot;trace buffer %s (%s)&quot;,
+	command_print(CMD_CTX, &quot;trace buffer %s (%s)&quot;,
 		(xscale-&gt;trace.buffer_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;,
 		(xscale-&gt;trace.buffer_fill &gt; 0) ? &quot;fill&quot; : &quot;wrap&quot;);
 
@@ -3369,17 +3369,17 @@ COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 
 COMMAND_HANDLER(xscale_handle_trace_image_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;usage: xscale trace_image &lt;file&gt; [base address] [type]&quot;);
+		command_print(CMD_CTX, &quot;usage: xscale trace_image &lt;file&gt; [base address] [type]&quot;);
 		return ERROR_OK;
 	}
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
@@ -3387,7 +3387,7 @@ COMMAND_HANDLER(xscale_handle_trace_image_command)
 	{
 		image_close(xscale-&gt;trace.image);
 		free(xscale-&gt;trace.image);
-		command_print(cmd_ctx, &quot;previously loaded image found and closed&quot;);
+		command_print(CMD_CTX, &quot;previously loaded image found and closed&quot;);
 	}
 
 	xscale-&gt;trace.image = malloc(sizeof(struct image));
@@ -3417,25 +3417,25 @@ COMMAND_HANDLER(xscale_handle_trace_image_command)
 
 COMMAND_HANDLER(xscale_handle_dump_trace_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	struct xscale_trace_data *trace_data;
 	struct fileio file;
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 
 	if (CMD_ARGC &lt; 1)
 	{
-		command_print(cmd_ctx, &quot;usage: xscale dump_trace &lt;file&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: xscale dump_trace &lt;file&gt;&quot;);
 		return ERROR_OK;
 	}
 
@@ -3443,7 +3443,7 @@ COMMAND_HANDLER(xscale_handle_dump_trace_command)
 
 	if (!trace_data)
 	{
-		command_print(cmd_ctx, &quot;no trace data collected&quot;);
+		command_print(CMD_CTX, &quot;no trace data collected&quot;);
 		return ERROR_OK;
 	}
 
@@ -3474,32 +3474,32 @@ COMMAND_HANDLER(xscale_handle_dump_trace_command)
 
 COMMAND_HANDLER(xscale_handle_analyze_trace_buffer_command)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
-	xscale_analyze_trace(target, cmd_ctx);
+	xscale_analyze_trace(target, CMD_CTX);
 
 	return ERROR_OK;
 }
 
 COMMAND_HANDLER(xscale_handle_cp15)
 {
-	struct target *target = get_current_target(cmd_ctx);
+	struct target *target = get_current_target(CMD_CTX);
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	retval = xscale_verify_pointer(cmd_ctx, xscale);
+	retval = xscale_verify_pointer(CMD_CTX, xscale);
 	if (retval != ERROR_OK)
 		return retval;
 
 	if (target-&gt;state != TARGET_HALTED)
 	{
-		command_print(cmd_ctx, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
+		command_print(CMD_CTX, &quot;target must be stopped for \&quot;%s\&quot; command&quot;, CMD_NAME);
 		return ERROR_OK;
 	}
 	uint32_t reg_no = 0;
@@ -3535,7 +3535,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 			reg_no = XSCALE_CPACCESS;
 			break;
 		default:
-			command_print(cmd_ctx, &quot;invalid register number&quot;);
+			command_print(CMD_CTX, &quot;invalid register number&quot;);
 			return ERROR_INVALID_ARGUMENTS;
 		}
 		reg = &amp;xscale-&gt;reg_cache-&gt;reg_list[reg_no];
@@ -3548,7 +3548,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 		/* read cp15 control register */
 		xscale_get_reg(reg);
 		value = buf_get_u32(reg-&gt;value, 0, 32);
-		command_print(cmd_ctx, &quot;%s (/%i): 0x%&quot; PRIx32 &quot;&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
+		command_print(CMD_CTX, &quot;%s (/%i): 0x%&quot; PRIx32 &quot;&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
 	}
 	else if (CMD_ARGC == 2)
 	{
@@ -3569,7 +3569,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 	}
 	else
 	{
-		command_print(cmd_ctx, &quot;usage: cp15 [register]&lt;, [value]&gt;&quot;);
+		command_print(CMD_CTX, &quot;usage: cp15 [register]&lt;, [value]&gt;&quot;);
 	}
 
 	return ERROR_OK;
diff --git a/src/xsvf/xsvf.c b/src/xsvf/xsvf.c
index 1fe0b86..9af9767 100644
--- a/src/xsvf/xsvf.c
+++ b/src/xsvf/xsvf.c
@@ -221,7 +221,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 
 	if (CMD_ARGC &lt; 2)
 	{
-		command_print(cmd_ctx, &quot;usage: xsvf &lt;device#|plain&gt; &lt;file&gt; [&lt;variant&gt;] [quiet]&quot;);
+		command_print(CMD_CTX, &quot;usage: xsvf &lt;device#|plain&gt; &lt;file&gt; [&lt;variant&gt;] [quiet]&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -233,14 +233,14 @@ COMMAND_HANDLER(handle_xsvf_command)
 		tap = jtag_tap_by_string(CMD_ARGV[0]);
 		if (!tap)
 		{
-			command_print(cmd_ctx, &quot;Tap: %s unknown&quot;, CMD_ARGV[0]);
+			command_print(CMD_CTX, &quot;Tap: %s unknown&quot;, CMD_ARGV[0]);
 			return ERROR_FAIL;
 		}
 	}
 
 	if ((xsvf_fd = open(filename, O_RDONLY)) &lt; 0)
 	{
-		command_print(cmd_ctx, &quot;file \&quot;%s\&quot; not found&quot;, filename);
+		command_print(CMD_CTX, &quot;file \&quot;%s\&quot; not found&quot;, filename);
 		return ERROR_FAIL;
 	}
 
@@ -1012,7 +1012,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 
 	if (tdo_mismatch)
 	{
-		command_print(cmd_ctx, &quot;TDO mismatch, somewhere near offset %lu in xsvf file, aborting&quot;,
+		command_print(CMD_CTX, &quot;TDO mismatch, somewhere near offset %lu in xsvf file, aborting&quot;,
 					  file_offset);
 
 
@@ -1022,7 +1022,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 	if (unsupported)
 	{
 		off_t offset = lseek(xsvf_fd, 0, SEEK_CUR) - 1;
-		command_print(cmd_ctx,
+		command_print(CMD_CTX,
 				&quot;unsupported xsvf command (0x%02X) at offset %jd, aborting&quot;,
 				uc, (intmax_t)offset);
 		return ERROR_FAIL;
@@ -1030,7 +1030,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 
 	if (do_abort)
 	{
-		command_print(cmd_ctx, &quot;premature end of xsvf file detected, aborting&quot;);
+		command_print(CMD_CTX, &quot;premature end of xsvf file detected, aborting&quot;);
 		return ERROR_FAIL;
 	}
 
@@ -1045,7 +1045,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 
 	close(xsvf_fd);
 
-	command_print(cmd_ctx, &quot;XSVF file programmed successfully&quot;);
+	command_print(CMD_CTX, &quot;XSVF file programmed successfully&quot;);
 
 	return ERROR_OK;
 }
-- 
1.6.4.4


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012456.html">[Openocd-development] [PATCH 3/6] command_handler: change 'args' to	CMD_ARGV
</A></li>
	<LI>Next message: <A HREF="012455.html">[Openocd-development] [PATCH 5/6] add struct command_invocation for	COMMAND_HANDLER
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12458">[ date ]</a>
              <a href="thread.html#12458">[ thread ]</a>
              <a href="subject.html#12458">[ subject ]</a>
              <a href="author.html#12458">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
