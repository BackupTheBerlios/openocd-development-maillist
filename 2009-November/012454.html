<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] [PATCH 2/6] command_handler: change to 'argc'	to CMD_ARGC
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2009-November/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20%5BPATCH%202/6%5D%20command_handler%3A%20change%20to%20%27argc%27%0A%09to%20CMD_ARGC&In-Reply-To=%3C1258414478-8037-3-git-send-email-zw%40superlucidity.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012453.html">
   <LINK REL="Next"  HREF="012456.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] [PATCH 2/6] command_handler: change to 'argc'	to CMD_ARGC</H1>
    <B>Zachary T Welch</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20%5BPATCH%202/6%5D%20command_handler%3A%20change%20to%20%27argc%27%0A%09to%20CMD_ARGC&In-Reply-To=%3C1258414478-8037-3-git-send-email-zw%40superlucidity.net%3E"
       TITLE="[Openocd-development] [PATCH 2/6] command_handler: change to 'argc'	to CMD_ARGC">zw at superlucidity.net
       </A><BR>
    <I>Tue Nov 17 00:34:34 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="012453.html">[Openocd-development] [PATCH 1/6] add more command_handler	conversion macros
</A></li>
        <LI>Next message: <A HREF="012456.html">[Openocd-development] [PATCH 3/6] command_handler: change 'args' to	CMD_ARGV
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12454">[ date ]</a>
              <a href="thread.html#12454">[ thread ]</a>
              <a href="subject.html#12454">[ subject ]</a>
              <a href="author.html#12454">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This patch converts all instances of 'argc' in COMMAND_HANDLER routines
to use CMD_ARGC.

Signed-off-by: Zachary T Welch &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">zw at superlucidity.net</A>&gt;
---
 src/flash/at91sam3.c                |    4 +-
 src/flash/at91sam7.c                |    6 +-
 src/flash/avrf.c                    |    4 +-
 src/flash/cfi.c                     |    4 +-
 src/flash/davinci_nand.c            |    2 +-
 src/flash/ecos.c                    |    2 +-
 src/flash/faux.c                    |    2 +-
 src/flash/flash.c                   |   32 ++++++------
 src/flash/flash.h                   |    2 +-
 src/flash/lpc2000.c                 |    6 +-
 src/flash/lpc288x.c                 |    2 +-
 src/flash/lpc2900.c                 |   16 +++---
 src/flash/lpc3180_nand_controller.c |    6 +-
 src/flash/mflash.c                  |    8 ++--
 src/flash/mx3_nand.c                |    2 +-
 src/flash/nand.c                    |   24 +++++-----
 src/flash/ocl.c                     |    2 +-
 src/flash/orion_nand.c              |    2 +-
 src/flash/pic32mx.c                 |   10 ++--
 src/flash/stellaris.c               |    4 +-
 src/flash/stm32x.c                  |   12 ++--
 src/flash/str7x.c                   |    4 +-
 src/flash/str9x.c                   |    4 +-
 src/flash/str9xpec.c                |   24 +++++-----
 src/flash/tms470.c                  |   14 +++---
 src/hello.c                         |    4 +-
 src/helper/command.c                |    6 +-
 src/helper/ioutil.c                 |   18 ++++----
 src/helper/log.c                    |    6 +-
 src/jtag/amt_jtagaccel.c            |    4 +-
 src/jtag/at91rm9200.c               |    2 +-
 src/jtag/ft2232.c                   |   20 ++++----
 src/jtag/gw16012.c                  |    2 +-
 src/jtag/jlink.c                    |    2 +-
 src/jtag/parport.c                  |    8 ++--
 src/jtag/presto.c                   |    2 +-
 src/jtag/tcl.c                      |   60 ++++++++++++------------
 src/jtag/vsllink.c                  |   12 ++--
 src/openocd.c                       |    4 +-
 src/pld/pld.c                       |    4 +-
 src/pld/virtex2.c                   |    4 +-
 src/server/gdb_server.c             |   12 ++--
 src/server/server.c                 |    2 +-
 src/svf/svf.c                       |    4 +-
 src/target/arm11.c                  |    6 +-
 src/target/arm720t.c                |    6 +-
 src/target/arm7_9_common.c          |   12 ++--
 src/target/arm920t.c                |   18 ++++----
 src/target/arm926ejs.c              |    4 +-
 src/target/arm966e.c                |    6 +-
 src/target/arm9tdmi.c               |    4 +-
 src/target/arm_adi_v5.c             |    8 ++--
 src/target/armv4_5.c                |    4 +-
 src/target/armv7a.c                 |    4 +-
 src/target/armv7m.c                 |    4 +-
 src/target/cortex_m3.c              |   14 +++---
 src/target/etb.c                    |    2 +-
 src/target/etm.c                    |   16 +++---
 src/target/oocd_trace.c             |    2 +-
 src/target/target.c                 |   88 +++++++++++++++++-----------------
 src/target/target_request.c         |    2 +-
 src/target/trace.c                  |    4 +-
 src/target/xscale.c                 |   38 ++++++++--------
 src/xsvf/xsvf.c                     |    8 ++--
 64 files changed, 312 insertions(+), 312 deletions(-)

diff --git a/src/flash/at91sam3.c b/src/flash/at91sam3.c
index 4507888..54e60bf 100644
--- a/src/flash/at91sam3.c
+++ b/src/flash/at91sam3.c
@@ -2365,7 +2365,7 @@ COMMAND_HANDLER(sam3_handle_gpnvm_command)
 	}
 
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	default:
 		command_print(cmd_ctx,&quot;Too many parameters\n&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -2438,7 +2438,7 @@ COMMAND_HANDLER(sam3_handle_slowclk_command)
 	}
 
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		// show
 		break;
diff --git a/src/flash/at91sam7.c b/src/flash/at91sam7.c
index 9d05d7b..193bfd3 100644
--- a/src/flash/at91sam7.c
+++ b/src/flash/at91sam7.c
@@ -743,7 +743,7 @@ FLASH_BANK_COMMAND_HANDLER(at91sam7_flash_bank_command)
 	at91sam7_info-&gt;ext_freq = 0;
 	at91sam7_info-&gt;flash_autodetection = 0;
 
-	if (argc &lt; 13)
+	if (CMD_ARGC &lt; 13)
 	{
 		at91sam7_info-&gt;flash_autodetection = 1;
 		return ERROR_OK;
@@ -760,7 +760,7 @@ FLASH_BANK_COMMAND_HANDLER(at91sam7_flash_bank_command)
 	COMMAND_PARSE_NUMBER(u16, args[11], page_size);
 	COMMAND_PARSE_NUMBER(u16, args[12], num_nvmbits);
 
-	if (argc == 14) {
+	if (CMD_ARGC == 14) {
 		unsigned long freq;
 		COMMAND_PARSE_NUMBER(ulong, args[13], freq);
 		ext_freq = freq * 1000;
@@ -1107,7 +1107,7 @@ COMMAND_HANDLER(at91sam7_handle_gpnvm_command)
 	struct at91sam7_flash_bank *at91sam7_info;
 	int retval;
 
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 	{
 		command_print(cmd_ctx, &quot;at91sam7 gpnvm &lt;bit&gt; &lt;set | clear&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/avrf.c b/src/flash/avrf.c
index 5d3c033..f1db3c4 100644
--- a/src/flash/avrf.c
+++ b/src/flash/avrf.c
@@ -184,7 +184,7 @@ FLASH_BANK_COMMAND_HANDLER(avrf_flash_bank_command)
 {
 	struct avrf_flash_bank *avrf_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank avr configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -419,7 +419,7 @@ COMMAND_HANDLER(avrf_handle_mass_erase_command)
 {
 	int i;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;avr mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/cfi.c b/src/flash/cfi.c
index c0ad50d..c68fb73 100644
--- a/src/flash/cfi.c
+++ b/src/flash/cfi.c
@@ -606,7 +606,7 @@ FLASH_BANK_COMMAND_HANDLER(cfi_flash_bank_command)
 {
 	struct cfi_flash_bank *cfi_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank cfi configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -633,7 +633,7 @@ FLASH_BANK_COMMAND_HANDLER(cfi_flash_bank_command)
 	cfi_info-&gt;jedec_probe = 0;
 	cfi_info-&gt;not_cfi = 0;
 
-	for (unsigned i = 6; i &lt; argc; i++)
+	for (unsigned i = 6; i &lt; CMD_ARGC; i++)
 	{
 		if (strcmp(args[i], &quot;x16_as_x8&quot;) == 0)
 		{
diff --git a/src/flash/davinci_nand.c b/src/flash/davinci_nand.c
index 413bcda..7c68be7 100644
--- a/src/flash/davinci_nand.c
+++ b/src/flash/davinci_nand.c
@@ -645,7 +645,7 @@ NAND_DEVICE_COMMAND_HANDLER(davinci_nand_device_command)
 	 *  - aemif address
 	 * Plus someday, optionally, ALE and CLE masks.
 	 */
-	if (argc &lt; 5) {
+	if (CMD_ARGC &lt; 5) {
 		LOG_ERROR(&quot;parameters: %s target &quot;
 				&quot;chip_addr hwecc_mode aemif_addr&quot;,
 				args[0]);
diff --git a/src/flash/ecos.c b/src/flash/ecos.c
index b2ffadf..8d2d3ee 100644
--- a/src/flash/ecos.c
+++ b/src/flash/ecos.c
@@ -109,7 +109,7 @@ FLASH_BANK_COMMAND_HANDLER(ecosflash_flash_bank_command)
 {
 	struct ecosflash_flash_bank *info;
 
-	if (argc &lt; 7)
+	if (CMD_ARGC &lt; 7)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank ecosflash configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
diff --git a/src/flash/faux.c b/src/flash/faux.c
index b048fcb..54acf75 100644
--- a/src/flash/faux.c
+++ b/src/flash/faux.c
@@ -41,7 +41,7 @@ FLASH_BANK_COMMAND_HANDLER(faux_flash_bank_command)
 {
 	struct faux_flash_bank *info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank faux configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
diff --git a/src/flash/flash.c b/src/flash/flash.c
index adc1411..7402772 100644
--- a/src/flash/flash.c
+++ b/src/flash/flash.c
@@ -222,7 +222,7 @@ COMMAND_HANDLER(handle_flash_bank_command)
 	int found = 0;
 	struct target *target;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -303,7 +303,7 @@ COMMAND_HANDLER(handle_flash_info_command)
 	int j = 0;
 	int retval;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned bank_nr;
@@ -362,7 +362,7 @@ COMMAND_HANDLER(handle_flash_probe_command)
 {
 	int retval;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -397,7 +397,7 @@ COMMAND_HANDLER(handle_flash_probe_command)
 
 COMMAND_HANDLER(handle_flash_erase_check_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -450,7 +450,7 @@ COMMAND_HANDLER(handle_flash_erase_address_command)
 
 	struct target *target = get_current_target(cmd_ctx);
 
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	COMMAND_PARSE_NUMBER(int, args[0], address);
@@ -487,7 +487,7 @@ COMMAND_HANDLER(handle_flash_erase_address_command)
 
 COMMAND_HANDLER(handle_flash_protect_check_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	struct flash_bank *p;
@@ -531,7 +531,7 @@ static int flash_check_sector_parameters(struct command_context *cmd_ctx,
 
 COMMAND_HANDLER(handle_flash_erase_command)
 {
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t bank_nr;
@@ -571,7 +571,7 @@ COMMAND_HANDLER(handle_flash_erase_command)
 
 COMMAND_HANDLER(handle_flash_protect_command)
 {
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t bank_nr;
@@ -622,7 +622,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 
 	int retval;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -637,13 +637,13 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 		{
 			auto_erase = 1;
 			args++;
-			argc--;
+			CMD_ARGC--;
 			command_print(cmd_ctx, &quot;auto erase enabled&quot;);
 		} else if (strcmp(args[0], &quot;unlock&quot;) == 0)
 		{
 			auto_unlock = true;
 			args++;
-			argc--;
+			CMD_ARGC--;
 			command_print(cmd_ctx, &quot;auto unlock enabled&quot;);
 		} else
 		{
@@ -651,7 +651,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 		}
 	}
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -665,7 +665,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 	struct duration bench;
 	duration_start(&amp;bench);
 
-	if (argc &gt;= 2)
+	if (CMD_ARGC &gt;= 2)
 	{
 		image.base_address_set = 1;
 		COMMAND_PARSE_NUMBER(int, args[1], image.base_address);
@@ -678,7 +678,7 @@ COMMAND_HANDLER(handle_flash_write_image_command)
 
 	image.start_address_set = 0;
 
-	retval = image_open(&amp;image, args[0], (argc == 3) ? args[2] : NULL);
+	retval = image_open(&amp;image, args[0], (CMD_ARGC == 3) ? args[2] : NULL);
 	if (retval != ERROR_OK)
 	{
 		return retval;
@@ -718,7 +718,7 @@ COMMAND_HANDLER(handle_flash_fill_command)
 	uint32_t i;
 	uint32_t wordsize;
 
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	COMMAND_PARSE_NUMBER(u32, args[0], address);
@@ -813,7 +813,7 @@ COMMAND_HANDLER(handle_flash_write_bank_command)
 	uint8_t *buffer;
 	struct fileio fileio;
 
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	struct duration bench;
diff --git a/src/flash/flash.h b/src/flash/flash.h
index 96a4120..df5b0c9 100644
--- a/src/flash/flash.h
+++ b/src/flash/flash.h
@@ -118,7 +118,7 @@ struct flash_driver
 	 *
 	 * For example, args[4] = 16 bit flash, args[5] = 32bit bus.
 	 *
-	 * If extra arguments are provided (@a argc &gt; 6), they will
+	 * If extra arguments are provided (@a CMD_ARGC &gt; 6), they will
 	 * start in @a args[6].  These can be used to implement
 	 * driver-specific extensions.
 	 *
diff --git a/src/flash/lpc2000.c b/src/flash/lpc2000.c
index a3f9718..60d909f 100644
--- a/src/flash/lpc2000.c
+++ b/src/flash/lpc2000.c
@@ -424,7 +424,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc2000_flash_bank_command)
 {
 	struct lpc2000_flash_bank *lpc2000_info;
 
-	if (argc &lt; 8)
+	if (CMD_ARGC &lt; 8)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank lpc2000 configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -469,7 +469,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc2000_flash_bank_command)
 	lpc2000_info-&gt;calc_checksum = 0;
 	lpc2000_build_sector_list(bank);
 
-	if (argc &gt;= 9)
+	if (CMD_ARGC &gt;= 9)
 	{
 		if (strcmp(args[8], &quot;calc_checksum&quot;) == 0)
 			lpc2000_info-&gt;calc_checksum = 1;
@@ -744,7 +744,7 @@ COMMAND_HANDLER(lpc2000_handle_part_id_command)
 	uint32_t result_table[4];
 	int status_code;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
diff --git a/src/flash/lpc288x.c b/src/flash/lpc288x.c
index eb95b66..2ad5014 100644
--- a/src/flash/lpc288x.c
+++ b/src/flash/lpc288x.c
@@ -169,7 +169,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc288x_flash_bank_command)
 {
 	struct lpc288x_flash_bank *lpc288x_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank LPC288x configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
diff --git a/src/flash/lpc2900.c b/src/flash/lpc2900.c
index dc91668..67a510e 100644
--- a/src/flash/lpc2900.c
+++ b/src/flash/lpc2900.c
@@ -537,7 +537,7 @@ COMMAND_HANDLER(lpc2900_handle_signature_command)
 	uint32_t signature[4];
 
 
-	if( argc &lt; 1 )
+	if( CMD_ARGC &lt; 1 )
 	{
 		LOG_WARNING( &quot;Too few arguments. Call: lpc2900 signature &lt;bank#&gt;&quot; );
 		return ERROR_FLASH_BANK_INVALID;
@@ -583,7 +583,7 @@ COMMAND_HANDLER(lpc2900_handle_signature_command)
  */
 COMMAND_HANDLER(lpc2900_handle_read_custom_command)
 {
-	if( argc &lt; 2 )
+	if( CMD_ARGC &lt; 2 )
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -654,7 +654,7 @@ COMMAND_HANDLER(lpc2900_handle_read_custom_command)
  */
 COMMAND_HANDLER(lpc2900_handle_password_command)
 {
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -689,7 +689,7 @@ COMMAND_HANDLER(lpc2900_handle_password_command)
  */
 COMMAND_HANDLER(lpc2900_handle_write_custom_command)
 {
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -724,7 +724,7 @@ COMMAND_HANDLER(lpc2900_handle_write_custom_command)
 	image.start_address_set = 0;
 
 	const char *filename = args[1];
-	const char *type = (argc &gt;= 3) ? args[2] : NULL;
+	const char *type = (CMD_ARGC &gt;= 3) ? args[2] : NULL;
 	retval = image_open(&amp;image, filename, type);
 	if (retval != ERROR_OK)
 	{
@@ -799,7 +799,7 @@ COMMAND_HANDLER(lpc2900_handle_write_custom_command)
  */
 COMMAND_HANDLER(lpc2900_handle_secure_sector_command)
 {
-	if (argc &lt; 3)
+	if (CMD_ARGC &lt; 3)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -898,7 +898,7 @@ COMMAND_HANDLER(lpc2900_handle_secure_sector_command)
  */
 COMMAND_HANDLER(lpc2900_handle_secure_jtag_command)
 {
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -1020,7 +1020,7 @@ FLASH_BANK_COMMAND_HANDLER(lpc2900_flash_bank_command)
 {
 	struct lpc2900_flash_bank *lpc2900_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank LPC2900 configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
diff --git a/src/flash/lpc3180_nand_controller.c b/src/flash/lpc3180_nand_controller.c
index 3589e8b..d7cbe38 100644
--- a/src/flash/lpc3180_nand_controller.c
+++ b/src/flash/lpc3180_nand_controller.c
@@ -31,7 +31,7 @@ static int lpc3180_controller_ready(struct nand_device *nand, int timeout);
  */
 NAND_DEVICE_COMMAND_HANDLER(lpc3180_nand_device_command)
 {
-	if (argc &lt; 3)
+	if (CMD_ARGC &lt; 3)
 	{
 		LOG_WARNING(&quot;incomplete 'lpc3180' nand flash configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -836,7 +836,7 @@ COMMAND_HANDLER(handle_lpc3180_select_command)
 		&quot;no&quot;, &quot;mlc&quot;, &quot;slc&quot;
 	};
 
-	if ((argc &lt; 1) || (argc &gt; 2))
+	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -852,7 +852,7 @@ COMMAND_HANDLER(handle_lpc3180_select_command)
 
 	lpc3180_info = nand-&gt;controller_priv;
 
-	if (argc == 2)
+	if (CMD_ARGC == 2)
 	{
 		if (strcmp(args[1], &quot;mlc&quot;) == 0)
 		{
diff --git a/src/flash/mflash.c b/src/flash/mflash.c
index 0620642..6aeeabc 100644
--- a/src/flash/mflash.c
+++ b/src/flash/mflash.c
@@ -710,7 +710,7 @@ COMMAND_HANDLER(mg_write_cmd)
 	struct fileio fileio;
 	int ret;
 
-	if (argc != 3) {
+	if (CMD_ARGC != 3) {
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
@@ -775,7 +775,7 @@ COMMAND_HANDLER(mg_dump_cmd)
 	struct fileio fileio;
 	int ret;
 
-	if (argc != 4) {
+	if (CMD_ARGC != 4) {
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
 
@@ -1223,7 +1223,7 @@ COMMAND_HANDLER(mg_config_cmd)
 	if ((ret = mg_mflash_rst()) != ERROR_OK)
 		return ret;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 		case 2:
 			if (!strcmp(args[1], &quot;boot&quot;))
 				return mg_boot_config();
@@ -1288,7 +1288,7 @@ COMMAND_HANDLER(mg_bank_cmd)
 	struct target *target;
 	int i;
 
-	if (argc &lt; 4)
+	if (CMD_ARGC &lt; 4)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
diff --git a/src/flash/mx3_nand.c b/src/flash/mx3_nand.c
index 45d2a32..49e1758 100644
--- a/src/flash/mx3_nand.c
+++ b/src/flash/mx3_nand.c
@@ -79,7 +79,7 @@ NAND_DEVICE_COMMAND_HANDLER(imx31_nand_device_command)
 	    LOG_ERROR (&quot;target '%s' not defined&quot;, args[1]);
 	    return ERROR_FAIL;
 	}
-	if (argc &lt; 3)
+	if (CMD_ARGC &lt; 3)
 	{
 	    LOG_ERROR (&quot;use \&quot;nand device imx31 target noecc|hwecc\&quot;&quot;);
 	    return ERROR_FAIL;
diff --git a/src/flash/nand.c b/src/flash/nand.c
index 71a67c4..9231b9a 100644
--- a/src/flash/nand.c
+++ b/src/flash/nand.c
@@ -210,7 +210,7 @@ COMMAND_HANDLER(handle_nand_device_command)
 	int i;
 	int retval;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		LOG_WARNING(&quot;incomplete flash device nand configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -1082,7 +1082,7 @@ COMMAND_HANDLER(handle_nand_info_command)
 	if (ERROR_OK != retval)
 		return retval;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	default:
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	case 1:
@@ -1147,7 +1147,7 @@ COMMAND_HANDLER(handle_nand_info_command)
 
 COMMAND_HANDLER(handle_nand_probe_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -1175,7 +1175,7 @@ COMMAND_HANDLER(handle_nand_probe_command)
 
 COMMAND_HANDLER(handle_nand_erase_command)
 {
-	if (argc != 1 &amp;&amp; argc != 3)
+	if (CMD_ARGC != 1 &amp;&amp; CMD_ARGC != 3)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
@@ -1190,7 +1190,7 @@ COMMAND_HANDLER(handle_nand_erase_command)
 	unsigned long length;
 
 	/* erase specified part of the chip; or else everything */
-	if (argc == 3) {
+	if (CMD_ARGC == 3) {
 		unsigned long size = p-&gt;erase_size * p-&gt;num_blocks;
 
 		COMMAND_PARSE_NUMBER(ulong, args[1], offset);
@@ -1234,7 +1234,7 @@ COMMAND_HANDLER(handle_nand_check_bad_blocks_command)
 	int first = -1;
 	int last = -1;
 
-	if ((argc &lt; 1) || (argc &gt; 3) || (argc == 2))
+	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; 3) || (CMD_ARGC == 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
@@ -1245,7 +1245,7 @@ COMMAND_HANDLER(handle_nand_check_bad_blocks_command)
 	if (ERROR_OK != retval)
 		return retval;
 
-	if (argc == 3)
+	if (CMD_ARGC == 3)
 	{
 		unsigned long offset;
 		unsigned long length;
@@ -1389,7 +1389,7 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 	nand_fileio_init(state);
 
 	unsigned minargs = need_size ? 4 : 3;
-	if (argc &lt; minargs)
+	if (CMD_ARGC &lt; minargs)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	struct nand_device *nand;
@@ -1414,9 +1414,9 @@ static COMMAND_HELPER(nand_fileio_parse_args, struct nand_fileio_state *state,
 			}
 	}
 
-	if (argc &gt; minargs)
+	if (CMD_ARGC &gt; minargs)
 	{
-		for (unsigned i = minargs; i &lt; argc; i++)
+		for (unsigned i = minargs; i &lt; CMD_ARGC; i++)
 		{
 			if (!strcmp(args[i], &quot;oob_raw&quot;))
 				state-&gt;oob_format |= NAND_OOB_RAW;
@@ -1646,7 +1646,7 @@ COMMAND_HANDLER(handle_nand_dump_command)
 
 COMMAND_HANDLER(handle_nand_raw_access_command)
 {
-	if ((argc &lt; 1) || (argc &gt; 2))
+	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -1662,7 +1662,7 @@ COMMAND_HANDLER(handle_nand_raw_access_command)
 		return ERROR_OK;
 	}
 
-	if (argc == 2)
+	if (CMD_ARGC == 2)
 	{
 		if (strcmp(&quot;enable&quot;, args[1]) == 0)
 			p-&gt;use_raw = 1;
diff --git a/src/flash/ocl.c b/src/flash/ocl.c
index 0b492c6..388395f 100644
--- a/src/flash/ocl.c
+++ b/src/flash/ocl.c
@@ -49,7 +49,7 @@ FLASH_BANK_COMMAND_HANDLER(ocl_flash_bank_command)
 	struct arm7_9_common *arm7_9;
 	struct ocl_priv *ocl;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank ocl configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
diff --git a/src/flash/orion_nand.c b/src/flash/orion_nand.c
index 4235b08..69d6d96 100644
--- a/src/flash/orion_nand.c
+++ b/src/flash/orion_nand.c
@@ -131,7 +131,7 @@ NAND_DEVICE_COMMAND_HANDLER(orion_nand_device_command)
 	uint32_t base;
 	uint8_t ale, cle;
 
-	if (argc != 3) {
+	if (CMD_ARGC != 3) {
 		LOG_ERROR(&quot;arguments must be: &lt;target_id&gt; &lt;NAND_address&gt;\n&quot;);
 		return ERROR_NAND_DEVICE_INVALID;
 	}
diff --git a/src/flash/pic32mx.c b/src/flash/pic32mx.c
index 51c42b5..95e2c63 100644
--- a/src/flash/pic32mx.c
+++ b/src/flash/pic32mx.c
@@ -66,7 +66,7 @@ FLASH_BANK_COMMAND_HANDLER(pic32mx_flash_bank_command)
 {
 	struct pic32mx_flash_bank *pic32mx_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank pic32mx configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -677,7 +677,7 @@ COMMAND_HANDLER(pic32mx_handle_lock_command)
 	struct target *target = NULL;
 	struct pic32mx_flash_bank *pic32mx_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;pic32mx lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -723,7 +723,7 @@ COMMAND_HANDLER(pic32mx_handle_unlock_command)
 	struct target *target = NULL;
 	struct pic32mx_flash_bank *pic32mx_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;pic32mx unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -813,7 +813,7 @@ COMMAND_HANDLER(pic32mx_handle_chip_erase_command)
 #if 0
 	int i;
 
-	if (argc != 0)
+	if (CMD_ARGC != 0)
 	{
 		command_print(cmd_ctx, &quot;pic32mx chip_erase&quot;);
 		return ERROR_OK;
@@ -848,7 +848,7 @@ COMMAND_HANDLER(pic32mx_handle_pgm_word_command)
 	uint32_t address, value;
 	int status, res;
 
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 	{
 		command_print(cmd_ctx, &quot;pic32mx pgm_word &lt;addr&gt; &lt;value&gt; &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/stellaris.c b/src/flash/stellaris.c
index bbe4aef..4f28c09 100644
--- a/src/flash/stellaris.c
+++ b/src/flash/stellaris.c
@@ -218,7 +218,7 @@ FLASH_BANK_COMMAND_HANDLER(stellaris_flash_bank_command)
 {
 	struct stellaris_flash_bank *stellaris_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank stellaris configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -1132,7 +1132,7 @@ COMMAND_HANDLER(stellaris_handle_mass_erase_command)
 {
 	int i;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;stellaris mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/stm32x.c b/src/flash/stm32x.c
index ab9831b..d32e9ea 100644
--- a/src/flash/stm32x.c
+++ b/src/flash/stm32x.c
@@ -38,7 +38,7 @@ FLASH_BANK_COMMAND_HANDLER(stm32x_flash_bank_command)
 {
 	struct stm32x_flash_bank *stm32x_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank stm32x configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -898,7 +898,7 @@ COMMAND_HANDLER(stm32x_handle_lock_command)
 	struct target *target = NULL;
 	struct stm32x_flash_bank *stm32x_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;stm32x lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -944,7 +944,7 @@ COMMAND_HANDLER(stm32x_handle_unlock_command)
 	struct target *target = NULL;
 	struct stm32x_flash_bank *stm32x_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;stm32x unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -988,7 +988,7 @@ COMMAND_HANDLER(stm32x_handle_options_read_command)
 	struct target *target = NULL;
 	struct stm32x_flash_bank *stm32x_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;stm32x options_read &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -1044,7 +1044,7 @@ COMMAND_HANDLER(stm32x_handle_options_write_command)
 	struct stm32x_flash_bank *stm32x_info = NULL;
 	uint16_t optionbyte = 0xF8;
 
-	if (argc &lt; 4)
+	if (CMD_ARGC &lt; 4)
 	{
 		command_print(cmd_ctx, &quot;stm32x options_write &lt;bank&gt; &lt;SWWDG | HWWDG&gt; &lt;RSTSTNDBY | NORSTSTNDBY&gt; &lt;RSTSTOP | NORSTSTOP&gt;&quot;);
 		return ERROR_OK;
@@ -1153,7 +1153,7 @@ COMMAND_HANDLER(stm32x_handle_mass_erase_command)
 {
 	int i;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;stm32x mass_erase &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/str7x.c b/src/flash/str7x.c
index d851051..134780b 100644
--- a/src/flash/str7x.c
+++ b/src/flash/str7x.c
@@ -114,7 +114,7 @@ FLASH_BANK_COMMAND_HANDLER(str7x_flash_bank_command)
 {
 	struct str7x_flash_bank *str7x_info;
 
-	if (argc &lt; 7)
+	if (CMD_ARGC &lt; 7)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank str7x configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -611,7 +611,7 @@ COMMAND_HANDLER(str7x_handle_disable_jtag_command)
 	uint16_t ProtectionLevel = 0;
 	uint16_t ProtectionRegs;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str7x disable_jtag &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/str9x.c b/src/flash/str9x.c
index 4c4d8ae..c103e57 100644
--- a/src/flash/str9x.c
+++ b/src/flash/str9x.c
@@ -121,7 +121,7 @@ FLASH_BANK_COMMAND_HANDLER(str9x_flash_bank_command)
 {
 	struct str9x_flash_bank *str9x_info;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank str9x configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -636,7 +636,7 @@ COMMAND_HANDLER(str9x_handle_flash_config_command)
 	struct str9x_flash_bank *str9x_info;
 	struct target *target = NULL;
 
-	if (argc &lt; 5)
+	if (CMD_ARGC &lt; 5)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
diff --git a/src/flash/str9xpec.c b/src/flash/str9xpec.c
index 7f6d8be..73027e4 100644
--- a/src/flash/str9xpec.c
+++ b/src/flash/str9xpec.c
@@ -242,7 +242,7 @@ FLASH_BANK_COMMAND_HANDLER(str9xpec_flash_bank_command)
 	struct arm7_9_common *arm7_9 = NULL;
 	struct arm_jtag *jtag_info = NULL;
 
-	if (argc &lt; 6)
+	if (CMD_ARGC &lt; 6)
 	{
 		LOG_WARNING(&quot;incomplete flash_bank str9x configuration&quot;);
 		return ERROR_FLASH_BANK_INVALID;
@@ -734,7 +734,7 @@ COMMAND_HANDLER(str9xpec_handle_part_id_command)
 	uint32_t idcode;
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	struct flash_bank *bank;
@@ -782,7 +782,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_read_command)
 	uint8_t status;
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_read &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -898,7 +898,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_write_command)
 {
 	uint8_t status;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_write &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -921,7 +921,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_cmap_command)
 {
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_cmap &lt;bank&gt; &lt;bank0 | bank1&gt;&quot;);
 		return ERROR_OK;
@@ -950,7 +950,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdthd_command)
 {
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_lvdthd &lt;bank&gt; &lt;2.4v | 2.7v&gt;&quot;);
 		return ERROR_OK;
@@ -979,7 +979,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdsel_command)
 {
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_lvdsel &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
 		return ERROR_OK;
@@ -1008,7 +1008,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_options_lvdwarn_command)
 {
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;str9xpec options_lvdwarn &lt;bank&gt; &lt;vdd | vdd_vddq&gt;&quot;);
 		return ERROR_OK;
@@ -1037,7 +1037,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_lock_command)
 {
 	uint8_t status;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec lock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -1060,7 +1060,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_unlock_command)
 {
 	uint8_t status;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec unlock &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -1086,7 +1086,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_enable_turbo_command)
 	struct jtag_tap *tap2;
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec enable_turbo &lt;bank&gt;&quot;);
 		return ERROR_OK;
@@ -1133,7 +1133,7 @@ COMMAND_HANDLER(str9xpec_handle_flash_disable_turbo_command)
 	struct jtag_tap *tap;
 	struct str9xpec_flash_controller *str9xpec_info = NULL;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;str9xpec disable_turbo &lt;bank&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/flash/tms470.c b/src/flash/tms470.c
index b71e9ed..d52dcc1 100644
--- a/src/flash/tms470.c
+++ b/src/flash/tms470.c
@@ -291,12 +291,12 @@ static uint32_t flashKeys[4];
 
 COMMAND_HANDLER(tms470_handle_flash_keyset_command)
 {
-	if (argc &gt; 4)
+	if (CMD_ARGC &gt; 4)
 	{
 		command_print(cmd_ctx, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
-	else if (argc == 4)
+	else if (CMD_ARGC == 4)
 	{
 		int i;
 
@@ -314,7 +314,7 @@ COMMAND_HANDLER(tms470_handle_flash_keyset_command)
 
 		keysSet = 1;
 	}
-	else if (argc != 0)
+	else if (CMD_ARGC != 0)
 	{
 		command_print(cmd_ctx, &quot;tms470 flash_keyset &lt;key0&gt; &lt;key1&gt; &lt;key2&gt; &lt;key3&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
@@ -355,12 +355,12 @@ static int oscMHz = 12;
 
 COMMAND_HANDLER(tms470_handle_osc_megahertz_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 	{
 		command_print(cmd_ctx, &quot;tms470 osc_megahertz &lt;MHz&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
-	else if (argc == 1)
+	else if (CMD_ARGC == 1)
 	{
 		sscanf(args[0], &quot;%d&quot;, &amp;oscMHz);
 	}
@@ -384,12 +384,12 @@ static int plldis = 0;
 
 COMMAND_HANDLER(tms470_handle_plldis_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 	{
 		command_print(cmd_ctx, &quot;tms470 plldis &lt;0 | 1&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
 	}
-	else if (argc == 1)
+	else if (CMD_ARGC == 1)
 	{
 		sscanf(args[0], &quot;%d&quot;, &amp;plldis);
 		plldis = plldis ? 1 : 0;
diff --git a/src/hello.c b/src/hello.c
index 275150a..b2d1d30 100644
--- a/src/hello.c
+++ b/src/hello.c
@@ -24,12 +24,12 @@
 
 static COMMAND_HELPER(handle_hello_args, const char **sep, const char **name)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 	{
 		LOG_ERROR(&quot;%s: too many arguments&quot;, CMD_NAME);
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	if (1 == argc)
+	if (1 == CMD_ARGC)
 	{
 		*sep = &quot; &quot;;
 		*name = args[0];
diff --git a/src/helper/command.c b/src/helper/command.c
index 7edd585..3abfdd6 100644
--- a/src/helper/command.c
+++ b/src/helper/command.c
@@ -723,14 +723,14 @@ static int jim_capture(Jim_Interp *interp, int argc, Jim_Obj *const *argv)
 COMMAND_HANDLER(handle_sleep_command)
 {
 	bool busy = false;
-	if (argc == 2)
+	if (CMD_ARGC == 2)
 	{
 		if (strcmp(args[1], &quot;busy&quot;) == 0)
 			busy = true;
 		else
 			return ERROR_COMMAND_SYNTAX_ERROR;
 	}
-	else if (argc &lt; 1 || argc &gt; 2)
+	else if (CMD_ARGC &lt; 1 || CMD_ARGC &gt; 2)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned long duration = 0;
@@ -755,7 +755,7 @@ COMMAND_HANDLER(handle_sleep_command)
 
 COMMAND_HANDLER(handle_fast_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	fast_and_dangerous = strcmp(&quot;enable&quot;, args[0]) == 0;
diff --git a/src/helper/ioutil.c b/src/helper/ioutil.c
index a9474a6..2e8229c 100644
--- a/src/helper/ioutil.c
+++ b/src/helper/ioutil.c
@@ -59,7 +59,7 @@
 
 COMMAND_HANDLER(handle_rm_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;rm &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
@@ -135,7 +135,7 @@ int loadFile(const char *fileName, void **data, size_t *len)
 
 COMMAND_HANDLER(handle_cat_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;cat &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
@@ -161,7 +161,7 @@ COMMAND_HANDLER(handle_cat_command)
 
 COMMAND_HANDLER(handle_trunc_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;trunc &lt;filename&gt;&quot;);
 		return ERROR_INVALID_ARGUMENTS;
@@ -180,7 +180,7 @@ COMMAND_HANDLER(handle_meminfo_command)
 	static int prev = 0;
 	struct mallinfo info;
 
-	if (argc != 0)
+	if (CMD_ARGC != 0)
 	{
 		command_print(cmd_ctx, &quot;meminfo&quot;);
 		return ERROR_INVALID_ARGUMENTS;
@@ -202,7 +202,7 @@ COMMAND_HANDLER(handle_meminfo_command)
 
 COMMAND_HANDLER(handle_append_command)
 {
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx,
 				&quot;append &lt;filename&gt; [&lt;string1&gt;, [&lt;string2&gt;, ...]]&quot;);
@@ -217,17 +217,17 @@ COMMAND_HANDLER(handle_append_command)
 		fseek(config_file, 0, SEEK_END);
 
 		unsigned i;
-		for (i = 1; i &lt; argc; i++)
+		for (i = 1; i &lt; CMD_ARGC; i++)
 		{
 			if (fwrite(args[i], 1, strlen(args[i]), config_file) != strlen(args[i]))
 				break;
-			if (i != argc - 1)
+			if (i != CMD_ARGC - 1)
 			{
 				if (fwrite(&quot; &quot;, 1, 1, config_file) != 1)
 					break;
 			}
 		}
-		if ((i == argc) &amp;&amp; (fwrite(&quot;\n&quot;, 1, 1, config_file) == 1))
+		if ((i == CMD_ARGC) &amp;&amp; (fwrite(&quot;\n&quot;, 1, 1, config_file) == 1))
 		{
 			retval = ERROR_OK;
 		}
@@ -241,7 +241,7 @@ COMMAND_HANDLER(handle_append_command)
 
 COMMAND_HANDLER(handle_cp_command)
 {
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 	{
 		return ERROR_INVALID_ARGUMENTS;
 	}
diff --git a/src/helper/log.c b/src/helper/log.c
index 9396ffe..715f2fa 100644
--- a/src/helper/log.c
+++ b/src/helper/log.c
@@ -275,13 +275,13 @@ void log_printf_lf(enum log_levels level, const char *file, unsigned line, const
  */
 COMMAND_HANDLER(handle_debug_level_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned new_level;
 		COMMAND_PARSE_NUMBER(uint, args[0], new_level);
 		debug_level = MIN(new_level, LOG_LVL_DEBUG);
 	}
-	else if (argc &gt; 1)
+	else if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	if (debug_level &gt;= LOG_LVL_DEBUG &amp;&amp; server_use_pipes == 1)
@@ -303,7 +303,7 @@ COMMAND_HANDLER(handle_debug_level_command)
 
 COMMAND_HANDLER(handle_log_output_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		FILE* file = fopen(args[0], &quot;w&quot;);
 
diff --git a/src/jtag/amt_jtagaccel.c b/src/jtag/amt_jtagaccel.c
index 3fb77f8..949acec 100644
--- a/src/jtag/amt_jtagaccel.c
+++ b/src/jtag/amt_jtagaccel.c
@@ -497,7 +497,7 @@ static int amt_jtagaccel_quit(void)
 
 COMMAND_HANDLER(amt_jtagaccel_handle_parport_port_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		/* only if the port wasn't overwritten by cmdline */
 		if (amt_jtagaccel_port == 0)
@@ -520,7 +520,7 @@ COMMAND_HANDLER(amt_jtagaccel_handle_parport_port_command)
 
 COMMAND_HANDLER(amt_jtagaccel_handle_rtck_command)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		command_print(cmd_ctx, &quot;amt_jtagaccel RTCK feature %s&quot;, (rtck_enabled) ? &quot;enabled&quot; : &quot;disabled&quot;);
 		return ERROR_OK;
diff --git a/src/jtag/at91rm9200.c b/src/jtag/at91rm9200.c
index dc9797e..90d94c9 100644
--- a/src/jtag/at91rm9200.c
+++ b/src/jtag/at91rm9200.c
@@ -187,7 +187,7 @@ static int at91rm9200_speed(int speed)
 
 static int at91rm9200_handle_device_command(struct command_context *cmd_ctx, char *cmd, char **args, int argc)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 		return ERROR_OK;
 
 	/* only if the device name wasn't overwritten by cmdline */
diff --git a/src/jtag/ft2232.c b/src/jtag/ft2232.c
index 7acdf1a..c1b3f10 100644
--- a/src/jtag/ft2232.c
+++ b/src/jtag/ft2232.c
@@ -2801,7 +2801,7 @@ COMMAND_HANDLER(ft2232_handle_device_desc_command)
 {
 	char *cp;
 	char buf[200];
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		ft2232_device_desc = strdup(args[0]);
 		cp = strchr(ft2232_device_desc, 0);
@@ -2833,7 +2833,7 @@ COMMAND_HANDLER(ft2232_handle_device_desc_command)
 
 COMMAND_HANDLER(ft2232_handle_serial_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		ft2232_serial = strdup(args[0]);
 	}
@@ -2847,7 +2847,7 @@ COMMAND_HANDLER(ft2232_handle_serial_command)
 
 COMMAND_HANDLER(ft2232_handle_layout_command)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 		return ERROR_OK;
 
 	ft2232_layout = malloc(strlen(args[0]) + 1);
@@ -2858,23 +2858,23 @@ COMMAND_HANDLER(ft2232_handle_layout_command)
 
 COMMAND_HANDLER(ft2232_handle_vid_pid_command)
 {
-	if (argc &gt; MAX_USB_IDS * 2)
+	if (CMD_ARGC &gt; MAX_USB_IDS * 2)
 	{
 		LOG_WARNING(&quot;ignoring extra IDs in ft2232_vid_pid &quot;
 					&quot;(maximum is %d pairs)&quot;, MAX_USB_IDS);
-		argc = MAX_USB_IDS * 2;
+		CMD_ARGC = MAX_USB_IDS * 2;
 	}
-	if (argc &lt; 2 || (argc &amp; 1))
+	if (CMD_ARGC &lt; 2 || (CMD_ARGC &amp; 1))
 	{
 		LOG_WARNING(&quot;incomplete ft2232_vid_pid configuration directive&quot;);
-		if (argc &lt; 2)
+		if (CMD_ARGC &lt; 2)
 			return ERROR_COMMAND_SYNTAX_ERROR;
 		/* remove the incomplete trailing id */
-		argc -= 1;
+		CMD_ARGC -= 1;
 	}
 
 	unsigned i;
-	for (i = 0; i &lt; argc; i += 2)
+	for (i = 0; i &lt; CMD_ARGC; i += 2)
 	{
 		COMMAND_PARSE_NUMBER(u16, args[i], ft2232_vid[i &gt;&gt; 1]);
 		COMMAND_PARSE_NUMBER(u16, args[i + 1], ft2232_pid[i &gt;&gt; 1]);
@@ -2891,7 +2891,7 @@ COMMAND_HANDLER(ft2232_handle_vid_pid_command)
 
 COMMAND_HANDLER(ft2232_handle_latency_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		ft2232_latency = atoi(args[0]);
 	}
diff --git a/src/jtag/gw16012.c b/src/jtag/gw16012.c
index e24c23a..d1da2a1 100644
--- a/src/jtag/gw16012.c
+++ b/src/jtag/gw16012.c
@@ -543,7 +543,7 @@ static int gw16012_quit(void)
 
 COMMAND_HANDLER(gw16012_handle_parport_port_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		/* only if the port wasn't overwritten by cmdline */
 		if (gw16012_port == 0)
diff --git a/src/jtag/jlink.c b/src/jtag/jlink.c
index 23ebc62..41b99a1 100644
--- a/src/jtag/jlink.c
+++ b/src/jtag/jlink.c
@@ -627,7 +627,7 @@ COMMAND_HANDLER(jlink_handle_jlink_info_command)
 
 COMMAND_HANDLER(jlink_handle_jlink_hw_jtag_command)
 {
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		command_print(cmd_ctx, &quot;jlink hw jtag  %i&quot;, jlink_hw_jtag_version);
 		break;
diff --git a/src/jtag/parport.c b/src/jtag/parport.c
index 399c00a..52289c5 100644
--- a/src/jtag/parport.c
+++ b/src/jtag/parport.c
@@ -411,7 +411,7 @@ static int parport_quit(void)
 
 COMMAND_HANDLER(parport_handle_parport_port_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		/* only if the port wasn't overwritten by cmdline */
 		if (parport_port == 0)
@@ -432,7 +432,7 @@ COMMAND_HANDLER(parport_handle_parport_port_command)
 
 COMMAND_HANDLER(parport_handle_parport_cable_command)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 		return ERROR_OK;
 
 	/* only if the cable name wasn't overwritten by cmdline */
@@ -447,7 +447,7 @@ COMMAND_HANDLER(parport_handle_parport_cable_command)
 
 COMMAND_HANDLER(parport_handle_write_on_exit_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;usage: parport_write_on_exit &lt;on | off&gt;&quot;);
 		return ERROR_OK;
@@ -463,7 +463,7 @@ COMMAND_HANDLER(parport_handle_write_on_exit_command)
 
 COMMAND_HANDLER(parport_handle_parport_toggling_time_command)
 {
-	if (argc == 1) {
+	if (CMD_ARGC == 1) {
 		uint32_t ns;
 		int retval = parse_u32(args[0], &amp;ns);
 
diff --git a/src/jtag/presto.c b/src/jtag/presto.c
index b4ba3f4..45d99ff 100644
--- a/src/jtag/presto.c
+++ b/src/jtag/presto.c
@@ -752,7 +752,7 @@ static char *presto_serial;
 
 COMMAND_HANDLER(presto_handle_serial_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (presto_serial)
 			free(presto_serial);
diff --git a/src/jtag/tcl.c b/src/jtag/tcl.c
index 71e7bd5..bd3f704 100644
--- a/src/jtag/tcl.c
+++ b/src/jtag/tcl.c
@@ -605,7 +605,7 @@ static int default_srst_asserted(int *srst_asserted)
 
 COMMAND_HANDLER(handle_interface_list_command)
 {
-	if (strcmp(CMD_NAME, &quot;interface_list&quot;) == 0 &amp;&amp; argc &gt; 0)
+	if (strcmp(CMD_NAME, &quot;interface_list&quot;) == 0 &amp;&amp; CMD_ARGC &gt; 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	command_print(cmd_ctx, &quot;The following JTAG interfaces are available:&quot;);
@@ -628,7 +628,7 @@ COMMAND_HANDLER(handle_interface_command)
 	}
 
 	/* interface name is a mandatory argument */
-	if (argc != 1 || args[0][0] == '\0')
+	if (CMD_ARGC != 1 || args[0][0] == '\0')
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	for (unsigned i = 0; NULL != jtag_interfaces[i]; i++)
@@ -711,7 +711,7 @@ COMMAND_HANDLER(handle_reset_config_command)
 	 * Here we don't care about the order, and only change values
 	 * which have been explicitly specified.
 	 */
-	for (; argc; argc--, args++) {
+	for (; CMD_ARGC; CMD_ARGC--, args++) {
 		int tmp = 0;
 		int m;
 
@@ -897,9 +897,9 @@ next:
 
 COMMAND_HANDLER(handle_jtag_nsrst_delay_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
 		COMMAND_PARSE_NUMBER(uint, args[0], delay);
@@ -912,9 +912,9 @@ COMMAND_HANDLER(handle_jtag_nsrst_delay_command)
 
 COMMAND_HANDLER(handle_jtag_ntrst_delay_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
 		COMMAND_PARSE_NUMBER(uint, args[0], delay);
@@ -927,9 +927,9 @@ COMMAND_HANDLER(handle_jtag_ntrst_delay_command)
 
 COMMAND_HANDLER(handle_jtag_nsrst_assert_width_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
 		COMMAND_PARSE_NUMBER(uint, args[0], delay);
@@ -942,9 +942,9 @@ COMMAND_HANDLER(handle_jtag_nsrst_assert_width_command)
 
 COMMAND_HANDLER(handle_jtag_ntrst_assert_width_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned delay;
 		COMMAND_PARSE_NUMBER(uint, args[0], delay);
@@ -957,11 +957,11 @@ COMMAND_HANDLER(handle_jtag_ntrst_assert_width_command)
 
 COMMAND_HANDLER(handle_jtag_khz_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int retval = ERROR_OK;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned khz = 0;
 		COMMAND_PARSE_NUMBER(uint, args[0], khz);
@@ -986,11 +986,11 @@ COMMAND_HANDLER(handle_jtag_khz_command)
 
 COMMAND_HANDLER(handle_jtag_rclk_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int retval = ERROR_OK;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned khz = 0;
 		COMMAND_PARSE_NUMBER(uint, args[0], khz);
@@ -1015,7 +1015,7 @@ COMMAND_HANDLER(handle_jtag_rclk_command)
 
 COMMAND_HANDLER(handle_jtag_reset_command)
 {
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int trst = -1;
@@ -1043,7 +1043,7 @@ COMMAND_HANDLER(handle_jtag_reset_command)
 
 COMMAND_HANDLER(handle_runtest_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned num_clocks;
@@ -1082,7 +1082,7 @@ COMMAND_HANDLER(handle_irscan_command)
 	struct jtag_tap *tap;
 	tap_state_t endstate;
 
-	if ((argc &lt; 2) || (argc % 2))
+	if ((CMD_ARGC &lt; 2) || (CMD_ARGC % 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -1093,21 +1093,21 @@ COMMAND_HANDLER(handle_irscan_command)
 	 */
 	endstate = TAP_IDLE;
 
-	if (argc &gt;= 4) {
+	if (CMD_ARGC &gt;= 4) {
 		/* have at least one pair of numbers. */
 		/* is last pair the magic text? */
-		if (strcmp(&quot;-endstate&quot;, args[argc - 2]) == 0) {
-			endstate = tap_state_by_name(args[argc - 1]);
+		if (strcmp(&quot;-endstate&quot;, args[CMD_ARGC - 2]) == 0) {
+			endstate = tap_state_by_name(args[CMD_ARGC - 1]);
 			if (endstate == TAP_INVALID)
 				return ERROR_COMMAND_SYNTAX_ERROR;
 			if (!scan_is_safe(endstate))
 				LOG_WARNING(&quot;unstable irscan endstate \&quot;%s\&quot;&quot;,
-						args[argc - 1]);
-			argc -= 2;
+						args[CMD_ARGC - 1]);
+			CMD_ARGC -= 2;
 		}
 	}
 
-	int num_fields = argc / 2;
+	int num_fields = CMD_ARGC / 2;
 	size_t fields_len = sizeof(struct scan_field) * num_fields;
 	fields = malloc(fields_len);
 	memset(fields, 0, fields_len);
@@ -1352,10 +1352,10 @@ static int Jim_Command_flush_count(Jim_Interp *interp, int argc, Jim_Obj *const
 
 COMMAND_HANDLER(handle_verify_ircapture_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;enable&quot;) == 0)
 			jtag_set_verify_capture_ir(true);
@@ -1373,10 +1373,10 @@ COMMAND_HANDLER(handle_verify_ircapture_command)
 
 COMMAND_HANDLER(handle_verify_jtag_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;enable&quot;) == 0)
 			jtag_set_verify(true);
@@ -1394,10 +1394,10 @@ COMMAND_HANDLER(handle_verify_jtag_command)
 
 COMMAND_HANDLER(handle_tms_sequence_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		bool use_new_table;
 		if (strcmp(args[0], &quot;short&quot;) == 0)
diff --git a/src/jtag/vsllink.c b/src/jtag/vsllink.c
index 0684dd3..cbea995 100644
--- a/src/jtag/vsllink.c
+++ b/src/jtag/vsllink.c
@@ -1324,7 +1324,7 @@ static void vsllink_simple_command(uint8_t command)
 
 COMMAND_HANDLER(vsllink_handle_mode_command)
 {
-	if (argc != 1) {
+	if (CMD_ARGC != 1) {
 		LOG_ERROR(&quot;parameter error, should be one parameter for VID&quot;);
 		return ERROR_FAIL;
 	}
@@ -1348,7 +1348,7 @@ COMMAND_HANDLER(vsllink_handle_mode_command)
 
 COMMAND_HANDLER(vsllink_handle_usb_vid_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		LOG_ERROR(&quot;parameter error, should be one parameter for VID&quot;);
 		return ERROR_OK;
@@ -1360,7 +1360,7 @@ COMMAND_HANDLER(vsllink_handle_usb_vid_command)
 
 COMMAND_HANDLER(vsllink_handle_usb_pid_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		LOG_ERROR(&quot;parameter error, should be one parameter for PID&quot;);
 		return ERROR_OK;
@@ -1371,7 +1371,7 @@ COMMAND_HANDLER(vsllink_handle_usb_pid_command)
 
 COMMAND_HANDLER(vsllink_handle_usb_bulkin_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		LOG_ERROR(&quot;parameter error, should be one parameter for BULKIN endpoint&quot;);
 		return ERROR_OK;
@@ -1386,7 +1386,7 @@ COMMAND_HANDLER(vsllink_handle_usb_bulkin_command)
 
 COMMAND_HANDLER(vsllink_handle_usb_bulkout_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		LOG_ERROR(&quot;parameter error, should be one parameter for BULKOUT endpoint&quot;);
 		return ERROR_OK;
@@ -1401,7 +1401,7 @@ COMMAND_HANDLER(vsllink_handle_usb_bulkout_command)
 
 COMMAND_HANDLER(vsllink_handle_usb_interface_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		LOG_ERROR(&quot;parameter error, should be one parameter for interface number&quot;);
 		return ERROR_OK;
diff --git a/src/openocd.c b/src/openocd.c
index 4c07511..1a43b3c 100644
--- a/src/openocd.c
+++ b/src/openocd.c
@@ -52,7 +52,7 @@
 /* Give TELNET a way to find out what version this is */
 COMMAND_HANDLER(handle_version_command)
 {
-	if (argc != 0)
+	if (CMD_ARGC != 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	command_print(cmd_ctx, OPENOCD_VERSION);
@@ -95,7 +95,7 @@ int ioutil_init(struct command_context *cmd_ctx);
 COMMAND_HANDLER(handle_init_command)
 {
 
-	if (argc != 0)
+	if (CMD_ARGC != 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	int retval;
diff --git a/src/pld/pld.c b/src/pld/pld.c
index fdb276f..178da97 100644
--- a/src/pld/pld.c
+++ b/src/pld/pld.c
@@ -62,7 +62,7 @@ COMMAND_HANDLER(handle_pld_device_command)
 	int i;
 	int found = 0;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		LOG_WARNING(&quot;incomplete 'pld device' command&quot;);
 		return ERROR_OK;
@@ -147,7 +147,7 @@ COMMAND_HANDLER(handle_pld_load_command)
 
 	gettimeofday(&amp;start, NULL);
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;usage: pld load &lt;device#&gt; &lt;file&gt;&quot;);
 		return ERROR_OK;
diff --git a/src/pld/virtex2.c b/src/pld/virtex2.c
index c07931e..a6587dd 100644
--- a/src/pld/virtex2.c
+++ b/src/pld/virtex2.c
@@ -183,7 +183,7 @@ COMMAND_HANDLER(virtex2_handle_read_stat_command)
 	struct virtex2_pld_device *virtex2_info;
 	uint32_t status;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;usage: virtex2 read_stat &lt;num&gt;&quot;);
 		return ERROR_OK;
@@ -213,7 +213,7 @@ PLD_DEVICE_COMMAND_HANDLER(virtex2_pld_device_command)
 
 	struct virtex2_pld_device *virtex2_info;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		LOG_WARNING(&quot;incomplete pld device 'virtex2' configuration&quot;);
 		return ERROR_PLD_DEVICE_INVALID;
diff --git a/src/server/gdb_server.c b/src/server/gdb_server.c
index 55ec7d4..fe82921 100644
--- a/src/server/gdb_server.c
+++ b/src/server/gdb_server.c
@@ -2252,7 +2252,7 @@ int gdb_init(void)
 
 COMMAND_HANDLER(handle_gdb_sync_command)
 {
-	if (argc != 0)
+	if (CMD_ARGC != 0)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -2277,7 +2277,7 @@ COMMAND_HANDLER(handle_gdb_port_command)
 
 COMMAND_HANDLER(handle_gdb_memory_map_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;enable&quot;) == 0)
 		{
@@ -2298,7 +2298,7 @@ COMMAND_HANDLER(handle_gdb_memory_map_command)
 
 COMMAND_HANDLER(handle_gdb_flash_program_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;enable&quot;) == 0)
 		{
@@ -2319,7 +2319,7 @@ COMMAND_HANDLER(handle_gdb_flash_program_command)
 
 COMMAND_HANDLER(handle_gdb_report_data_abort_command)
 {
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;enable&quot;) == 0)
 		{
@@ -2341,10 +2341,10 @@ COMMAND_HANDLER(handle_gdb_report_data_abort_command)
 /* gdb_breakpoint_override */
 COMMAND_HANDLER(handle_gdb_breakpoint_override_command)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 
-	} else if (argc == 1)
+	} else if (CMD_ARGC == 1)
 	{
 		gdb_breakpoint_override = 1;
 		if (strcmp(args[0], &quot;hard&quot;) == 0)
diff --git a/src/server/server.c b/src/server/server.c
index 92292eb..17a116d 100644
--- a/src/server/server.c
+++ b/src/server/server.c
@@ -551,7 +551,7 @@ int server_register_commands(struct command_context *context)
 
 SERVER_PORT_COMMAND()
 {
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		command_print(cmd_ctx, &quot;%d&quot;, *out);
 		break;
diff --git a/src/svf/svf.c b/src/svf/svf.c
index fb5e1b0..c51e609 100644
--- a/src/svf/svf.c
+++ b/src/svf/svf.c
@@ -308,7 +308,7 @@ COMMAND_HANDLER(handle_svf_command)
 	int ret = ERROR_OK;
 	long long time_ago;
 
-	if ((argc &lt; 1) || (argc &gt; (1 + SVF_NUM_OF_OPTIONS)))
+	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; (1 + SVF_NUM_OF_OPTIONS)))
 	{
 		command_print(cmd_ctx, &quot;usage: svf &lt;file&gt; [quiet]&quot;);
 		return ERROR_FAIL;
@@ -316,7 +316,7 @@ COMMAND_HANDLER(handle_svf_command)
 
 	// parse variant
 	svf_quiet = 0;
-	for (unsigned i = 1; i &lt; argc; i++)
+	for (unsigned i = 1; i &lt; CMD_ARGC; i++)
 	{
 		if (!strcmp(args[i], &quot;quiet&quot;))
 		{
diff --git a/src/target/arm11.c b/src/target/arm11.c
index 750c1f5..22c586f 100644
--- a/src/target/arm11.c
+++ b/src/target/arm11.c
@@ -2006,13 +2006,13 @@ static int arm11_build_reg_cache(struct target *target)
 
 static COMMAND_HELPER(arm11_handle_bool, bool *var, char *name)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		LOG_INFO(&quot;%s is %s.&quot;, name, *var ? &quot;enabled&quot; : &quot;disabled&quot;);
 		return ERROR_OK;
 	}
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	switch (args[0][0])
@@ -2053,7 +2053,7 @@ BOOL_WRAPPER(hardware_step,			&quot;hardware single step&quot;)
 
 COMMAND_HANDLER(arm11_handle_vcr)
 {
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		break;
 	case 1:
diff --git a/src/target/arm720t.c b/src/target/arm720t.c
index 5d83517..df173fc 100644
--- a/src/target/arm720t.c
+++ b/src/target/arm720t.c
@@ -430,12 +430,12 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 	}
 
 	/* one or more argument, access a single register (write if second argument is given */
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		uint32_t opcode;
 		COMMAND_PARSE_NUMBER(u32, args[0], opcode);
 
-		if (argc == 1)
+		if (CMD_ARGC == 1)
 		{
 			uint32_t value;
 			if ((retval = arm720t_read_cp15(target, opcode, &amp;value)) != ERROR_OK)
@@ -451,7 +451,7 @@ COMMAND_HANDLER(arm720t_handle_cp15_command)
 
 			command_print(cmd_ctx, &quot;0x%8.8&quot; PRIx32 &quot;: 0x%8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
-		else if (argc == 2)
+		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
 			COMMAND_PARSE_NUMBER(u32, args[1], value);
diff --git a/src/target/arm7_9_common.c b/src/target/arm7_9_common.c
index 27a9b8d..9ff5561 100644
--- a/src/target/arm7_9_common.c
+++ b/src/target/arm7_9_common.c
@@ -2766,7 +2766,7 @@ COMMAND_HANDLER(handle_arm7_9_write_xpsr_command)
 		return ERROR_FAIL;
 	}
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;usage: write_xpsr &lt;value&gt; &lt;not cpsr | spsr&gt;&quot;);
 		return ERROR_FAIL;
@@ -2810,7 +2810,7 @@ COMMAND_HANDLER(handle_arm7_9_write_xpsr_im8_command)
 		return ERROR_FAIL;
 	}
 
-	if (argc &lt; 3)
+	if (CMD_ARGC &lt; 3)
 	{
 		command_print(cmd_ctx, &quot;usage: write_xpsr_im8 &lt;im8&gt; &lt;rotate&gt; &lt;not cpsr | spsr&gt;&quot;);
 		return ERROR_FAIL;
@@ -2850,7 +2850,7 @@ COMMAND_HANDLER(handle_arm7_9_write_core_reg_command)
 		return ERROR_FAIL;
 	}
 
-	if (argc &lt; 3)
+	if (CMD_ARGC &lt; 3)
 	{
 		command_print(cmd_ctx, &quot;usage: write_core_reg &lt;num&gt; &lt;mode&gt; &lt;value&gt;&quot;);
 		return ERROR_FAIL;
@@ -2874,7 +2874,7 @@ COMMAND_HANDLER(handle_arm7_9_dbgrq_command)
 		return ERROR_TARGET_INVALID;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (strcmp(&quot;enable&quot;, args[0]) == 0)
 		{
@@ -2906,7 +2906,7 @@ COMMAND_HANDLER(handle_arm7_9_fast_memory_access_command)
 		return ERROR_TARGET_INVALID;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (strcmp(&quot;enable&quot;, args[0]) == 0)
 		{
@@ -2938,7 +2938,7 @@ COMMAND_HANDLER(handle_arm7_9_dcc_downloads_command)
 		return ERROR_TARGET_INVALID;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (strcmp(&quot;enable&quot;, args[0]) == 0)
 		{
diff --git a/src/target/arm920t.c b/src/target/arm920t.c
index fca3743..d423b9c 100644
--- a/src/target/arm920t.c
+++ b/src/target/arm920t.c
@@ -684,7 +684,7 @@ COMMAND_HANDLER(arm920t_handle_read_cache_command)
 	if (retval != ERROR_OK)
 		return retval;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;usage: arm920t read_cache &lt;filename&gt;&quot;);
 		return ERROR_OK;
@@ -930,7 +930,7 @@ COMMAND_HANDLER(arm920t_handle_read_mmu_command)
 	if (retval != ERROR_OK)
 		return retval;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;usage: arm920t read_mmu &lt;filename&gt;&quot;);
 		return ERROR_OK;
@@ -1209,12 +1209,12 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 	}
 
 	/* one or more argument, access a single register (write if second argument is given */
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		int address;
 		COMMAND_PARSE_NUMBER(int, args[0], address);
 
-		if (argc == 1)
+		if (CMD_ARGC == 1)
 		{
 			uint32_t value;
 			if ((retval = arm920t_read_cp15_physical(target, address, &amp;value)) != ERROR_OK)
@@ -1229,7 +1229,7 @@ COMMAND_HANDLER(arm920t_handle_cp15_command)
 
 			command_print(cmd_ctx, &quot;%i: %8.8&quot; PRIx32 &quot;&quot;, address, value);
 		}
-		else if (argc == 2)
+		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
 			COMMAND_PARSE_NUMBER(u32, args[1], value);
@@ -1263,12 +1263,12 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 	}
 
 	/* one or more argument, access a single register (write if second argument is given */
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		uint32_t opcode;
 		COMMAND_PARSE_NUMBER(u32, args[0], opcode);
 
-		if (argc == 1)
+		if (CMD_ARGC == 1)
 		{
 			uint32_t value;
 			if ((retval = arm920t_read_cp15_interpreted(target, opcode, 0x0, &amp;value)) != ERROR_OK)
@@ -1279,7 +1279,7 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 
 			command_print(cmd_ctx, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
-		else if (argc == 2)
+		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
 			COMMAND_PARSE_NUMBER(u32, args[1], value);
@@ -1290,7 +1290,7 @@ COMMAND_HANDLER(arm920t_handle_cp15i_command)
 			}
 			command_print(cmd_ctx, &quot;%8.8&quot; PRIx32 &quot;: %8.8&quot; PRIx32 &quot;&quot;, opcode, value);
 		}
-		else if (argc == 3)
+		else if (CMD_ARGC == 3)
 		{
 			uint32_t value;
 			COMMAND_PARSE_NUMBER(u32, args[1], value);
diff --git a/src/target/arm926ejs.c b/src/target/arm926ejs.c
index f305390..02198d9 100644
--- a/src/target/arm926ejs.c
+++ b/src/target/arm926ejs.c
@@ -724,7 +724,7 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 	int CRn;
 	int CRm;
 
-	if ((argc &lt; 4) || (argc &gt; 5))
+	if ((CMD_ARGC &lt; 4) || (CMD_ARGC &gt; 5))
 	{
 		command_print(cmd_ctx, &quot;usage: arm926ejs cp15 &lt;opcode_1&gt; &lt;opcode_2&gt; &lt;CRn&gt; &lt;CRm&gt; [value]&quot;);
 		return ERROR_OK;
@@ -745,7 +745,7 @@ COMMAND_HANDLER(arm926ejs_handle_cp15_command)
 		return ERROR_OK;
 	}
 
-	if (argc == 4)
+	if (CMD_ARGC == 4)
 	{
 		uint32_t value;
 		if ((retval = arm926ejs-&gt;read_cp15(target, opcode_1, opcode_2, CRn, CRm, &amp;value)) != ERROR_OK)
diff --git a/src/target/arm966e.c b/src/target/arm966e.c
index 3b85a5c..a1debb8 100644
--- a/src/target/arm966e.c
+++ b/src/target/arm966e.c
@@ -179,12 +179,12 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 	}
 
 	/* one or more argument, access a single register (write if second argument is given */
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		uint32_t address;
 		COMMAND_PARSE_NUMBER(u32, args[0], address);
 
-		if (argc == 1)
+		if (CMD_ARGC == 1)
 		{
 			uint32_t value;
 			if ((retval = arm966e_read_cp15(target, address, &amp;value)) != ERROR_OK)
@@ -202,7 +202,7 @@ COMMAND_HANDLER(arm966e_handle_cp15_command)
 			command_print(cmd_ctx, &quot;%&quot; PRIi32 &quot;: %8.8&quot; PRIx32,
 					address, value);
 		}
-		else if (argc == 2)
+		else if (CMD_ARGC == 2)
 		{
 			uint32_t value;
 			COMMAND_PARSE_NUMBER(u32, args[1], value);
diff --git a/src/target/arm9tdmi.c b/src/target/arm9tdmi.c
index 8e8f4d6..6d9903a 100644
--- a/src/target/arm9tdmi.c
+++ b/src/target/arm9tdmi.c
@@ -844,7 +844,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 	/* get the current setting */
 	vector_catch_value = buf_get_u32(vector_catch-&gt;value, 0, 8);
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		vector_catch_value = 0x0;
 		if (strcmp(args[0], &quot;all&quot;) == 0)
@@ -857,7 +857,7 @@ COMMAND_HANDLER(handle_arm9tdmi_catch_vectors_command)
 		}
 		else
 		{
-			for (unsigned i = 0; i &lt; argc; i++)
+			for (unsigned i = 0; i &lt; CMD_ARGC; i++)
 			{
 				/* go through list of vectors */
 				unsigned j;
diff --git a/src/target/arm_adi_v5.c b/src/target/arm_adi_v5.c
index 958844b..dcae818 100644
--- a/src/target/arm_adi_v5.c
+++ b/src/target/arm_adi_v5.c
@@ -1370,7 +1370,7 @@ DAP_COMMAND_HANDLER(dap_baseaddr_command)
 	int retval;
 
 	apselsave = swjdp-&gt;apsel;
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = swjdp-&gt;apsel;
 		break;
@@ -1398,7 +1398,7 @@ DAP_COMMAND_HANDLER(dap_memaccess_command)
 {
 	uint32_t memaccess_tck;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		memaccess_tck = swjdp-&gt;memaccess_tck;
 		break;
@@ -1421,7 +1421,7 @@ DAP_COMMAND_HANDLER(dap_apsel_command)
 	uint32_t apsel, apid;
 	int retval;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = 0;
 		break;
@@ -1447,7 +1447,7 @@ DAP_COMMAND_HANDLER(dap_apid_command)
 	int retval;
 
 	apselsave = swjdp-&gt;apsel;
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = swjdp-&gt;apsel;
 		break;
diff --git a/src/target/armv4_5.c b/src/target/armv4_5.c
index 0d890b8..4d58f0f 100644
--- a/src/target/armv4_5.c
+++ b/src/target/armv4_5.c
@@ -368,7 +368,7 @@ COMMAND_HANDLER(handle_armv4_5_core_state_command)
 		return ERROR_OK;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (strcmp(args[0], &quot;arm&quot;) == 0)
 		{
@@ -404,7 +404,7 @@ COMMAND_HANDLER(handle_armv4_5_disassemble_command)
 		return ERROR_OK;
 	}
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 3:
 		if (strcmp(args[2], &quot;thumb&quot;) != 0)
 			goto usage;
diff --git a/src/target/armv7a.c b/src/target/armv7a.c
index 7f2c387..8d1fe21 100644
--- a/src/target/armv7a.c
+++ b/src/target/armv7a.c
@@ -260,7 +260,7 @@ COMMAND_HANDLER(handle_dap_info_command)
 	struct swjdp_common *swjdp = &amp;armv7a-&gt;swjdp_info;
 	uint32_t apsel;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = swjdp-&gt;apsel;
 		break;
@@ -292,7 +292,7 @@ COMMAND_HANDLER(handle_armv7a_disassemble_command)
 	 * some opcodes work differently.
 	 */
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 3:
 		if (strcmp(args[2], &quot;thumb&quot;) != 0)
 			goto usage;
diff --git a/src/target/armv7m.c b/src/target/armv7m.c
index 132b786..23b0830 100644
--- a/src/target/armv7m.c
+++ b/src/target/armv7m.c
@@ -772,7 +772,7 @@ COMMAND_HANDLER(handle_dap_baseaddr_command)
 	int retval;
 
 	apselsave = swjdp-&gt;apsel;
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = swjdp-&gt;apsel;
 		break;
@@ -835,7 +835,7 @@ COMMAND_HANDLER(handle_dap_info_command)
 	struct swjdp_common *swjdp = &amp;armv7m-&gt;swjdp_info;
 	uint32_t apsel;
 
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 0:
 		apsel = swjdp-&gt;apsel;
 		break;
diff --git a/src/target/cortex_m3.c b/src/target/cortex_m3.c
index e99e99c..d7d5be0 100644
--- a/src/target/cortex_m3.c
+++ b/src/target/cortex_m3.c
@@ -1795,7 +1795,7 @@ COMMAND_HANDLER(handle_cortex_m3_disassemble_command)
 		return retval;
 
 	errno = 0;
-	switch (argc) {
+	switch (CMD_ARGC) {
 	case 2:
 		COMMAND_PARSE_NUMBER(ulong, args[1], count);
 		/* FALL THROUGH */
@@ -1847,10 +1847,10 @@ COMMAND_HANDLER(handle_cortex_m3_vector_catch_command)
 
 	mem_ap_read_atomic_u32(swjdp, DCB_DEMCR, &amp;demcr);
 
-	if (argc &gt; 0) {
+	if (CMD_ARGC &gt; 0) {
 		unsigned catch = 0;
 
-		if (argc == 1) {
+		if (CMD_ARGC == 1) {
 			if (strcmp(args[0], &quot;all&quot;) == 0) {
 				catch = VC_HARDERR | VC_INTERR | VC_BUSERR
 					| VC_STATERR | VC_CHKERR | VC_NOCPERR
@@ -1860,16 +1860,16 @@ COMMAND_HANDLER(handle_cortex_m3_vector_catch_command)
 				goto write;
 			}
 		}
-		while (argc-- &gt; 0) {
+		while (CMD_ARGC-- &gt; 0) {
 			unsigned i;
 			for (i = 0; i &lt; ARRAY_SIZE(vec_ids); i++) {
-				if (strcmp(args[argc], vec_ids[i].name) != 0)
+				if (strcmp(args[CMD_ARGC], vec_ids[i].name) != 0)
 					continue;
 				catch |= vec_ids[i].mask;
 				break;
 			}
 			if (i == ARRAY_SIZE(vec_ids)) {
-				LOG_ERROR(&quot;No CM3 vector '%s'&quot;, args[argc]);
+				LOG_ERROR(&quot;No CM3 vector '%s'&quot;, args[CMD_ARGC]);
 				return ERROR_INVALID_ARGUMENTS;
 			}
 		}
@@ -1905,7 +1905,7 @@ COMMAND_HANDLER(handle_cortex_m3_mask_interrupts_command)
 		return ERROR_OK;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (!strcmp(args[0], &quot;on&quot;))
 		{
diff --git a/src/target/etb.c b/src/target/etb.c
index 196df6c..e902b01 100644
--- a/src/target/etb.c
+++ b/src/target/etb.c
@@ -355,7 +355,7 @@ COMMAND_HANDLER(handle_etb_config_command)
 	struct jtag_tap *tap;
 	struct arm *arm;
 
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
diff --git a/src/target/etm.c b/src/target/etm.c
index fa7a71b..b33d817 100644
--- a/src/target/etm.c
+++ b/src/target/etm.c
@@ -1266,7 +1266,7 @@ COMMAND_HANDLER(handle_etm_tracemode_command)
 
 	etmv1_tracemode_t tracemode = etm-&gt;tracemode;
 
-	switch (argc)
+	switch (CMD_ARGC)
 	{
 	case 0:
 		break;
@@ -1377,7 +1377,7 @@ COMMAND_HANDLER(handle_etm_config_command)
 	struct etm_context *etm_ctx;
 	int i;
 
-	if (argc != 5)
+	if (CMD_ARGC != 5)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	target = get_target(args[0]);
@@ -1733,7 +1733,7 @@ COMMAND_HANDLER(handle_etm_image_command)
 	struct arm *arm;
 	struct etm_context *etm_ctx;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;usage: etm image &lt;file&gt; [base address] [type]&quot;);
 		return ERROR_FAIL;
@@ -1766,7 +1766,7 @@ COMMAND_HANDLER(handle_etm_image_command)
 	etm_ctx-&gt;image-&gt;start_address_set = 0;
 
 	/* a base address isn't always necessary, default to 0x0 (i.e. don't relocate) */
-	if (argc &gt;= 2)
+	if (CMD_ARGC &gt;= 2)
 	{
 		etm_ctx-&gt;image-&gt;base_address_set = 1;
 		COMMAND_PARSE_NUMBER(int, args[1], etm_ctx-&gt;image-&gt;base_address);
@@ -1776,7 +1776,7 @@ COMMAND_HANDLER(handle_etm_image_command)
 		etm_ctx-&gt;image-&gt;base_address_set = 0;
 	}
 
-	if (image_open(etm_ctx-&gt;image, args[0], (argc &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(etm_ctx-&gt;image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
 	{
 		free(etm_ctx-&gt;image);
 		etm_ctx-&gt;image = NULL;
@@ -1794,7 +1794,7 @@ COMMAND_HANDLER(handle_etm_dump_command)
 	struct etm_context *etm_ctx;
 	uint32_t i;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;usage: etm dump &lt;file&gt;&quot;);
 		return ERROR_FAIL;
@@ -1862,7 +1862,7 @@ COMMAND_HANDLER(handle_etm_load_command)
 	struct etm_context *etm_ctx;
 	uint32_t i;
 
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 	{
 		command_print(cmd_ctx, &quot;usage: etm load &lt;file&gt;&quot;);
 		return ERROR_FAIL;
@@ -1959,7 +1959,7 @@ COMMAND_HANDLER(handle_etm_trigger_percent_command)
 		return ERROR_FAIL;
 	}
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		uint32_t new_value;
 		COMMAND_PARSE_NUMBER(u32, args[0], new_value);
diff --git a/src/target/oocd_trace.c b/src/target/oocd_trace.c
index cad4977..47c2bb4 100644
--- a/src/target/oocd_trace.c
+++ b/src/target/oocd_trace.c
@@ -294,7 +294,7 @@ COMMAND_HANDLER(handle_oocd_trace_config_command)
 	struct target *target;
 	struct arm *arm;
 
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 	{
 		LOG_ERROR(&quot;incomplete 'oocd_trace config &lt;target&gt; &lt;tty&gt;' command&quot;);
 		return ERROR_FAIL;
diff --git a/src/target/target.c b/src/target/target.c
index c00c2ed..5f5d3fb 100644
--- a/src/target/target.c
+++ b/src/target/target.c
@@ -1648,7 +1648,7 @@ COMMAND_HANDLER(handle_targets_command)
 {
 	struct target *target = all_targets;
 
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		target = get_target(args[0]);
 		if (target == NULL) {
@@ -1868,7 +1868,7 @@ COMMAND_HANDLER(handle_reg_command)
 	target = get_current_target(cmd_ctx);
 
 	/* list all available registers for the current target */
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		struct reg_cache *cache = target-&gt;reg_cache;
 
@@ -1948,9 +1948,9 @@ COMMAND_HANDLER(handle_reg_command)
 	}
 
 	/* display a register */
-	if ((argc == 1) || ((argc == 2) &amp;&amp; !((args[1][0] &gt;= '0') &amp;&amp; (args[1][0] &lt;= '9'))))
+	if ((CMD_ARGC == 1) || ((CMD_ARGC == 2) &amp;&amp; !((args[1][0] &gt;= '0') &amp;&amp; (args[1][0] &lt;= '9'))))
 	{
-		if ((argc == 2) &amp;&amp; (strcmp(args[1], &quot;force&quot;) == 0))
+		if ((CMD_ARGC == 2) &amp;&amp; (strcmp(args[1], &quot;force&quot;) == 0))
 			reg-&gt;valid = 0;
 
 		if (reg-&gt;valid == 0)
@@ -1965,7 +1965,7 @@ COMMAND_HANDLER(handle_reg_command)
 	}
 
 	/* set register value */
-	if (argc == 2)
+	if (CMD_ARGC == 2)
 	{
 		uint8_t *buf = malloc(DIV_ROUND_UP(reg-&gt;size, 8));
 		str_to_buf(args[1], strlen(args[1]), buf, reg-&gt;size, 0);
@@ -1992,7 +1992,7 @@ COMMAND_HANDLER(handle_poll_command)
 	int retval = ERROR_OK;
 	struct target *target = get_current_target(cmd_ctx);
 
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		command_print(cmd_ctx, &quot;background polling: %s&quot;,
 				jtag_poll_get_enabled() ? &quot;on&quot; : &quot;off&quot;);
@@ -2007,7 +2007,7 @@ COMMAND_HANDLER(handle_poll_command)
 			return retval;
 
 	}
-	else if (argc == 1)
+	else if (CMD_ARGC == 1)
 	{
 		if (strcmp(args[0], &quot;on&quot;) == 0)
 		{
@@ -2031,11 +2031,11 @@ COMMAND_HANDLER(handle_poll_command)
 
 COMMAND_HANDLER(handle_wait_halt_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned ms = 5000;
-	if (1 == argc)
+	if (1 == CMD_ARGC)
 	{
 		int retval = parse_uint(args[0], &amp;ms);
 		if (ERROR_OK != retval)
@@ -2105,7 +2105,7 @@ COMMAND_HANDLER(handle_halt_command)
 	if (ERROR_OK != retval)
 		return retval;
 
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		unsigned wait;
 		retval = parse_uint(args[0], &amp;wait);
@@ -2131,11 +2131,11 @@ COMMAND_HANDLER(handle_soft_reset_halt_command)
 
 COMMAND_HANDLER(handle_reset_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	enum target_reset_mode reset_mode = RESET_RUN;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		const Jim_Nvp *n;
 		n = Jim_Nvp_name2value_simple(nvp_reset_modes, args[0]);
@@ -2153,7 +2153,7 @@ COMMAND_HANDLER(handle_reset_command)
 COMMAND_HANDLER(handle_resume_command)
 {
 	int current = 1;
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	struct target *target = get_current_target(cmd_ctx);
@@ -2163,7 +2163,7 @@ COMMAND_HANDLER(handle_resume_command)
 	 * with one arguments, addr = args[0],
 	 * handle breakpoints, not debugging */
 	uint32_t addr = 0;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		COMMAND_PARSE_NUMBER(u32, args[0], addr);
 		current = 0;
@@ -2174,7 +2174,7 @@ COMMAND_HANDLER(handle_resume_command)
 
 COMMAND_HANDLER(handle_step_command)
 {
-	if (argc &gt; 1)
+	if (CMD_ARGC &gt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	LOG_DEBUG(&quot;-&quot;);
@@ -2184,7 +2184,7 @@ COMMAND_HANDLER(handle_step_command)
 	 * handle breakpoints, debugging */
 	uint32_t addr = 0;
 	int current_pc = 1;
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		COMMAND_PARSE_NUMBER(u32, args[0], addr);
 		current_pc = 0;
@@ -2246,7 +2246,7 @@ static void handle_md_output(struct command_context *cmd_ctx,
 
 COMMAND_HANDLER(handle_md_command)
 {
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	unsigned size = 0;
@@ -2263,14 +2263,14 @@ COMMAND_HANDLER(handle_md_command)
 			uint32_t address, uint32_t size, uint32_t count, uint8_t *buffer);
 	if (physical)
 	{
-		argc--;
+		CMD_ARGC--;
 		args++;
 		fn=target_read_phys_memory;
 	} else
 	{
 		fn=target_read_memory;
 	}
-	if ((argc &lt; 1) || (argc &gt; 2))
+	if ((CMD_ARGC &lt; 1) || (CMD_ARGC &gt; 2))
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -2279,7 +2279,7 @@ COMMAND_HANDLER(handle_md_command)
 	COMMAND_PARSE_NUMBER(u32, args[0], address);
 
 	unsigned count = 1;
-	if (argc == 2)
+	if (CMD_ARGC == 2)
 		COMMAND_PARSE_NUMBER(uint, args[1], count);
 
 	uint8_t *buffer = calloc(count, size);
@@ -2296,7 +2296,7 @@ COMMAND_HANDLER(handle_md_command)
 
 COMMAND_HANDLER(handle_mw_command)
 {
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -2306,14 +2306,14 @@ COMMAND_HANDLER(handle_mw_command)
 	const char *cmd_name = CMD_NAME;
 	if (physical)
 	{
-		argc--;
+		CMD_ARGC--;
 		args++;
 		fn=target_write_phys_memory;
 	} else
 	{
 		fn=target_write_memory;
 	}
-	if ((argc &lt; 2) || (argc &gt; 3))
+	if ((CMD_ARGC &lt; 2) || (CMD_ARGC &gt; 3))
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t address;
@@ -2323,7 +2323,7 @@ COMMAND_HANDLER(handle_mw_command)
 	COMMAND_PARSE_NUMBER(u32, args[1], value);
 
 	unsigned count = 1;
-	if (argc == 3)
+	if (CMD_ARGC == 3)
 		COMMAND_PARSE_NUMBER(uint, args[2], count);
 
 	struct target *target = get_current_target(cmd_ctx);
@@ -2362,12 +2362,12 @@ COMMAND_HANDLER(handle_mw_command)
 static COMMAND_HELPER(parse_load_image_command_args, struct image *image,
 		uint32_t *min_address, uint32_t *max_address)
 {
-	if (argc &lt; 1 || argc &gt; 5)
+	if (CMD_ARGC &lt; 1 || CMD_ARGC &gt; 5)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	/* a base address isn't always necessary,
 	 * default to 0x0 (i.e. don't relocate) */
-	if (argc &gt;= 2)
+	if (CMD_ARGC &gt;= 2)
 	{
 		uint32_t addr;
 		COMMAND_PARSE_NUMBER(u32, args[1], addr);
@@ -2379,11 +2379,11 @@ static COMMAND_HELPER(parse_load_image_command_args, struct image *image,
 
 	image-&gt;start_address_set = 0;
 
-	if (argc &gt;= 4)
+	if (CMD_ARGC &gt;= 4)
 	{
 		COMMAND_PARSE_NUMBER(u32, args[3], *min_address);
 	}
-	if (argc == 5)
+	if (CMD_ARGC == 5)
 	{
 		COMMAND_PARSE_NUMBER(u32, args[4], *max_address);
 		// use size (given) to find max (required)
@@ -2416,7 +2416,7 @@ COMMAND_HANDLER(handle_load_image_command)
 	struct duration bench;
 	duration_start(&amp;bench);
 
-	if (image_open(&amp;image, args[0], (argc &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(&amp;image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
 	{
 		return ERROR_OK;
 	}
@@ -2497,7 +2497,7 @@ COMMAND_HANDLER(handle_dump_image_command)
 
 	struct target *target = get_current_target(cmd_ctx);
 
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 	{
 		command_print(cmd_ctx, &quot;usage: dump_image &lt;filename&gt; &lt;address&gt; &lt;size&gt;&quot;);
 		return ERROR_OK;
@@ -2564,7 +2564,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 
 	struct target *target = get_current_target(cmd_ctx);
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -2578,7 +2578,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 	struct duration bench;
 	duration_start(&amp;bench);
 
-	if (argc &gt;= 2)
+	if (CMD_ARGC &gt;= 2)
 	{
 		uint32_t addr;
 		COMMAND_PARSE_NUMBER(u32, args[1], addr);
@@ -2593,7 +2593,7 @@ static COMMAND_HELPER(handle_verify_image_command_internal, int verify)
 
 	image.start_address_set = 0;
 
-	if ((retval = image_open(&amp;image, args[0], (argc == 3) ? args[2] : NULL)) != ERROR_OK)
+	if ((retval = image_open(&amp;image, args[0], (CMD_ARGC == 3) ? args[2] : NULL)) != ERROR_OK)
 	{
 		return retval;
 	}
@@ -2747,10 +2747,10 @@ static int handle_bp_command_set(struct command_context *cmd_ctx,
 
 COMMAND_HANDLER(handle_bp_command)
 {
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 		return handle_bp_command_list(cmd_ctx);
 
-	if (argc &lt; 2 || argc &gt; 3)
+	if (CMD_ARGC &lt; 2 || CMD_ARGC &gt; 3)
 	{
 		command_print(cmd_ctx, &quot;usage: bp &lt;address&gt; &lt;length&gt; ['hw']&quot;);
 		return ERROR_COMMAND_SYNTAX_ERROR;
@@ -2762,7 +2762,7 @@ COMMAND_HANDLER(handle_bp_command)
 	COMMAND_PARSE_NUMBER(u32, args[1], length);
 
 	int hw = BKPT_SOFT;
-	if (argc == 3)
+	if (CMD_ARGC == 3)
 	{
 		if (strcmp(args[2], &quot;hw&quot;) == 0)
 			hw = BKPT_HARD;
@@ -2775,7 +2775,7 @@ COMMAND_HANDLER(handle_bp_command)
 
 COMMAND_HANDLER(handle_rbp_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t addr;
@@ -2791,7 +2791,7 @@ COMMAND_HANDLER(handle_wp_command)
 {
 	struct target *target = get_current_target(cmd_ctx);
 
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		struct watchpoint *watchpoint = target-&gt;watchpoints;
 
@@ -2817,7 +2817,7 @@ COMMAND_HANDLER(handle_wp_command)
 	uint32_t data_value = 0x0;
 	uint32_t data_mask = 0xffffffff;
 
-	switch (argc)
+	switch (CMD_ARGC)
 	{
 	case 5:
 		COMMAND_PARSE_NUMBER(u32, args[4], data_mask);
@@ -2863,7 +2863,7 @@ COMMAND_HANDLER(handle_wp_command)
 
 COMMAND_HANDLER(handle_rwp_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t addr;
@@ -2884,7 +2884,7 @@ COMMAND_HANDLER(handle_rwp_command)
  */
 COMMAND_HANDLER(handle_virt2phys_command)
 {
-	if (argc != 1)
+	if (CMD_ARGC != 1)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 
 	uint32_t va;
@@ -3022,7 +3022,7 @@ COMMAND_HANDLER(handle_profile_command)
 	struct timeval timeout, now;
 
 	gettimeofday(&amp;timeout, NULL);
-	if (argc != 2)
+	if (CMD_ARGC != 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -4553,7 +4553,7 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 	struct duration bench;
 	duration_start(&amp;bench);
 
-	if (image_open(&amp;image, args[0], (argc &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(&amp;image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
 	{
 		return ERROR_OK;
 	}
@@ -4647,7 +4647,7 @@ COMMAND_HANDLER(handle_fast_load_image_command)
 
 COMMAND_HANDLER(handle_fast_load_command)
 {
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	if (fastload == NULL)
 	{
diff --git a/src/target/target_request.c b/src/target/target_request.c
index be176ca..c5de691 100644
--- a/src/target/target_request.c
+++ b/src/target/target_request.c
@@ -268,7 +268,7 @@ COMMAND_HANDLER(handle_target_request_debugmsgs_command)
 	if (find_debug_msg_receiver(cmd_ctx, target) != NULL)
 		receiving = 1;
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		if (!strcmp(args[0], &quot;enable&quot;) || !strcmp(args[0], &quot;charmsg&quot;))
 		{
diff --git a/src/target/trace.c b/src/target/trace.c
index 6ec08d6..88f4ed3 100644
--- a/src/target/trace.c
+++ b/src/target/trace.c
@@ -52,7 +52,7 @@ COMMAND_HANDLER(handle_trace_point_command)
 	struct target *target = get_current_target(cmd_ctx);
 	struct trace *trace = target-&gt;trace_info;
 
-	if (argc == 0)
+	if (CMD_ARGC == 0)
 	{
 		uint32_t i;
 
@@ -100,7 +100,7 @@ COMMAND_HANDLER(handle_trace_history_command)
 	struct target *target = get_current_target(cmd_ctx);
 	struct trace *trace = target-&gt;trace_info;
 
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		trace-&gt;trace_history_pos = 0;
 		trace-&gt;trace_history_overflowed = 0;
diff --git a/src/target/xscale.c b/src/target/xscale.c
index 9e93c02..53bea52 100644
--- a/src/target/xscale.c
+++ b/src/target/xscale.c
@@ -2996,7 +2996,7 @@ COMMAND_HANDLER(xscale_handle_debug_handler_command)
 	int retval;
 	uint32_t handler_address;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		LOG_ERROR(&quot;'xscale debug_handler &lt;target#&gt; &lt;address&gt;' command takes two required operands&quot;);
 		return ERROR_OK;
@@ -3036,7 +3036,7 @@ COMMAND_HANDLER(xscale_handle_cache_clean_address_command)
 	int retval;
 	uint32_t cache_clean_address;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		return ERROR_COMMAND_SYNTAX_ERROR;
 	}
@@ -3131,7 +3131,7 @@ COMMAND_HANDLER(xscale_handle_mmu_command)
 		return ERROR_OK;
 	}
 
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		if (strcmp(&quot;enable&quot;, args[0]) == 0)
 		{
@@ -3172,7 +3172,7 @@ COMMAND_HANDLER(xscale_handle_idcache_command)
 	else if (strcmp(CMD_NAME, &quot;dcache&quot;) == 0)
 		dcache = 1;
 
-	if (argc &gt;= 1)
+	if (CMD_ARGC &gt;= 1)
 	{
 		if (strcmp(&quot;enable&quot;, args[0]) == 0)
 		{
@@ -3213,7 +3213,7 @@ COMMAND_HANDLER(xscale_handle_vector_catch_command)
 	if (retval != ERROR_OK)
 		return retval;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;usage: xscale vector_catch [mask]&quot;);
 	}
@@ -3241,7 +3241,7 @@ COMMAND_HANDLER(xscale_handle_vector_table_command)
 	if (retval != ERROR_OK)
 		return retval;
 
-	if (argc == 0) /* print current settings */
+	if (CMD_ARGC == 0) /* print current settings */
 	{
 		int idx;
 
@@ -3255,7 +3255,7 @@ COMMAND_HANDLER(xscale_handle_vector_table_command)
 		return ERROR_OK;
 	}
 
-	if (argc != 3)
+	if (CMD_ARGC != 3)
 		err = 1;
 	else
 	{
@@ -3306,7 +3306,7 @@ COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 		return ERROR_OK;
 	}
 
-	if ((argc &gt;= 1) &amp;&amp; (strcmp(&quot;enable&quot;, args[0]) == 0))
+	if ((CMD_ARGC &gt;= 1) &amp;&amp; (strcmp(&quot;enable&quot;, args[0]) == 0))
 	{
 		struct xscale_trace_data *td, *next_td;
 		xscale-&gt;trace.buffer_enabled = 1;
@@ -3324,19 +3324,19 @@ COMMAND_HANDLER(xscale_handle_trace_buffer_command)
 		}
 		xscale-&gt;trace.data = NULL;
 	}
-	else if ((argc &gt;= 1) &amp;&amp; (strcmp(&quot;disable&quot;, args[0]) == 0))
+	else if ((CMD_ARGC &gt;= 1) &amp;&amp; (strcmp(&quot;disable&quot;, args[0]) == 0))
 	{
 		xscale-&gt;trace.buffer_enabled = 0;
 	}
 
-	if ((argc &gt;= 2) &amp;&amp; (strcmp(&quot;fill&quot;, args[1]) == 0))
+	if ((CMD_ARGC &gt;= 2) &amp;&amp; (strcmp(&quot;fill&quot;, args[1]) == 0))
 	{
 		uint32_t fill = 1;
-		if (argc &gt;= 3)
+		if (CMD_ARGC &gt;= 3)
 			COMMAND_PARSE_NUMBER(u32, args[2], fill);
 		xscale-&gt;trace.buffer_fill = fill;
 	}
-	else if ((argc &gt;= 2) &amp;&amp; (strcmp(&quot;wrap&quot;, args[1]) == 0))
+	else if ((CMD_ARGC &gt;= 2) &amp;&amp; (strcmp(&quot;wrap&quot;, args[1]) == 0))
 	{
 		xscale-&gt;trace.buffer_fill = -1;
 	}
@@ -3373,7 +3373,7 @@ COMMAND_HANDLER(xscale_handle_trace_image_command)
 	struct xscale_common *xscale = target_to_xscale(target);
 	int retval;
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;usage: xscale trace_image &lt;file&gt; [base address] [type]&quot;);
 		return ERROR_OK;
@@ -3395,7 +3395,7 @@ COMMAND_HANDLER(xscale_handle_trace_image_command)
 	xscale-&gt;trace.image-&gt;start_address_set = 0;
 
 	/* a base address isn't always necessary, default to 0x0 (i.e. don't relocate) */
-	if (argc &gt;= 2)
+	if (CMD_ARGC &gt;= 2)
 	{
 		xscale-&gt;trace.image-&gt;base_address_set = 1;
 		COMMAND_PARSE_NUMBER(int, args[1], xscale-&gt;trace.image-&gt;base_address);
@@ -3405,7 +3405,7 @@ COMMAND_HANDLER(xscale_handle_trace_image_command)
 		xscale-&gt;trace.image-&gt;base_address_set = 0;
 	}
 
-	if (image_open(xscale-&gt;trace.image, args[0], (argc &gt;= 3) ? args[2] : NULL) != ERROR_OK)
+	if (image_open(xscale-&gt;trace.image, args[0], (CMD_ARGC &gt;= 3) ? args[2] : NULL) != ERROR_OK)
 	{
 		free(xscale-&gt;trace.image);
 		xscale-&gt;trace.image = NULL;
@@ -3433,7 +3433,7 @@ COMMAND_HANDLER(xscale_handle_dump_trace_command)
 		return ERROR_OK;
 	}
 
-	if (argc &lt; 1)
+	if (CMD_ARGC &lt; 1)
 	{
 		command_print(cmd_ctx, &quot;usage: xscale dump_trace &lt;file&gt;&quot;);
 		return ERROR_OK;
@@ -3504,7 +3504,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 	}
 	uint32_t reg_no = 0;
 	struct reg *reg = NULL;
-	if (argc &gt; 0)
+	if (CMD_ARGC &gt; 0)
 	{
 		COMMAND_PARSE_NUMBER(u32, args[0], reg_no);
 		/*translate from xscale cp15 register no to openocd register*/
@@ -3541,7 +3541,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 		reg = &amp;xscale-&gt;reg_cache-&gt;reg_list[reg_no];
 
 	}
-	if (argc == 1)
+	if (CMD_ARGC == 1)
 	{
 		uint32_t value;
 
@@ -3550,7 +3550,7 @@ COMMAND_HANDLER(xscale_handle_cp15)
 		value = buf_get_u32(reg-&gt;value, 0, 32);
 		command_print(cmd_ctx, &quot;%s (/%i): 0x%&quot; PRIx32 &quot;&quot;, reg-&gt;name, (int)(reg-&gt;size), value);
 	}
-	else if (argc == 2)
+	else if (CMD_ARGC == 2)
 	{
 		uint32_t value;
 		COMMAND_PARSE_NUMBER(u32, args[1], value);
diff --git a/src/xsvf/xsvf.c b/src/xsvf/xsvf.c
index 01a9411..311acc6 100644
--- a/src/xsvf/xsvf.c
+++ b/src/xsvf/xsvf.c
@@ -219,7 +219,7 @@ COMMAND_HANDLER(handle_xsvf_command)
 	*/
 	struct jtag_tap *tap = NULL;
 
-	if (argc &lt; 2)
+	if (CMD_ARGC &lt; 2)
 	{
 		command_print(cmd_ctx, &quot;usage: xsvf &lt;device#|plain&gt; &lt;file&gt; [&lt;variant&gt;] [quiet]&quot;);
 		return ERROR_FAIL;
@@ -245,14 +245,14 @@ COMMAND_HANDLER(handle_xsvf_command)
 	}
 
 	/* if this argument is present, then interpret xruntest counts as TCK cycles rather than as usecs */
-	if ((argc &gt; 2) &amp;&amp; (strcmp(args[2], &quot;virt2&quot;) == 0))
+	if ((CMD_ARGC &gt; 2) &amp;&amp; (strcmp(args[2], &quot;virt2&quot;) == 0))
 	{
 		runtest_requires_tck = 1;
-		--argc;
+		--CMD_ARGC;
 		++args;
 	}
 
-	if ((argc &gt; 2) &amp;&amp; (strcmp(args[2], &quot;quiet&quot;) == 0))
+	if ((CMD_ARGC &gt; 2) &amp;&amp; (strcmp(args[2], &quot;quiet&quot;) == 0))
 	{
 		verbose = 0;
 	}
-- 
1.6.4.4


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012453.html">[Openocd-development] [PATCH 1/6] add more command_handler	conversion macros
</A></li>
	<LI>Next message: <A HREF="012456.html">[Openocd-development] [PATCH 3/6] command_handler: change 'args' to	CMD_ARGV
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12454">[ date ]</a>
              <a href="thread.html#12454">[ thread ]</a>
              <a href="subject.html#12454">[ subject ]</a>
              <a href="author.html#12454">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
