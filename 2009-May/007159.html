<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] Correct script to flash the lpc-2148
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2009-May/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Correct%20script%20to%20flash%20the%20lpc-2148&In-Reply-To=%3Ca276da400905232032y313883b7u989da639874ad87f%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007158.html">
   <LINK REL="Next"  HREF="007173.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] Correct script to flash the lpc-2148</H1>
    <B>Xiaofan Chen</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Correct%20script%20to%20flash%20the%20lpc-2148&In-Reply-To=%3Ca276da400905232032y313883b7u989da639874ad87f%40mail.gmail.com%3E"
       TITLE="[Openocd-development] Correct script to flash the lpc-2148">xiaofanc at gmail.com
       </A><BR>
    <I>Sun May 24 05:32:57 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="007158.html">[Openocd-development] Correct script to flash the lpc-2148
</A></li>
        <LI>Next message: <A HREF="007173.html">[Openocd-development] Correct script to flash the lpc-2148
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7159">[ date ]</a>
              <a href="thread.html#7159">[ thread ]</a>
              <a href="subject.html#7159">[ subject ]</a>
              <a href="author.html#7159">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, May 24, 2009 at 11:18 AM, Xiaofan Chen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">xiaofanc at gmail.com</A>&gt; wrote:
&gt;<i> After this error, I have to unplug everything and then use lpc21isp
</I>&gt;<i> to flash the target so that I can run OpenOCD again with J-Link V3.
</I>&gt;<i>
</I>&gt;<i> I know the hex is correct since the target works when flashing
</I>&gt;<i> with lpc21isp. The hex file is built from the lpcusb project and
</I>&gt;<i> tested with the Linux host program from psas.
</I>
[<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">mcuee at acerpc</A> jlinkv3]$ sh lpc21isp.sh
lpc21isp version 1.63
File isoc_io_sample.hex:
	loaded...
	converted to binary format...
	image size : 8036
Synchronizing (ESC to abort). OK
Read bootcode version: 11
2
Read part ID: LPC2148, 512 kiB ROM / 40 kiB SRAM (0x402FF25)
Will start programming at Sector 1 if possible, and conclude with
Sector 0 to ensure that checksum is written last.
Sector 1: ...........................................................................................
Sector 0: ...............................................................................................
Download Finished... taking 9 seconds
Now launching the brand new code

[<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">mcuee at acerpc</A> jlinkv3]$ openocd -f myopenocd.cfg
Open On-Chip Debugger 0.2.0-in-development (2009-05-24-08:11) svn:1898


BUGS? Read <A HREF="http://svn.berlios.de/svnroot/repos/openocd/trunk/BUGS">http://svn.berlios.de/svnroot/repos/openocd/trunk/BUGS</A>


$URL: <A HREF="svn://svn.berlios.de/openocd/trunk/src/openocd.c">svn://svn.berlios.de/openocd/trunk/src/openocd.c</A> $
jtag_speed: 20
RCLK - adaptive
Info : J-Link compiled Feb 20 2006 18:20:20 -- Update --
Info : JLink caps 0x3
Info : JLink hw version 30000
Info : Vref = 3.269 TCK = 1 TDI = 1 TDO = 0 TMS = 1 SRST = 1 TRST = 255

Info : J-Link JTAG Interface ready
Info : JTAG tap: lpc2148.cpu tap/device found: 0x4f1f0f0f
(Manufacturer: 0x787, Part: 0xf1f0, Version: 0x4)
Info : JTAG Tap/device matched
Info : accepting 'telnet' connection from 0
target state: halted
target halted in ARM state due to debug-request, current mode: System
cpsr: 0x8000005f pc: 0x0000085c
Debug: 32 47270 command.c:88 script_command(): script_command - reset
Debug: 33 47270 command.c:105 script_command(): script_command -
reset, argv[0]=ocd_reset
Debug: 34 47270 command.c:105 script_command(): script_command -
reset, argv[1]=halt
Debug: 35 47271 target.c:3969 jim_target(): Target command params:
Debug: 36 47271 target.c:3970 jim_target(): target names
Debug: 37 47271 target.c:3103 target_handle_event(): event: 11
reset-start - no action
Debug: 38 47271 jtag.c:2416 jtag_init_reset(): Trying to bring the
JTAG controller to life by asserting TRST / RESET
Debug: 39 47271 jlink.c:488 jlink_reset(): trst: 1, srst: 0
Debug: 40 47277 jtag.c:1264 jtag_add_reset(): SRST line released
Debug: 41 47277 jtag.c:1283 jtag_add_reset(): TRST line asserted
Debug: 42 47277 jtag.c:413 jtag_call_event_callbacks(): jtag event:
JTAG controller reset (RESET or TRST)
Debug: 43 47277 jtag.c:1630 jtag_reset_callback(): -
Debug: 44 47478 jlink.c:488 jlink_reset(): trst: 1, srst: 1
Debug: 45 47482 jtag.c:1260 jtag_add_reset(): SRST line asserted
Debug: 46 47483 jtag.c:1283 jtag_add_reset(): TRST line asserted
Debug: 47 47483 jtag.c:413 jtag_call_event_callbacks(): jtag event:
JTAG controller reset (RESET or TRST)
Debug: 48 47483 jtag.c:1630 jtag_reset_callback(): -
Debug: 49 47483 jlink.c:488 jlink_reset(): trst: 0, srst: 0
Debug: 50 47496 jtag.c:1264 jtag_add_reset(): SRST line released
Debug: 52 47920 jtag.c:2383 jtag_init_inner(): Init JTAG chain
Debug: 53 47922 jtag.c:413 jtag_call_event_callbacks(): jtag event:
JTAG controller reset (RESET or TRST)
Debug: 54 47922 jtag.c:1630 jtag_reset_callback(): -
Info : 55 47929 jtag.c:1751 jtag_examine_chain(): JTAG tap:
lpc2148.cpu tap/device found: 0x4f1f0f0f (Manufacturer: 0x787, Part:
0xf1f0, Version: 0x4)
Info : 56 47930 jtag.c:1789 jtag_examine_chain(): JTAG Tap/device matched
Debug: 57 47930 jtag.c:413 jtag_call_event_callbacks(): jtag event:
JTAG controller reset (RESET or TRST)
Debug: 58 47930 jtag.c:1630 jtag_reset_callback(): -
Debug: 59 47933 target.c:3969 jim_target(): Target command params:
Debug: 60 47933 target.c:3970 jim_target(): target names
Debug: 61 47941 embeddedice.c:363 embeddedice_write_reg(): 0: 0x00000000
Debug: 62 47943 embeddedice.c:363 embeddedice_write_reg(): 12: 0x00000000
Debug: 63 47943 embeddedice.c:363 embeddedice_write_reg(): 20: 0x00000000
Debug: 64 47948 target.c:3969 jim_target(): Target command params:
Debug: 65 47948 target.c:3970 jim_target(): target names
Debug: 66 47948 target.c:3103 target_handle_event(): event: 12
reset-assert-pre - no action
Debug: 67 47948 arm7_9_common.c:976 arm7_9_assert_reset(): target-&gt;state: halted
Debug: 68 47948 embeddedice.c:363 embeddedice_write_reg(): 8: 0x00000000
Debug: 69 47948 embeddedice.c:363 embeddedice_write_reg(): 9: 0x00000003
Debug: 70 47949 embeddedice.c:363 embeddedice_write_reg(): 11: 0xffffffff
Debug: 71 47949 embeddedice.c:363 embeddedice_write_reg(): 12: 0x00000100
Debug: 72 47949 embeddedice.c:363 embeddedice_write_reg(): 13: 0x000000f7
Debug: 73 47952 jlink.c:488 jlink_reset(): trst: 1, srst: 1
Debug: 74 47958 jtag.c:1260 jtag_add_reset(): SRST line asserted
Debug: 75 47958 jtag.c:1283 jtag_add_reset(): TRST line asserted
Debug: 76 47958 jtag.c:413 jtag_call_event_callbacks(): jtag event:
JTAG controller reset (RESET or TRST)
Debug: 77 47958 jtag.c:1630 jtag_reset_callback(): -
Debug: 78 47958 target.c:3103 target_handle_event(): event: 13
reset-assert-post - no action
Debug: 79 47958 target.c:3969 jim_target(): Target command params:
Debug: 80 47958 target.c:3970 jim_target(): target names
Debug: 81 47959 target.c:3103 target_handle_event(): event: 14
reset-deassert-pre - no action
Debug: 82 47959 arm7_9_common.c:1045 arm7_9_deassert_reset():
target-&gt;state: reset
Debug: 83 48009 jlink.c:488 jlink_reset(): trst: 0, srst: 0
Debug: 84 48024 jtag.c:1264 jtag_add_reset(): SRST line released
Warn : 85 48024 arm7_9_common.c:1052 arm7_9_deassert_reset(): srst
pulls trst - can not reset into halted mode. Issuing halt after reset.
Debug: 87 48428 embeddedice.c:363 embeddedice_write_reg(): 0: 0x00000000
Debug: 88 48432 embeddedice.c:363 embeddedice_write_reg(): 12: 0x00000000
Debug: 89 48432 embeddedice.c:363 embeddedice_write_reg(): 20: 0x00000000
Debug: 90 48441 arm7_9_common.c:1257 arm7_9_halt(): target-&gt;state: running
Debug: 91 48441 embeddedice.c:363 embeddedice_write_reg(): 9: 0xffffffff
Debug: 92 48441 embeddedice.c:363 embeddedice_write_reg(): 11: 0xffffffff
Debug: 93 48441 embeddedice.c:363 embeddedice_write_reg(): 12: 0x00000100
Debug: 94 48441 embeddedice.c:363 embeddedice_write_reg(): 13: 0x000000f7
Debug: 95 48441 target.c:3103 target_handle_event(): event: 15
reset-deassert-post - no action
Debug: 96 48441 target.c:3969 jim_target(): Target command params:
Debug: 97 48441 target.c:3970 jim_target(): target names
Debug: 98 48445 embeddedice.c:363 embeddedice_write_reg(): 0: 0x00000005
Debug: 99 48445 embeddedice.c:363 embeddedice_write_reg(): 12: 0x00000000
Debug: 100 48448 arm7_9_common.c:1367 arm7_9_debug_entry(): target
entered debug from ARM state
Debug: 101 48452 arm7_9_common.c:1399 arm7_9_debug_entry(): target
entered debug state in System mode
Debug: 102 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r0: 0x00fe0500
Debug: 103 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r1: 0x00000001
Debug: 104 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r2: 0x00000800
Debug: 105 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r3: 0x00061a7f
Debug: 106 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r4: 0x00046234
Debug: 107 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r5: 0xe01fc040
Debug: 108 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r6: 0x7fffd1bc
Debug: 109 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r7: 0x40000120
Debug: 110 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r8: 0xea1e1000
Debug: 111 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r9: 0xf75bbc15
Debug: 112 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r10: 0xeab4779d
Debug: 113 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r11: 0xafe2eb12
Debug: 114 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r12: 0x000000e2
Debug: 115 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r13: 0x40007914
Debug: 116 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r14: 0x00000a54
Debug: 117 48453 arm7_9_common.c:1430 arm7_9_debug_entry(): r15: 0x00000858
Debug: 118 48453 arm7_9_common.c:1436 arm7_9_debug_entry(): entered
debug state at PC 0x858
Debug: 119 48453 target.c:712 target_call_event_callbacks(): target
event 4 (early-halted)
Debug: 120 48453 target.c:3103 target_handle_event(): event: 4
early-halted - no action
Debug: 121 48453 target.c:712 target_call_event_callbacks(): target
event 5 (halted)
Debug: 122 48453 target.c:3103 target_handle_event(): event: 5 halted
- no action
User : 123 48453 target.c:964 target_arch_state(): target state: halted
User : 124 48453 armv4_5.c:305 armv4_5_arch_state(): target halted in
ARM state due to debug-request, current mode: System
cpsr: 0x8000005f pc: 0x00000858
Debug: 125 48454 target.c:3969 jim_target(): Target command params:
Debug: 126 48454 target.c:3970 jim_target(): target names
Debug: 127 48454 target.c:3103 target_handle_event(): event: 21
reset-end - no action
Debug: 129 48460 command.c:88 script_command(): script_command - log_output
Debug: 130 48460 command.c:105 script_command(): script_command -
log_output, argv[0]=ocd_log_output
Debug: 131 48461 command.c:105 script_command(): script_command -
log_output, argv[1]=write_flash.log
^C

With debug level 3, the log file is too big to be attached.
The error is something like this.
Debug: 2604 52886 embeddedice.c:363 embeddedice_write_reg(): 9: 0xffffffff
Debug: 2605 52886 embeddedice.c:363 embeddedice_write_reg(): 11: 0xffffffff
Debug: 2606 52886 embeddedice.c:363 embeddedice_write_reg(): 12: 0x00000100
Debug: 2607 52886 embeddedice.c:363 embeddedice_write_reg(): 13: 0x000000f7
Debug: 2608 52889 embeddedice.c:363 embeddedice_write_reg(): 0: 0x00000005
Debug: 2609 52890 embeddedice.c:363 embeddedice_write_reg(): 12: 0x00000000
Debug: 2610 52893 arm7_9_common.c:1359 arm7_9_debug_entry(): target
entered debug from Thumb state
Debug: 2611 52898 arm7_9_common.c:1363 arm7_9_debug_entry(): r0_thumb:
0x00000000, pc_thumb: 0xfffffff6
Error: 2612 52904 armv4_5.h:117 armv4_5_mode_to_number(): invalid mode
value encountered
Error: 2613 52905 arm7_9_common.c:1395 arm7_9_debug_entry(): cpsr
contains invalid mode value - communication failure
Debug: 2614 52905 command.c:424 run_command(): Command failed with
error code -305
User : 2615 52905 command.c:626 openocd_jim_vfprintf(): Runtime error,
file &quot;oocd_flash_lpc2148.script&quot;, line 96:
    User : 2616 52905 command.c:626 openocd_jim_vfprintf():
User : 2619 52905 command.c:626 openocd_jim_vfprintf():
User : 2621 52905 command.c:626 openocd_jim_vfprintf():
Warn : 2622 52991 arm7_9_common.c:899 arm7_9_poll(): DBGACK set while
target was in unknown state. Reset or initialize target.
Debug: 2623 52992 embeddedice.c:363 embeddedice_write_reg(): 0: 0x00000005
Debug: 2624 52992 embeddedice.c:363 embeddedice_write_reg(): 12: 0x00000000
Debug: 2625 52994 arm7_9_common.c:1359 arm7_9_debug_entry(): target
entered debug from Thumb state
Debug: 2626 52998 arm7_9_common.c:1363 arm7_9_debug_entry(): r0_thumb:
0x00000000, pc_thumb: 0xfffffff6
Error: 2627 53003 armv4_5.h:117 armv4_5_mode_to_number(): invalid mode
value encountered
Error: 2628 53004 arm7_9_common.c:1395 arm7_9_debug_entry(): cpsr
contains invalid mode value - communication failure
Warn : 2629 53096 arm7_9_common.c:899 arm7_9_poll(): DBGACK set while
target was in unknown state. Reset or initialize target.


-- 
Xiaofan <A HREF="http://mcuee.blogspot.com">http://mcuee.blogspot.com</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007158.html">[Openocd-development] Correct script to flash the lpc-2148
</A></li>
	<LI>Next message: <A HREF="007173.html">[Openocd-development] Correct script to flash the lpc-2148
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7159">[ date ]</a>
              <a href="thread.html#7159">[ thread ]</a>
              <a href="subject.html#7159">[ subject ]</a>
              <a href="author.html#7159">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
