<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] Flashing failed with GCC optimisation on	Olimex STM32-P103
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Flashing%20failed%20with%20GCC%20optimisation%20on%0A%09Olimex%20STM32-P103&In-Reply-To=%3C1233878409.7000.35.camel%40Ubuntu-Desktop%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004700.html">
   <LINK REL="Next"  HREF="004658.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] Flashing failed with GCC optimisation on	Olimex STM32-P103</H1>
    <B>James</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Flashing%20failed%20with%20GCC%20optimisation%20on%0A%09Olimex%20STM32-P103&In-Reply-To=%3C1233878409.7000.35.camel%40Ubuntu-Desktop%3E"
       TITLE="[Openocd-development] Flashing failed with GCC optimisation on	Olimex STM32-P103">jamessteward at optusnet.com.au
       </A><BR>
    <I>Fri Feb  6 01:00:09 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004700.html">[Openocd-development] FTX232H bring higher JTAG speed?
</A></li>
        <LI>Next message: <A HREF="004658.html">[Openocd-development] Flashing failed with GCC optimisation on	Olimex STM32-P103
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4657">[ date ]</a>
              <a href="thread.html#4657">[ thread ]</a>
              <a href="subject.html#4657">[ subject ]</a>
              <a href="author.html#4657">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I've got an Olimex STM32-P103 board and a wiggler to connect openocd to
the board.  I'm using Open On-Chip Debugger 0.1.0 (2009-01-22-10:03)
Release.

If I build my STM32 app with gcc -O0 ... (no optimisation) openocd has
no problem flashing the binary.  However, if I build with -O2 or -Os, or
I use -ffunction-sections -fdata-sections and -Wl,-gc-sections, openocd
doesn't like to flash the CPU.  I do not yet understand how the binary
contents affect flashing the CPU.  This is what openocd says..

&gt;<i> reset init                          
</I>JTAG tap: stm32.cpu tap/device found: 0x3ba00477 (Manufacturer: 0x23b,
Part: 0xba00, Version: 0x3)
JTAG tap: stm32.bs tap/device found: 0x16410041 (Manufacturer: 0x020,
Part: 0x6410, Version: 0x1)
target state: halted
target halted due to debug-request, current mode: Thread 
xPSR: 0x01000000 pc: 0x00003e90

&gt;<i> flash erase_sector 0 0 127          
</I>erased sectors 0 through 127 on flash bank 0 in 0.041680s

&gt;<i> flash write_bank 0 ./obj/ct_in.bin 0
</I>BUG: keep_alive() was not invoked in the 1000ms timelimit. GDB alive
packet not sent! (1079)
timed out while waiting for target halted
error executing stm32x flash write algorithm
flash writing failed with error code: 0xfffffc7a
error writing to flash at address 0x08000000 at offset 0x00000000 (-902)

called at file &quot;command.c&quot;, line 456
called at file &quot;embedded:startup.tcl&quot;, line 89
called at file &quot;embedded:startup.tcl&quot;, line 93

Is this an openocd bug, or have I done/not done something in openocd?

Cheers,
James.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004700.html">[Openocd-development] FTX232H bring higher JTAG speed?
</A></li>
	<LI>Next message: <A HREF="004658.html">[Openocd-development] Flashing failed with GCC optimisation on	Olimex STM32-P103
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4657">[ date ]</a>
              <a href="thread.html#4657">[ thread ]</a>
              <a href="subject.html#4657">[ subject ]</a>
              <a href="author.html#4657">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
