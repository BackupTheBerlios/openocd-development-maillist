<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] Cortex-A8 problems
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Cortex-A8%20problems&In-Reply-To=%3C20090901082759.GF5504%40prithivi.gnumonks.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010294.html">
   <LINK REL="Next"  HREF="010288.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] Cortex-A8 problems</H1>
    <B>Harald Welte</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Cortex-A8%20problems&In-Reply-To=%3C20090901082759.GF5504%40prithivi.gnumonks.org%3E"
       TITLE="[Openocd-development] Cortex-A8 problems">laforge at gnumonks.org
       </A><BR>
    <I>Tue Sep  1 10:27:59 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="010294.html">[Openocd-development] write image on sam7x512
</A></li>
        <LI>Next message: <A HREF="010288.html">[Openocd-development] Cortex-A8 problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10286">[ date ]</a>
              <a href="thread.html#10286">[ thread ]</a>
              <a href="subject.html#10286">[ subject ]</a>
              <a href="author.html#10286">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Magnus,

On Mon, Aug 31, 2009 at 05:36:11PM +0200, Magnus Lundin wrote:

&gt;&gt;<i> 	dap_ap_select(swjdp, 1);
</I>&gt;&gt;<i> before the two lines
</I>&gt;&gt;<i>         dap_ap_read_reg_u32(swjdp, 0xFC, &amp;idreg);
</I>&gt;&gt;<i>         dap_ap_read_reg_u32(swjdp, 0xF8, &amp;romaddr);
</I>&gt;&gt;<i> in ahbap_debugport_init()
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   
</I>&gt;<i> What happens when you do  &quot;dap info 0&quot; from the telnet interface ?
</I>
=======
Open On-Chip Debugger
&gt;<i> dap info 0
</I>ap identification register 0x14770001
        Type is mem-ap AHB
ap debugbase 0xffffffff
        No ROM table present
&gt;<i> dap info 1
</I>ap identification register 0x04770002
        Type is mem-ap APB
ap debugbase 0x80000000
        ROM table in legacy format
        CID3 0xb1, CID2 0x5, CID1 0x10 CID0, 0xd
        MEMTYPE system memory not present. Dedicated debug bus
        ROMTABLE[0x0] = 0x1003
                Component base address 0x80001000, pid4 0x4, start address 0x80001000
                Component cid1 0x90, class is CoreSight component
                CID3 0xb1, CID2 0x5, CID1 0x90, CID0, 0xd
                PID3 0x0, PID2 0xb, PID1 0xb9, PID0, 0x7
        ROMTABLE[0x4] = 0x2003
                Component base address 0x80002000, pid4 0x4, start address 0x80002000
                Component cid1 0x90, class is CoreSight component
                CID3 0xb1, CID2 0x5, CID1 0x90, CID0, 0xd
                PID3 0x0, PID2 0xb, PID1 0xb9, PID0, 0x6
        ROMTABLE[0x8] = 0x4003
                Component base address 0x80004000, pid4 0x4, start address 0x80004000
                Component cid1 0x90, class is CoreSight component
                CID3 0xb1, CID2 0x5, CID1 0x90, CID0, 0xd
                PID3 0x0, PID2 0xb, PID1 0xb9, PID0, 0x8
        ROMTABLE[0xc] = 0x5003
                Component base address 0x80005000, pid4 0x4, start address 0x80005000
                Component cid1 0x90, class is CoreSight component
                CID3 0xb1, CID2 0x5, CID1 0x90, CID0, 0xd
                PID3 0x0, PID2 0x5b, PID1 0xbc, PID0, 0x8
        ROMTABLE[0x10] = 0x6003
                Component base address 0x80006000, pid4 0x4, start address 0x80006000
                Component cid1 0x90, class is CoreSight component
                CID3 0xb1, CID2 0x5, CID1 0x90, CID0, 0xd
                PID3 0x0, PID2 0x5b, PID1 0xb9, PID0, 0x21
        ROMTABLE[0x14] = 0x7003
                Component base address 0x80007000, pid4 0x4, start address 0x80007000
                Component cid1 0x90, class is CoreSight component
                CID3 0xb1, CID2 0x5, CID1 0x90, CID0, 0xd
                PID3 0x0, PID2 0x5b, PID1 0xb9, PID0, 0x22
        ROMTABLE[0x18] = 0x8003
                Component base address 0x80008000, pid4 0x0, start address 0x80008000
                Component cid1 0x0, class is Reserved
                CID3 0x0, CID2 0x0, CID1 0x0, CID0, 0x0
                PID3 0x0, PID2 0x0, PID1 0x0, PID0, 0x0
        ROMTABLE[0x1c] = 0x0
                End of ROM table
&gt;<i> dap info 3
</I>ap identification register 0x00000000
No AP found at this apsel 0x3
        No ROM table present
=======

&gt;&gt;<i> However, as soon as the code enters cortex_a8_poll() and calls
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        retval = mem_ap_read_atomic_u32(swjdp,
</I>&gt;&gt;<i>                         OMAP3530_DEBUG_BASE + CPUDBG_DSCR, &amp;dscr);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> the implicit swjdp_transaction_endcheck(). Specifically,
</I>&gt;&gt;<i> SSTICKYORUN is set during the first DP_CTRL_STAT read.
</I>&gt;<i> 
</I>&gt;<i> So you can read some of the registers,  can you read CPUDBG_DSCR ? and  
</I>&gt;<i> its value is?
</I>
no, it cannot be read. neither from u-boot, nor from the AHB DAP

&gt;<i> Your problems are probably related to the DBGEN signal, this is an input  
</I>&gt;<i> to the Cortex_A8 core and controls debug access. There is some  
</I>&gt;<i> documentation of this in the Cortex_A8 TRM, but no way to controling it  
</I>&gt;<i> from the debug registers defined by ARM.
</I>
I see.  It's somewhat strange if ARM has all those detailed and fairly
extensive specifications (and the romtable to discover the debugging
capabilities), but then no standard way how DBGEN can be set?  That's weird.

After searching the Cortex-A8 TRM, I found Chapter 12.5.10 authentication
status register (0xFB8).  Bit 0 of this register is supposed to correspond to
the DBGEN level.  Reading this register through 'mdw 0x80005fb8' tells me it is
set to 0xff, which would mean that DBGEN is set.

Also, the SoC has its own SJGTAG_STATUS register that prinets the DBGEN, NIDEN,
SPIDEN, SPNIDEN signals at 0x80008004, and all of those are set to '1'

So what now?  Any more ideas?

-- 
- Harald Welte &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">laforge at gnumonks.org</A>&gt;           <A HREF="http://laforge.gnumonks.org/">http://laforge.gnumonks.org/</A>
============================================================================
&quot;Privacy in residential applications is a desirable marketing option.&quot;
                                                  (ETSI EN 300 175-7 Ch. A6)

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010294.html">[Openocd-development] write image on sam7x512
</A></li>
	<LI>Next message: <A HREF="010288.html">[Openocd-development] Cortex-A8 problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10286">[ date ]</a>
              <a href="thread.html#10286">[ thread ]</a>
              <a href="subject.html#10286">[ subject ]</a>
              <a href="author.html#10286">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
