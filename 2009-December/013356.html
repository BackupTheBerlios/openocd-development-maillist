<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] [patch 1/N] ARM: renaming
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2009-December/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20%5Bpatch%201/N%5D%20ARM%3A%20renaming&In-Reply-To=%3C1259985188.27619.2950.camel%40localhost%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013355.html">
   <LINK REL="Next"  HREF="013357.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] [patch 1/N] ARM: renaming</H1>
    <B>Zach Welch</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20%5Bpatch%201/N%5D%20ARM%3A%20renaming&In-Reply-To=%3C1259985188.27619.2950.camel%40localhost%3E"
       TITLE="[Openocd-development] [patch 1/N] ARM: renaming">zw at superlucidity.net
       </A><BR>
    <I>Sat Dec  5 04:53:08 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="013355.html">[Openocd-development] [patch 1/N] ARM: renaming
</A></li>
        <LI>Next message: <A HREF="013357.html">[Openocd-development] [patch 1/N] ARM: renaming
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13356">[ date ]</a>
              <a href="thread.html#13356">[ thread ]</a>
              <a href="subject.html#13356">[ subject ]</a>
              <a href="author.html#13356">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sounds good to me.  I have given the target directory a wide berth since
you have been working on it. ;)

On Fri, 2009-12-04 at 19:29 -0800, David Brownell wrote:
&gt;<i> I'm committing some renaming patches, which help move the
</I>&gt;<i> stuff in &quot;armv4_5.h&quot; more towards being generic ARM stuff.
</I>&gt;<i> 
</I>&gt;<i> Sample patch appended ... they're all equally boring, so
</I>&gt;<i> I won't be posting every one of them.  They're done by
</I>&gt;<i> more or less
</I>&gt;<i> 
</I>&gt;<i> 	for F in $(grep -rl OLD src)
</I>&gt;<i> 	do
</I>&gt;<i> 		sed -i &quot;s/$OLD/$NEW&quot; $F
</I>&gt;<i> 	done
</I>&gt;<i> 
</I>&gt;<i> with a test build.  Any goofage should be easy to find and
</I>&gt;<i> fix, including in your own as-yet-unmerged patches.
</I>&gt;<i> 
</I>&gt;<i> - Dave
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ==============
</I>&gt;<i>  flash/arm_nandio.c       |    4 ++--
</I>&gt;<i>  flash/nor/aduc702x.c     |    2 +-
</I>&gt;<i>  flash/nor/cfi.c          |    4 ++--
</I>&gt;<i>  flash/nor/ecos.c         |    2 +-
</I>&gt;<i>  flash/nor/lpc2000.c      |    2 +-
</I>&gt;<i>  flash/nor/lpc2900.c      |    2 +-
</I>&gt;<i>  flash/nor/str7x.c        |    2 +-
</I>&gt;<i>  flash/nor/str9x.c        |    2 +-
</I>&gt;<i>  target/arm7_9_common.c   |   30 +++++++++++++++---------------
</I>&gt;<i>  target/arm_dpm.c         |   12 ++++++------
</I>&gt;<i>  target/arm_semihosting.c |    2 +-
</I>&gt;<i>  target/arm_simulator.c   |   28 ++++++++++++++--------------
</I>&gt;<i>  target/armv4_5.c         |   18 +++++++++---------
</I>&gt;<i>  target/armv4_5.h         |    6 +++---
</I>&gt;<i>  target/cortex_a8.c       |    8 ++++----
</I>&gt;<i>  target/etm.c             |   18 +++++++++---------
</I>&gt;<i>  target/feroceon.c        |    2 +-
</I>&gt;<i>  target/xscale.c          |   10 +++++-----
</I>&gt;<i>  18 files changed, 77 insertions(+), 77 deletions(-)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --- a/src/flash/arm_nandio.c
</I>&gt;<i> +++ b/src/flash/arm_nandio.c
</I>&gt;<i> @@ -138,7 +138,7 @@ int arm_nandwrite(struct arm_nand_data *nand, uint8_t *data, int size)
</I>&gt;<i>  	/* set up algorithm and parameters */
</I>&gt;<i>  	algo.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  	algo.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -	algo.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	algo.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN);
</I>&gt;<i>  	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_IN);
</I>&gt;<i> @@ -214,7 +214,7 @@ int arm_nandread(struct arm_nand_data *nand, uint8_t *data, uint32_t size)
</I>&gt;<i>  	/* set up algorithm and parameters */
</I>&gt;<i>  	algo.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  	algo.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -	algo.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	algo.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN);
</I>&gt;<i>  	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_IN);
</I>&gt;<i> --- a/src/flash/nor/aduc702x.c
</I>&gt;<i> +++ b/src/flash/nor/aduc702x.c
</I>&gt;<i> @@ -243,7 +243,7 @@ static int aduc702x_write_block(struct flash_bank *bank, uint8_t *buffer, uint32
</I>&gt;<i>  
</I>&gt;<i>  	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	armv4_5_info.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
</I>&gt;<i>  	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_OUT);
</I>&gt;<i> --- a/src/flash/nor/cfi.c
</I>&gt;<i> +++ b/src/flash/nor/cfi.c
</I>&gt;<i> @@ -1087,7 +1087,7 @@ static int cfi_intel_write_block(struct flash_bank *bank, uint8_t *buffer, uint3
</I>&gt;<i>  
</I>&gt;<i>  	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	armv4_5_info.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	/* If we are setting up the write_algorith, we need target_code_src */
</I>&gt;<i>  	/* if not we only need target_code_size. */
</I>&gt;<i> @@ -1410,7 +1410,7 @@ static int cfi_spansion_write_block(struct flash_bank *bank, uint8_t *buffer, ui
</I>&gt;<i>  
</I>&gt;<i>  	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	armv4_5_info.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	int target_code_size;
</I>&gt;<i>  	const uint32_t *target_code_src;
</I>&gt;<i> --- a/src/flash/nor/ecos.c
</I>&gt;<i> +++ b/src/flash/nor/ecos.c
</I>&gt;<i> @@ -212,7 +212,7 @@ static int runCode(struct ecosflash_flash_bank *info,
</I>&gt;<i>  	struct armv4_5_algorithm armv4_5_info;
</I>&gt;<i>  	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	armv4_5_info.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN_OUT);
</I>&gt;<i>  	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_OUT);
</I>&gt;<i> --- a/src/flash/nor/lpc2000.c
</I>&gt;<i> +++ b/src/flash/nor/lpc2000.c
</I>&gt;<i> @@ -294,7 +294,7 @@ static int lpc2000_iap_call(struct flash_bank *bank, int code, uint32_t param_ta
</I>&gt;<i>  		case lpc2000_v2:
</I>&gt;<i>  			armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  			armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -			armv4_5_info.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +			armv4_5_info.core_state = ARM_STATE_ARM;
</I>&gt;<i>  			iap_entry_point = 0x7ffffff1;
</I>&gt;<i>  			break;
</I>&gt;<i>  		default:
</I>&gt;<i> --- a/src/flash/nor/lpc2900.c
</I>&gt;<i> +++ b/src/flash/nor/lpc2900.c
</I>&gt;<i> @@ -1425,7 +1425,7 @@ static int lpc2900_write(struct flash_bank *bank, uint8_t *buffer,
</I>&gt;<i>  			/* Execute algorithm, assume breakpoint for last instruction */
</I>&gt;<i>  			armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  			armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -			armv4_5_info.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +			armv4_5_info.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  			retval = target_run_algorithm(target, 0, NULL, 5, reg_params,
</I>&gt;<i>  				(warea-&gt;address) + buffer_size,
</I>&gt;<i> --- a/src/flash/nor/str7x.c
</I>&gt;<i> +++ b/src/flash/nor/str7x.c
</I>&gt;<i> @@ -373,7 +373,7 @@ static int str7x_write_block(struct flash_bank *bank, uint8_t *buffer, uint32_t
</I>&gt;<i>  
</I>&gt;<i>  	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	armv4_5_info.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
</I>&gt;<i>  	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_OUT);
</I>&gt;<i> --- a/src/flash/nor/str9x.c
</I>&gt;<i> +++ b/src/flash/nor/str9x.c
</I>&gt;<i> @@ -410,7 +410,7 @@ static int str9x_write_block(struct flash_bank *bank,
</I>&gt;<i>  
</I>&gt;<i>  	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	armv4_5_info.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
</I>&gt;<i>  	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_OUT);
</I>&gt;<i> --- a/src/target/arm7_9_common.c
</I>&gt;<i> +++ b/src/target/arm7_9_common.c
</I>&gt;<i> @@ -1211,7 +1211,7 @@ int arm7_9_soft_reset_halt(struct target *target)
</I>&gt;<i>  		uint32_t r0_thumb, pc_thumb;
</I>&gt;<i>  		LOG_DEBUG(&quot;target entered debug from Thumb state, changing to ARM&quot;);
</I>&gt;<i>  		/* Entered debug from Thumb mode */
</I>&gt;<i> -		armv4_5-&gt;core_state = ARMV4_5_STATE_THUMB;
</I>&gt;<i> +		armv4_5-&gt;core_state = ARM_STATE_THUMB;
</I>&gt;<i>  		arm7_9-&gt;change_to_arm(target, &amp;r0_thumb, &amp;pc_thumb);
</I>&gt;<i>  	}
</I>&gt;<i>  
</I>&gt;<i> @@ -1373,7 +1373,7 @@ static int arm7_9_debug_entry(struct target *target)
</I>&gt;<i>  	{
</I>&gt;<i>  		LOG_DEBUG(&quot;target entered debug from Thumb state&quot;);
</I>&gt;<i>  		/* Entered debug from Thumb mode */
</I>&gt;<i> -		armv4_5-&gt;core_state = ARMV4_5_STATE_THUMB;
</I>&gt;<i> +		armv4_5-&gt;core_state = ARM_STATE_THUMB;
</I>&gt;<i>  		cpsr_mask = 1 &lt;&lt; 5;
</I>&gt;<i>  		arm7_9-&gt;change_to_arm(target, &amp;r0_thumb, &amp;pc_thumb);
</I>&gt;<i>  		LOG_DEBUG(&quot;r0_thumb: 0x%8.8&quot; PRIx32
</I>&gt;<i> @@ -1385,13 +1385,13 @@ static int arm7_9_debug_entry(struct target *target)
</I>&gt;<i>  		 * B.7.3 for the reverse.  That'd be the bare minimum...
</I>&gt;<i>  		 */
</I>&gt;<i>  		LOG_DEBUG(&quot;target entered debug from Jazelle state&quot;);
</I>&gt;<i> -		armv4_5-&gt;core_state = ARMV4_5_STATE_JAZELLE;
</I>&gt;<i> +		armv4_5-&gt;core_state = ARM_STATE_JAZELLE;
</I>&gt;<i>  		cpsr_mask = 1 &lt;&lt; 24;
</I>&gt;<i>  		LOG_ERROR(&quot;Jazelle debug entry -- BROKEN!&quot;);
</I>&gt;<i>  	} else {
</I>&gt;<i>  		LOG_DEBUG(&quot;target entered debug from ARM state&quot;);
</I>&gt;<i>  		/* Entered debug from ARM mode */
</I>&gt;<i> -		armv4_5-&gt;core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +		armv4_5-&gt;core_state = ARM_STATE_ARM;
</I>&gt;<i>  	}
</I>&gt;<i>  
</I>&gt;<i>  	for (i = 0; i &lt; 16; i++)
</I>&gt;<i> @@ -1419,21 +1419,21 @@ static int arm7_9_debug_entry(struct target *target)
</I>&gt;<i>  	LOG_DEBUG(&quot;target entered debug state in %s mode&quot;,
</I>&gt;<i>  			 arm_mode_name(armv4_5-&gt;core_mode));
</I>&gt;<i>  
</I>&gt;<i> -	if (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
</I>&gt;<i> +	if (armv4_5-&gt;core_state == ARM_STATE_THUMB)
</I>&gt;<i>  	{
</I>&gt;<i>  		LOG_DEBUG(&quot;thumb state, applying fixups&quot;);
</I>&gt;<i>  		context[0] = r0_thumb;
</I>&gt;<i>  		context[15] = pc_thumb;
</I>&gt;<i> -	} else if (armv4_5-&gt;core_state == ARMV4_5_STATE_ARM)
</I>&gt;<i> +	} else if (armv4_5-&gt;core_state == ARM_STATE_ARM)
</I>&gt;<i>  	{
</I>&gt;<i>  		/* adjust value stored by STM */
</I>&gt;<i>  		context[15] -= 3 * 4;
</I>&gt;<i>  	}
</I>&gt;<i>  
</I>&gt;<i>  	if ((target-&gt;debug_reason != DBG_REASON_DBGRQ) || (!arm7_9-&gt;use_dbgrq))
</I>&gt;<i> -		context[15] -= 3 * ((armv4_5-&gt;core_state == ARMV4_5_STATE_ARM) ? 4 : 2);
</I>&gt;<i> +		context[15] -= 3 * ((armv4_5-&gt;core_state == ARM_STATE_ARM) ? 4 : 2);
</I>&gt;<i>  	else
</I>&gt;<i> -		context[15] -= arm7_9-&gt;dbgreq_adjust_pc * ((armv4_5-&gt;core_state == ARMV4_5_STATE_ARM) ? 4 : 2);
</I>&gt;<i> +		context[15] -= arm7_9-&gt;dbgreq_adjust_pc * ((armv4_5-&gt;core_state == ARM_STATE_ARM) ? 4 : 2);
</I>&gt;<i>  
</I>&gt;<i>  	for (i = 0; i &lt;= 15; i++)
</I>&gt;<i>  	{
</I>&gt;<i> @@ -1846,9 +1846,9 @@ int arm7_9_resume(struct target *target, int current, uint32_t address, int hand
</I>&gt;<i>  				return retval;
</I>&gt;<i>  			}
</I>&gt;<i>  
</I>&gt;<i> -			if (armv4_5-&gt;core_state == ARMV4_5_STATE_ARM)
</I>&gt;<i> +			if (armv4_5-&gt;core_state == ARM_STATE_ARM)
</I>&gt;<i>  				arm7_9-&gt;branch_resume(target);
</I>&gt;<i> -			else if (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
</I>&gt;<i> +			else if (armv4_5-&gt;core_state == ARM_STATE_THUMB)
</I>&gt;<i>  			{
</I>&gt;<i>  				arm7_9-&gt;branch_resume_thumb(target);
</I>&gt;<i>  			}
</I>&gt;<i> @@ -1895,11 +1895,11 @@ int arm7_9_resume(struct target *target, int current, uint32_t address, int hand
</I>&gt;<i>  		return retval;
</I>&gt;<i>  	}
</I>&gt;<i>  
</I>&gt;<i> -	if (armv4_5-&gt;core_state == ARMV4_5_STATE_ARM)
</I>&gt;<i> +	if (armv4_5-&gt;core_state == ARM_STATE_ARM)
</I>&gt;<i>  	{
</I>&gt;<i>  		arm7_9-&gt;branch_resume(target);
</I>&gt;<i>  	}
</I>&gt;<i> -	else if (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
</I>&gt;<i> +	else if (armv4_5-&gt;core_state == ARM_STATE_THUMB)
</I>&gt;<i>  	{
</I>&gt;<i>  		arm7_9-&gt;branch_resume_thumb(target);
</I>&gt;<i>  	}
</I>&gt;<i> @@ -2046,11 +2046,11 @@ int arm7_9_step(struct target *target, int current, uint32_t address, int handle
</I>&gt;<i>  
</I>&gt;<i>  	arm7_9-&gt;enable_single_step(target, next_pc);
</I>&gt;<i>  
</I>&gt;<i> -	if (armv4_5-&gt;core_state == ARMV4_5_STATE_ARM)
</I>&gt;<i> +	if (armv4_5-&gt;core_state == ARM_STATE_ARM)
</I>&gt;<i>  	{
</I>&gt;<i>  		arm7_9-&gt;branch_resume(target);
</I>&gt;<i>  	}
</I>&gt;<i> -	else if (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
</I>&gt;<i> +	else if (armv4_5-&gt;core_state == ARM_STATE_THUMB)
</I>&gt;<i>  	{
</I>&gt;<i>  		arm7_9-&gt;branch_resume_thumb(target);
</I>&gt;<i>  	}
</I>&gt;<i> @@ -2698,7 +2698,7 @@ int arm7_9_bulk_write_memory(struct target *target, uint32_t address, uint32_t c
</I>&gt;<i>  
</I>&gt;<i>  	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	armv4_5_info.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN_OUT);
</I>&gt;<i>  
</I>&gt;<i> --- a/src/target/arm_dpm.c
</I>&gt;<i> +++ b/src/target/arm_dpm.c
</I>&gt;<i> @@ -147,14 +147,14 @@ static int dpm_read_reg(struct arm_dpm *dpm, struct reg *r, unsigned regnum)
</I>&gt;<i>  		 * is always right except in those broken-by-intent cases.
</I>&gt;<i>  		 */
</I>&gt;<i>  		switch (dpm-&gt;arm-&gt;core_state) {
</I>&gt;<i> -		case ARMV4_5_STATE_ARM:
</I>&gt;<i> +		case ARM_STATE_ARM:
</I>&gt;<i>  			value -= 8;
</I>&gt;<i>  			break;
</I>&gt;<i> -		case ARMV4_5_STATE_THUMB:
</I>&gt;<i> +		case ARM_STATE_THUMB:
</I>&gt;<i>  		case ARM_STATE_THUMB_EE:
</I>&gt;<i>  			value -= 4;
</I>&gt;<i>  			break;
</I>&gt;<i> -		case ARMV4_5_STATE_JAZELLE:
</I>&gt;<i> +		case ARM_STATE_JAZELLE:
</I>&gt;<i>  			/* core-specific ... ? */
</I>&gt;<i>  			LOG_WARNING(&quot;Jazelle PC adjustment unknown&quot;);
</I>&gt;<i>  			break;
</I>&gt;<i> @@ -744,14 +744,14 @@ static int dpm_remove_watchpoint(struct target *target, struct watchpoint *wp)
</I>&gt;<i>  void arm_dpm_report_wfar(struct arm_dpm *dpm, uint32_t addr)
</I>&gt;<i>  {
</I>&gt;<i>  	switch (dpm-&gt;arm-&gt;core_state) {
</I>&gt;<i> -	case ARMV4_5_STATE_ARM:
</I>&gt;<i> +	case ARM_STATE_ARM:
</I>&gt;<i>  		addr -= 8;
</I>&gt;<i>  		break;
</I>&gt;<i> -	case ARMV4_5_STATE_THUMB:
</I>&gt;<i> +	case ARM_STATE_THUMB:
</I>&gt;<i>  	case ARM_STATE_THUMB_EE:
</I>&gt;<i>  		addr -= 4;
</I>&gt;<i>  		break;
</I>&gt;<i> -	case ARMV4_5_STATE_JAZELLE:
</I>&gt;<i> +	case ARM_STATE_JAZELLE:
</I>&gt;<i>  		/* ?? */
</I>&gt;<i>  		break;
</I>&gt;<i>  	}
</I>&gt;<i> --- a/src/target/arm_semihosting.c
</I>&gt;<i> +++ b/src/target/arm_semihosting.c
</I>&gt;<i> @@ -387,7 +387,7 @@ static int do_semihosting(struct target *target)
</I>&gt;<i>  	armv4_5-&gt;core_cache-&gt;reg_list[ARMV4_5_CPSR].dirty = 1;
</I>&gt;<i>  	armv4_5-&gt;core_mode = spsr &amp; 0x1f;
</I>&gt;<i>  	if (spsr &amp; 0x20)
</I>&gt;<i> -		armv4_5-&gt;core_state = ARMV4_5_STATE_THUMB;
</I>&gt;<i> +		armv4_5-&gt;core_state = ARM_STATE_THUMB;
</I>&gt;<i>  	return target_resume(target, 1, 0, 0, 0);
</I>&gt;<i>  }
</I>&gt;<i>  
</I>&gt;<i> --- a/src/target/arm_simulator.c
</I>&gt;<i> +++ b/src/target/arm_simulator.c
</I>&gt;<i> @@ -135,7 +135,7 @@ static uint32_t arm_shifter_operand(struct arm_sim_interface *sim,
</I>&gt;<i>  	uint32_t return_value;
</I>&gt;<i>  	int instruction_size;
</I>&gt;<i>  
</I>&gt;<i> -	if (sim-&gt;get_state(sim) == ARMV4_5_STATE_ARM)
</I>&gt;<i> +	if (sim-&gt;get_state(sim) == ARM_STATE_ARM)
</I>&gt;<i>  		instruction_size = 4;
</I>&gt;<i>  	else
</I>&gt;<i>  		instruction_size = 2;
</I>&gt;<i> @@ -286,7 +286,7 @@ int arm_simulate_step_core(struct target *target,
</I>&gt;<i>  	int instruction_size;
</I>&gt;<i>  	int retval = ERROR_OK;
</I>&gt;<i>  
</I>&gt;<i> -	if (sim-&gt;get_state(sim) == ARMV4_5_STATE_ARM)
</I>&gt;<i> +	if (sim-&gt;get_state(sim) == ARM_STATE_ARM)
</I>&gt;<i>  	{
</I>&gt;<i>  		uint32_t opcode;
</I>&gt;<i>  
</I>&gt;<i> @@ -392,7 +392,7 @@ int arm_simulate_step_core(struct target *target,
</I>&gt;<i>  			else if (instruction.type == ARM_BL)
</I>&gt;<i>  			{
</I>&gt;<i>  				uint32_t old_pc = sim-&gt;get_reg(sim, 15);
</I>&gt;<i> -				int T = (sim-&gt;get_state(sim) == ARMV4_5_STATE_THUMB);
</I>&gt;<i> +				int T = (sim-&gt;get_state(sim) == ARM_STATE_THUMB);
</I>&gt;<i>  				sim-&gt;set_reg_mode(sim, 14, old_pc + 4 + T);
</I>&gt;<i>  				sim-&gt;set_reg(sim, 15, target);
</I>&gt;<i>  			}
</I>&gt;<i> @@ -400,27 +400,27 @@ int arm_simulate_step_core(struct target *target,
</I>&gt;<i>  			{
</I>&gt;<i>  				if (target &amp; 0x1)
</I>&gt;<i>  				{
</I>&gt;<i> -					sim-&gt;set_state(sim, ARMV4_5_STATE_THUMB);
</I>&gt;<i> +					sim-&gt;set_state(sim, ARM_STATE_THUMB);
</I>&gt;<i>  				}
</I>&gt;<i>  				else
</I>&gt;<i>  				{
</I>&gt;<i> -					sim-&gt;set_state(sim, ARMV4_5_STATE_ARM);
</I>&gt;<i> +					sim-&gt;set_state(sim, ARM_STATE_ARM);
</I>&gt;<i>  				}
</I>&gt;<i>  				sim-&gt;set_reg(sim, 15, target &amp; 0xfffffffe);
</I>&gt;<i>  			}
</I>&gt;<i>  			else if (instruction.type == ARM_BLX)
</I>&gt;<i>  			{
</I>&gt;<i>  				uint32_t old_pc = sim-&gt;get_reg(sim, 15);
</I>&gt;<i> -				int T = (sim-&gt;get_state(sim) == ARMV4_5_STATE_THUMB);
</I>&gt;<i> +				int T = (sim-&gt;get_state(sim) == ARM_STATE_THUMB);
</I>&gt;<i>  				sim-&gt;set_reg_mode(sim, 14, old_pc + 4 + T);
</I>&gt;<i>  
</I>&gt;<i>  				if (target &amp; 0x1)
</I>&gt;<i>  				{
</I>&gt;<i> -					sim-&gt;set_state(sim, ARMV4_5_STATE_THUMB);
</I>&gt;<i> +					sim-&gt;set_state(sim, ARM_STATE_THUMB);
</I>&gt;<i>  				}
</I>&gt;<i>  				else
</I>&gt;<i>  				{
</I>&gt;<i> -					sim-&gt;set_state(sim, ARMV4_5_STATE_ARM);
</I>&gt;<i> +					sim-&gt;set_state(sim, ARM_STATE_ARM);
</I>&gt;<i>  				}
</I>&gt;<i>  				sim-&gt;set_reg(sim, 15, target &amp; 0xfffffffe);
</I>&gt;<i>  			}
</I>&gt;<i> @@ -493,9 +493,9 @@ int arm_simulate_step_core(struct target *target,
</I>&gt;<i>  			if (instruction.info.data_proc.Rd == 15) {
</I>&gt;<i>  				sim-&gt;set_reg_mode(sim, 15, Rd &amp; ~1);
</I>&gt;<i>  				if (Rd &amp; 1)
</I>&gt;<i> -					sim-&gt;set_state(sim, ARMV4_5_STATE_THUMB);
</I>&gt;<i> +					sim-&gt;set_state(sim, ARM_STATE_THUMB);
</I>&gt;<i>  				else
</I>&gt;<i> -					sim-&gt;set_state(sim, ARMV4_5_STATE_ARM);
</I>&gt;<i> +					sim-&gt;set_state(sim, ARM_STATE_ARM);
</I>&gt;<i>  				return ERROR_OK;
</I>&gt;<i>  			}
</I>&gt;<i>  			sim-&gt;set_reg_mode(sim, instruction.info.data_proc.Rd, Rd);
</I>&gt;<i> @@ -605,9 +605,9 @@ int arm_simulate_step_core(struct target *target,
</I>&gt;<i>  			if (instruction.info.load_store.Rd == 15) {
</I>&gt;<i>  				sim-&gt;set_reg_mode(sim, 15, load_value &amp; ~1);
</I>&gt;<i>  				if (load_value &amp; 1)
</I>&gt;<i> -					sim-&gt;set_state(sim, ARMV4_5_STATE_THUMB);
</I>&gt;<i> +					sim-&gt;set_state(sim, ARM_STATE_THUMB);
</I>&gt;<i>  				else
</I>&gt;<i> -					sim-&gt;set_state(sim, ARMV4_5_STATE_ARM);
</I>&gt;<i> +					sim-&gt;set_state(sim, ARM_STATE_ARM);
</I>&gt;<i>  				return ERROR_OK;
</I>&gt;<i>  			}
</I>&gt;<i>  			sim-&gt;set_reg_mode(sim, instruction.info.load_store.Rd, load_value);
</I>&gt;<i> @@ -684,9 +684,9 @@ int arm_simulate_step_core(struct target *target,
</I>&gt;<i>  						uint32_t val = load_values[i];
</I>&gt;<i>  					sim-&gt;set_reg_mode(sim, i, val &amp; ~1);
</I>&gt;<i>  					if (val &amp; 1)
</I>&gt;<i> -						sim-&gt;set_state(sim, ARMV4_5_STATE_THUMB);
</I>&gt;<i> +						sim-&gt;set_state(sim, ARM_STATE_THUMB);
</I>&gt;<i>  					else
</I>&gt;<i> -						sim-&gt;set_state(sim, ARMV4_5_STATE_ARM);
</I>&gt;<i> +						sim-&gt;set_state(sim, ARM_STATE_ARM);
</I>&gt;<i>  					} else {
</I>&gt;<i>  						sim-&gt;set_reg_mode(sim, i, load_values[i]);
</I>&gt;<i>  					}
</I>&gt;<i> --- a/src/target/armv4_5.c
</I>&gt;<i> +++ b/src/target/armv4_5.c
</I>&gt;<i> @@ -381,13 +381,13 @@ void arm_set_cpsr(struct arm *arm, uint32_t cpsr)
</I>&gt;<i>  			LOG_WARNING(&quot;ThumbEE -- incomplete support&quot;);
</I>&gt;<i>  			state = ARM_STATE_THUMB_EE;
</I>&gt;<i>  		} else
</I>&gt;<i> -			state = ARMV4_5_STATE_THUMB;
</I>&gt;<i> +			state = ARM_STATE_THUMB;
</I>&gt;<i>  	} else {
</I>&gt;<i>  		if (cpsr &amp; (1 &lt;&lt; 24)) {	/* J */
</I>&gt;<i>  			LOG_ERROR(&quot;Jazelle state handling is BROKEN!&quot;);
</I>&gt;<i> -			state = ARMV4_5_STATE_JAZELLE;
</I>&gt;<i> +			state = ARM_STATE_JAZELLE;
</I>&gt;<i>  		} else
</I>&gt;<i> -			state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +			state = ARM_STATE_ARM;
</I>&gt;<i>  	}
</I>&gt;<i>  	arm-&gt;core_state = state;
</I>&gt;<i>  
</I>&gt;<i> @@ -710,11 +710,11 @@ COMMAND_HANDLER(handle_armv4_5_core_state_command)
</I>&gt;<i>  	{
</I>&gt;<i>  		if (strcmp(CMD_ARGV[0], &quot;arm&quot;) == 0)
</I>&gt;<i>  		{
</I>&gt;<i> -			armv4_5-&gt;core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +			armv4_5-&gt;core_state = ARM_STATE_ARM;
</I>&gt;<i>  		}
</I>&gt;<i>  		if (strcmp(CMD_ARGV[0], &quot;thumb&quot;) == 0)
</I>&gt;<i>  		{
</I>&gt;<i> -			armv4_5-&gt;core_state = ARMV4_5_STATE_THUMB;
</I>&gt;<i> +			armv4_5-&gt;core_state = ARM_STATE_THUMB;
</I>&gt;<i>  		}
</I>&gt;<i>  	}
</I>&gt;<i>  
</I>&gt;<i> @@ -1115,9 +1115,9 @@ int armv4_5_run_algorithm_inner(struct target *target,
</I>&gt;<i>  	}
</I>&gt;<i>  
</I>&gt;<i>  	armv4_5-&gt;core_state = armv4_5_algorithm_info-&gt;core_state;
</I>&gt;<i> -	if (armv4_5-&gt;core_state == ARMV4_5_STATE_ARM)
</I>&gt;<i> +	if (armv4_5-&gt;core_state == ARM_STATE_ARM)
</I>&gt;<i>  		exit_breakpoint_size = 4;
</I>&gt;<i> -	else if (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
</I>&gt;<i> +	else if (armv4_5-&gt;core_state == ARM_STATE_THUMB)
</I>&gt;<i>  		exit_breakpoint_size = 2;
</I>&gt;<i>  	else
</I>&gt;<i>  	{
</I>&gt;<i> @@ -1275,7 +1275,7 @@ int arm_checksum_memory(struct target *target,
</I>&gt;<i>  
</I>&gt;<i>  	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	armv4_5_info.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_IN_OUT);
</I>&gt;<i>  	init_reg_param(&amp;reg_params[1], &quot;r1&quot;, 32, PARAM_OUT);
</I>&gt;<i> @@ -1352,7 +1352,7 @@ int arm_blank_check_memory(struct target *target,
</I>&gt;<i>  
</I>&gt;<i>  	armv4_5_info.common_magic = ARMV4_5_COMMON_MAGIC;
</I>&gt;<i>  	armv4_5_info.core_mode = ARMV4_5_MODE_SVC;
</I>&gt;<i> -	armv4_5_info.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	armv4_5_info.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	init_reg_param(&amp;reg_params[0], &quot;r0&quot;, 32, PARAM_OUT);
</I>&gt;<i>  	buf_set_u32(reg_params[0].value, 0, 32, address);
</I>&gt;<i> --- a/src/target/armv4_5.h
</I>&gt;<i> +++ b/src/target/armv4_5.h
</I>&gt;<i> @@ -51,9 +51,9 @@ enum armv4_5_mode armv4_5_number_to_mode(int number);
</I>&gt;<i>  
</I>&gt;<i>  typedef enum armv4_5_state
</I>&gt;<i>  {
</I>&gt;<i> -	ARMV4_5_STATE_ARM,
</I>&gt;<i> -	ARMV4_5_STATE_THUMB,
</I>&gt;<i> -	ARMV4_5_STATE_JAZELLE,
</I>&gt;<i> +	ARM_STATE_ARM,
</I>&gt;<i> +	ARM_STATE_THUMB,
</I>&gt;<i> +	ARM_STATE_JAZELLE,
</I>&gt;<i>  	ARM_STATE_THUMB_EE,
</I>&gt;<i>  } armv4_5_state_t;
</I>&gt;<i>  
</I>&gt;<i> --- a/src/target/cortex_a8.c
</I>&gt;<i> +++ b/src/target/cortex_a8.c
</I>&gt;<i> @@ -705,17 +705,17 @@ static int cortex_a8_resume(struct target *target, int current,
</I>&gt;<i>  	 */
</I>&gt;<i>  	switch (armv4_5-&gt;core_state)
</I>&gt;<i>  	{
</I>&gt;<i> -	case ARMV4_5_STATE_ARM:
</I>&gt;<i> +	case ARM_STATE_ARM:
</I>&gt;<i>  		resume_pc &amp;= 0xFFFFFFFC;
</I>&gt;<i>  		break;
</I>&gt;<i> -	case ARMV4_5_STATE_THUMB:
</I>&gt;<i> +	case ARM_STATE_THUMB:
</I>&gt;<i>  	case ARM_STATE_THUMB_EE:
</I>&gt;<i>  		/* When the return address is loaded into PC
</I>&gt;<i>  		 * bit 0 must be 1 to stay in Thumb state
</I>&gt;<i>  		 */
</I>&gt;<i>  		resume_pc |= 0x1;
</I>&gt;<i>  		break;
</I>&gt;<i> -	case ARMV4_5_STATE_JAZELLE:
</I>&gt;<i> +	case ARM_STATE_JAZELLE:
</I>&gt;<i>  		LOG_ERROR(&quot;How do I resume into Jazelle state??&quot;);
</I>&gt;<i>  		return ERROR_FAIL;
</I>&gt;<i>  	}
</I>&gt;<i> @@ -974,7 +974,7 @@ static int cortex_a8_step(struct target *target, int current, uint32_t address,
</I>&gt;<i>  
</I>&gt;<i>  	/* Setup single step breakpoint */
</I>&gt;<i>  	stepbreakpoint.address = address;
</I>&gt;<i> -	stepbreakpoint.length = (armv4_5-&gt;core_state == ARMV4_5_STATE_THUMB)
</I>&gt;<i> +	stepbreakpoint.length = (armv4_5-&gt;core_state == ARM_STATE_THUMB)
</I>&gt;<i>  			? 2 : 4;
</I>&gt;<i>  	stepbreakpoint.type = BKPT_HARD;
</I>&gt;<i>  	stepbreakpoint.set = 0;
</I>&gt;<i> --- a/src/target/etm.c
</I>&gt;<i> +++ b/src/target/etm.c
</I>&gt;<i> @@ -659,7 +659,7 @@ static int etm_read_instruction(struct etm_context *ctx, struct arm_instruction
</I>&gt;<i>  		return ERROR_TRACE_INSTRUCTION_UNAVAILABLE;
</I>&gt;<i>  	}
</I>&gt;<i>  
</I>&gt;<i> -	if (ctx-&gt;core_state == ARMV4_5_STATE_ARM)
</I>&gt;<i> +	if (ctx-&gt;core_state == ARM_STATE_ARM)
</I>&gt;<i>  	{
</I>&gt;<i>  		uint8_t buf[4];
</I>&gt;<i>  		if ((retval = image_read_section(ctx-&gt;image, section,
</I>&gt;<i> @@ -672,7 +672,7 @@ static int etm_read_instruction(struct etm_context *ctx, struct arm_instruction
</I>&gt;<i>  		opcode = target_buffer_get_u32(ctx-&gt;target, buf);
</I>&gt;<i>  		arm_evaluate_opcode(opcode, ctx-&gt;current_pc, instruction);
</I>&gt;<i>  	}
</I>&gt;<i> -	else if (ctx-&gt;core_state == ARMV4_5_STATE_THUMB)
</I>&gt;<i> +	else if (ctx-&gt;core_state == ARM_STATE_THUMB)
</I>&gt;<i>  	{
</I>&gt;<i>  		uint8_t buf[2];
</I>&gt;<i>  		if ((retval = image_read_section(ctx-&gt;image, section,
</I>&gt;<i> @@ -685,7 +685,7 @@ static int etm_read_instruction(struct etm_context *ctx, struct arm_instruction
</I>&gt;<i>  		opcode = target_buffer_get_u16(ctx-&gt;target, buf);
</I>&gt;<i>  		thumb_evaluate_opcode(opcode, ctx-&gt;current_pc, instruction);
</I>&gt;<i>  	}
</I>&gt;<i> -	else if (ctx-&gt;core_state == ARMV4_5_STATE_JAZELLE)
</I>&gt;<i> +	else if (ctx-&gt;core_state == ARM_STATE_JAZELLE)
</I>&gt;<i>  	{
</I>&gt;<i>  		LOG_ERROR(&quot;BUG: tracing of jazelle code not supported&quot;);
</I>&gt;<i>  		return ERROR_FAIL;
</I>&gt;<i> @@ -829,7 +829,7 @@ static int etmv1_branch_address(struct etm_context *ctx)
</I>&gt;<i>  	/* if a full address was output, we might have branched into Jazelle state */
</I>&gt;<i>  	if ((shift == 32) &amp;&amp; (packet &amp; 0x80))
</I>&gt;<i>  	{
</I>&gt;<i> -		ctx-&gt;core_state = ARMV4_5_STATE_JAZELLE;
</I>&gt;<i> +		ctx-&gt;core_state = ARM_STATE_JAZELLE;
</I>&gt;<i>  	}
</I>&gt;<i>  	else
</I>&gt;<i>  	{
</I>&gt;<i> @@ -837,12 +837,12 @@ static int etmv1_branch_address(struct etm_context *ctx)
</I>&gt;<i>  		 * encoded in bit 0 of the branch target address */
</I>&gt;<i>  		if (ctx-&gt;last_branch &amp; 0x1)
</I>&gt;<i>  		{
</I>&gt;<i> -			ctx-&gt;core_state = ARMV4_5_STATE_THUMB;
</I>&gt;<i> +			ctx-&gt;core_state = ARM_STATE_THUMB;
</I>&gt;<i>  			ctx-&gt;last_branch &amp;= ~0x1;
</I>&gt;<i>  		}
</I>&gt;<i>  		else
</I>&gt;<i>  		{
</I>&gt;<i> -			ctx-&gt;core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +			ctx-&gt;core_state = ARM_STATE_ARM;
</I>&gt;<i>  			ctx-&gt;last_branch &amp;= ~0x3;
</I>&gt;<i>  		}
</I>&gt;<i>  	}
</I>&gt;<i> @@ -1126,12 +1126,12 @@ static int etmv1_analyze_trace(struct etm_context *ctx, struct command_context *
</I>&gt;<i>  			}
</I>&gt;<i>  			else
</I>&gt;<i>  			{
</I>&gt;<i> -				next_pc += (ctx-&gt;core_state == ARMV4_5_STATE_ARM) ? 4 : 2;
</I>&gt;<i> +				next_pc += (ctx-&gt;core_state == ARM_STATE_ARM) ? 4 : 2;
</I>&gt;<i>  			}
</I>&gt;<i>  		}
</I>&gt;<i>  		else if (pipestat == STAT_IN)
</I>&gt;<i>  		{
</I>&gt;<i> -			next_pc += (ctx-&gt;core_state == ARMV4_5_STATE_ARM) ? 4 : 2;
</I>&gt;<i> +			next_pc += (ctx-&gt;core_state == ARM_STATE_ARM) ? 4 : 2;
</I>&gt;<i>  		}
</I>&gt;<i>  
</I>&gt;<i>  		if ((pipestat != STAT_TD) &amp;&amp; (pipestat != STAT_WT))
</I>&gt;<i> @@ -1498,7 +1498,7 @@ COMMAND_HANDLER(handle_etm_config_command)
</I>&gt;<i>  	etm_ctx-&gt;trigger_percent = 50;
</I>&gt;<i>  	etm_ctx-&gt;trace_data = NULL;
</I>&gt;<i>  	etm_ctx-&gt;portmode = portmode;
</I>&gt;<i> -	etm_ctx-&gt;core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	etm_ctx-&gt;core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	arm-&gt;etm = etm_ctx;
</I>&gt;<i>  
</I>&gt;<i> --- a/src/target/feroceon.c
</I>&gt;<i> +++ b/src/target/feroceon.c
</I>&gt;<i> @@ -524,7 +524,7 @@ int feroceon_bulk_write_memory(struct target *target, uint32_t address, uint32_t
</I>&gt;<i>  	buf_set_u32(armv4_5-&gt;core_cache-&gt;reg_list[0].value, 0, 32, address);
</I>&gt;<i>  	armv4_5-&gt;core_cache-&gt;reg_list[0].valid = 1;
</I>&gt;<i>  	armv4_5-&gt;core_cache-&gt;reg_list[0].dirty = 1;
</I>&gt;<i> -	armv4_5-&gt;core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +	armv4_5-&gt;core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  	embeddedice_write_reg(&amp;arm7_9-&gt;eice_cache-&gt;reg_list[EICE_COMMS_DATA], 0);
</I>&gt;<i>  	arm7_9_resume(target, 0, arm7_9-&gt;dcc_working_area-&gt;address, 1, 1);
</I>&gt;<i> --- a/src/target/xscale.c
</I>&gt;<i> +++ b/src/target/xscale.c
</I>&gt;<i> @@ -2607,7 +2607,7 @@ static int xscale_read_instruction(struct target *target,
</I>&gt;<i>  		return ERROR_TRACE_INSTRUCTION_UNAVAILABLE;
</I>&gt;<i>  	}
</I>&gt;<i>  
</I>&gt;<i> -	if (xscale-&gt;trace.core_state == ARMV4_5_STATE_ARM)
</I>&gt;<i> +	if (xscale-&gt;trace.core_state == ARM_STATE_ARM)
</I>&gt;<i>  	{
</I>&gt;<i>  		uint8_t buf[4];
</I>&gt;<i>  		if ((retval = image_read_section(xscale-&gt;trace.image, section,
</I>&gt;<i> @@ -2620,7 +2620,7 @@ static int xscale_read_instruction(struct target *target,
</I>&gt;<i>  		opcode = target_buffer_get_u32(target, buf);
</I>&gt;<i>  		arm_evaluate_opcode(opcode, xscale-&gt;trace.current_pc, instruction);
</I>&gt;<i>  	}
</I>&gt;<i> -	else if (xscale-&gt;trace.core_state == ARMV4_5_STATE_THUMB)
</I>&gt;<i> +	else if (xscale-&gt;trace.core_state == ARM_STATE_THUMB)
</I>&gt;<i>  	{
</I>&gt;<i>  		uint8_t buf[2];
</I>&gt;<i>  		if ((retval = image_read_section(xscale-&gt;trace.image, section,
</I>&gt;<i> @@ -2672,7 +2672,7 @@ static int xscale_analyze_trace(struct target *target, struct command_context *c
</I>&gt;<i>  		int rollover;
</I>&gt;<i>  		int branch;
</I>&gt;<i>  		int exception;
</I>&gt;<i> -		xscale-&gt;trace.core_state = ARMV4_5_STATE_ARM;
</I>&gt;<i> +		xscale-&gt;trace.core_state = ARM_STATE_ARM;
</I>&gt;<i>  
</I>&gt;<i>  		chkpt = 0;
</I>&gt;<i>  		rollover = 0;
</I>&gt;<i> @@ -2806,7 +2806,7 @@ static int xscale_analyze_trace(struct target *target, struct command_context *c
</I>&gt;<i>  					}
</I>&gt;<i>  					else
</I>&gt;<i>  					{
</I>&gt;<i> -						xscale-&gt;trace.current_pc += (xscale-&gt;trace.core_state == ARMV4_5_STATE_ARM) ? 4 : 2;
</I>&gt;<i> +						xscale-&gt;trace.current_pc += (xscale-&gt;trace.core_state == ARM_STATE_ARM) ? 4 : 2;
</I>&gt;<i>  					}
</I>&gt;<i>  					command_print(cmd_ctx, &quot;%s&quot;, instruction.text);
</I>&gt;<i>  				}
</I>&gt;<i> @@ -2821,7 +2821,7 @@ static int xscale_analyze_trace(struct target *target, struct command_context *c
</I>&gt;<i>  			}
</I>&gt;<i>  		}
</I>&gt;<i>  
</I>&gt;<i> -		for (; xscale-&gt;trace.current_pc &lt; trace_data-&gt;last_instruction; xscale-&gt;trace.current_pc += (xscale-&gt;trace.core_state == ARMV4_5_STATE_ARM) ? 4 : 2)
</I>&gt;<i> +		for (; xscale-&gt;trace.current_pc &lt; trace_data-&gt;last_instruction; xscale-&gt;trace.current_pc += (xscale-&gt;trace.core_state == ARM_STATE_ARM) ? 4 : 2)
</I>&gt;<i>  		{
</I>&gt;<i>  			struct arm_instruction instruction;
</I>&gt;<i>  			if ((retval = xscale_read_instruction(target, &amp;instruction)) != ERROR_OK)
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Openocd-development mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">Openocd-development at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">https://lists.berlios.de/mailman/listinfo/openocd-development</A>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013355.html">[Openocd-development] [patch 1/N] ARM: renaming
</A></li>
	<LI>Next message: <A HREF="013357.html">[Openocd-development] [patch 1/N] ARM: renaming
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13356">[ date ]</a>
              <a href="thread.html#13356">[ thread ]</a>
              <a href="subject.html#13356">[ subject ]</a>
              <a href="author.html#13356">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
