<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] new flash_write patch
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20new%20flash_write%20patch&In-Reply-To=%3C200708161113.58578.Dominic.Rath%40gmx.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000291.html">
   <LINK REL="Next"  HREF="000293.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] new flash_write patch</H1>
    <B>Dominic Rath</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20new%20flash_write%20patch&In-Reply-To=%3C200708161113.58578.Dominic.Rath%40gmx.de%3E"
       TITLE="[Openocd-development] new flash_write patch">Dominic.Rath at gmx.de
       </A><BR>
    <I>Thu Aug 16 11:13:58 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000291.html">[Openocd-development] new flash_write patch
</A></li>
        <LI>Next message: <A HREF="000293.html">[Openocd-development] new flash_write patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#292">[ date ]</a>
              <a href="thread.html#292">[ thread ]</a>
              <a href="subject.html#292">[ subject ]</a>
              <a href="author.html#292">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Pavel,

thank you for the patch, I applied it with some whitespace changes (tabs for 
spaces, no other statements in the same line as an 'if').

Best regards,

Dominic

On Wednesday 15 August 2007 19:12:27 Pavel Chromy wrote:
&gt;<i> Hello Dominic and the list!
</I>&gt;<i>
</I>&gt;<i> I have made some work on flash_write() function:
</I>&gt;<i>
</I>&gt;<i> Number of nested loops reduced to just 2 by concatenating just sections
</I>&gt;<i> which at least partly fall into the same bank as the first section in the
</I>&gt;<i> run, I hope this would make the code more readable.
</I>&gt;<i>
</I>&gt;<i> I finally decided not to sort the sections by address inside flash_write()
</I>&gt;<i> as we discussed, but there is a test and a warning if a section is out of
</I>&gt;<i> order. I believe that sorting of sections is rather job for some image
</I>&gt;<i> handling function - there may be image sorting function in the future.
</I>&gt;<i> The same applies to empty sections, a warning is issued in such case.
</I>&gt;<i>
</I>&gt;<i> &quot;image_size&quot; was renamed to &quot;written&quot; as it indicates amount of data
</I>&gt;<i> successfully written to the flash, skipped sections (i.e. RAM sections) are
</I>&gt;<i> not taken into account.
</I>&gt;<i>
</I>&gt;<i> Pointer parameter &quot;u32 *failed&quot; changed to &quot;int *failed&quot;, so that the array
</I>&gt;<i> the error code returned by flash driver may be stored for each section
</I>&gt;<i> directly (possible future improvement). (the patch includes changes in
</I>&gt;<i> other functions reflecting this)
</I>&gt;<i>
</I>&gt;<i> Pointer parameters written, err_str, failed are considered optional and may
</I>&gt;<i> be NULL.
</I>&gt;<i>
</I>&gt;<i> Bugs in flash_write () in revision 195 fixed by this patch:
</I>&gt;<i> - may stuck in an infinite loop if section was to be skipped because of no
</I>&gt;<i> corresponding bank was found. (line 779). - memory leak on line 799 (buffer
</I>&gt;<i> not freed before return)
</I>&gt;<i> - the test on line 803 should be &lt;= (less than or equal) otherwise there
</I>&gt;<i> may be an infinite loop
</I>&gt;<i>
</I>&gt;<i> I hope this patch is helpful and without conflicts.
</I>&gt;<i>
</I>&gt;<i> Best Regards,
</I>&gt;<i>
</I>&gt;<i> Pavel
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000291.html">[Openocd-development] new flash_write patch
</A></li>
	<LI>Next message: <A HREF="000293.html">[Openocd-development] new flash_write patch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#292">[ date ]</a>
              <a href="thread.html#292">[ thread ]</a>
              <a href="subject.html#292">[ subject ]</a>
              <a href="author.html#292">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
