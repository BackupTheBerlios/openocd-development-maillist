<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openocd-development] Flash Write Error in telnet
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openocd-development/2008-February/index.html" >
   <LINK REL="made" HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Flash%20Write%20Error%20in%20telnet&In-Reply-To=%3C5BF78BCE8D9BF14A83F836BD9E3916BA053E02%40blrms.slti.sanyo.co.in%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000933.html">
   <LINK REL="Next"  HREF="000942.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openocd-development] Flash Write Error in telnet</H1>
    <B>Gururaja Hebbar K R</B> 
    <A HREF="mailto:openocd-development%40lists.berlios.de?Subject=Re%3A%20%5BOpenocd-development%5D%20Flash%20Write%20Error%20in%20telnet&In-Reply-To=%3C5BF78BCE8D9BF14A83F836BD9E3916BA053E02%40blrms.slti.sanyo.co.in%3E"
       TITLE="[Openocd-development] Flash Write Error in telnet">gururajakr at sanyo.co.in
       </A><BR>
    <I>Tue Feb 19 00:57:01 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000933.html">[Openocd-development] Cosmetic change to armv4_5.c
</A></li>
        <LI>Next message: <A HREF="000942.html">[Openocd-development] Flash Write Error in telnet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#940">[ date ]</a>
              <a href="thread.html#940">[ thread ]</a>
              <a href="subject.html#940">[ subject ]</a>
              <a href="author.html#940">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> 
Hi,

1st Thanks for the wonderful program OpenOCD.


Now i am working on a customized Variant of arm versatile board. We have
spansion s29gl128n 16 mb flash on board. when try to write small file to
flash in telnet i get below error 

//////////////////////////
&gt;<i> flash write_binary 0 ram.gdb 0xc0000
</I>BUG: debug re-entry from system speed access shouldn't be handled here
invalid mode value encountered cpsr contains invalid mode value -
communication failure timeout waiting for algorithm to complete, trying
to halt target Target 0 halted target halted in ARM state due to debug
request, current mode: Abort
cpsr: 0x200000d7 pc: 0x2c000390
MMU: disabled, D-Cache: disabled, I-Cache: disabled failed writing file
ram.gdb to flash bank 0 at offset 0x000c0000 flash program error wrote
424 byte from file ram.gdb to flash bank 0 at offset 0x000c0000 in 13s
868000us (0.029857 kb/s)

//////////////////////////////////////////////

When writing to flash failed, why is it saying that flash write is
complete. 

Also what Openocd server output. 

Info:    118 1203387946 server.c:67 add_connection(): accepted 'telnet'
connection from 0
Error:   307 1203388085 cfi.c:888 cfi_protect(): cfi primary command set
2 unsupported
Error:   456 1203388350 arm926ejs.c:329
arm926ejs_examine_debug_reason(): BUG: debug re-entry from system speed
access shouldn't be handled here
Error:   458 1203388350 armv4_5.c:186 armv4_5_mode_to_number(): invalid
mode value encountered
Error:   459 1203388350 arm7_9_common.c:1096 arm7_9_debug_entry(): cpsr
contains invalid mode value - communication failure
Error:   1460 1203388363 armv4_5.c:591 armv4_5_run_algorithm(): timeout
waiting for algorithm to complete, trying to halt target



Regards
Gururaja

-----Original Message-----
From: <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">openocd-development-bounces at lists.berlios.de</A>
[mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">openocd-development-bounces at lists.berlios.de</A>] On Behalf Of
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">openocd-development-request at lists.berlios.de</A>
Sent: Sunday, February 17, 2008 11:59 PM
To: <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">openocd-development at lists.berlios.de</A>
Subject: Openocd-development Digest, Vol 17, Issue 33

Send Openocd-development mailing list submissions to
	<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">openocd-development at lists.berlios.de</A>

To subscribe or unsubscribe via the World Wide Web, visit
	<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">https://lists.berlios.de/mailman/listinfo/openocd-development</A>
or, via email, send a message with subject or body 'help' to
	<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">openocd-development-request at lists.berlios.de</A>

You can reach the person managing the list at
	<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">openocd-development-owner at lists.berlios.de</A>

When replying, please edit your Subject line so it is more specific than
&quot;Re: Contents of Openocd-development digest...&quot;


Today's Topics:

   1. More GDB fixes ( ?yvind Harboe )
   2. Re: GDB remote protocol,	memory read/write accesses and the
      horrid truth (Dominic Rath)
   3. Re: More GDB fixes (Dominic Rath)
   4. Re: More GDB fixes ( ?yvind Harboe )


----------------------------------------------------------------------

Message: 1
Date: Mon, 18 Feb 2008 08:42:32 +0100
From: &quot; ?yvind Harboe &quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">oyvind.harboe at zylin.com</A>&gt;
Subject: [Openocd-development] More GDB fixes
To: Openocd-Dev &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">openocd-development at lists.berlios.de</A>&gt;
Message-ID:
	&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">c09652430802172342w737966abj94a2dcf8e0918dca at mail.gmail.com</A>&gt;
Content-Type: text/plain; charset=&quot;iso-8859-1&quot;

- Added a &quot;User:&quot; debug level. These are messages that are intended for
  the user and are part of normal operation.
- Faster DEBUG/INFO() when they are disabled
- target_read/write_buffer() now uses 16 and 32 bit access for single
  word aligned requests. Other requests are serviced as quickly
  as possible.
- Workaround for GDB bug 2395 always enabled. No options. This
  kludge will be removed once GDB is fixed. There is nothing gained
  by confusing the user with the details here and OpenOCD developers
  are acutely aware of the problem.
- *much* faster read/write GDB packets, removing timeout problems.
- GDB read/write packets w/single word aligned 32/16 bit access
  now use 32/16 bit word access.
- working area can now be changed on the fly. Provides a way to
  move working area about as MMU is enabled/disabled.
- cleaned up error messages for verify_image.

--
?yvind Harboe
<A HREF="http://www.zylin.com">http://www.zylin.com</A> - eCos ARM &amp; FPGA  developer kit
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: moregdbfixes.txt
Url:
<A HREF="https://lists.berlios.de/pipermail/openocd-development/attachments/20080">https://lists.berlios.de/pipermail/openocd-development/attachments/20080</A>
218/4c4245d2/attachment-0001.txt 

------------------------------

Message: 2
Date: Mon, 18 Feb 2008 08:43:12 +0100
From: Dominic Rath &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">Dominic.Rath at gmx.de</A>&gt;
Subject: Re: [Openocd-development] GDB remote protocol,	memory
	read/write accesses and the horrid truth
To: <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">openocd-development at lists.berlios.de</A>
Message-ID: &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">200802180843.12734.Dominic.Rath at gmx.de</A>&gt;
Content-Type: text/plain;  charset=&quot;iso-8859-1&quot;

On Sunday 17 February 2008 20:40:23 you wrote:
&gt;<i> On Feb 17, 2008 5:56 PM, Dominic Rath &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">Dominic.Rath at gmx.de</A>&gt; wrote:
</I>&gt;<i> &gt; On Sunday 17 February 2008 16:12:22 ?yvind Harboe wrote:
</I>&gt;<i> &gt; &gt; A summary of the situation and a suggestion for various remedies.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I've made some modifications to GDB in my latest patch without 
</I>&gt;<i> &gt; &gt; perhaps explaining enough about *why* I ended up making these 
</I>&gt;<i> &gt; &gt; changes. I understand the negative consequences that have been 
</I>&gt;<i> &gt; &gt; raised in the mailing list and I sympathize, but taking the full 
</I>&gt;<i> &gt; &gt; picture into account, I landed on making some changes to GDB 
</I>&gt;<i> &gt; &gt; server.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 1. GDB has a bug where it will fail in various ways if the GDB 
</I>&gt;<i> &gt; &gt; remote server responds with an error condition for reading memory.
</I>&gt;<i> &gt; &gt; This is a known problem in GDB. The quixotic attitude is that 
</I>&gt;<i> &gt; &gt; OpenOCD should report an error and the problem should be fixed in 
</I>&gt;<i> &gt; &gt; GDB. My view on this is that the average user stands no hope in 
</I>&gt;<i> &gt; &gt; hell of understanding the lockups that result in e.g. mouseover 
</I>&gt;<i> &gt; &gt; evaluation of local variables that point to outer space when 
</I>&gt;<i> &gt; &gt; debugging -O3 compiled applications, or e.g. the failure to 
</I>&gt;<i> &gt; &gt; evaluate stack traces. The problem has been duely reported and 
</I>&gt;<i> &gt; &gt; recognized by the GDB guys. Once GDB is fixed in CVS HEAD, OpenOCD
</I>
&gt;<i> &gt; &gt; should have it's kludge removed. Feel free to follow up on this 
</I>&gt;<i> &gt; &gt; one, with the GDB guys. I failed to come up with a pactch, it's 
</I>&gt;<i> &gt; &gt; quite involved and I wouldn't hold my breath waiting for this to 
</I>&gt;<i> &gt; &gt; be fixed &quot;properly&quot;.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt;<A HREF="http://sourceware.org/cgi-bin/gnatsweb.pl?cmd=view%20audit-trail&amp;da">http://sourceware.org/cgi-bin/gnatsweb.pl?cmd=view%20audit-trail&amp;da</A>
</I>&gt;<i> &gt; &gt;taba
</I>&gt;<i> &gt; &gt;se=g db&amp;pr=2395
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; As I said in my other post (regarding the bkpts), this change is 
</I>&gt;<i> &gt; fine with me, even if it breaks existing non-GDB users of the GDB
</I>server.
&gt;<i> &gt;
</I>&gt;<i> &gt; But would it be a lot of trouble to make this configurable, with a 
</I>&gt;<i> &gt; default of return 0x0 and no error? The majority of our users 
</I>&gt;<i> &gt; certainly uses GDB, but I would like to preserve the existing 
</I>&gt;<i> &gt; behaviour if possible, especially as there's going to be a long 
</I>&gt;<i> &gt; period where people use both compliant and non-compliant versions of
</I>
&gt;<i> &gt; GDB (after this got fixed in GDB).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I know you're against additional configuration options, but I guess 
</I>&gt;<i> &gt; this is a legitimate reason for adding another one.
</I>&gt;<i>
</I>&gt;<i> I don't see a compelling specific reason to add such an option at this
</I>
&gt;<i> point.
</I>&gt;<i>
</I>&gt;<i> What's the harm in adding this option only after we discover a clear 
</I>&gt;<i> an present need for it?
</I>&gt;<i>
</I>&gt;<i> &gt; &gt; 2. GDB has a default 2 second timeout for packets. When reading 
</I>&gt;<i> &gt; &gt; large amounts of memory from the target GDB will split these reads
</I>
&gt;<i> &gt; &gt; into smaller memory reads to avoid running into a timeout. The 
</I>&gt;<i> &gt; &gt; default is 8191 bytes(which is *strange*). Before I modified 
</I>&gt;<i> &gt; &gt; OpenOCD, this would result in 8191 *byte* reads from the 
</I>&gt;<i> &gt; &gt; target(and a timeout), instead of a 8198 32 bit bulk read + some 
</I>&gt;<i> &gt; &gt; byte reads. It is *crucial* to understand that users of
</I>&gt;<i> &gt; &gt; Eclipse+GDB+OpenOCD have *very* little control(or even
</I>&gt;<i> &gt; &gt; understanding) over what sort of queries that go to the target. A 
</I>&gt;<i> &gt; &gt; mouseover can evaluate e.g. a global array which can easily be
</I>&gt;<i> &gt; &gt; &gt;8191 bytes. It is therefore important to service 8191 byte
</I>&gt;<i> &gt; &gt; request faster than 2 seconds(achieved via bulk reads), or the 
</I>&gt;<i> &gt; &gt; user is in for some nasty debugging of OpenOCD, following subtle 
</I>&gt;<i> &gt; &gt; hints from Eclipse and digging up obscure GDB options. Oh and this
</I>
&gt;<i> &gt; &gt; fix makes Eclipse+GDB
</I>&gt;<i> &gt; &gt; *much* snappier.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I usually had the remote timeouts increased to be able to attach a 
</I>&gt;<i> &gt; gdb to OpenOCD itself so I rarely noticed this. I certainly didn't
</I>ever &quot;use&quot;
&gt;<i> &gt; Eclipse ;). I just don't agree about the exact change, see below.
</I>&gt;<i>
</I>&gt;<i> I'm not worried about Dominic figuring out how to get OpenOCD to work
</I>&gt;<i> :-) I made this change after gathering some data on on how mere 
</I>&gt;<i> mortals were failing to get Eclipse + OpenOCD to play together. It's 
</I>&gt;<i> perfectly straighftward to fix the OpenOCD GDB server to work well 
</I>&gt;<i> within the limits of the default sensible 2 second timeout.
</I>&gt;<i>
</I>&gt;<i> &gt; &gt; 3. The GDB remote protocol does not guarantee what access type is 
</I>&gt;<i> &gt; &gt; to be used. This can be achieved using &quot;monitor mwX&quot;
</I>&gt;<i> &gt; &gt; commands. To be guaranteed a certain access type &quot;monitor mwX&quot;
</I>&gt;<i> &gt; &gt; *must* be used. Currently target_read/write_buffer() will not use
</I>&gt;<i> &gt; &gt; 16 and 32 bit access for aligned single word accesses and there is
</I>
&gt;<i> &gt; &gt; no particular reason not to do so. I therefore suggest that GDB 
</I>&gt;<i> &gt; &gt; server should use target_read/write_buffer() and that
</I>&gt;<i> &gt; &gt; target_read/write_buffer() should be changed to guarantee use of
</I>&gt;<i> &gt; &gt; 16 and 32 bit accesses for single word accesses. NB!
</I>&gt;<i> &gt; &gt; for &gt;1 word access, target_read/write_buffer() should use the 
</I>&gt;<i> &gt; &gt; fastest possible read/write, ditto for unaligned accesses, this to
</I>
&gt;<i> &gt; &gt; maximize throughput.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; target_read_buffer only guarantees to deliver bytes in the same 
</I>&gt;<i> &gt; order as they're found on the target, and it does so as fast as 
</I>&gt;<i> &gt; possible (if it doesn't it needs fixing).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The target-&gt;read_memory functions guarantee an access of a certain
</I>size.
&gt;<i> &gt; Currently that's limited to aligned accesses, but newer ARM 
</I>&gt;<i> &gt; architectures define unaligned accesses, too.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I don't see where we gain anything by moving some implied behaviour 
</I>&gt;<i> &gt; from the GDB server to the target_read_buffer function? IMHO it 
</I>&gt;<i> &gt; belongs to the GDB server, because we assume this is what GDB wants.
</I>&gt;<i>
</I>&gt;<i> At this point my only requirement that is based on observable problems
</I>
&gt;<i> is that the OpenOCD GDB server needs to service memory read/write 
</I>&gt;<i> packets as quickly as possible, otherwise OpenOCD will be broken out 
</I>&gt;<i> of the box. A timeout being indistinguishable from incorrect operation
</I>
&gt;<i> from the users point of view.
</I>
All right, so lets use target_read_buffer for everything except 1, 2 and
4 byte accesses.

&gt;<i> W.r.t. alignment of accesses, you're arguing above that only the 
</I>&gt;<i> target can know the alignment rules. That would imply that the target 
</I>&gt;<i> should figure out what type of accesses to service a GDB request with.
</I>
Right - this is problematic, because either the
target_t-&gt;read/write_memory interface needs to be enhanced to translate
unsupported accesses to something it can support, or GDB needs to
evaluate the ERROR_TARGET_UNALIGNED_ACCESS return value, and fall back
to the target_read_buffer function if necessary.
Currently I'd prefer the latter.

Regards,

Dominic


------------------------------

Message: 3
Date: Mon, 18 Feb 2008 08:50:27 +0100
From: Dominic Rath &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">Dominic.Rath at gmx.de</A>&gt;
Subject: Re: [Openocd-development] More GDB fixes
To: <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">openocd-development at lists.berlios.de</A>
Message-ID: &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">200802180850.27729.Dominic.Rath at gmx.de</A>&gt;
Content-Type: text/plain;  charset=&quot;iso-8859-15&quot;

On Monday 18 February 2008 08:42:32 ?yvind Harboe wrote:
&gt;<i> - Added a &quot;User:&quot; debug level. These are messages that are intended
</I>for
&gt;<i>   the user and are part of normal operation.
</I>
ACK

&gt;<i> - Faster DEBUG/INFO() when they are disabled
</I>
ACK

&gt;<i> - target_read/write_buffer() now uses 16 and 32 bit access for single
</I>&gt;<i>   word aligned requests. Other requests are serviced as quickly
</I>&gt;<i>   as possible.
</I>
Whatever - it results in the inteded behaviour. ACK

&gt;<i> - Workaround for GDB bug 2395 always enabled. No options. This
</I>&gt;<i>   kludge will be removed once GDB is fixed. There is nothing gained
</I>&gt;<i>   by confusing the user with the details here and OpenOCD developers
</I>&gt;<i>   are acutely aware of the problem.
</I>
NAK - there are existing users of the OpenOCD remote protocol that
evaluate the error responses, and I don't want to lock them out for no
reason other than saving a config option.

&gt;<i> - *much* faster read/write GDB packets, removing timeout problems.
</I>&gt;<i> - GDB read/write packets w/single word aligned 32/16 bit access
</I>&gt;<i>   now use 32/16 bit word access.
</I>
ACK and ACK, but I suppose that's the result of using
target_read/write_buffer, right?

&gt;<i> - working area can now be changed on the fly. Provides a way to
</I>&gt;<i>   move working area about as MMU is enabled/disabled.
</I>
ACK

&gt;<i> - cleaned up error messages for verify_image.
</I>
ACK


------------------------------

Message: 4
Date: Mon, 18 Feb 2008 08:57:36 +0100
From: &quot; ?yvind Harboe &quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">oyvind.harboe at zylin.com</A>&gt;
Subject: Re: [Openocd-development] More GDB fixes
To: &quot;Dominic Rath&quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">Dominic.Rath at gmx.de</A>&gt;
Cc: <A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">openocd-development at lists.berlios.de</A>
Message-ID:
	&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">c09652430802172357m43cd8c19v5f6d612507f89fd7 at mail.gmail.com</A>&gt;
Content-Type: text/plain; charset=ISO-8859-1

&gt;<i> &gt; - Workaround for GDB bug 2395 always enabled. No options. This
</I>&gt;<i> &gt;   kludge will be removed once GDB is fixed. There is nothing gained
</I>&gt;<i> &gt;   by confusing the user with the details here and OpenOCD developers
</I>&gt;<i> &gt;   are acutely aware of the problem.
</I>&gt;<i>
</I>&gt;<i> NAK - there are existing users of the OpenOCD remote protocol that 
</I>&gt;<i> evaluate the error responses, and I don't want to lock them out for no
</I>
&gt;<i> reason other than saving a config option.
</I>
Do we have any evidence that this will cause a problem? If not, then we
can change the behaviour to work around the GDB bug and add the option
*if* anyone needs it *after* receiving evidence that this is a problem.

I don't see the problem with letting this option cool of for a week or
two before we add it.

&gt;<i> &gt; - *much* faster read/write GDB packets, removing timeout problems.
</I>&gt;<i> &gt; - GDB read/write packets w/single word aligned 32/16 bit access
</I>&gt;<i> &gt;   now use 32/16 bit word access.
</I>&gt;<i>
</I>&gt;<i> ACK and ACK, but I suppose that's the result of using 
</I>&gt;<i> target_read/write_buffer, right?
</I>
Yes.


--
?yvind Harboe
<A HREF="http://www.zylin.com">http://www.zylin.com</A> - eCos ARM &amp; FPGA  developer kit


------------------------------

_______________________________________________
Openocd-development mailing list
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">Openocd-development at lists.berlios.de</A>
<A HREF="https://lists.berlios.de/mailman/listinfo/openocd-development">https://lists.berlios.de/mailman/listinfo/openocd-development</A>


End of Openocd-development Digest, Vol 17, Issue 33
***************************************************

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000933.html">[Openocd-development] Cosmetic change to armv4_5.c
</A></li>
	<LI>Next message: <A HREF="000942.html">[Openocd-development] Flash Write Error in telnet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#940">[ date ]</a>
              <a href="thread.html#940">[ thread ]</a>
              <a href="subject.html#940">[ subject ]</a>
              <a href="author.html#940">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openocd-development">More information about the Openocd-development
mailing list</a><br>
</body></html>
